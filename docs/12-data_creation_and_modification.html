<head>
    <meta charset="UTF-8">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=PT+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="chapter.css" />
    <link rel="stylesheet" href="pygments.css" />

    <title>Data creation and modification - Manticore Search 6.2.12 (Aug 23, 2023)</title>
</head>

<body>
    
    <section class="chapter-section" id="toc-12-data_creation_and_modification">
        <header>
            <a class="chapter-link" href="#toc-12-data_creation_and_modification"> ¶ 12</a>

            
            <h1 id="data-creation-and-modification">Data creation and modification</h1>
            
        </header>

        
        
<p>You can add, update, replace, and delete your indexed data using different ways provided by Manticore. Manticore supports working with external storages such as databases, XML, CSV, and TSV documents. For insert and delete operations, a <a href="../12-data_creation_and_modification.html#toc-12.05-transactions">transaction mechanism</a> is supported.</p>
<p>Also, for insert and replace queries, Manticore supports Elasticsearch-like query format along with its own format. For details, see the corresponding examples in the <a href="../12-data_creation_and_modification.html#toc-12.01.01-adding_documents_to_a_realtime_table">Adding documents to a real-time table</a> and <a href="../12-data_creation_and_modification.html#toc-12.03.02-replace">REPLACE</a> sections.</p>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-12.01-adding_documents_to_a_table">
        <header>
            <a class="chapter-link" href="#toc-12.01-adding_documents_to_a_table"> ¶ 12.1</a>

            
            <h1>Adding documents to a table</h1>
            
        </header>

        
    </section>
    
    <section class="chapter-section" id="toc-12.01.01-adding_documents_to_a_realtime_table">
        <header>
            <a class="chapter-link" href="#toc-12.01.01-adding_documents_to_a_realtime_table"> ¶ 12.1.1</a>

            
            <h1 id="adding-documents-to-a-real-time-table">Adding documents to a real-time table</h1>
            
        </header>

        
        
<blockquote>
<p>If you're looking for information on adding documents to a plain table, please refer to the section on <a href="12-data_creation_and_modification.html#toc-12.02.01-plain_tables_creation">adding data from external storages</a>.</p>
</blockquote>
<!-- example insert -->
<p>Adding documents in real-time is supported only for <a href="06-creating_a_table.html#toc-06.02.01-realtime_table">Real-Time</a> and <a href="06-creating_a_table.html#toc-06.02.04-percolate_table">percolate</a> tables. The corresponding SQL command, HTTP endpoint, or client functions insert new rows (documents) into a table with the provided field values. It's not necessary for a table to exist before adding documents to it. If the table doesn't exist, Manticore will attempt to create it automatically. For more information, see <a href="12-data_creation_and_modification.html#auto-schema">Auto schema</a>.</p>
<p>You can insert a single or <a href="12-data_creation_and_modification.html#bulk-adding-documents">multiple documents</a> with values for all fields of the table or just a portion of them. In this case, the other fields will be filled with their default values (0 for scalar types, an empty string for text types).</p>
<p>Expressions are not currently supported in <code>INSERT</code>, so values must be explicitly specified.</p>
<p>The ID field/value can be omitted, as RT and PQ tables support <a href="12-data_creation_and_modification.html#auto-id">auto-id</a> functionality. You can also use <code>0</code> as the id value to force automatic ID generation. Rows with duplicate IDs will not be overwritten by <code>INSERT</code>. Instead, you can use <a href="12-data_creation_and_modification.html#toc-12.03.02-replace">REPLACE</a> for that purpose.</p>
<p>When using the HTTP JSON protocol, you have two different request formats to choose from: a common Manticore format and an Elasticsearch-like format. Both formats are demonstrated in the examples below.</p>
<p>Additionally, when using the Manticore JSON request format, keep in mind that the <code>doc</code> node is required, and all the values should be provided within it.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>
<!-- request SQL -->
General syntax:


<div class="codehilite"><pre><span></span><code><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">&lt;</span><span class="k">table</span><span class="w"> </span><span class="n">name</span><span class="o">&gt;</span><span class="w"> </span><span class="p">[(</span><span class="k">column</span><span class="p">,</span><span class="w"> </span><span class="p">...)]</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span>
<span class="p">[,</span><span class="w"> </span><span class="p">(...)]</span>
</code></pre></div>




<div class="codehilite"><pre><span></span><code><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">products</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">price</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;Crossbody Bag with Tassel&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="p">.</span><span class="mi">85</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">products</span><span class="p">(</span><span class="n">title</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;Crossbody Bag with Tassel&#39;</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;Yellow bag&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="mi">95</span><span class="p">);</span>
</code></pre></div>


<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
<span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
<span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/i</span><span class="kc">nsert</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Crossbody Bag with Tassel&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;price&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">19.85</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="err">POST</span><span class="w"> </span><span class="err">/i</span><span class="kc">nsert</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Crossbody Bag with Tassel&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="err">POST</span><span class="w"> </span><span class="err">/i</span><span class="kc">nsert</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Yellow bag&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;created&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">201</span>
<span class="p">}</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;created&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">201</span>
<span class="p">}</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;created&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">201</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Elasticsearch
</div>

<!-- request Elasticsearch -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/produc</span><span class="kc">ts</span><span class="err">/_crea</span><span class="kc">te</span><span class="err">/</span><span class="mi">3</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Yellow Bag with Tassel&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">19.85</span>
<span class="p">}</span>

<span class="err">POST</span><span class="w"> </span><span class="err">/produc</span><span class="kc">ts</span><span class="err">/_crea</span><span class="kc">te</span><span class="err">/</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Red Bag with Tassel&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">19.85</span>
<span class="p">}</span>
</code></pre></div>


<!-- response Elasticsearch -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
<span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="nt">&quot;_primary_term&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="nt">&quot;_seq_no&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="nt">&quot;_shards&quot;</span><span class="p">:{</span>
<span class="w">    </span><span class="nt">&quot;failed&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;successful&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="p">},</span>
<span class="nt">&quot;_type&quot;</span><span class="p">:</span><span class="s2">&quot;_doc&quot;</span><span class="p">,</span>
<span class="nt">&quot;_version&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="s2">&quot;updated&quot;</span>
<span class="p">}</span>
<span class="p">{</span>
<span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="mi">2235747273424240642</span><span class="p">,</span>
<span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="nt">&quot;_primary_term&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="nt">&quot;_seq_no&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="nt">&quot;_shards&quot;</span><span class="p">:{</span>
<span class="w">    </span><span class="nt">&quot;failed&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;successful&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="p">},</span>
<span class="nt">&quot;_type&quot;</span><span class="p">:</span><span class="s2">&quot;_doc&quot;</span><span class="p">,</span>
<span class="nt">&quot;_version&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="s2">&quot;updated&quot;</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;addDocuments([</span>
<span class="x">        [&#39;id&#39; =&gt; 1, &#39;title&#39; =&gt; &#39;Crossbody Bag with Tassel&#39;, &#39;price&#39; =&gt; 19.85]</span>
<span class="x">]);</span>
<span class="x">$index-&gt;addDocuments([</span>
<span class="x">        [&#39;id&#39; =&gt; 2, &#39;title&#39; =&gt; &#39;Crossbody Bag with Tassel&#39;]</span>
<span class="x">]);</span>
<span class="x">$index-&gt;addDocuments([</span>
<span class="x">        [&#39;id&#39; =&gt; 0, &#39;title&#39; =&gt; &#39;Yellow bag&#39;]</span>
<span class="x">]);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Python
</div>

<!-- request Python -->


<div class="codehilite"><pre><span></span><code><span class="n">indexApi</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;doc&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span> <span class="p">:</span> <span class="s2">&quot;Crossbody Bag with Tassel&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span> <span class="p">:</span> <span class="mf">19.85</span><span class="p">}})</span>
<span class="n">indexApi</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;doc&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span> <span class="p">:</span> <span class="s2">&quot;Crossbody Bag with Tassel&quot;</span><span class="p">}})</span>
<span class="n">indexApi</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;doc&quot;</span> <span class="p">:</span> <span class="p">{{</span><span class="s2">&quot;title&quot;</span> <span class="p">:</span> <span class="s2">&quot;Yellow bag&quot;</span><span class="p">}})</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Javascript
</div>

<!-- request Javascript -->


<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Crossbody Bag with Tassel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;price&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">19.85</span><span class="p">}});</span>
<span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Crossbody Bag with Tassel&quot;</span><span class="p">}});</span>
<span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{{</span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Yellow bag&quot;</span><span class="p">}});</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
java
</div>

<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">InsertDocumentRequest</span><span class="w"> </span><span class="n">newdoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InsertDocumentRequest</span><span class="p">();</span>
<span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span><span class="s">&quot;Crossbody Bag with Tassel&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">,</span><span class="mf">19.85</span><span class="p">);</span>
<span class="p">}};</span>
<span class="n">newdoc</span><span class="p">.</span><span class="na">index</span><span class="p">(</span><span class="s">&quot;products&quot;</span><span class="p">).</span><span class="na">id</span><span class="p">(</span><span class="mi">1L</span><span class="p">).</span><span class="na">setDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">sqlresult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">indexApi</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">newdoc</span><span class="p">);</span>

<span class="n">newdoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InsertDocumentRequest</span><span class="p">();</span>
<span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span><span class="s">&quot;Crossbody Bag with Tassel&quot;</span><span class="p">);</span>
<span class="p">}};</span>
<span class="n">newdoc</span><span class="p">.</span><span class="na">index</span><span class="p">(</span><span class="s">&quot;products&quot;</span><span class="p">).</span><span class="na">id</span><span class="p">(</span><span class="mi">2L</span><span class="p">).</span><span class="na">setDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">sqlresult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">indexApi</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">newdoc</span><span class="p">);</span>

<span class="n">newdoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InsertDocumentRequest</span><span class="p">();</span>
<span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span><span class="s">&quot;Yellow bag&quot;</span><span class="p">);</span>
<span class="w"> </span><span class="p">}};</span>
<span class="n">newdoc</span><span class="p">.</span><span class="na">index</span><span class="p">(</span><span class="s">&quot;products&quot;</span><span class="p">).</span><span class="na">id</span><span class="p">(</span><span class="mi">0</span><span class="n">L</span><span class="p">).</span><span class="na">setDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">sqlresult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">indexApi</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">newdoc</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="p">();</span><span class="w"> </span>
<span class="n">doc</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Crossbody Bag with Tassel&quot;</span><span class="p">);</span>
<span class="n">doc</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;price&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">19.85</span><span class="p">);</span>
<span class="n">InsertDocumentRequest</span><span class="w"> </span><span class="n">newdoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">InsertDocumentRequest</span><span class="p">(</span><span class="n">index</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">doc</span><span class="p">:</span><span class="w"> </span><span class="n">doc</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">sqlresult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">indexApi</span><span class="o">.</span><span class="n">Insert</span><span class="p">(</span><span class="n">newdoc</span><span class="p">);</span>

<span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="p">();</span><span class="w"> </span>
<span class="n">doc</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Crossbody Bag with Tassel&quot;</span><span class="p">);</span>
<span class="n">newdoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">InsertDocumentRequest</span><span class="p">(</span><span class="n">index</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">doc</span><span class="p">:</span><span class="w"> </span><span class="n">doc</span><span class="p">);</span>
<span class="n">sqlresult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">indexApi</span><span class="o">.</span><span class="n">Insert</span><span class="p">(</span><span class="n">newdoc</span><span class="p">);</span>

<span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="p">();</span><span class="w"> </span>
<span class="n">doc</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Yellow bag&quot;</span><span class="p">);</span>
<span class="n">newdoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">InsertDocumentRequest</span><span class="p">(</span><span class="n">index</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">doc</span><span class="p">:</span><span class="w"> </span><span class="n">doc</span><span class="p">);</span>
<span class="n">sqlresult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">indexApi</span><span class="o">.</span><span class="n">Insert</span><span class="p">(</span><span class="n">newdoc</span><span class="p">);</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<h2 id="auto-schema">Auto schema</h2>
<p>Manticore features an automatic table creation mechanism, which activates when a specified table in the insert query doesn't yet exist. This mechanism is enabled by default. To disable it, set <code>auto_schema = 0</code> in the <a href="20-server_settings.html#auto_schema">Searchd</a> section of your Manticore config file.</p>
<!-- example auto-schema -->

<p>By default, all text values in the <code>VALUES</code> clause are considered to be of the <code>text</code> type, except for values representing valid email addresses, which are treated as the <code>string</code> type.</p>
<p>If you attempt to INSERT multiple rows with different, incompatible value types for the same field, auto table creation will be canceled, and an error message will be returned. However, if the different value types are compatible, the resulting field type will be the one that accommodates all the values. Some automatic data type conversions that may occur include:</p>
<ul>
<li>mva -&gt; mva64</li>
<li>uint -&gt; bigint -&gt; float</li>
<li>string -&gt; text</li>
</ul>
<p>Keep in mind that the <code>/bulk</code> HTTP endpoint does not support automatic table creation (auto schema). Only the <code>/_bulk</code> (Elasticsearch-like) HTTP endpoint and the SQL interface support this feature.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="n">MySQL</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">drop</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">exists</span><span class="w"> </span><span class="n">t</span><span class="p">;</span><span class="w"> </span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">mb</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">123</span><span class="p">,</span><span class="mi">1</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;text here&#39;</span><span class="p">,</span><span class="s1">&#39;test@mail.com&#39;</span><span class="p">,</span><span class="s1">&#39;{&quot;a&quot;: 123}&#39;</span><span class="p">,</span><span class="mi">1099511627776</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1099511627776</span><span class="p">,</span><span class="mi">1099511627777</span><span class="p">));</span><span class="w"> </span><span class="k">desc</span><span class="w"> </span><span class="n">t</span><span class="p">;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
</code></pre></div>



<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="c1">--------------</span>
<span class="k">drop</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">exists</span><span class="w"> </span><span class="n">t</span>
<span class="c1">--------------</span>

<span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">42</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="c1">--------------</span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">mb</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">123</span><span class="p">,</span><span class="mi">1</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;text here&#39;</span><span class="p">,</span><span class="s1">&#39;{&quot;a&quot;: 123}&#39;</span><span class="p">,</span><span class="mi">1099511627776</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1099511627776</span><span class="p">,</span><span class="mi">1099511627777</span><span class="p">))</span>
<span class="c1">--------------</span>

<span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="c1">--------------</span>
<span class="k">desc</span><span class="w"> </span><span class="n">t</span>
<span class="c1">--------------</span>

<span class="o">+</span><span class="c1">-------+--------+----------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Field</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">Type</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Properties</span><span class="w">     </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------+--------+----------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="nb">bigint</span><span class="w"> </span><span class="o">|</span><span class="w">                </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">t</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="nb">text</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">indexed</span><span class="w"> </span><span class="n">stored</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">s</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">|</span><span class="w">                </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">j</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">json</span><span class="w">   </span><span class="o">|</span><span class="w">                </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">i</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">uint</span><span class="w">   </span><span class="o">|</span><span class="w">                </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">b</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="nb">bigint</span><span class="w"> </span><span class="o">|</span><span class="w">                </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">f</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="nb">float</span><span class="w">  </span><span class="o">|</span><span class="w">                </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">m</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">mva</span><span class="w">    </span><span class="o">|</span><span class="w">                </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">mb</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">mva64</span><span class="w">  </span><span class="o">|</span><span class="w">                </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------+--------+----------------+</span>
<span class="mi">8</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="c1">--------------</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t</span>
<span class="c1">--------------</span>

<span class="o">+</span><span class="c1">---------------------+------+---------------+----------+------+-----------------------------+-----------+---------------+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">i</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">b</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">f</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">m</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">mb</span><span class="w">                          </span><span class="o">|</span><span class="w"> </span><span class="n">t</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">s</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">j</span><span class="w">          </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+------+---------------+----------+------+-----------------------------+-----------+---------------+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">5045949922868723723</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="mi">123</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1099511627776</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">200000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">1099511627776</span><span class="p">,</span><span class="mi">1099511627777</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">test</span><span class="o">@</span><span class="n">mail</span><span class="p">.</span><span class="n">com</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="err">}</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+------+---------------+----------+------+-----------------------------+-----------+---------------+------------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/i</span><span class="kc">nsert</span><span class="w">  </span><span class="mi">-</span><span class="err">d</span>
<span class="p">{</span>
<span class="w"> </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;t&quot;</span><span class="p">,</span>
<span class="w"> </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w"> </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span>
<span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="nt">&quot;i&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;f&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">1.23</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;t&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;text here&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;s&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test@mail.com&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;j&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">},</span>
<span class="w">   </span><span class="nt">&quot;b&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1099511627776</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;m&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
<span class="w">   </span><span class="nt">&quot;mb&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1099511627776</span><span class="p">,</span><span class="mi">1099511627777</span><span class="p">]</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;t&quot;</span><span class="p">,</span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="nt">&quot;created&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="s2">&quot;created&quot;</span><span class="p">,</span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="mi">201</span><span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<h2 id="auto-id">Auto ID</h2>
<!-- example autoid -->
<p>Manticore provides an auto ID generation functionality for the column ID of documents inserted or replaced into a real-time or <a href="06-creating_a_table.html#toc-06.02.04-percolate_table">Percolate table</a>. The generator produces a unique ID for a document with some guarantees, but it should not be considered an auto-incremented ID.</p>
<p>The generated ID value is guaranteed to be unique under the following conditions:</p>
<ul>
<li>The <a href="20-server_settings.html#server_id">server_id</a> value of the current server is in the range of 0 to 127 and is unique among nodes in the cluster, or it uses the default value generated from the MAC address as a seed</li>
<li>The system time does not change for the Manticore node between server restarts</li>
<li>The auto ID is generated fewer than 16 million times per second between search server restarts</li>
</ul>
<p>The auto ID generator creates a 64-bit integer for a document ID and uses the following schema:</p>
<ul>
<li>Bits 0 to 23 form a counter that gets incremented on every call to the auto ID generator</li>
<li>Bits 24 to 55 represent the Unix timestamp of the server start</li>
<li>Bits 56 to 63 correspond to the server_id</li>
</ul>
<p>This schema ensures that the generated ID is unique among all nodes in the cluster and that data inserted into different cluster nodes does not create collisions between the nodes.</p>
<p>As a result, the first ID from the generator used for auto ID is NOT 1 but a larger number. Additionally, the document stream inserted into a table might have non-sequential ID values if inserts into other tables occur between calls, as the ID generator is singular in the server and shared between all its tables.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>
<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">products</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">price</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;Crossbody Bag with Tassel&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="p">.</span><span class="mi">85</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;Yello bag&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="mi">95</span><span class="p">);</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">products</span><span class="p">;</span>
</code></pre></div>


<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="nb">+---------------------+-----------+---------------------------+</span>
<span class="c">| id                  | price     | title                     |</span>
<span class="nb">+---------------------+-----------+---------------------------+</span>
<span class="c">| 1657860156022587404 | 19</span><span class="nt">.</span><span class="c">850000 | Crossbody Bag with Tassel |</span>
<span class="c">| 1657860156022587405 |  4</span><span class="nt">.</span><span class="c">950000 | Yello bag                 |</span>
<span class="nb">+---------------------+-----------+---------------------------+</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>
<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/i</span><span class="kc">nsert</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Yellow bag&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="err">GET</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:{</span>
<span class="w">    </span><span class="nt">&quot;query_string&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1657860156022587406&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Yellow bag&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>
<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;addDocuments([</span>
<span class="x">        [&#39;id&#39; =&gt; 0, &#39;title&#39; =&gt; &#39;Yellow bag&#39;]</span>
<span class="x">]);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Python
</div>

<!-- request Python -->


<div class="codehilite"><pre><span></span><code><span class="n">indexApi</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;doc&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span> <span class="p">:</span> <span class="s2">&quot;Yellow bag&quot;</span><span class="p">}})</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Javascript
</div>

<!-- request Javascript -->


<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Yellow bag&quot;</span><span class="p">}});</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
java
</div>

<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">newdoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InsertDocumentRequest</span><span class="p">();</span>
<span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span><span class="s">&quot;Yellow bag&quot;</span><span class="p">);</span>
<span class="w"> </span><span class="p">}};</span>
<span class="n">newdoc</span><span class="p">.</span><span class="na">index</span><span class="p">(</span><span class="s">&quot;products&quot;</span><span class="p">).</span><span class="na">id</span><span class="p">(</span><span class="mi">0</span><span class="n">L</span><span class="p">).</span><span class="na">setDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">sqlresult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">indexApi</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">newdoc</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="p">();</span><span class="w"> </span>
<span class="n">doc</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Yellow bag&quot;</span><span class="p">);</span>
<span class="n">InsertDocumentRequest</span><span class="w"> </span><span class="n">newdoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">InsertDocumentRequest</span><span class="p">(</span><span class="n">index</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">doc</span><span class="p">:</span><span class="w"> </span><span class="n">doc</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">sqlresult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">indexApi</span><span class="o">.</span><span class="n">Insert</span><span class="p">(</span><span class="n">newdoc</span><span class="p">);</span>
</code></pre></div>


<!-- end -->

</div>

</div>

<!-- example bulk_insert -->
<h2 id="bulk-adding-documents">Bulk adding documents</h2>
<p>You can insert not just a single document into a real-time table, but as many as you'd like. It's perfectly fine to insert batches of tens of thousands of documents into a real-time table. However, it's important to keep the following points in mind:</p>
<ul>
<li>The larger the batch, the higher the latency of each insert operation</li>
<li>The larger the batch, the higher the indexation speed you can expect</li>
<li>You might want to increase the <a href="20-server_settings.html#max_packet_size">max_packet_size</a> value to allow for larger batches</li>
<li>Normally, each batch insert operation is considered a single <a href="12-data_creation_and_modification.html#toc-12.05-transactions">transaction</a> with atomicity guarantee, so you will either have all the new documents in the table at once or, in case of failure, none of them will be added. See more details about an empty line or switching to another table in the "JSON" example.</li>
</ul>
<p>Note that the <code>/bulk</code> HTTP endpoint does not support automatic creation of tables (auto schema). Only the <code>/_bulk</code> (Elasticsearch-like) HTTP endpoint and the SQL interface support this feature.</p>
<h4 id="chunked-transfer-in-bulk">Chunked transfer in /bulk</h4>
<p>The <code>/bulk</code> (Manticore mode) endpoint supports <a href="https://en.wikipedia.org/wiki/Chunked_transfer_encoding">Chunked transfer encoding</a>. You can use it to transmit large batches. It:</p>
<ul>
<li>reduces peak RAM usage, lowering the risk of OOM</li>
<li>decreases response time</li>
<li>allows you to bypass <a href="../20-server_settings.html#max_packet_size">max_packet_size</a> and transfer batches much larger than the maximum allowed value of <code>max_packet_size</code> (128MB), for example, 1GB at a time.</li>
</ul>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>
### Bulk insert examples

<div class='item-select'>
SQL
</div>
<!-- request SQL -->
For bulk insert, simply provide more documents in brackets after `VALUES()`. The syntax is:


<div class="codehilite"><pre><span></span><code><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">&lt;</span><span class="k">table</span><span class="w"> </span><span class="n">name</span><span class="o">&gt;</span><span class="p">[(</span><span class="n">column1</span><span class="p">,</span><span class="w"> </span><span class="n">column2</span><span class="p">,</span><span class="w"> </span><span class="p">...)]</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">()[,(</span><span class="n">value1</span><span class="p">,[</span><span class="n">value2</span><span class="p">,</span><span class="w"> </span><span class="p">...])]</span>
</code></pre></div>



The optional column name list allows you to explicitly specify values for some of the columns present in the table. All other columns will be filled with their default values (0 for scalar types, empty string for string types).

For example:


<div class="codehilite"><pre><span></span><code><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">products</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">price</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;Crossbody Bag with Tassel&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="p">.</span><span class="mi">85</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;microfiber sheet set&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="p">.</span><span class="mi">99</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;Pet Hair Remover Glove&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">.</span><span class="mi">99</span><span class="p">);</span>
</code></pre></div>


<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



Expressions are currently not supported in `INSERT`, and values should be explicitly specified.

<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>
<!-- request JSON -->
The syntax is generally the same as for [inserting a single document](04-quick_start_guide.html#add-documents). Just provide more lines, one for each document, and use the `/bulk` endpoint instead of `/insert`. Enclose each document in the "insert" node. Note that it also requires:

* `Content-Type: application/x-ndjson`
* The data should be formatted as newline-delimited JSON (NDJSON). Essentially, this means that each line should contain exactly one JSON statement and end with a newline `\n` and possibly `\r`.

The `/bulk` endpoint supports 'insert', 'replace', 'delete', and 'update' queries. Keep in mind that you can direct operations to multiple tables, but transactions are only possible for a single table. If you specify more, Manticore will gather operations directed to one table into a single transaction. When the table changes, it will commit the collected operations and initiate a new transaction on the new table. An empty line separating batches also leads to committing the previous batch and starting a new transaction.

In the response for a `/bulk` request, you can find the following fields:

* "errors": shows whether any errors occurred (true/false)
* "error": describes the error that took place
* "current_line": the line number where execution stopped (or failed); empty lines, including the first empty line, are also counted
* "skipped_lines": the count of non-committed lines, beginning from the `current_line` and moving backward


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/bulk</span>
<span class="mi">-</span><span class="err">H</span><span class="w"> </span><span class="s2">&quot;Content-Type: application/x-ndjson&quot;</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span>
<span class="p">{</span><span class="nt">&quot;insert&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span><span class="w">  </span><span class="p">{</span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;Crossbody Bag with Tassel&quot;</span><span class="p">,</span><span class="nt">&quot;price&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">19.85</span><span class="p">}}}</span>
<span class="p">{</span><span class="nt">&quot;insert&quot;</span><span class="p">:{</span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span><span class="w">  </span><span class="p">{</span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;microfiber sheet set&quot;</span><span class="p">,</span><span class="nt">&quot;price&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">19.99</span><span class="p">}}}</span>
<span class="err">&#39;</span>

<span class="err">POST</span><span class="w"> </span><span class="err">/bulk</span>
<span class="mi">-</span><span class="err">H</span><span class="w"> </span><span class="s2">&quot;Content-Type: application/x-ndjson&quot;</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span>
<span class="p">{</span><span class="nt">&quot;insert&quot;</span><span class="p">:{</span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test1&quot;</span><span class="p">,</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span><span class="nt">&quot;doc&quot;</span><span class="p">:{</span><span class="nt">&quot;int_col&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="mf">1.1</span><span class="p">,</span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;bulk doc one&quot;</span><span class="p">}}}</span>
<span class="p">{</span><span class="nt">&quot;insert&quot;</span><span class="p">:{</span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test1&quot;</span><span class="p">,</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">22</span><span class="p">,</span><span class="nt">&quot;doc&quot;</span><span class="p">:{</span><span class="nt">&quot;int_col&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="mf">2.2</span><span class="p">,</span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;bulk doc two&quot;</span><span class="p">}}}</span>

<span class="p">{</span><span class="nt">&quot;insert&quot;</span><span class="p">:{</span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test1&quot;</span><span class="p">,</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">23</span><span class="p">,</span><span class="nt">&quot;doc&quot;</span><span class="p">:{</span><span class="nt">&quot;int_col&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="mf">3.3</span><span class="p">,</span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;bulk doc three&quot;</span><span class="p">}}}</span>
<span class="p">{</span><span class="nt">&quot;insert&quot;</span><span class="p">:{</span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test2&quot;</span><span class="p">,</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">24</span><span class="p">,</span><span class="nt">&quot;doc&quot;</span><span class="p">:{</span><span class="nt">&quot;int_col&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="mf">4.4</span><span class="p">,</span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;bulk doc four&quot;</span><span class="p">}}}</span>
<span class="p">{</span><span class="nt">&quot;insert&quot;</span><span class="p">:{</span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test2&quot;</span><span class="p">,</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">25</span><span class="p">,</span><span class="nt">&quot;doc&quot;</span><span class="p">:{</span><span class="nt">&quot;int_col&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="mf">5.5</span><span class="p">,</span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;bulk doc five&quot;</span><span class="p">}}}</span>
<span class="err">&#39;</span>
</code></pre></div>



<!-- response JSON -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;bulk&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;created&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;deleted&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;updated&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">201</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;current_line&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;skipped_lines&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;errors&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="p">}</span>

<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;bulk&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;created&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;deleted&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;updated&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">201</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;bulk&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">23</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;created&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;deleted&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;updated&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">201</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;bulk&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test2&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;created&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;deleted&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;updated&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">201</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;current_line&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;skipped_lines&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;errors&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="p">}</span>
</code></pre></div>



<!-- request Elasticsearch -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/_bulk</span>
<span class="mi">-</span><span class="err">H</span><span class="w"> </span><span class="s2">&quot;Content-Type: application/x-ndjson&quot;</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span>
<span class="p">{</span><span class="w"> </span><span class="nt">&quot;index&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;_index&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="p">{</span><span class="w"> </span><span class="nt">&quot;title&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Yellow Bag&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="p">}</span>
<span class="p">{</span><span class="w"> </span><span class="nt">&quot;create&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;_index&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="p">{</span><span class="w"> </span><span class="nt">&quot;title&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Red Bag&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">12.5</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">}</span>
<span class="err">&#39;</span>
</code></pre></div>


<!-- response Elasticsearch -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_shards&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;successful&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;failed&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;_seq_no&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_primary_term&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">201</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;create&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_shards&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;successful&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;failed&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;_seq_no&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_primary_term&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">201</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;errors&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>
<!-- request PHP -->
Use method addDocuments():


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;addDocuments([</span>
<span class="x">        [&#39;id&#39; =&gt; 1, &#39;title&#39; =&gt; &#39;Crossbody Bag with Tassel&#39;, &#39;price&#39; =&gt; 19.85],</span>
<span class="x">        [&#39;id&#39; =&gt; 2, &#39;title&#39; =&gt; &#39;microfiber sheet set&#39;, &#39;price&#39; =&gt; 19.99],</span>
<span class="x">        [&#39;id&#39; =&gt; 3, &#39;title&#39; =&gt; &#39;Pet Hair Remover Glove&#39;, &#39;price&#39; =&gt; 7.99]</span>
<span class="x">]);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Python
</div>

<!-- request Python -->


<div class="codehilite"><pre><span></span><code><span class="n">docs</span> <span class="o">=</span> <span class="p">[</span> \
    <span class="p">{</span><span class="s2">&quot;insert&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;doc&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span> <span class="p">:</span> <span class="s2">&quot;Crossbody Bag with Tassel&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span> <span class="p">:</span> <span class="mf">19.85</span><span class="p">}}},</span> \
    <span class="p">{</span><span class="s2">&quot;insert&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;doc&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span> <span class="p">:</span> <span class="s2">&quot;microfiber sheet set&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span> <span class="p">:</span> <span class="mf">19.99</span><span class="p">}}},</span> \
    <span class="p">{</span><span class="s2">&quot;insert&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;doc&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span> <span class="p">:</span> <span class="s2">&quot;CPet Hair Remover Glove&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span> <span class="p">:</span> <span class="mf">7.99</span><span class="p">}}}</span>
<span class="p">]</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">indexApi</span><span class="o">.</span><span class="n">bulk</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">,</span><span class="n">docs</span><span class="p">)))</span>
</code></pre></div>




<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Javascript
</div>

<!-- request Javascript -->


<div class="codehilite"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">docs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="s2">&quot;insert&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Crossbody Bag with Tassel&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;price&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">19.85</span><span class="p">}}},</span>
<span class="w">    </span><span class="p">{</span><span class="s2">&quot;insert&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;microfiber sheet set&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;price&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">19.99</span><span class="p">}}},</span>
<span class="w">    </span><span class="p">{</span><span class="s2">&quot;insert&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;CPet Hair Remover Glove&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;price&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">7.99</span><span class="p">}}}</span>
<span class="p">];</span>
<span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">bulk</span><span class="p">(</span><span class="nx">docs</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">e</span><span class="p">=&gt;</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">e</span><span class="p">)).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">));</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
java
</div>

<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">String</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;{\&quot;insert\&quot;: {\&quot;index\&quot; : \&quot;products\&quot;, \&quot;id\&quot; : 1, \&quot;doc\&quot; : {\&quot;title\&quot; : \&quot;Crossbody Bag with Tassel\&quot;, \&quot;price\&quot; : 19.85}}}&quot;</span><span class="o">+</span><span class="s">&quot;\n&quot;</span><span class="o">+</span>
<span class="w">    </span><span class="s">&quot;{\&quot;insert\&quot;: {\&quot;index\&quot; : \&quot;products\&quot;, \&quot;id\&quot; : 4, \&quot;doc\&quot; : {\&quot;title\&quot; : \&quot;microfiber sheet set\&quot;, \&quot;price\&quot; : 19.99}}}&quot;</span><span class="o">+</span><span class="s">&quot;\n&quot;</span><span class="o">+</span>
<span class="w">    </span><span class="s">&quot;{\&quot;insert\&quot;: {\&quot;index\&quot; : \&quot;products\&quot;, \&quot;id\&quot; : 5, \&quot;doc\&quot; : {\&quot;title\&quot; : \&quot;CPet Hair Remover Glove\&quot;, \&quot;price\&quot; : 7.99}}}&quot;</span><span class="o">+</span><span class="s">&quot;\n&quot;</span><span class="p">;</span><span class="w">         </span>
<span class="n">BulkResponse</span><span class="w"> </span><span class="n">bulkresult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">indexApi</span><span class="p">.</span><span class="na">bulk</span><span class="p">(</span><span class="n">body</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->


<div class="codehilite"><pre><span></span><code>string body = &quot;{\&quot;insert\&quot;: {\&quot;index\&quot; : \&quot;products\&quot;, \&quot;id\&quot; : 1, \&quot;doc\&quot; : {\&quot;title\&quot; : \&quot;Crossbody Bag with Tassel\&quot;, \&quot;price\&quot; : 19.85}}}&quot;+&quot;\n&quot;+
    &quot;{\&quot;insert\&quot;: {\&quot;index\&quot; : \&quot;products\&quot;, \&quot;id\&quot; : 4, \&quot;doc\&quot; : {\&quot;title\&quot; : \&quot;microfiber sheet set\&quot;, \&quot;price\&quot; : 19.99}}}&quot;+&quot;\n&quot;+
    &quot;{\&quot;insert\&quot;: {\&quot;index\&quot; : \&quot;products\&quot;, \&quot;id\&quot; : 5, \&quot;doc\&quot; : {\&quot;title\&quot; : \&quot;CPet Hair Remover Glove\&quot;, \&quot;price\&quot; : 7.99}}}&quot;+&quot;\n&quot;;                                 
BulkResponse bulkresult = indexApi.Bulk(string.Join(&quot;\n&quot;, docs));
</code></pre></div>



<!-- end -->

</div>

</div>
<!-- example MVA_insert -->
<h2 id="inserting-multi-value-attributes-mva-values">Inserting multi-value attributes (MVA) values</h2>
<p>Multi-value attributes (MVA) are inserted as arrays of numbers.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>
### Examples

<div class='item-select'>
SQL
</div>
<!-- request SQL -->

<div class="codehilite"><pre><span></span><code>INSERT INTO products(title, sizes) VALUES(&#39;shoes&#39;, (40,41,42,43));
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>
<!-- request JSON -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/i</span><span class="kc">nsert</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;shoes&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;sizes&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="mi">41</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mi">43</span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Elasticsearch
</div>
<!-- request Elasticsearch -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/produc</span><span class="kc">ts</span><span class="err">/_crea</span><span class="kc">te</span><span class="err">/</span><span class="mi">1</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;shoes&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;sizes&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="mi">41</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mi">43</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>



Or, alternatively

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/produc</span><span class="kc">ts</span><span class="err">/_doc/</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;shoes&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;sizes&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="mi">41</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mi">43</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>




<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>
<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;addDocument(</span>
<span class="x">  [&#39;title&#39; =&gt; &#39;shoes&#39;, &#39;sizes&#39; =&gt; [40,41,42,43]],</span>
<span class="x">  1</span>
<span class="x">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Python
</div>

<!-- request Python -->


<div class="codehilite"><pre><span></span><code><span class="n">indexApi</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;doc&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span> <span class="p">:</span> <span class="s2">&quot;Yellow bag&quot;</span><span class="p">,</span><span class="s2">&quot;sizes&quot;</span><span class="p">:[</span><span class="mi">40</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="mi">43</span><span class="p">]}})</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Javascript
</div>

<!-- request Javascript -->


<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Yellow bag&quot;</span><span class="p">,</span><span class="s2">&quot;sizes&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">40</span><span class="p">,</span><span class="mf">41</span><span class="p">,</span><span class="mf">42</span><span class="p">,</span><span class="mf">43</span><span class="p">]}});</span>
</code></pre></div>




<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
java
</div>

<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">newdoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InsertDocumentRequest</span><span class="p">();</span>
<span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span><span class="s">&quot;Yellow bag&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;sizes&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="o">[]</span><span class="p">{</span><span class="mi">40</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="mi">43</span><span class="p">});</span>
<span class="w"> </span><span class="p">}};</span>
<span class="n">newdoc</span><span class="p">.</span><span class="na">index</span><span class="p">(</span><span class="s">&quot;products&quot;</span><span class="p">).</span><span class="na">id</span><span class="p">(</span><span class="mi">0</span><span class="n">L</span><span class="p">).</span><span class="na">setDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">sqlresult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">indexApi</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">newdoc</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="p">();</span><span class="w"> </span>
<span class="n">doc</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Yellow bag&quot;</span><span class="p">);</span>
<span class="n">doc</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;sizes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="mi">40</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="mi">43</span><span class="p">});</span>
<span class="n">InsertDocumentRequest</span><span class="w"> </span><span class="n">newdoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">InsertDocumentRequest</span><span class="p">(</span><span class="n">index</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">doc</span><span class="p">:</span><span class="w"> </span><span class="n">doc</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">sqlresult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">indexApi</span><span class="o">.</span><span class="n">Insert</span><span class="p">(</span><span class="n">newdoc</span><span class="p">);</span>
</code></pre></div>


<!-- end -->

</div>

</div>

<!-- example JSON_insert -->
<h2 id="inserting-json">Inserting JSON</h2>
<p>JSON value can be inserted as an <a href="13-searching.html#toc-13.02.03-escaping">escaped</a> string (via SQL or JSON) or as a JSON object (via the JSON interface).</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>
### Examples

<div class='item-select'>
SQL
</div>
<!-- request SQL -->

<div class="codehilite"><pre><span></span><code>INSERT INTO products VALUES (1, &#39;shoes&#39;, &#39;{&quot;size&quot;: 41, &quot;color&quot;: &quot;red&quot;}&#39;);
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>
<!-- request JSON -->
JSON value can be inserted as a JSON object

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/i</span><span class="kc">nsert</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;shoes&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;meta&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">41</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;color&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;red&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



JSON value can be also inserted as a string containing escaped JSON:

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/i</span><span class="kc">nsert</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;shoes&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;meta&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{\&quot;size\&quot;: 41, \&quot;color\&quot;: \&quot;red\&quot;}&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Elasticsearch
</div>
<!-- request Elasticsearch -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/produc</span><span class="kc">ts</span><span class="err">/_crea</span><span class="kc">te</span><span class="err">/</span><span class="mi">1</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;shoes&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">41</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;color&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;red&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



Or, alternatively

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/produc</span><span class="kc">ts</span><span class="err">/_doc/</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;shoes&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;meta&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">41</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;color&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;red&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>




<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>
Consider JSON just as string:
<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;addDocument(</span>
<span class="x">  [&#39;title&#39; =&gt; &#39;shoes&#39;, &#39;meta&#39; =&gt; &#39;{&quot;size&quot;: 41, &quot;color&quot;: &quot;red&quot;}&#39;],</span>
<span class="x">  1</span>
<span class="x">);</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Python
</div>

<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">indexApi</span> <span class="o">=</span> <span class="n">api</span> <span class="o">=</span> <span class="n">manticoresearch</span><span class="o">.</span><span class="n">IndexApi</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">indexApi</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;doc&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span> <span class="p">:</span> <span class="s2">&quot;Yellow bag&quot;</span><span class="p">,</span><span class="s2">&quot;meta&quot;</span><span class="p">:</span><span class="s1">&#39;{&quot;size&quot;: 41, &quot;color&quot;: &quot;red&quot;}&#39;</span><span class="p">}})</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Javascript
</div>

<!-- request Javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Yellow bag&quot;</span><span class="p">,</span><span class="s2">&quot;meta&quot;</span><span class="o">:</span><span class="s1">&#39;{&quot;size&quot;: 41, &quot;color&quot;: &quot;red&quot;}&#39;</span><span class="p">}});</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
java
</div>

<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">newdoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InsertDocumentRequest</span><span class="p">();</span>
<span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span><span class="s">&quot;Yellow bag&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;meta&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">            </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;size&quot;</span><span class="p">,</span><span class="mi">41</span><span class="p">);</span>
<span class="w">            </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;color&quot;</span><span class="p">,</span><span class="s">&quot;red&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}});</span>
<span class="w"> </span><span class="p">}};</span>
<span class="n">newdoc</span><span class="p">.</span><span class="na">index</span><span class="p">(</span><span class="s">&quot;products&quot;</span><span class="p">).</span><span class="na">id</span><span class="p">(</span><span class="mi">0</span><span class="n">L</span><span class="p">).</span><span class="na">setDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">sqlresult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">indexApi</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">newdoc</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="p">();</span><span class="w"> </span>
<span class="n">meta</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">41</span><span class="p">);</span>
<span class="n">meta</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;red&quot;</span><span class="p">);</span>
<span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="p">();</span><span class="w"> </span>
<span class="n">doc</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Yellow bag&quot;</span><span class="p">);</span>
<span class="n">doc</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;meta&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="p">);</span>
<span class="n">InsertDocumentRequest</span><span class="w"> </span><span class="n">newdoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">InsertDocumentRequest</span><span class="p">(</span><span class="n">index</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">doc</span><span class="p">:</span><span class="w"> </span><span class="n">doc</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">sqlresult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">indexApi</span><span class="o">.</span><span class="n">Insert</span><span class="p">(</span><span class="n">newdoc</span><span class="p">);</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-12.01.02-adding_rules_to_a_percolate_table">
        <header>
            <a class="chapter-link" href="#toc-12.01.02-adding_rules_to_a_percolate_table"> ¶ 12.1.2</a>

            
            <h1 id="adding-rules-to-a-percolate-table">Adding rules to a percolate table</h1>
            
        </header>

        
        
<!-- example -->
<p>In a <a href="06-creating_a_table.html#toc-06.02.04-percolate_table">percolate table</a> documents that are percolate query rules are stored and must follow the exact schema of four fields:</p>
<table>
<thead>
<tr>
<th>field</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>bigint</td>
<td>PQ rule identifier (if omitted, it will be assigned automatically)</td>
</tr>
<tr>
<td>query</td>
<td>string</td>
<td>Full-text query (can be empty) compatible with the <a href="06-creating_a_table.html#toc-06.02.04-percolate_table">percolate table</a></td>
</tr>
<tr>
<td>filters</td>
<td>string</td>
<td>Additional filters by non-full-text fields (can be empty) compatible with the <a href="06-creating_a_table.html#toc-06.02.04-percolate_table">percolate table</a></td>
</tr>
<tr>
<td>tags</td>
<td>string</td>
<td>A string with one or many comma-separated tags, which may be used to selectively show/delete saved queries</td>
</tr>
</tbody>
</table>
<p>Any other field names are not supported and will trigger an error.</p>
<p><strong>Warning:</strong> Inserting/replacing JSON-formatted PQ rules via SQL will not work. In other words, the JSON-specific operators (<code>match</code> etc) will be considered just parts of the rule's text that should match with documents. If you prefer JSON syntax, use the HTTP endpoint instead of <code>INSERT</code>/<code>REPLACE</code>.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>
<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">pq</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="n">filters</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;@title shoes&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;price &gt; 5&#39;</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">pq</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="n">tags</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;@title bag&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Louis Vuitton&#39;</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">pq</span><span class="p">;</span>
</code></pre></div>


<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">------+--------------+---------------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">query</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">tags</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">filters</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+--------------+---------------+---------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">@</span><span class="n">title</span><span class="w"> </span><span class="n">shoes</span><span class="w"> </span><span class="o">|</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">price</span><span class="o">&gt;</span><span class="mi">5</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">@</span><span class="n">title</span><span class="w"> </span><span class="n">bag</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Louis</span><span class="w"> </span><span class="n">Vuitton</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+--------------+---------------+---------+</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>
<!-- request JSON -->
There are two ways you can add a percolate query into a percolate table:

* Query in JSON /search compatible format, described at [json/search](13-searching.html#http-json)

<div class="codehilite"><pre><span></span><code><span class="err">PUT</span><span class="w"> </span><span class="err">/pq/pq_</span><span class="kc">ta</span><span class="err">ble/doc/</span><span class="mi">1</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;shoes&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;range&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;gt&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Loius Vuitton&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>



* Query in SQL format, described at [search query syntax](13-searching.html#queries-in-sql-format)

<div class="codehilite"><pre><span></span><code><span class="err">PUT</span><span class="w"> </span><span class="err">/pq/pq_</span><span class="kc">ta</span><span class="err">ble/doc/</span><span class="mi">2</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;ql&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;@title shoes&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;filters&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;price &gt; 5&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Loius Vuitton&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>
<!-- request PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">$newstoredquery = [</span>
<span class="x">    &#39;index&#39; =&gt; &#39;test_pq&#39;,</span>
<span class="x">    &#39;body&#39; =&gt; [</span>
<span class="x">        &#39;query&#39; =&gt; [</span>
<span class="x">                       &#39;match&#39; =&gt; [</span>
<span class="x">                               &#39;title&#39; =&gt; &#39;shoes&#39;</span>
<span class="x">                       ]</span>
<span class="x">               ],</span>
<span class="x">               &#39;range&#39; =&gt; [</span>
<span class="x">                       &#39;price&#39; =&gt; [</span>
<span class="x">                               &#39;gt&#39; =&gt; 5</span>
<span class="x">                       ]</span>
<span class="x">               ]</span>
<span class="x">       ],</span>
<span class="x">    &#39;tags&#39; =&gt; [&#39;Loius Vuitton&#39;]</span>
<span class="x">];</span>
<span class="x">$client-&gt;pq()-&gt;doc($newstoredquery);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Python
</div>
<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">newstoredquery</span> <span class="o">=</span><span class="p">{</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;test_pq&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;doc&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ql&quot;</span><span class="p">:</span> <span class="s2">&quot;@title shoes&quot;</span><span class="p">},</span><span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="s2">&quot;price &gt; 5&quot;</span><span class="p">,</span><span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Loius Vuitton&quot;</span><span class="p">]}}</span>
<span class="n">indexApi</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">newstoredquery</span><span class="p">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Javascript
</div>
<!-- request Javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">newstoredquery</span><span class="w"> </span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test_pq&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;ql&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;@title shoes&quot;</span><span class="p">},</span><span class="s2">&quot;filters&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;price &gt; 5&quot;</span><span class="p">,</span><span class="s2">&quot;tags&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Loius Vuitton&quot;</span><span class="p">]}};</span>
<span class="nx">indexApi</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="nx">newstoredquery</span><span class="p">);</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
java
</div>
<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">newstoredquery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;query&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;q1&quot;</span><span class="p">,</span><span class="s">&quot;@title shoes&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;filters&quot;</span><span class="p">,</span><span class="s">&quot;price&gt;5&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;tags&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Loius Vuitton&quot;</span><span class="p">});</span>
<span class="w">    </span><span class="p">}});</span>
<span class="p">}};</span>
<span class="n">newdoc</span><span class="p">.</span><span class="na">index</span><span class="p">(</span><span class="s">&quot;test_pq&quot;</span><span class="p">).</span><span class="na">id</span><span class="p">(</span><span class="mi">2L</span><span class="p">).</span><span class="na">setDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">indexApi</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">newdoc</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>
<!-- request C# -->

<div class="codehilite"><pre><span></span><code><span class="k">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="k">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="k">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="k">Object</span><span class="o">&gt;</span><span class="p">();</span><span class="w"> </span>
<span class="n">query</span><span class="p">.</span><span class="k">Add</span><span class="p">(</span><span class="ss">&quot;q1&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;@title shoes&quot;</span><span class="p">);</span>
<span class="n">query</span><span class="p">.</span><span class="k">Add</span><span class="p">(</span><span class="ss">&quot;filters&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;price&gt;5&quot;</span><span class="p">);</span>
<span class="n">query</span><span class="p">.</span><span class="k">Add</span><span class="p">(</span><span class="ss">&quot;tags&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;Loius Vuitton&quot;</span><span class="err">}</span><span class="p">);</span>
<span class="k">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="k">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">newstoredquery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="k">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="k">Object</span><span class="o">&gt;</span><span class="p">();</span><span class="w"> </span>
<span class="n">newstoredquery</span><span class="p">.</span><span class="k">Add</span><span class="p">(</span><span class="ss">&quot;query&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">);</span>
<span class="n">InsertDocumentRequest</span><span class="w"> </span><span class="n">newdoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InsertDocumentRequest</span><span class="p">(</span><span class="k">index</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;test_pq&quot;</span><span class="p">,</span><span class="w"> </span><span class="nl">id</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nl">doc</span><span class="p">:</span><span class="w"> </span><span class="n">doc</span><span class="p">);</span>
<span class="n">indexApi</span><span class="p">.</span><span class="k">Insert</span><span class="p">(</span><span class="n">newdoc</span><span class="p">);</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example noid -->
<h2 id="auto-id-provisioning">Auto ID provisioning</h2>
<p>If you don't specify an ID, it will be assigned automatically. You can read more about auto-ID <a href="12-data_creation_and_modification.html#auto-id">here</a>.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">pq</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="n">filters</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;wristband&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;price &gt; 5&#39;</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">pq</span><span class="p">;</span>
</code></pre></div>


<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">---------------------+-----------+------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">query</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">tags</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filters</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+-----------+------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657843905795719192</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">wristband</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">price</span><span class="o">&gt;</span><span class="mi">5</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+-----------+------+---------+</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>
<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">PUT</span><span class="w"> </span><span class="err">/pq/pq_</span><span class="kc">ta</span><span class="err">ble/doc</span>
<span class="p">{</span>
<span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;shoes&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;range&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;gt&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">},</span>
<span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Loius Vuitton&quot;</span><span class="p">]</span>
<span class="p">}</span>

<span class="err">PUT</span><span class="w"> </span><span class="err">/pq/pq_</span><span class="kc">ta</span><span class="err">ble/doc</span>
<span class="p">{</span>
<span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;ql&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;@title shoes&quot;</span>
<span class="p">},</span>
<span class="nt">&quot;filters&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;price &gt; 5&quot;</span><span class="p">,</span>
<span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Loius Vuitton&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>


<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pq_table&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1657843905795719196&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span>
<span class="p">}</span>

<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pq_table&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1657843905795719198&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span>
<span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>
<!-- request PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">$newstoredquery = [</span>
<span class="x">    &#39;index&#39; =&gt; &#39;pq_table&#39;,</span>
<span class="x">    &#39;body&#39; =&gt; [</span>
<span class="x">        &#39;query&#39; =&gt; [</span>
<span class="x">                       &#39;match&#39; =&gt; [</span>
<span class="x">                               &#39;title&#39; =&gt; &#39;shoes&#39;</span>
<span class="x">                       ]</span>
<span class="x">               ],</span>
<span class="x">               &#39;range&#39; =&gt; [</span>
<span class="x">                       &#39;price&#39; =&gt; [</span>
<span class="x">                               &#39;gt&#39; =&gt; 5</span>
<span class="x">                       ]</span>
<span class="x">               ]</span>
<span class="x">       ],</span>
<span class="x">    &#39;tags&#39; =&gt; [&#39;Loius Vuitton&#39;]</span>
<span class="x">];</span>
<span class="x">$client-&gt;pq()-&gt;doc($newstoredquery);</span>
</code></pre></div>


<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Array(</span>
<span class="x">       [index] =&gt; pq_table</span>
<span class="x">       [type] =&gt; doc</span>
<span class="x">       [_id] =&gt; 1657843905795719198</span>
<span class="x">       [result] =&gt; created</span>
<span class="x">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Python
</div>
<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">indexApi</span> <span class="o">=</span> <span class="n">api</span> <span class="o">=</span> <span class="n">manticoresearch</span><span class="o">.</span><span class="n">IndexApi</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">newstoredquery</span> <span class="o">=</span><span class="p">{</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;test_pq&quot;</span><span class="p">,</span>   <span class="s2">&quot;doc&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ql&quot;</span><span class="p">:</span> <span class="s2">&quot;@title shoes&quot;</span><span class="p">},</span><span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="s2">&quot;price &gt; 5&quot;</span><span class="p">,</span><span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Loius Vuitton&quot;</span><span class="p">]}}</span>
<span class="n">indexApi</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">store_query</span><span class="p">)</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;created&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
 <span class="s1">&#39;found&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1657843905795719198</span><span class="p">,</span>
 <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;test_pq&#39;</span><span class="p">,</span>
 <span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="s1">&#39;created&#39;</span><span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Javascript
</div>
<!-- request Javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">newstoredquery</span><span class="w"> </span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test_pq&quot;</span><span class="p">,</span><span class="w">  </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;ql&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;@title shoes&quot;</span><span class="p">},</span><span class="s2">&quot;filters&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;price &gt; 5&quot;</span><span class="p">,</span><span class="s2">&quot;tags&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Loius Vuitton&quot;</span><span class="p">]}};</span>
<span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="nx">store_query</span><span class="p">);</span>
</code></pre></div>


<!-- response Javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;test_pq&quot;</span><span class="p">,</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">1657843905795719198</span><span class="p">,</span><span class="s2">&quot;created&quot;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;created&quot;</span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
java
</div>
<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">newstoredquery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;query&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;q1&quot;</span><span class="p">,</span><span class="s">&quot;@title shoes&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;filters&quot;</span><span class="p">,</span><span class="s">&quot;price&gt;5&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;tags&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Loius Vuitton&quot;</span><span class="p">});</span>
<span class="w">    </span><span class="p">}});</span>
<span class="p">}};</span>
<span class="n">newdoc</span><span class="p">.</span><span class="na">index</span><span class="p">(</span><span class="s">&quot;test_pq&quot;</span><span class="p">).</span><span class="na">setDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">indexApi</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">newdoc</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>
<!-- request C# -->

<div class="codehilite"><pre><span></span><code><span class="k">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="k">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="k">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="k">Object</span><span class="o">&gt;</span><span class="p">();</span><span class="w"> </span>
<span class="n">query</span><span class="p">.</span><span class="k">Add</span><span class="p">(</span><span class="ss">&quot;q1&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;@title shoes&quot;</span><span class="p">);</span>
<span class="n">query</span><span class="p">.</span><span class="k">Add</span><span class="p">(</span><span class="ss">&quot;filters&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;price&gt;5&quot;</span><span class="p">);</span>
<span class="n">query</span><span class="p">.</span><span class="k">Add</span><span class="p">(</span><span class="ss">&quot;tags&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;Loius Vuitton&quot;</span><span class="err">}</span><span class="p">);</span>
<span class="k">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="k">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">newstoredquery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="k">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="k">Object</span><span class="o">&gt;</span><span class="p">();</span><span class="w"> </span>
<span class="n">newstoredquery</span><span class="p">.</span><span class="k">Add</span><span class="p">(</span><span class="ss">&quot;query&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">);</span>
<span class="n">InsertDocumentRequest</span><span class="w"> </span><span class="n">newdoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InsertDocumentRequest</span><span class="p">(</span><span class="k">index</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;test_pq&quot;</span><span class="p">,</span><span class="w"> </span><span class="nl">doc</span><span class="p">:</span><span class="w"> </span><span class="n">doc</span><span class="p">);</span>
<span class="n">indexApi</span><span class="p">.</span><span class="k">Insert</span><span class="p">(</span><span class="n">newdoc</span><span class="p">);</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example noschema -->
<h2 id="no-schema-in-sql">No schema in SQL</h2>
<p>In case of omitted schema in SQL <code>INSERT</code> command, the following parameters are expected:<br />
1. ID. You can use <code>0</code> as the ID to trigger auto-ID generation.<br />
2. Query - Full-text query.<br />
3. Tags - PQ rule tags string.<br />
4. Filters - Additional filters by attributes.</p>
<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">pq</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;@title shoes&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">pq</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;@title shoes&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Louis Vuitton&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">pq</span><span class="p">;</span>
</code></pre></div>

<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">---------------------+--------------+---------------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">query</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">tags</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">filters</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+--------------+---------------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2810855531667783688</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">@</span><span class="n">title</span><span class="w"> </span><span class="n">shoes</span><span class="w"> </span><span class="o">|</span><span class="w">               </span><span class="o">|</span><span class="w">         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2810855531667783689</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">@</span><span class="n">title</span><span class="w"> </span><span class="n">shoes</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Louis</span><span class="w"> </span><span class="n">Vuitton</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+--------------+---------------+---------+</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<!-- example replace -->
<h2 id="replacing-rules-in-a-pq-table">Replacing rules in a PQ table</h2>
<p>To replace an existing PQ rule with a new one in SQL, just use a regular <a href="12-data_creation_and_modification.html#toc-12.03.02-replace">REPLACE</a> command. There's a special syntax <code>?refresh=1</code> to replace a PQ rule <strong>defined in JSON mode</strong> via the HTTP JSON interface.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pq</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------------------+--------------+------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">query</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">tags</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filters</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+--------------+------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2810823411335430148</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">@</span><span class="n">title</span><span class="w"> </span><span class="n">shoes</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w">         </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+--------------+------+---------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">replace</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">pq</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">query</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">2810823411335430148</span><span class="p">,</span><span class="s1">&#39;@title boots&#39;</span><span class="p">);</span>
<span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">pq</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------------------+--------------+------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">query</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">tags</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filters</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+--------------+------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2810823411335430148</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">@</span><span class="n">title</span><span class="w"> </span><span class="n">boots</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w">         </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+--------------+------+---------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- request JSON -->

<div class="codehilite"><pre><span></span><code><span class="err">GET</span><span class="w"> </span><span class="err">/pq/pq/doc/</span><span class="mi">2810823411335430149</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2810823411335430149&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;shoes&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;filters&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="err">PUT</span><span class="w"> </span><span class="err">/pq/pq/doc/</span><span class="mi">2810823411335430149</span><span class="err">?re</span><span class="kc">fres</span><span class="err">h=</span><span class="mi">1</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;boots&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span><span class="err">&#39;</span>

<span class="err">GET</span><span class="w"> </span><span class="err">/pq/pq/doc/</span><span class="mi">2810823411335430149</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2810823411335430149&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;boots&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;filters&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-12.02-adding_data_from_external_storages">
        <header>
            <a class="chapter-link" href="#toc-12.02-adding_data_from_external_storages"> ¶ 12.2</a>

            
            <h1>Adding data from external storages</h1>
            
        </header>

        
    </section>
    
    <section class="chapter-section" id="toc-12.02.01-plain_tables_creation">
        <header>
            <a class="chapter-link" href="#toc-12.02.01-plain_tables_creation"> ¶ 12.2.1</a>

            
            <h1 id="plain-tables-creation">Plain tables creation</h1>
            
        </header>

        
        
<p>Plain tables are tables that are created one-time by fetching data at creation from one or several sources. A plain table is immutable as documents cannot be added or deleted during its lifespan. It is only possible to update values of numeric attributes (including MVA). Refreshing the data is only possible by recreating the whole table.</p>
<p>Plain tables are available only in the <a href="06-creating_a_table.html#defining-table-schema-in-config-%28plain mode%29">Plain mode</a> and their definition is made up of a table declaration and one or several source declarations. The data gathering and table creation are not made by the <code>searchd</code> server but by the auxiliary tool <code>indexer</code>.</p>
<p><strong>Indexer</strong> is a command-line tool that can be called directly from the command line or from shell scripts.</p>
<p>It can accept a number of arguments when called, but there are also several settings of its own in the Manticore configuration file.</p>
<p>In the typical scenario, indexer does the following:</p>
<ul>
<li>Fetches the data from the source</li>
<li>Builds the plain table</li>
<li>Writes the table files</li>
<li>(Optional) Informs the search server about the new table which triggers table rotation</li>
</ul>
<h2 id="indexer-tool">Indexer tool</h2>
<p>The <code>indexer</code> tool is used to create plain tables in Manticore Search. It has a general syntax of:</p>
<div class="codehilite"><pre><span></span><code>indexer<span class="w"> </span><span class="o">[</span>OPTIONS<span class="o">]</span><span class="w"> </span><span class="o">[</span>table_name1<span class="w"> </span><span class="o">[</span>table_name2<span class="w"> </span><span class="o">[</span>...<span class="o">]]]</span>
</code></pre></div>

<p>When creating tables with <code>indexer</code>, the generated table files must be made with permissions that allow <code>searchd</code> to read, write, and delete them. In case of the official Linux packages, <code>searchd</code> runs under the <code>manticore</code> user. Therefore, <code>indexer</code> must also run under the <code>manticore</code> user:</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>-u<span class="w"> </span>manticore<span class="w"> </span>indexer<span class="w"> </span>...
</code></pre></div>

<p>If you are running <code>searchd</code> differently, you might need to omit <code>sudo -u manticore</code>. Just make sure that the user under which your <code>searchd</code> instance is running has read/write permissions to the tables generated using <code>indexer</code>.</p>
<p>To create a plain table, you need to list the table(s) you want to process. For example, if your <code>manticore.conf</code> file contains details on two tables, <code>mybigindex</code> and <code>mysmallindex</code>, you could run:</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>-u<span class="w"> </span>manticore<span class="w"> </span>indexer<span class="w"> </span>mysmallindex<span class="w"> </span>mybigindex
</code></pre></div>

<p>You can also use wildcard tokens to match table names:</p>
<ul>
<li><code>?</code> matches any single character</li>
<li><code>*</code> matches any count of any characters</li>
<li><code>%</code> matches none or any single character</li>
</ul>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>-u<span class="w"> </span>manticore<span class="w"> </span>indexer<span class="w"> </span>indexpart*main<span class="w"> </span>--rotate
</code></pre></div>

<p>The exit codes for indexer are as follows:</p>
<ul>
<li>0: everything went OK</li>
<li>1: there was a problem while indexing (and if <code>--rotate</code> was specified, it was skipped) or an operation emitted a warning</li>
<li>2: indexing went OK, but the <code>--rotate</code> attempt failed</li>
</ul>
<p>Also, you can run <code>indexer</code> via a systemctl unit file:</p>
<div class="codehilite"><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>--no-block<span class="w"> </span>manticore-indexer
</code></pre></div>

<p>Or, in case you want to build a specific table:</p>
<div class="codehilite"><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>--no-block<span class="w"> </span>manticore-indexer@specific-table-name
</code></pre></div>

<p>Find more information about scheduling <code>indexer</code> via systemd below.</p>
<h3 id="indexer-command-line-arguments">Indexer command line arguments</h3>
<ul>
<li><code>--config &lt;file&gt;</code> (<code>-c &lt;file&gt;</code> for short) tells <code>indexer</code> to use the given file as its configuration. Normally, it will look for <code>manticore.conf</code> in the installation directory (e.g. <code>/etc/manticoresearch/manticore.conf</code>), followed by the current directory you are in when calling <code>indexer</code> from the shell. This is most useful in shared environments where the binary files are installed in a global folder, e.g. <code>/usr/bin/</code>, but you want to provide users with the ability to make their own custom Manticore set-ups, or if you want to run multiple instances on a single server. In cases like those you could allow them to create their own <code>manticore.conf</code> files and pass them to <code>indexer</code> with this option. For example:</li>
</ul>
<p><code>shell
  sudo -u manticore indexer --config /home/myuser/manticore.conf mytable</code></p>
<ul>
<li><code>--all</code> tells <code>indexer</code> to update every table listed in <code>manticore.conf</code> instead of listing individual tables. This would be useful in small configurations or cron-kind or maintenance jobs where the entire table set will get rebuilt each day or week or whatever period is best. Please note that since <code>--all</code> tries to update all found tables in the configuration, it will issue a warning if it encounters RealTime tables and the exit code of the command will be <code>1</code> not <code>0</code> even if the plain tables finished without issue. Example usage:</li>
</ul>
<p><code>shell
  sudo -u manticore indexer --config /home/myuser/manticore.conf --all</code></p>
<ul>
<li><code>--rotate</code> is used for rotating tables. Unless you have the situation where you can take the search function offline without troubling users you will almost certainly need to keep search running whilst indexing new documents. <code>--rotate</code> creates a second table, parallel to the first (in the same place, simply including <code>.new</code> in the filenames). Once complete, <code>indexer</code> notifies <code>searchd</code> via sending the <code>SIGHUP</code> signal, and the <code>searchd</code> will attempt to rename the tables (renaming the existing ones to include <code>.old</code> and renaming the <code>.new</code> to replace them), and then will start serving from the newer files. Depending on the setting of <a href="20-server_settings.html#seamless_rotate">seamless_rotate</a> there may be a slight delay in being able to search the newer tables. In case multiple tables are rotated at once which are chained by <a href="06-creating_a_table.html#killlist_target">killlist_target</a> relations rotation will start with the tables that are not targets and finish with the ones at the end of target chain. Example usage:</li>
</ul>
<p><code>shell
  sudo -u manticore indexer --rotate --all</code></p>
<ul>
<li><code>--quiet</code> tells <code>indexer</code> ot to output anything, unless there is an error. This is mostly used for cron-type or other scripted jobs where the output is irrelevant or unnecessary, except in the event of some kind of error. Example usage:</li>
</ul>
<p><code>shell
  sudo -u manticore indexer --rotate --all --quiet</code></p>
<ul>
<li><code>--noprogress</code> does not display progress details as they occur. Instead, the final status details (such as documents indexed, speed of indexing and so on are only reported at completion of indexing. In instances where the script is not being run on a console (or 'tty'), this will be on by default. Example usage:</li>
</ul>
<p><code>shell
  sudo -u manticore indexer --rotate --all --noprogress</code></p>
<ul>
<li><code>--buildstops &lt;outputfile.text&gt; &lt;N&gt;</code> reviews the table source, as if it were indexing the data, and produces a list of the terms that are being indexed. In other words, it produces a list of all the searchable terms that are becoming part of the table. Note, it does not update the table in question, it simply processes the data as if it were indexing, including running queries defined with <a href="12-data_creation_and_modification.html#sql_query_pre">sql_query_pre</a> or <a href="12-data_creation_and_modification.html#sql_query_post">sql_query_post</a>. <code>outputfile.txt</code> will contain the list of words, one per line, sorted by frequency with most frequent first, and <code>N</code> specifies the maximum number of words that will be listed. If it's sufficiently large to encompass every word in the table, only that many words will be returned. Such a dictionary list could be used for client application features around "Did you mean…" functionality, usually in conjunction with <code>--buildfreqs</code>, below. Example:</li>
</ul>
<p><code>shell
  sudo -u manticore indexer mytable --buildstops word_freq.txt 1000</code></p>
<p>This would produce a document in the current directory, <code>word_freq.txt</code>, with the 1,000 most common words in 'mytable', ordered by most common first. Note that the file will pertain to the last table indexed when specified with multiple tables or <code>--all</code> (i.e. the last one listed in the configuration file)</p>
<ul>
<li><code>--buildfreqs</code> works with <code>--buildstops</code> (and is ignored if <code>--buildstops</code> is not specified). As <code>--buildstops</code> provides the list of words used within the table, <code>--buildfreqs</code> adds the quantity present in the table, which would be useful in establishing whether certain words should be considered stopwords if they are too prevalent. It will also help with developing "Did you mean…" features where you need to know how much more common a given word compared to another, similar one. For example:</li>
</ul>
<p><code>shell
  sudo -u manticore indexer mytable --buildstops word_freq.txt 1000 --buildfreqs</code></p>
<p>This would produce the <code>word_freq.txt</code> as above, however after each word would be the number of times it occurred in the table in question.</p>
<ul>
<li><code>--merge &lt;dst-table&gt; &lt;src-table&gt;</code> is used for physically merging tables together, for example if you have a <a href="06-creating_a_table.html#main+delta-scenario">main+delta scheme</a>, where the main table rarely changes, but the delta table is rebuilt frequently, and <code>--merge</code> would be used to combine the two. The operation moves from right to left - the contents of <code>src-table</code> get examined and physically combined with the contents of <code>dst-table</code> and the result is left in <code>dst-table</code>. In pseudo-code, it might be expressed as: <code>dst-table += src-table</code> An example:</li>
</ul>
<p><code>shell
  sudo -u manticore indexer --merge main delta --rotate</code></p>
<p>In the above example, where the main is the master, rarely modified table, and the delta is more frequently modified one, you might use the above to call <code>indexer</code> to combine the contents of the delta into the main table and rotate the tables.</p>
<ul>
<li><code>--merge-dst-range &lt;attr&gt; &lt;min&gt; &lt;max&gt;</code> runs the filter range given upon merging. Specifically, as the merge is applied to the destination table (as part of <code>--merge</code>, and is ignored if <code>--merge</code> is not specified), <code>indexer</code> will also filter the documents ending up in the destination table, and only documents will pass through the filter given will end up in the final table. This could be used for example, in a table where there is a 'deleted' attribute, where 0 means 'not deleted'. Such a table could be merged with:</li>
</ul>
<p><code>shell
  sudo -u manticore indexer --merge main delta --merge-dst-range deleted 0 0</code></p>
<p>Any documents marked as deleted (value 1) will be removed from the newly-merged destination table. It can be added several times to the command line, to add successive filters to the merge, all of which must be met in order for a document to become part of the final table.</p>
<ul>
<li>--<code>merge-killlists</code> (and its shorter alias <code>--merge-klists</code>) changes the way kill lists are processed when merging tables. By default, both kill lists get discarded after a merge. That supports the most typical main+delta merge scenario. With this option enabled, however, kill lists from both tables get concatenated and stored into the destination table. Note that a source (delta) table kill list will be used to suppress rows from a destination (main) table at all times.</li>
<li><code>--keep-attrs</code> allows to reuse existing attributes on reindexing. Whenever the table is rebuilt, each new document id is checked for presence in the "old" table, and if it already exists, its attributes are transferred to the "new" table; if not found, attributes from the new table are used. If the user has updated attributes in the table, but not in the actual source used for the table, all updates will be lost when reindexing; using <code>--keep-attrs</code> enables saving the updated attribute values from the previous table. It is possible to specify a path for table files to be used instead of the reference path from the config:</li>
</ul>
<p><code>shell
  sudo -u manticore indexer mytable --keep-attrs=/path/to/index/files</code></p>
<ul>
<li><code>--keep-attrs-names=&lt;attributes list&gt;</code> allows you to specify attributes to reuse from an existing table on reindexing. By default, all attributes from the existing table are reused in the new table:</li>
</ul>
<p><code>shell
  sudo -u manticore indexer mytable --keep-attrs=/path/to/table/files --keep-attrs-names=update,state</code></p>
<ul>
<li><code>--dump-rows &lt;FILE&gt;</code> dumps rows fetched by SQL source(s) into the specified file, in a MySQL compatible syntax. The resulting dumps are the exact representation of data as received by <code>indexer</code> and can help repeat indexing-time issues. The command performs fetching from the source and creates both table files and the dump file.</li>
<li><code>--print-rt &lt;rt_index&gt; &lt;table&gt;</code> outputs fetched data from the source as INSERTs for a real-time table. The first lines of the dump will contain the real-time fields and attributes (as a reflection of the plain table fields and attributes). The command performs fetching from the source and creates both table files and the dump output. The command can be used as <code>sudo -u manticore indexer -c manticore.conf --print-rt indexrt indexplain &gt; dump.sql</code>. Only SQL-based sources are supported. MVAs are not supported.</li>
<li><code>--sighup-each</code>  is useful when you are rebuilding many big tables and want each one rotated into <code>searchd</code> as soon as possible. With <code>--sighup-each</code>, <code>indexer</code> will send the SIGHUP signal to searchd after successfully completing work on each table. (The default behavior is to send a single SIGHUP after all the tables are built).</li>
<li><code>--nohup</code> is useful when you want to check your table with indextool before actually rotating it. indexer won't send the SIGHUP if this option is on. Table files are renamed to .tmp. Use indextool to rename table files to .new and rotate it. Example usage:</li>
</ul>
<p><code>shell
  sudo -u manticore indexer --rotate --nohup mytable
  sudo -u manticore indextool --rotate --check mytable</code></p>
<ul>
<li><code>--print-queries</code> prints out SQL queries that <code>indexer</code> sends to the database, along with SQL connection and disconnection events. That is useful to diagnose and fix problems with SQL sources.</li>
<li><code>--help</code> (<code>-h</code> for short) lists all the parameters that can be called in <code>indexer</code>.</li>
<li><code>-v</code> shows <code>indexer</code> version.</li>
</ul>
<h3 id="indexer-configuration-settings">Indexer configuration settings</h3>
<p>You can also configure indexer behavior in the Manticore configuration file in the <code>indexer</code> section:</p>
<div class="codehilite"><pre><span></span><code><span class="na">indexer {</span>
<span class="na">...</span>
<span class="na">}</span>
</code></pre></div>

<h4 id="lemmatizer_cache">lemmatizer_cache</h4>
<div class="codehilite"><pre><span></span><code><span class="na">lemmatizer_cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">256M</span>
</code></pre></div>

<p>Lemmatizer cache size. Optional, default is 256K.</p>
<p>Our <a href="20-server_settings.html#lemmatizer_base">lemmatizer</a> implementation uses a compressed dictionary format that enables a space/speed tradeoff. It can either perform lemmatization off the compressed data, using more CPU but less RAM, or it can decompress and precache the dictionary either partially or fully, thus using less CPU but more RAM. The lemmatizer_cache directive lets you control how much RAM exactly can be spent for that uncompressed dictionary cache.</p>
<p>Currently, the only available dictionaries are <a href="https://manticoresearch.com/install/">ru.pak, en.pak, and de.pak</a>. These are the Russian, English, and German dictionaries. The compressed dictionary is approximately 2 to 10 MB in size. Note that the dictionary stays in memory at all times too. The default cache size is 256 KB. The accepted cache sizes are 0 to 2047 MB. It's safe to raise the cache size too high; the lemmatizer will only use the needed memory. For example, the entire Russian dictionary decompresses to approximately 110 MB; thus setting<code>lemmatizer_cache</code> higher than that will not affect the memory use. Even when 1024 MB is allowed for the cache, if only 110 MB is needed, it will only use those 110 MB.</p>
<h4 id="max_file_field_buffer">max_file_field_buffer</h4>
<div class="codehilite"><pre><span></span><code><span class="na">max_file_field_buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">128M</span>
</code></pre></div>

<p>Maximum file field adaptive buffer size in bytes. Optional, default is 8MB, minimum is 1MB.</p>
<p>The file field buffer is used to load files referred to from <a href="12-data_creation_and_modification.html#sql_file_field">sql_file_field</a> columns. This buffer is adaptive, starting at 1 MB at first allocation, and growing in 2x steps until either the file contents can be loaded or the maximum buffer size, specified by the <code>max_file_field_buffer</code> directive, is reached.</p>
<p>Thus, if no file fields are specified, no buffer is allocated at all. If all files loaded during indexing are under (for example) 2 MB in size, but the <code>max_file_field_buffer</code> value is 128 MB, the peak buffer usage would still be only 2 MB. However, files over 128 MB would be entirely skipped.</p>
<h4 id="max_iops">max_iops</h4>
<div class="codehilite"><pre><span></span><code><span class="na">max_iops</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">40</span>
</code></pre></div>

<p>Maximum I/O operations per second, for I/O throttling. Optional, default is 0 (unlimited).</p>
<p>I/O throttling related option. It limits the maximum count of I/O operations (reads or writes) per any given second. A value of 0 means that no limit is imposed.</p>
<p><code>indexer</code> can cause bursts of intensive disk I/O during building a table, and it might be desirable to limit its disk activity (and reserve something for other programs running on the same machine, such as <code>searchd</code>). I/O throttling helps to do that. It works by enforcing a minimum guaranteed delay between subsequent disk I/O operations performed by <code>indexer</code>. Throttling I/O can help reduce search performance degradation caused by building. This setting is not effective for other kinds of data ingestion, e.g. inserting data into a real-time table.</p>
<h4 id="max_iosize">max_iosize</h4>
<div class="codehilite"><pre><span></span><code><span class="na">max_iosize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1048576</span>
</code></pre></div>

<p>Maximum allowed I/O operation size, in bytes, for I/O throttling. Optional, default is 0 (unlimited).</p>
<p>I/O throttling related option. It limits the maximum file I/O operation (read or write) size for all operations performed by <code>indexer</code>. A value of 0 means that no limit is imposed. Reads or writes that are bigger than the limit will be split into several smaller operations, and counted as several operations by the <a href="12-data_creation_and_modification.html#max_iops">max_iops</a> setting. At the time of this writing, all I/O calls should be under 256 KB (default internal buffer size) anyway, so max_iosize values higher than 256 KB should not have any effect.</p>
<h4 id="max_xmlpipe2_field">max_xmlpipe2_field</h4>
<div class="codehilite"><pre><span></span><code><span class="na">max_xmlpipe2_field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">8M</span>
</code></pre></div>

<p>Maximum allowed field size for XMLpipe2 source type, in bytes. Optional, default is 2 MB.</p>
<h4 id="mem_limit">mem_limit</h4>
<div class="codehilite"><pre><span></span><code><span class="na">mem_limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">256M</span>
<span class="c1"># mem_limit = 262144K # same, but in KB</span>
<span class="c1"># mem_limit = 268435456 # same, but in bytes</span>
</code></pre></div>

<p>Plain table building RAM usage limit. Optional, default is 128 MB. Enforced memory usage limit that the <code>indexer</code> will not go above. Can be specified in bytes, or kilobytes (using K postfix), or megabytes (using M postfix); see the example. This limit will be automatically raised if set to an extremely low value causing I/O buffers to be less than 8 KB; the exact lower bound for that depends on the built data size. If the buffers are less than 256 KB, a warning will be produced.</p>
<p>The maximum possible limit is 2047M. Too low values can hurt plain table building speed, but 256M to 1024M should be enough for most, if not all datasets. Setting this value too high can cause SQL server timeouts. During the document collection phase, there will be periods when the memory buffer is partially sorted and no communication with the database is performed; and the database server can timeout. You can resolve that either by raising timeouts on the SQL server side or by lowering <code>mem_limit</code>.  </p>
<h4 id="on_file_field_error">on_file_field_error</h4>
<div class="codehilite"><pre><span></span><code><span class="na">on_file_field_error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">skip_document</span>
</code></pre></div>

<p>How to handle IO errors in file fields. Optional, default is <code>ignore_field</code>.<br />
When there is a problem indexing a file referenced by a file field (<a href="12-data_creation_and_modification.html#sql_file_field">sql_file_field</a>), <code>indexer</code> can either process the document, assuming empty content in this particular field, or skip the document, or fail indexing entirely. <code>on_file_field_error</code> directive controls that behavior. The values it takes are:</p>
<ul>
<li><code>ignore_field</code>, process the current document without field;</li>
<li><code>skip_document</code>, skip the current document but continue indexing;</li>
<li><code>fail_index</code>, fail indexing with an error message.</li>
</ul>
<p>The problems that can arise are: open error, size error (file too big), and data read error. Warning messages on any problem will be given at all times, regardless of the phase and the <code>on_file_field_error</code> setting.</p>
<p>Note that with <code>on_file_field_error = skip_document</code> documents will only be ignored if problems are detected during an early check phase, and <strong>not</strong> during the actual file parsing phase. <code>indexer</code> will open every referenced file and check its size before doing any work, and then open it again when doing actual parsing work. So in case a file goes away between these two open attempts, the document will still be indexed.</p>
<h4 id="write_buffer">write_buffer</h4>
<div class="codehilite"><pre><span></span><code><span class="na">write_buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">4M</span>
</code></pre></div>

<p>Write buffer size, bytes. Optional, default is 1MB. Write buffers are used to write both temporary and final table files when indexing. Larger buffers reduce the number of required disk writes. Memory for the buffers is allocated in addition to <a href="12-data_creation_and_modification.html#mem_limit">mem_limit</a>. Note that several (currently up to 4) buffers for different files will be allocated, proportionally increasing the RAM usage.</p>
<h4 id="ignore_non_plain">ignore_non_plain</h4>
<div class="codehilite"><pre><span></span><code><span class="na">ignore_non_plain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1</span>
</code></pre></div>

<p><code>ignore_non_plain</code> allows you to completely ignore warnings about skipping non-plain tables. The default is 0 (not ignoring).</p>
<!-- proofread -->

<h3 id="schedule-indexer-via-systemd">Schedule indexer via systemd</h3>
<p>There are two approaches to scheduling indexer runs. The first way is the classical method of using crontab. The second way is using a systemd timer with a user-defined schedule. To create the timer unit files, you should place them in the appropriate directory where systemd looks for such unit files. On most Linux distributions, this directory is typically <code>/etc/systemd/system</code>. Here's how to do it:</p>
<ol>
<li>Create a timer unit file for your custom schedule:</li>
</ol>
<div class="codehilite"><pre><span></span><code>cat<span class="w"> </span><span class="s">&lt;&lt; EOF &gt; /etc/systemd/system/manticore-indexer@.timer</span>
<span class="s">[Unit]</span>
<span class="s">Description=Run Manticore Search&#39;s indexer on schedule</span>
<span class="s">[Timer]</span>
<span class="s">OnCalendar=minutely</span>
<span class="s">RandomizedDelaySec=5m</span>
<span class="s">Unit=manticore-indexer@%i.service</span>
<span class="s">[Install]</span>
<span class="s">WantedBy=timers.target</span>
<span class="s">EOF</span>
</code></pre></div>

<p>More on the <code>OnCalendar</code> syntax and examples can be found <a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.time.html#Calendar%20Events">here</a>.</p>
<ol start="2">
<li>Edit the timer unit for your specific needs.</li>
<li>Enable the timer:</li>
</ol>
<div class="codehilite"><pre><span></span><code>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>manticore-indexer@idx1.timer
</code></pre></div>

<ol start="4">
<li>Start the timer:</li>
</ol>
<div class="codehilite"><pre><span></span><code>systemctl<span class="w"> </span>start<span class="w"> </span>manticore-indexer@idx1.timer
</code></pre></div>

<ol start="5">
<li>Repeat steps 2-4 for any additional timers.</li>
</ol>
        
    </section>
    
    <section class="chapter-section" id="toc-12.02.02-fetching_from_databases">
        <header>
            <a class="chapter-link" href="#toc-12.02.02-fetching_from_databases"> ¶ 12.2.2</a>

            
            <h1>Fetching from databases</h1>
            
        </header>

        
    </section>
    
    <section class="chapter-section" id="toc-12.02.02.01-introduction">
        <header>
            <a class="chapter-link" href="#toc-12.02.02.01-introduction"> ¶ 12.2.2.1</a>

            
            <h1 id="introduction">Introduction</h1>
            
        </header>

        
        
<p>Manticore Search allows fetching data from databases using specialized drivers or ODBC. Current drivers include:</p>
<ul>
<li><code>mysql</code> - for MySQL/MariaDB/Percona MySQL databases</li>
<li><code>pgsql</code> - for PostgreSQL database</li>
<li><code>mssql</code> - for Microsoft SQL database</li>
<li><code>odbc</code> - for any database that accepts connections using ODBC</li>
</ul>
<p>To fetch data from the database, a source must be configured with type as one of the above. The source requires information about how to connect to the database and the query that will be used to fetch the data. Additional pre- and post-queries can also be set - either to configure session settings or to perform pre/post fetch tasks. The source also must contain definitions of data types for the columns that are fetched.</p>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-12.02.02.02-database_connection">
        <header>
            <a class="chapter-link" href="#toc-12.02.02.02-database_connection"> ¶ 12.2.2.2</a>

            
            <h1 id="database-connection">Database connection</h1>
            
        </header>

        
        
<p>The source definition must contain the settings of the connection, this includes the host, port, user credentials, or specific settings of a driver.</p>
<h2 id="sql_host">sql_host</h2>
<p>The database server host to connect to. Note that the MySQL client library chooses whether to connect over TCP/IP or over UNIX socket based on the host name. Specifically, "localhost" will force it to use UNIX socket (this is the default and generally recommended mode) and "127.0.0.1" will force TCP/IP usage.</p>
<h2 id="sql_port">sql_port</h2>
<p>The server IP port to connect to. <br />
For <code>mysql</code> the default is 3306 and for <code>pgsql</code>, it is 5432.</p>
<h2 id="sql_db">sql_db</h2>
<p>The SQL database to use after the connection is established and perform further queries within.</p>
<h2 id="sql_user">sql_user</h2>
<p>The username used for connecting.</p>
<h2 id="sql_pass">sql_pass</h2>
<p>The user password to use when connecting. If the password includes <code>#</code> (which can be used to add comments in the configuration file), you can escape it with <code>\</code>.</p>
<h2 id="sql_sock">sql_sock</h2>
<p>UNIX socket name to connect to for local database servers. Note that it depends on the <code>sql_host</code> setting whether this value will actually be used.</p>
<div class="codehilite"><pre><span></span><code><span class="na">sql_sock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/var/lib/mysql/mysql.sock</span>
</code></pre></div>

<h2 id="specific-settings-for-drivers">Specific settings for drivers</h2>
<h3 id="mysql">MySQL</h3>
<h4 id="mysql_connect_flags">mysql_connect_flags</h4>
<p>MySQL client connection flags. Optional, the default value is 0 (do not set any flags).</p>
<p>This option must contain an integer value with the sum of the flags. The value will be passed to mysql_real_connect() verbatim. The flags are enumerated in mysql_com.h include file. Flags that are especially interesting in regard to indexing, with their respective values, are as follows:</p>
<ul>
<li>CLIENT_COMPRESS = 32; can use compression protocol</li>
<li>CLIENT_SSL = 2048; switch to SSL after handshake</li>
<li>CLIENT_SECURE_CONNECTION = 32768; new 4.1 authentication<br />
For instance, you can specify 2080 (2048+32) to use both compression and SSL, or 32768 to use new authentication only. Initially, this option was introduced to be able to use compression when the indexer and mysqld are on different hosts. Compression on 1 Gbps links is most likely to hurt indexing time though it reduces network traffic, both in theory and in practice. However, enabling compression on 100 Mbps links may improve indexing time significantly (up to 20-30% of the total indexing time improvement was reported). Your mileage may vary.</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="na">mysql_connect_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">32</span><span class="w"> </span><span class="c1"># enable compression</span>
</code></pre></div>

<h3 id="ssl-certificate-settings">SSL certificate settings</h3>
<ul>
<li><code>mysql_ssl_cert</code> - path to SSL certificate</li>
<li><code>mysql_ssl_key</code> - path to SSL key file</li>
<li><code>mysql_ssl_ca</code> - path to CA certificate</li>
</ul>
<h3 id="unpack_mysqlcompress">unpack_mysqlcompress</h3>
<div class="codehilite"><pre><span></span><code><span class="na">unpack_mysqlcompress_maxsize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1M</span>
</code></pre></div>

<p>Columns to unpack using MySQL <code>UNCOMPRESS()</code> algorithm. Multi-value, optional, default value is an empty list of columns.</p>
<p>Columns specified using this directive will be unpacked by the indexer using the modified zlib algorithm used by MySQL <code>COMPRESS()</code> and <code>UNCOMPRESS()</code> functions. When indexing on a different box than the database, this lets you offload the database and save on network traffic. This feature is only available if zlib and zlib-devel were both available during build time.</p>
<div class="codehilite"><pre><span></span><code><span class="na">unpack_mysqlcompress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">body_compressed</span>
<span class="na">unpack_mysqlcompress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">description_compressed</span>
</code></pre></div>

<p>By default, a buffer of 16M is used for uncompressing the data. This can be changed by setting <code>unpack_mysqlcompress_maxsize</code>.</p>
<p>When using unpack_mysqlcompress, due to implementation intricacies, it is not possible to deduce the required buffer size from the compressed data. So, the buffer must be preallocated in advance, and the unpacked data can not go over the buffer size.</p>
<h3 id="unpack_zlib">unpack_zlib</h3>
<div class="codehilite"><pre><span></span><code><span class="na">unpack_zlib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">col1</span>
<span class="na">unpack_zlib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">col2</span>
</code></pre></div>

<p>Columns to unpack using zlib (aka deflate, aka gunzip). Multi-value, optional, default value is an empty list of columns. Applies to source types <code>mysql</code> and <code>pgsql</code> only.</p>
<p>Columns specified using this directive will be unpacked by the <code>indexer</code> using the standard zlib algorithm (called deflate and also implemented by <code>gunzip</code>). When indexing on a different box than the database, this lets you offload the database and save on network traffic. This feature is only available if zlib and zlib-devel were both available during build time.</p>
<h3 id="mssql">MSSQL</h3>
<p>MS SQL Windows authentication flag. Whether to use currently logged-in Windows account credentials for authentication when connecting to MS SQL Server.</p>
<div class="codehilite"><pre><span></span><code><span class="na">mssql_winauth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1</span>
</code></pre></div>

<h3 id="odbc">ODBC</h3>
<p>Sources using ODBC require the presence of a DSN (Data Source Name) string which can be set with <code>odbc_dsn</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="na">odbc_dsn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">Driver={Oracle ODBC Driver}</span><span class="c1">;Dbq=myDBName;Uid=myUsername;Pwd=myPassword</span>
</code></pre></div>

<p>Please note that the format depends on the specific ODBC driver used.</p>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-12.02.02.03-execution_of_fetch_queries">
        <header>
            <a class="chapter-link" href="#toc-12.02.02.03-execution_of_fetch_queries"> ¶ 12.2.2.3</a>

            
            <h1 id="execution-of-fetch-queries">Execution of fetch queries</h1>
            
        </header>

        
        
<p>With all the SQL drivers, building a plain table generally works as follows.</p>
<ul>
<li>A connection to the database is established.</li>
<li>The <code>sql_query_pre_all</code> queries are executed to perform any necessary initial setup, such as setting per-connection encoding with MySQL. These queries run before the entire indexing process, and also after a reconnect for indexing MVA attributes and joined fields.</li>
<li>The <code>sql_query_pre</code> pre-query is executed to perform any necessary initial setup, such as setting up temporary tables or maintaining counter tables. These queries run once for the entire indexing process.</li>
<li>
<p>Pre-queries as <code>sql_query_pre</code> is executed to perform any necessary initial setup, such as setting up temporary<br />
  tables, or maintaining counter table. These queries run once per whole indexing.</p>
</li>
<li>
<p>Main query as <code>sql_query</code> is executed and the rows it returns are processed.</p>
</li>
<li>Post-query as <code>sql_query_post</code> is executed to perform some necessary cleanup.</li>
<li>The connection to the database is closed.</li>
<li>Indexer does the sorting phase (to be pedantic, table-type specific post-processing).</li>
<li>A connection to the database is established again.</li>
<li>Post-processing query as <code>sql_query_post_index</code> is executed to perform some necessary final cleanup.</li>
<li>The connection to the database is closed again.</li>
</ul>
<p>Example of a source fetching data from MYSQL:</p>
<div class="codehilite"><pre><span></span><code><span class="na">source mysource {</span>
<span class="w">  </span><span class="na">type</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="s">mysql</span>
<span class="w">  </span><span class="na">path</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="s">/path/to/realtime</span>
<span class="w">  </span><span class="na">sql_host</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">localhost</span>
<span class="w">  </span><span class="na">sql_user</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">myuser</span>
<span class="w">  </span><span class="na">sql_pass</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s">mypass</span>
<span class="w">  </span><span class="na">sql_db</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s">mydb</span>
<span class="w">  </span><span class="na">sql_query_pre</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s">SET CHARACTER_SET_RESULTS=utf8</span>
<span class="w">  </span><span class="na">sql_query_pre</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s">SET NAMES utf8</span>
<span class="w">  </span><span class="na">sql_query</span><span class="w">        </span><span class="o">=</span><span class="w">  </span><span class="s">SELECT id, title, description, category_id  FROM mytable</span>
<span class="w">  </span><span class="na">sql_query_post</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s">DROP TABLE view_table</span>
<span class="w">  </span><span class="na">sql_query_post_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">REPLACE INTO counters ( id, val ) </span>\
<span class="w">    </span><span class="s">VALUES ( &#39;max_indexed_id&#39;, $maxid )</span>
<span class="w">  </span><span class="na">sql_attr_uint</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s">category_id</span>
<span class="w">  </span><span class="na">sql_field_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">title</span>
<span class="w"> </span><span class="na">}</span>

<span class="na">table mytable {</span>
<span class="w">  </span><span class="na">type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s">plain</span>
<span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">mysource</span>
<span class="w">  </span><span class="na">path</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s">/path/to/mytable</span>
<span class="w">  </span><span class="na">...</span>
<span class="w"> </span><span class="na">}</span>
</code></pre></div>

<h2 id="sql_query">sql_query</h2>
<p>This is the query used to retrieve documents from a SQL server. There can be only one sql_query declared, and it's mandatory to have one. See also <a href="../12-data_creation_and_modification.html#processing-fetched-data">Processing fetched data</a></p>
<h2 id="sql_query_pre">sql_query_pre</h2>
<p>Pre-fetch query or pre-query. This is a multi-value, optional setting, with the default being an empty list of queries. The pre-queries are executed before the sql_query in the order they appear in the configuration file. The results of the pre-queries are ignored.</p>
<p>Pre-queries are useful in many ways. They can be used to set up encoding, mark records that are going to be indexed, update internal counters, set various per-connection SQL server options and variables, and so on.</p>
<p>Perhaps the most frequent use of pre-query is to specify the encoding that the server will use for the rows it returns. Note that Manticore accepts only UTF-8 text. Two MySQL specific examples of setting the encoding are:</p>
<div class="codehilite"><pre><span></span><code><span class="na">sql_query_pre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">SET CHARACTER_SET_RESULTS=utf8</span>
<span class="na">sql_query_pre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">SET NAMES utf8</span>
</code></pre></div>

<p>Also, specific to MySQL sources, it is useful to disable query cache (for indexer connection only) in pre-query, because indexing queries are not going to be re-run frequently anyway, and there's no sense in caching their results.<br />
That could be achieved with:</p>
<div class="codehilite"><pre><span></span><code><span class="na">sql_query_pre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">SET SESSION query_cache_type=OFF</span>
</code></pre></div>

<h2 id="sql_query_post">sql_query_post</h2>
<p>Post-fetch query. This is an optional setting, with the default value being empty.</p>
<p>This query is executed immediately after sql_query completes successfully. When the post-fetch query produces errors, they are reported as warnings, but indexing is not terminated. Its result set is ignored. Note that indexing is not yet completed at the point when this query gets executed, and further indexing may still fail. Therefore, any permanent updates should not be done from here. For instance, updates on a helper table that permanently change the last successfully indexed ID should not be run from the <code>sql_query_post</code> query; they should be run from the <code>sql_query_post_index</code> query instead.</p>
<h2 id="sql_query_post_index">sql_query_post_index</h2>
<p>Post-processing query. This is an optional setting, with the default value being empty.</p>
<p>This query is executed when indexing is fully and successfully completed. If this query produces errors, they are reported as warnings, but indexing is not terminated. Its result set is ignored. The <code>$maxid</code> macro can be used in its text; it will be expanded to the maximum document ID that was actually fetched from the database during indexing. If no documents were indexed, <code>$maxid</code> will be expanded to 0.</p>
<p>Example:</p>
<div class="codehilite"><pre><span></span><code><span class="na">sql_query_post_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">REPLACE INTO counters ( id, val ) </span>\
<span class="w">    </span><span class="s">VALUES ( &#39;max_indexed_id&#39;, $maxid )</span>
</code></pre></div>

<p>The difference between <code>sql_query_post</code> and <code>sql_query_post_index</code> is that <code>sql_query_post</code> is run immediately when Manticore receives all the documents, but further indexing may still fail for some other reason. On the contrary, by the time the <code>sql_query_post_index</code> query gets executed, it is guaranteed that the table was created successfully. Database connection is dropped and re-established because sorting phase can be very lengthy and would just time out otherwise.</p>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-12.02.02.04-processing_fetched_data">
        <header>
            <a class="chapter-link" href="#toc-12.02.02.04-processing_fetched_data"> ¶ 12.2.2.4</a>

            
            <h1 id="processing-fetched-data">Processing fetched data</h1>
            
        </header>

        
        
<p>By default, the first column from the result set of <code>sql_query</code> is indexed as the document id.</p>
<p>Document ID <em>MUST</em> be the very first field, and it <strong>MUST BE</strong> UNIQUE SIGNED (NON-ZERO) INTEGER NUMBER from -9223372036854775808 to 9223372036854775807.</p>
<p>You can specify up to 256 full-text fields and an arbitrary amount of attributes. All the columns that are neither document ID (the first one) nor attributes will be indexed as full-text fields.</p>
<h2 id="declaration-of-attributes">Declaration of attributes:</h2>
<h3 id="sql_attr_bigint">sql_attr_bigint</h3>
<p>Declares a 64-bit <em>signed</em> integer.</p>
<h3 id="sql_attr_bool">sql_attr_bool</h3>
<p>Declares a boolean attribute. It's equivalent to an integer attribute with bit count of 1.</p>
<h3 id="sql_attr_float">sql_attr_float</h3>
<p>Declares a floating point attribute.</p>
<p>The values will be stored in single precision, 32-bit IEEE 754 format. Represented range is approximately from 1e-38 to 1e+38. The amount of decimal digits that can be stored precisely is approximately 7.</p>
<p>One important usage of float attributes is storing latitude and longitude values (in radians), for further usage in query-time geosphere distance calculations.</p>
<h3 id="sql_attr_json">sql_attr_json</h3>
<p>Declares a JSON attribute.</p>
<p>When indexing JSON attributes, Manticore expects a text field with JSON formatted data. JSON attributes support arbitrary JSON data with no limitation in nested levels or types.</p>
<h3 id="sql_attr_multi">sql_attr_multi</h3>
<p>Declares a multi-value attribute.</p>
<p>Plain attributes only allow attaching 1 value per each document. However, there are cases (such as tags or categories) when it is desired to attach multiple values of the same attribute and be able to apply filtering or grouping to value lists.</p>
<p>The MVA can take the values from a column (like the rest of the data types) - in this case, the column in the result set must provide a string with multiple integer values separated by commas - or by running a separate query to get the values.</p>
<p>When executing a query, the engine runs the query, groups the results by IDs, and assigns the values to their corresponding documents in the table. Values with an ID not found in the table are discarded. Before executing the query, any defined <code>sql_query_pre_all</code> will be run.</p>
<p>The declaration format for sql_attr_multi is as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="na">sql_attr_multi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">ATTR-TYPE ATTR-NAME &#39;from&#39; SOURCE-TYPE </span>\
<span class="w">    </span><span class="s">[;QUERY] </span>\
<span class="w">    </span><span class="s">[;RANGED-QUERY]</span>
</code></pre></div>

<p>where</p>
<ul>
<li>ATTR-TYPE is <code>uint</code>, <code>bigint</code> or <code>timestamp</code>.</li>
<li>SOURCE-TYPE is <code>field</code>, <code>query</code>, <code>ranged-query</code>, or <code>ranged-main-query</code>.</li>
<li>QUERY is an optional SQL query used to fetch all (docid, attrvalue) pairs.</li>
<li>RANGED-QUERY is an optional SQL query used to fetch min and max ID values, similar to <code>sql_query_range</code>.</li>
<li>The backslashes are included for clarity only; everything can be declared in a single line as well.</li>
</ul>
<p>It's used with ranged-query SOURCE-TYPE. If using <code>ranged-main-query</code> SOURCE-TYPE, then omit the RANGED-QUERY, and it will automatically use the same query from <code>sql_query_range</code>(useful option in complex inheritance setups to save having to manually duplicate the same query many times).</p>
<div class="codehilite"><pre><span></span><code><span class="na">sql_attr_multi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">uint tag from field</span>
<span class="na">sql_attr_multi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">uint tag from query</span><span class="c1">; SELECT id, tag FROM tags</span>
<span class="na">sql_attr_multi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">bigint tag from ranged-query</span><span class="c1">; \</span>
<span class="w">    </span><span class="na">SELECT id, tag FROM tags WHERE id&gt;</span><span class="o">=</span><span class="s">$start AND id&lt;=$end</span><span class="c1">; \</span>
<span class="w">    </span><span class="na">SELECT MIN(id), MAX(id) FROM tags</span>
</code></pre></div>

<h3 id="sql_attr_string">sql_attr_string</h3>
<p>Declares a string attribute. The maximum size of each value is fixed at 4GB.</p>
<h3 id="sql_attr_timestamp">sql_attr_timestamp</h3>
<p>Declares a UNIX timestamp.</p>
<p>Timestamps can store dates and times in the range of January 01, 1970, to January 19, 2038, with a precision of one second. The expected column value should be a timestamp in UNIX format, which is a 32-bit unsigned integer number of seconds elapsed since midnight on January 01, 1970, GMT. Timestamps are internally stored and handled as integers everywhere. In addition to working with timestamps as integers, you can also use them with different date-based functions, such as time segments sorting mode or day/week/month/year extraction for GROUP BY.</p>
<p>Note that DATE or DATETIME column types in MySQL cannot be directly used as timestamp attributes in Manticore; you need to explicitly convert such columns using UNIX_TIMESTAMP function (if the data is in range).</p>
<p>Note timestamps can not represent dates before January 01, 1970, and UNIX_TIMESTAMP() in MySQL will not return anything expected. If you only need to work with dates, not times, consider <code>TO_DAYS()</code> function in MySQL instead.</p>
<h3 id="sql_attr_uint">sql_attr_uint</h3>
<p>Declares an unsigned integer attribute.</p>
<p>You can specify the bit count for integer attributes by appending ':BITCOUNT' to attribute name (see example below). Attributes with less than default 32-bit size, or bitfields, perform slower.</p>
<div class="codehilite"><pre><span></span><code><span class="na">sql_attr_uint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">group_id</span>
<span class="na">sql_attr_uint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">forum_id:9</span><span class="w"> </span><span class="c1"># 9 bits for forum_id</span>
</code></pre></div>

<h3 id="sql_field_string">sql_field_string</h3>
<p>Declares a combo string attribute/text field. The values will be indexed as a full-text field, but also stored in a string attribute with the same name. Note, it should only be used when you are sure you want the field to be searchable both in a full-text manner and as an attribute (with the ability to sort and group by it). If you just want to be able to fetch the original value of the field, you don't need to do anything for it unless you implicitly removed the field from the stored fields list via <a href="../06-creating_a_table.html#stored_fields">stored_fields</a>.</p>
<div class="codehilite"><pre><span></span><code><span class="na">sql_field_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">name</span>
</code></pre></div>

<h3 id="sql_file_field">sql_file_field</h3>
<p>Declares a file based field.</p>
<p>This directive makes indexer interpret field contents as a file name, and load and process the referred file. Files larger than max_file_field_buffer in size are skipped. Any errors during the file loading (IO errors, missed limits, etc.) will be reported as indexing warnings and will not early terminate the indexing. No content will be indexed for such files.</p>
<div class="codehilite"><pre><span></span><code><span class="na">sql_file_field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">field_name</span>
</code></pre></div>

<h3 id="sql_joined_field">sql_joined_field</h3>
<p>Joined/payload field fetch query. Multi-value, optional, the default is an empty list of queries.</p>
<p><code>sql_joined_field</code> lets you use two different features: joined fields and payloads (payload fields). Its syntax is as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="na">sql_joined_field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">FIELD-NAME &#39;from&#39;  ( &#39;query&#39; | &#39;payload-query&#39; | &#39;ranged-query&#39; | &#39;ranged-main-query&#39; )</span><span class="c1">; \</span>
<span class="w">        </span><span class="na">QUERY [ ; RANGE-QUERY ]</span>
</code></pre></div>

<p>where</p>
<ul>
<li>FIELD-NAME is a joined/payload field name</li>
<li>QUERY is an SQL query that must fetch values for further processing</li>
<li>RANGE-QUERY is an optional SQL query that fetches a range of values to process</li>
</ul>
<p><strong>Joined fields</strong> let you avoid JOIN and/or GROUP_CONCAT statements in the main document fetch query (sql_query). This can be useful when the SQL-side JOIN is slow, or needs to be offloaded on the Manticore side, or simply to emulate MySQL-specific <code>GROUP_CONCAT</code> functionality in case your database server does not support it.</p>
<p>The query must return exactly 2 columns: document ID, and text to append to a joined field. Document IDs can be duplicate, but they must be in ascending order. All the text rows fetched for a given ID will be concatenated together, and the concatenation result will be indexed as the entire contents of a joined field. Rows will be concatenated in the order returned from the query, and separating whitespace will be inserted between them. For instance, if the joined field query returns the following rows:</p>
<div class="codehilite"><pre><span></span><code><span class="na">( 1, &#39;red&#39; )</span>
<span class="na">( 1, &#39;right&#39; )</span>
<span class="na">( 1, &#39;hand&#39; )</span>
<span class="na">( 2, &#39;mysql&#39; )</span>
<span class="na">( 2, &#39;manticore&#39; )</span>
</code></pre></div>

<p>then the indexing results would be equivalent to adding a new text field with a value of 'red right hand' to document 1 and 'mysql sphinx' to document 2, including the keyword positions inside the field in the order they come from the query. If the rows need to be in a specific order, that needs to be explicitly defined in the query.</p>
<p>Joined fields are only indexed differently. There are no other differences between joined fields and regular text fields.</p>
<p>Before executing the joined fields query, any set of <code>sql_query_pre_all</code> will be run, if any exist. This allows you to set the desired encoding, etc., within the joined fields' context.</p>
<p>When a single query is not efficient enough or does not work because of the database driver limitations, ranged queries can be used. It works similarly to the ranged queries in the main indexing loop. The range will be queried for and fetched upfront once, then multiple queries with different <code>$start</code> and <code>$end</code> substitutions will be run to fetch the actual data.</p>
<p>When using <code>ranged-main-query</code> query, omit the <code>ranged-query</code>, and it will automatically use the same query from <code>sql_query_range</code> (a useful option in complex inheritance setups to save having to manually duplicate the same query many times).</p>
<!-- example payload -->

<p><strong>Payloads</strong> let you create a special field in which, instead of keyword positions, so-called user payloads are stored. Payloads are custom integer values attached to every keyword. They can then be used at search time to affect the ranking.</p>
<p>The payload query must return exactly 3 columns:<br />
- document ID<br />
- keyword<br />
- and integer payload value.</p>
<p>Document IDs can be duplicate, but they must be in ascending order. Payloads <strong>must</strong> be unsigned integers within the 24-bit range, i.e., from 0 to 16777215.</p>
<p>The only ranker that accounts for payloads is <code>proximity_bm25</code> (the default <a href="13-searching.html#available-built-in-rankers">ranker</a>). On tables with payload fields, it will automatically switch to a variant that matches keywords in those fields, computes a sum of matched payloads multiplied by field weights, and adds that sum to the final rank.</p>
<p>Please note that the payload field is ignored for full-text queries containing complex operators. It only works for simple bag-of-words queries.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>
Configuration example:
<!-- request Configuration file -->

<div class="codehilite"><pre><span></span><code><span class="na">source min {</span>
<span class="w">    </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">mysql</span>
<span class="w">    </span><span class="na">sql_host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">localhost</span>
<span class="w">    </span><span class="na">sql_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">test</span>
<span class="w">    </span><span class="na">sql_pass</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="na">sql_db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">test</span>
<span class="w">    </span><span class="na">sql_query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">select 1, &#39;Nike bag&#39; f </span>\
<span class="w">    </span><span class="s">UNION select 2, &#39;Adidas bag&#39; f </span>\
<span class="w">    </span><span class="s">UNION select 3, &#39;Reebok bag&#39; f </span>\
<span class="w">    </span><span class="s">UNION select 4, &#39;Nike belt&#39; f</span>

<span class="w">    </span><span class="na">sql_joined_field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">tag from payload-query</span><span class="c1">; select 1 id, &#39;nike&#39; tag, 10 weight \</span>
<span class="w">    </span><span class="na">UNION select 4 id, &#39;nike&#39; tag, 10 weight;</span>
<span class="na">}</span>

<span class="na">index idx {</span>
<span class="w">    </span><span class="na">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">idx</span>
<span class="w">    </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">min</span>
<span class="na">}</span>
</code></pre></div>



<!-- request Just SELECT -->

<div class="codehilite"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">idx</span><span class="p">;</span>
<span class="o">+</span><span class="c1">------+------------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">f</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">tag</span><span class="w">  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------------+------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Nike</span><span class="w"> </span><span class="n">bag</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">nike</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Adidas</span><span class="w"> </span><span class="n">bag</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Reebok</span><span class="w"> </span><span class="n">bag</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Nike</span><span class="w"> </span><span class="n">belt</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">nike</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------------+------+</span>
<span class="mi">4</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- request Full-text search -->

Note that when you search for `nike | adidas`, the results containing "nike" receive a higher weight due to the "nike" tag and its weight originating from the payload query.

<div class="codehilite"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">weight</span><span class="p">()</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">match</span><span class="p">(</span><span class="s1">&#39;nike|adidas&#39;</span><span class="p">);</span>
<span class="o">+</span><span class="c1">------+------------+------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">f</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">tag</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">weight</span><span class="p">()</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------------+------+----------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Nike</span><span class="w"> </span><span class="n">bag</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">nike</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">11539</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Nike</span><span class="w"> </span><span class="n">belt</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">nike</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">11539</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Adidas</span><span class="w"> </span><span class="n">bag</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w">     </span><span class="mi">1597</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------------+------+----------+</span>
<span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- request Complex full-text search -->

Note that the special payload field is ignored for full-text queries containing complex operators. It only works for simple bag-of-words queries.


<div class="codehilite"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">weight</span><span class="p">()</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">match</span><span class="p">(</span><span class="s1">&#39;&quot;nike bag&quot;|&quot;adidas bag&quot;&#39;</span><span class="p">);</span>
<span class="o">+</span><span class="c1">------+------------+------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">f</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">tag</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">weight</span><span class="p">()</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------------+------+----------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Adidas</span><span class="w"> </span><span class="n">bag</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w">     </span><span class="mi">2565</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Nike</span><span class="w"> </span><span class="n">bag</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">nike</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">2507</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------------+------+----------+</span>
<span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<h3 id="sql_column_buffers">sql_column_buffers</h3>
<div class="codehilite"><pre><span></span><code><span class="na">sql_column_buffers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;colname&gt;=&lt;size&gt;[K|M] [, ...]</span>
</code></pre></div>

<p>Per-column buffer sizes. Optional, default is empty (deduce the sizes automatically). Applies to <code>odbc</code>, <code>mssql</code> source types only.</p>
<p>ODBC and MS SQL drivers sometimes cannot return the maximum actual column size to be expected. For instance,<code>NVARCHAR(MAX)</code> columns always report their length as 2147483647 bytes to <code>indexer</code> even though the actually used length is likely considerably less. However, the receiving buffers still need to be allocated upfront, and their sizes have to be determined. When the driver does not report the column length at all, Manticore allocates default 1 KB buffers for each non-char column, and 1 MB buffers for each char column. Driver-reported column length also gets clamped by an upper limit of 8 MB, so in case the driver reports (almost) a 2 GB column length, it will be clamped and an 8 MB buffer will be allocated instead for that column. These hard-coded limits can be overridden using the <code>sql_column_buffers</code> directive, either in order to save memory on actually shorter columns or to overcome the 8 MB limit on actually longer columns. The directive values must be a comma-separated list of selected column names and sizes:</p>
<p>Example:</p>
<div class="codehilite"><pre><span></span><code><span class="na">sql_query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">SELECT id, mytitle, mycontent FROM documents</span>
<span class="na">sql_column_buffers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">mytitle=64K, mycontent=10M</span>
</code></pre></div>

<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-12.02.02.05-ranged_queries">
        <header>
            <a class="chapter-link" href="#toc-12.02.02.05-ranged_queries"> ¶ 12.2.2.5</a>

            
            <h1 id="ranged-queries">Ranged queries</h1>
            
        </header>

        
        
<p>Main query, which needs to fetch all the documents, can impose a read lock on the whole table and stall the concurrent queries (e.g. INSERTs to MyISAM table), waste a lot of memory for result set, etc. To avoid this, Manticore supports so-called <em>ranged queries</em>. With ranged queries, Manticore first fetches min and max document IDs from the table, and then substitutes different ID intervals into main query text and runs the modified query to fetch another chunk of documents. Here's an example.</p>
<p>Ranged query usage example:</p>
<div class="codehilite"><pre><span></span><code><span class="na">sql_query_range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">SELECT MIN(id),MAX(id) FROM documents</span>
<span class="na">sql_range_step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1000</span>
<span class="na">sql_query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">SELECT * FROM documents WHERE id&gt;=$start AND id&lt;=$end</span>
</code></pre></div>

<p>If the table contains document IDs from 1 to, say, 2345, then sql_query would be run three times:</p>
<ol>
<li>with <code>$start</code> replaced with 1 and <code>$end</code> replaced with 1000;</li>
<li>with <code>$start</code> replaced with 1001 and <code>$end</code> replaced with 2000;</li>
<li>with <code>$start</code> replaced with 2001 and <code>$end</code> replaced with 2345.</li>
</ol>
<p>Obviously, that's not much of a difference for 2000-row table, but when it comes to indexing 10-million-row table, ranged queries might be of some help.</p>
<h3 id="sql_query_range">sql_query_range</h3>
<p>Defines the range query. The query specified in this option must fetch min and max document IDs that will be used as range boundaries. It must return exactly two integer fields, min ID first and max ID second; the field names are ignored. When enabled, <code>sql_query</code> will be required to contain $start and $end macros. Note that the intervals specified by $start..$end will not overlap, so you should not remove document IDs that are exactly equal to $start or $end from your query.</p>
<h3 id="sql_range_step">sql_range_step</h3>
<p>This directive defines the range query step. The default value is 1024.</p>
<h3 id="sql_ranged_throttle">sql_ranged_throttle</h3>
<p>This directive can be used to throttle the ranged query. By default, there is no throttling. Values for sql_ranged_throttle should be specified in milliseconds.</p>
<p>Throttling can be useful when the indexer imposes too much load on the database server. It causes the indexer to sleep for a given amount of time once per each ranged query step. This sleep is unconditional and is performed before the fetch query.</p>
<div class="codehilite"><pre><span></span><code><span class="na">sql_ranged_throttle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1000</span><span class="w"> </span><span class="c1"># sleep for 1 sec before each query step</span>
</code></pre></div>

<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-12.02.03-fetching_from_xml_stream">
        <header>
            <a class="chapter-link" href="#toc-12.02.03-fetching_from_xml_stream"> ¶ 12.2.3</a>

            
            <h1 id="fetching-from-xml-streams">Fetching from XML streams</h1>
            
        </header>

        
        
<p>The <code>xmlpipe2</code> source type allows for passing custom full-text and attribute data to Manticore in a custom XML format, with the schema (i.e., set of fields and attributes) specified in either the XML stream itself or in the source settings.</p>
<h2 id="declaration-of-xml-stream">Declaration of XML stream</h2>
<p>To declare the XML stream, the <code>xmlpipe_command</code> directive is mandatory and contains the shell command that produces the XML stream to be indexed. This can be a file, but it can also be a program that generates XML content on-the-fly.</p>
<h2 id="xml-file-format">XML file format</h2>
<p>When indexing an xmlpipe2 source, the indexer runs the specified command, opens a pipe to its stdout, and expects a well-formed XML stream. </p>
<p>Here's an example of what the XML stream data might look like:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;sphinx:docset&gt;</span>

<span class="nt">&lt;sphinx:schema&gt;</span>
<span class="nt">&lt;sphinx:field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;subject&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;sphinx:field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;content&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;sphinx:attr</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;published&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;timestamp&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;sphinx:attr</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;author_id&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;int&quot;</span><span class="w"> </span><span class="na">bits=</span><span class="s">&quot;16&quot;</span><span class="w"> </span><span class="na">default=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/sphinx:schema&gt;</span>

<span class="nt">&lt;sphinx:document</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;1234&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;content&gt;</span>this<span class="w"> </span>is<span class="w"> </span>the<span class="w"> </span>main<span class="w"> </span>content<span class="w"> </span><span class="cp">&lt;![CDATA[and this &lt;cdata&gt; entry</span>
<span class="cp">must be handled properly by xml parser lib]]&gt;</span><span class="nt">&lt;/content&gt;</span>
<span class="nt">&lt;published&gt;</span>1012325463<span class="nt">&lt;/published&gt;</span>
<span class="nt">&lt;subject&gt;</span>note<span class="w"> </span>how<span class="w"> </span>field/attr<span class="w"> </span>tags<span class="w"> </span>can<span class="w"> </span>be
in<span class="w"> </span><span class="nt">&lt;b&gt;</span><span class="w"> </span>class=&quot;red&quot;&gt;randomized<span class="nt">&lt;/b&gt;</span><span class="w"> </span>order<span class="nt">&lt;/subject&gt;</span>
<span class="nt">&lt;misc&gt;</span>some<span class="w"> </span>undeclared<span class="w"> </span>element<span class="nt">&lt;/misc&gt;</span>
<span class="nt">&lt;/sphinx:document&gt;</span>

<span class="nt">&lt;sphinx:document</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;1235&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;subject&gt;</span>another<span class="w"> </span>subject<span class="nt">&lt;/subject&gt;</span>
<span class="nt">&lt;content&gt;</span>here<span class="w"> </span>comes<span class="w"> </span>another<span class="w"> </span>document,<span class="w"> </span>and<span class="w"> </span>i<span class="w"> </span>am<span class="w"> </span>given<span class="w"> </span>to<span class="w"> </span>understand,
that<span class="w"> </span>in-document<span class="w"> </span>field<span class="w"> </span>order<span class="w"> </span>must<span class="w"> </span>not<span class="w"> </span>matter,<span class="w"> </span>sir<span class="nt">&lt;/content&gt;</span>
<span class="nt">&lt;published&gt;</span>1012325467<span class="nt">&lt;/published&gt;</span>
<span class="nt">&lt;/sphinx:document&gt;</span>

<span class="cm">&lt;!-- ... even more sphinx:document entries here ... --&gt;</span>

<span class="nt">&lt;sphinx:killlist&gt;</span>
<span class="nt">&lt;id&gt;</span>1234<span class="nt">&lt;/id&gt;</span>
<span class="nt">&lt;id&gt;</span>4567<span class="nt">&lt;/id&gt;</span>
<span class="nt">&lt;/sphinx:killlist&gt;</span>

<span class="nt">&lt;/sphinx:docset&gt;</span>
</code></pre></div>

<p>Arbitrary fields and attributes are allowed. They can also occur in the stream in arbitrary order within each document; the order is ignored. There is a restriction on the maximum field length; fields longer than 2 MB will be truncated to 2 MB (this limit can be changed in the source).</p>
<p>The schema, i.e., complete fields and attributes list, must be declared before any document can be parsed. This can be done either in the configuration file by using <code>xmlpipe_field</code> and <code>xmlpipe_attr_XXX</code> settings, or right in the stream using <code>&lt;sphinx:schema&gt;</code> element. <code>&lt;sphinx:schema&gt;</code> is optional. It is only allowed to occur as the very first sub-element in <code>&lt;sphinx:docset&gt;</code>. If there is no in-stream schema definition, settings from the configuration file will be used. Otherwise, stream settings take precedence. Note that the document id should be specified as a property  <code>id</code> of tag <code>&lt;sphinx:document&gt;</code> (e.g. <code>&lt;sphinx:document id="1235"&gt;</code>) and is supposed to be a unique-signed positive non-zero 64-bit integer.</p>
<p>Unknown tags (which were not declared neither as fields nor as attributes) will be ignored with a warning. In the example above, <code>&lt;misc&gt;</code> will be ignored. All embedded tags and their attributes (such as <code>&lt;strong&gt;</code> in <code>&lt;subject&gt;</code> in the example above) will be silently ignored.</p>
<p>Support for incoming stream encodings depends on whether <code>iconv</code> is installed on the system. xmlpipe2 is parsed using the <code>libexpat</code> parser, which understands US-ASCII, ISO-8859-1, UTF-8, and a few UTF-16 variants natively. Manticore's <code>configure</code> script will also check for <code>libiconv</code> presence and utilize it to handle other encodings. <code>libexpat</code> also enforces the requirement to use the UTF-8 charset on the Manticore side because the parsed data it returns is always in UTF-8.</p>
<p>XML elements (tags) recognized by xmlpipe2 (and their attributes where applicable) are:</p>
<ul>
<li><code>sphinx:docset</code> - Mandatory top-level element, denotes and contains the xmlpipe2 document set.</li>
<li><code>sphinx:schema</code> -  Optional element, must either occur as the very first child of sphinx:docset or never occur at all. Declares the document schema and contains field and attribute declarations. If present, it overrides per-source settings from the configuration file.</li>
<li><code>sphinx:field</code> - Optional element, child of sphinx:schema. Declares a full-text field. Known attributes are:<ul>
<li>"name", specifies the XML element name that will be treated as a full-text field in the subsequent documents.</li>
<li>attr", specifies whether to also index this field as a string. Possible value is "string".</li>
</ul>
</li>
<li><code>sphinx:attr</code> - Optional element, child of sphinx:schema. Declares an attribute. Known attributes are:<ul>
<li>"name", specifies the element name that should be treated as an attribute in the subsequent documents.</li>
<li>"type", specifies the attribute type. Possible values are "int", "bigint", "timestamp", "bool", "float", "multi" and "json".</li>
<li>"bits", specifies the bit size for the "int" attribute type. Valid values are 1 to 32.</li>
<li>"default", specifies the default value for this attribute that should be used if the attribute's element is not present in the document.</li>
</ul>
</li>
<li><code>sphinx:document</code> - Mandatory element, must be a child of sphinx:docset. Contains arbitrary other elements with field and attribute values to be indexed, as declared either using sphinx:field and sphinx:attr elements or in the configuration file. The only known attribute is "id" that must contain the unique integer document ID.</li>
<li><code>sphinx:killlist</code> - Optional element, child of sphinx:docset. Contains a number of "id" elements whose contents are document IDs to be put into a kill-list of the table. The kill-list is used in multi-table searches to suppress documents found in other tables of the search.</li>
</ul>
<h2 id="data-definition-in-source-configuration">Data definition in source configuration</h2>
<p>If the XML doesn't define a schema, the data types of tables elements must be defined in the source configuration.</p>
<ul>
<li><code>xmlpipe_field</code> -  declares a <code>text</code> field.</li>
<li><code>xmlpipe_field_string</code> - declares a text field/string attribute. The column will be both indexed as a text field but also stored as a string attribute.</li>
<li><code>xmlpipe_attr_uint</code> - declares an integer attribute</li>
<li><code>xmlpipe_attr_timestamp</code> - declares a timestamp attribute</li>
<li><code>xmlpipe_attr_bool</code> -  declares a boolean attribute</li>
<li><code>xmlpipe_attr_float</code> - declares a float attribute</li>
<li><code>xmlpipe_attr_bigint</code> - declares a big integer attribute</li>
<li><code>xmlpipe_attr_multi</code> - declares a multi-value attribute with integers</li>
<li><code>xmlpipe_attr_multi_64</code> - declares a multi-value attribute with 64-bit integers</li>
<li><code>xmlpipe_attr_string</code> - declares a string attribute</li>
<li><code>xmlpipe_attr_json</code> - declares a JSON attribute</li>
</ul>
<h3 id="specific-xml-source-settings">Specific XML source settings</h3>
<p>If <code>xmlpipe_fixup_utf8</code> is set it will enable Manticore-side UTF-8 validation and filtering to prevent XML parser from choking on non-UTF-8 documents. By default, this option is disabled.</p>
<p>Under certain occasions it might be hard or even impossible to guarantee that the incoming XMLpipe2 document bodies are in perfectly valid and conforming UTF-8 encoding. For instance, documents with national single-byte encodings could sneak into the stream. libexpat XML parser is fragile, meaning that it will stop processing in such cases. UTF8 fixup feature lets you avoid that. When fixup is enabled, Manticore will preprocess the incoming stream before passing it to the XML parser and replace invalid UTF-8 sequences with spaces.</p>
<div class="codehilite"><pre><span></span><code><span class="na">xmlpipe_fixup_utf8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1</span>
</code></pre></div>

<p>Example of XML source without schema in configuration:</p>
<div class="codehilite"><pre><span></span><code><span class="na">source xml_test_1</span>
<span class="na">{</span>
<span class="w">    </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">xmlpipe2</span>
<span class="w">    </span><span class="na">xmlpipe_command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">cat /tmp/products_today.xml</span>
<span class="na">}</span>
</code></pre></div>

<p>Example of XML source with schema in configuration:</p>
<div class="codehilite"><pre><span></span><code><span class="na">source xml_test_2</span>
<span class="na">{</span>
<span class="w">    </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">xmlpipe2</span>
<span class="w">    </span><span class="na">xmlpipe_command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">cat /tmp/products_today.xml</span>
<span class="w">    </span><span class="na">xmlpipe_field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">subject</span>
<span class="w">    </span><span class="na">xmlpipe_field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">content</span>
<span class="w">    </span><span class="na">xmlpipe_attr_timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">published</span>
<span class="w">    </span><span class="na">xmlpipe_attr_uint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">author_id:16</span>
<span class="na">}</span>
</code></pre></div>

<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-12.02.04-fetching_from_csvtsv">
        <header>
            <a class="chapter-link" href="#toc-12.02.04-fetching_from_csvtsv"> ¶ 12.2.4</a>

            
            <h1 id="fetching-from-tsvcsv">Fetching from TSV,CSV</h1>
            
        </header>

        
        
<p>TSV/CSV is the simplest way to pass data to the Manticore indexer. This method was created due to the limitations of xmlpipe2. In xmlpipe2, the indexer must map each attribute and field tag in the XML file to a corresponding schema element. This mapping requires time, and it increases with the number of fields and attributes in the schema. TSV/CSV has no such issue, as each field and attribute corresponds to a particular column in the TSV/CSV file. In some cases, TSV/CSV could work slightly faster than xmlpipe2.</p>
<h2 id="file-format">File format</h2>
<p>The first column in TSV/CSV file must be a document ID. The rest columns must mirror the declaration of fields and attributes in the schema definition. Note that you don't need to declare the document ID in the schema, since it's always considered to be present, should be in the 1st column and needs to be a unique-signed positive non-zero 64-bit integer.</p>
<p>The difference between tsvpipe and csvpipe is delimiter and quoting rules. tsvpipe has a tab character as hardcoded delimiter and has no quoting rules. csvpipe has the  <code>csvpipe_delimiter</code>option for delimiter with a default value of , and also has quoting rules, such as:</p>
<ul>
<li>Any field may be quoted</li>
<li>Fields containing a line-break, double-quote or commas should be quoted</li>
<li>A double quote character in a field must be represented by two double quote characters</li>
</ul>
<h2 id="declaration-of-tsv-stream">Declaration of TSV stream</h2>
<p><code>tsvpipe_command</code> directive is mandatory and contains the shell command invoked to produce the TSV stream that gets indexed. The command can read a TSV file, but it can also be a program that generates on-the-fly the tab delimited content.</p>
<h2 id="tsv-indexed-columns">TSV indexed columns</h2>
<p>The following directives can be used to declare the types of the indexed columns:</p>
<ul>
<li><code>tsvpipe_field</code> -  declares a <code>text</code> field. </li>
<li><code>tsvpipe_field_string</code> - declares a text field/string attribute. The column will be both indexed as a text field but also stored as a string attribute.</li>
<li><code>tsvpipe_attr_uint</code> - declares an integer attribute. </li>
<li><code>tsvpipe_attr_timestamp</code> - declares a timestamp attribute.</li>
<li><code>tsvpipe_attr_bool</code> -  declares a boolean attribute.</li>
<li><code>tsvpipe_attr_float</code> - declares a float attribute.</li>
<li><code>tsvpipe_attr_bigint</code> - declares a big integer attribute.</li>
<li><code>tsvpipe_attr_multi</code> - declares a multi-value attribute with integers.</li>
<li><code>tsvpipe_attr_multi_64</code> - declares a multi-value attribute with 64-bit integers.</li>
<li><code>tsvpipe_attr_string</code> - declares a string attribute. </li>
<li><code>tsvpipe_attr_json</code> - declares a JSON attribute.</li>
</ul>
<p>Example of a source using a TSV file:</p>
<div class="codehilite"><pre><span></span><code><span class="na">source tsv_test</span>
<span class="na">{</span>
<span class="w">    </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">tsvpipe</span>
<span class="w">    </span><span class="na">tsvpipe_command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">cat /tmp/rock_bands.tsv</span>
<span class="w">    </span><span class="na">tsvpipe_field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">name</span>
<span class="w">    </span><span class="na">tsvpipe_attr_multi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">genre_tags</span>
<span class="na">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="na">1   Led Zeppelin    35,23,16</span>
<span class="na">2   Deep Purple 35,92</span>
<span class="na">3   Frank Zappa 35,23,16,92,33,24</span>
</code></pre></div>

<h2 id="declaration-of-csv-stream">Declaration of CSV stream</h2>
<p><code>csvpipe_command</code> directive is mandatory and contains the shell command invoked to produce the CSV stream which gets indexed. The command can just read a CSV file but it can also be a program that generates on-the-fly the comma delimited content.</p>
<h2 id="csv-indexed-columns">CSV indexed columns</h2>
<p>The following directives can be used to declare the types of the indexed columns:</p>
<ul>
<li><code>csvpipe_field</code> -  declares a <code>text</code> field. </li>
<li><code>csvpipe_field_string</code> - declares a text field/string attribute. The column will be both indexed as a text field but also stored as a string attribute.</li>
<li><code>csvpipe_attr_uint</code> - declares an integer attribute. </li>
<li><code>csvpipe_attr_timestamp</code> - declares a timestamp attribute.</li>
<li><code>csvpipe_attr_bool</code> -  declares a boolean attribute.</li>
<li><code>csvpipe_attr_float</code> - declares a float attribute.</li>
<li><code>csvpipe_attr_bigint</code> - declares a big integer attribute.</li>
<li><code>csvpipe_attr_multi</code> - declares a multi-value attribute with integers.</li>
<li><code>csvpipe_attr_multi_64</code> - declares a multi-value attribute with 64-bit integers.</li>
<li><code>csvpipe_attr_string</code> - declares a string attribute.</li>
<li><code>csvpipe_attr_json</code> - declares a JSON attribute.</li>
</ul>
<p>Example of a source using a CSV file:</p>
<div class="codehilite"><pre><span></span><code><span class="na">source csv_test</span>
<span class="na">{</span>
<span class="w">    </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">csvpipe</span>
<span class="w">    </span><span class="na">csvpipe_command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">cat /tmp/rock_bands.csv</span>
<span class="w">    </span><span class="na">csvpipe_field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">name</span>
<span class="w">    </span><span class="na">csvpipe_attr_multi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">genre_tags</span>
<span class="na">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="na">1,&quot;Led Zeppelin&quot;,&quot;35,23,16&quot;</span>
<span class="na">2,&quot;Deep Purple&quot;,&quot;35,92&quot;</span>
<span class="na">3,&quot;Frank Zappa&quot;,&quot;35,23,16,92,33,24&quot;</span>
</code></pre></div>

<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-12.02.05-maindelta_schema">
        <header>
            <a class="chapter-link" href="#toc-12.02.05-maindelta_schema"> ¶ 12.2.5</a>

            
            <h1 id="maindelta-schema">Main+delta schema</h1>
            
        </header>

        
        
<!-- example maindelta -->
<p>In many situations, the total dataset is too large to be frequently rebuilt from scratch, while the number of new records remains relatively small. For example, a forum may have 1,000,000 archived posts but only receive 1,000 new posts per day.</p>
<p>In such cases, implementing "live" (nearly real-time) table updates can be achieved using a "main+delta" scheme.</p>
<p>The concept involves setting up two sources and two tables, with one "main" table for data that rarely changes (if ever), and one "delta" table for new documents. In the example, the 1,000,000 archived posts would be stored in the main table, while the 1,000 new daily posts would be placed in the delta table. The delta table can then be rebuilt frequently, making the documents available for searching within seconds or minutes. Determining which documents belong to which table and rebuilding the main table can be fully automated. One approach is to create a counter table that tracks the ID used to split the documents and update it whenever the main table is rebuilt.</p>
<p>Using a timestamp column as the split variable is more effective than using the ID since timestamps can track not only new documents but also modified ones.</p>
<p>For datasets that may contain modified or deleted documents, the delta table should provide a list of affected documents, ensuring they are suppressed and excluded from search queries. This is accomplished using a feature called Kill Lists. The document IDs to be killed can be specified in an auxiliary query defined by <a href="12-data_creation_and_modification.html#table-kill-list">sql_query_killlist</a>. The delta table must indicate the target tables for which the kill lists will be applied using the <a href="12-data_creation_and_modification.html#killlist_target">killlist_target</a> directive. The impact of kill lists is permanent on the target table, meaning that even if a search is performed without the delta table, the suppressed documents will not appear in the search results.</p>
<p>Notice how we're overriding <code>sql_query_pre</code> in the delta source. We must explicitly include this override. If we don't, the <code>REPLACE</code> query would be executed during the delta source's build as well, effectively rendering it useless.</p>
<!-- request Example -->

<div class="codehilite"><pre><span></span><code><span class="c1"># in MySQL</span>
<span class="na">CREATE TABLE deltabreaker (</span>
<span class="w">  </span><span class="na">index_name VARCHAR(50) NOT NULL,</span>
<span class="w">  </span><span class="na">created_at TIMESTAMP NOT NULL  DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span>
<span class="w">  </span><span class="na">PRIMARY KEY (index_name)</span>
<span class="na">);</span>

<span class="c1"># in manticore.conf</span>
<span class="na">source main {</span>
<span class="w">  </span><span class="na">...</span>
<span class="w">  </span><span class="na">sql_query_pre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">REPLACE INTO deltabreaker SET index_name = &#39;main&#39;, created_at = NOW()</span>
<span class="w">  </span><span class="na">sql_query</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s">SELECT id, title, UNIX_TIMESTAMP(updated_at) AS updated FROM documents WHERE deleted=0 AND  updated_at  &gt;=FROM_UNIXTIME($start) AND updated_at  &lt;=FROM_UNIXTIME($end)</span>
<span class="w">  </span><span class="na">sql_query_range</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s">SELECT ( SELECT UNIX_TIMESTAMP(MIN(updated_at)) FROM documents) min, ( SELECT UNIX_TIMESTAMP(created_at)-1 FROM deltabreaker WHERE index_name=&#39;main&#39;) max</span>
<span class="w">  </span><span class="na">sql_query_post_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">REPLACE INTO deltabreaker set index_name = &#39;delta&#39;, created_at = (SELECT created_at FROM deltabreaker t WHERE index_name=&#39;main&#39;)</span>
<span class="w">  </span><span class="na">...</span>
<span class="w">  </span><span class="na">sql_attr_timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">updated</span>
<span class="na">}</span>

<span class="na">source delta</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">main {</span>
<span class="w">  </span><span class="na">sql_query_pre</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="na">sql_query_range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">SELECT ( SELECT UNIX_TIMESTAMP(created_at) FROM deltabreaker WHERE index_name=&#39;delta&#39;) min, UNIX_TIMESTAMP() max</span>
<span class="w">  </span><span class="na">sql_query_killlist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">SELECT id FROM documents WHERE updated_at &gt;=  (SELECT created_at FROM deltabreaker WHERE index_name=&#39;delta&#39;)</span>
<span class="na">}</span>

<span class="na">table main {</span>
<span class="w">  </span><span class="na">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/var/lib/manticore/main</span>
<span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">main</span>
<span class="na">}</span>

<span class="na">table delta {</span>
<span class="w">  </span><span class="na">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/var/lib/manticore/delta</span>
<span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">delta</span>
<span class="w">  </span><span class="na">killlist_target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">main:kl</span>
<span class="na">}</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-12.02.06-adding_data_from_tables">
        <header>
            <a class="chapter-link" href="#toc-12.02.06-adding_data_from_tables"> ¶ 12.2.6</a>

            
            <h1>Adding data from tables</h1>
            
        </header>

        
    </section>
    
    <section class="chapter-section" id="toc-12.02.06.01-merging_tables">
        <header>
            <a class="chapter-link" href="#toc-12.02.06.01-merging_tables"> ¶ 12.2.6.1</a>

            
            <h1 id="merging-tables">Merging tables</h1>
            
        </header>

        
        
<p>Merging two existing <strong>plain</strong> tables can be more efficient than indexing the data from scratch and might be desired in some cases (such as merging 'main' and 'delta' tables instead of simply rebuilding 'main' in the 'main+delta' partitioning scheme). Thus,<code>indexer</code> provides an option to do that. Merging tables is typically faster than rebuilding, but still <strong>not</strong> instant for huge tables. Essentially, it needs to read the contents of both tables once and write the result once. Merging a 100 GB and 1 GB table, for example, will result in 202 GB of I/O (but that's still likely less than indexing from scratch requires).</p>
<p>The basic command syntax is as follows:</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>-u<span class="w"> </span>manticore<span class="w"> </span>indexer<span class="w"> </span>--merge<span class="w"> </span>DSTINDEX<span class="w"> </span>SRCINDEX<span class="w"> </span><span class="o">[</span>--rotate<span class="o">]</span><span class="w"> </span><span class="o">[</span>--drop-src<span class="o">]</span>
</code></pre></div>

<p>Unless <code>--drop-src</code> is specified, only the DSTINDEX table will be affected: the contents of SRCINDEX will be merged into it.</p>
<p>The <code>--rotate</code> switch is required if DSTINDEX is already being served by <code>searchd</code>.</p>
<p>The typical usage pattern is to merge a smaller update from SRCINDEX into DSTINDEX. Thus, when merging attributes, the values from SRCINDEX will take precedence if duplicate document IDs are encountered. However, note that the "old" keywords will <strong>not</strong> be automatically removed in such cases. For example, if there's a keyword "old" associated with document 123 in DSTINDEX, and a keyword "new" associated with it in SRCINDEX, document 123 will be found by both keywords after the merge. You can supply an explicit condition to remove documents from DSTINDEX to mitigate this; the relevant switch is <code>--merge-dst-range</code>:</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>-u<span class="w"> </span>manticore<span class="w"> </span>indexer<span class="w"> </span>--merge<span class="w"> </span>main<span class="w"> </span>delta<span class="w"> </span>--merge-dst-range<span class="w"> </span>deleted<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span>
</code></pre></div>

<p>This switch allows you to apply filters to the destination table along with merging. There can be several filters; all of their conditions must be met in order to include the document in the resulting merged table. In the example above, the filter passes only those records where 'deleted' is 0, eliminating all records that were flagged as deleted.</p>
<p><code>--drop-src</code> enables dropping SRCINDEX after the merge and before rotating the tables, which is important if you specify DSTINDEX in <code>killlist_target</code> of DSTINDEX. Otherwise, when rotating the tables, the documents that have been merged into DSTINDEX may be suppressed by SRCINDEX.</p>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-12.02.06.02-killlists_in_plain_tables">
        <header>
            <a class="chapter-link" href="#toc-12.02.06.02-killlists_in_plain_tables"> ¶ 12.2.6.2</a>

            
            <h1 id="killlist-in-plain-tables">Killlist in plain tables</h1>
            
        </header>

        
        
<p>When using plain tables, there's a challenge arising from the need to have the data in the table as fresh as possible.</p>
<p>In this case, one or more secondary (also known as delta) tables are used to capture the modified data between the time the main table was created and the current time. The modified data can include new, updated, or deleted documents. The search becomes a search over the <strong>main table and the delta table</strong>. This works seamlessly when you just add <strong>new</strong> documents to the delta table, but when it comes to updated or deleted documents, there remains the following issue.</p>
<p>If a document is present in both the main and delta tables, it can cause issues during searching, as the engine will see two versions of a document and won't know how to pick the right one. So, the delta needs to somehow inform the search that there are deleted documents in the main table that should be disregarded. <strong>This is where kill lists come in</strong>.</p>
<h2 id="table-kill-list">Table kill-list</h2>
<p>A table can maintain a list of document IDs that can be used to suppress records in other tables. This feature is available for plain tables using database sources or plain tables using XML sources. In the case of database sources, the source needs to provide an additional query defined by <code>sql_query_killlist</code>. It will store in the table a list of documents that can be used by the server to remove documents from other plain tables.</p>
<p>This query is expected to return a number of 1-column rows, each containing just the document ID.</p>
<p>In many cases, the query is a union between a query that retrieves a list of updated documents and a list of deleted documents, e.g.:</p>
<div class="codehilite"><pre><span></span><code><span class="na">sql_query_killlist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>\
<span class="w">    </span><span class="s">SELECT id FROM documents WHERE updated_ts&gt;=@last_reindex UNION </span>\
<span class="w">    </span><span class="s">SELECT id FROM documents_deleted WHERE deleted_ts&gt;=@last_reindex</span>
</code></pre></div>

<h2 id="removing-documents-in-a-plain-table">Removing documents in a plain table</h2>
<p>A plain table can contain a directive called <a href="../06-creating_a_table.html#killlist_target">killlist_target</a> that will tell the server it can provide a list of document IDs that should be removed from certain existing tables. The table can use either its document IDs as the source for this list or provide a separate <a href="../12-data_creation_and_modification.html#table-kill-list">list</a>.</p>
<h3 id="killlist_target">killlist_target</h3>
<!-- example killlist_target 1 -->
<p>Sets the table(s) that the kill-list will be applied to. Optional, default value is empty.</p>
<p>When you use <a href="../06-creating_a_table.html#toc-06.02.02-plain_table">plain tables</a> you often need to maintain not just a single table, but a set of them to be able to add/update/delete new documents sooner (read about <a href="../12-data_creation_and_modification.html#toc-12.02.05-maindelta_schema">delta table updates</a>). n order to suppress matches in the previous (<strong>main</strong>) table that were updated or deleted in the next (<strong>delta</strong>) table, you need to:</p>
<ol>
<li>Create a kill-list in the <strong>delta</strong> table using <a href="../12-data_creation_and_modification.html#table-kill-list">sql_query_killlist</a></li>
<li>Specify <strong>main</strong> table as <code>killlist_target</code> in <strong>delta</strong> table settings:</li>
</ol>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
CONFIG
</div>

<!-- request CONFIG -->


<div class="codehilite"><pre><span></span><code><span class="na">table products {</span>
<span class="w">  </span><span class="na">killlist_target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">main:kl</span>

<span class="w">  </span><span class="na">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">products</span>
<span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">src_base</span>
<span class="na">}</span>
</code></pre></div>


<!-- end -->

</div>

</div>

<p>When <code>killlist_target</code>  is specified, the kill-list is applied to all the tables listed in it on <code>searchd</code> startup. If any of the tables from <code>killlist_target</code> are rotated, the kill-list is reapplied to these tables. When the kill-list is applied, tables that were affected save these changes to disk.</p>
<p><code>killlist_target</code> has 3 modes of operation:</p>
<ol>
<li><code>killlist_target = main:kl</code>. Document IDs from the kill-list of the <strong>delta</strong> table are suppressed in the <strong>main</strong> table (see <code>sql_query_killlist</code>).</li>
<li><code>killlist_target = main:id</code>. All document IDs from the <strong>delta</strong> table are suppressed in the <strong>main</strong> table. The kill-list is ignored.</li>
<li><code>killlist_target = main</code>. Both document IDs from the <strong>delta</strong> table and its kill-list are suppressed in the <strong>main</strong> table.</li>
</ol>
<p>Multiple targets can be specified, separated by commas like:</p>
<div class="codehilite"><pre><span></span><code><span class="na">killlist_target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">table_one:kl,table_two:kl</span>
</code></pre></div>

<!-- example killlist_target 2 -->
<p>You can change the <code>killlist_target</code>  settings for a table without rebuilding it by using <code>ALTER</code>.</p>
<p>However, since the 'old' main table has already written the changes to disk, the documents that were deleted in it will <strong>remain</strong> deleted even if it is no longer in the <code>killlist_target</code> of the <strong>delta</strong> table.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="n">KILLLIST_TARGET</span><span class="o">=</span><span class="s1">&#39;new_main_table:kl&#39;</span>
</code></pre></div>



<!-- request HTTP -->


<div class="codehilite"><pre><span></span><code><span class="err">POST /cli -d &quot;</span>
<span class="err">ALTER TABLE delta KILLLIST_TARGET=&#39;new_main_table:kl&#39;&quot;</span>
</code></pre></div>


<!-- end -->

</div>

</div>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-12.02.06.03-attaching_a_plain_table_to_rt_table">
        <header>
            <a class="chapter-link" href="#toc-12.02.06.03-attaching_a_plain_table_to_rt_table"> ¶ 12.2.6.3</a>

            
            <h1 id="attaching-a-plain-table-to-a-real-time-table">Attaching a plain table to a real-time table</h1>
            
        </header>

        
        
<!-- example Example_1 -->

<p>A plain table can be converted into a real-time table or added to an existing real-time table.</p>
<p>The first case is useful when you need to regenerate a real-time table completely, which may be needed, for example, if tokenization settings need an update. In this situation, preparing a plain table and converting it into a real-time table may be easier than preparing a batch job to perform INSERTs for adding all the data into a real-time table.</p>
<p>In the second case, you normally want to add a large bulk of new data to a real-time table, and again, creating a plain table with that data is easier than populating the existing real-time table.</p>
<div class='item-select'>
Attaching table - general syntax
</div>
<p>The <code>ATTACH</code> statement allows you to convert a plain table to be attached to an existing real-time table. It also enables you to attach the content of one real-time table to another real-time table.</p>
<div class="codehilite"><pre><span></span><code><span class="n">ATTACH</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">plain_or_rt_table</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">rt_table</span><span class="w"> </span><span class="p">[</span><span class="k">WITH</span><span class="w"> </span><span class="k">TRUNCATE</span><span class="p">]</span>
</code></pre></div>

<p><code>ATTACH TABLE</code> statement lets you move data from a plain table or a RT table to an RT table.</p>
<p>After a successful <code>ATTACH</code> the data originally stored in the source plain table becomes a part of the target RT table, and the source plain table becomes unavailable (until the next rebuild). If the source table is an RT table, its content is moved into the destination RT table, and the source RT table remains empty. <code>ATTACH</code> does not result in any table data changes. Essentially, it just renames the files (making the source table a new disk chunk of the target RT table) and updates the metadata. So it is generally a quick operation that might (frequently) complete as fast as under a second.</p>
<p>Note that when a table is attached to an empty RT table, the fields, attributes, and text processing settings (tokenizer, wordforms, etc.) from the <em>source</em> table are copied over and take effect. The respective parts of the RT table definition from the configuration file will be ignored.</p>
<p>When the <code>TRUNCATE</code> option is used, the RT table gets truncated prior to attaching the source plain table. This allows the operation to be atomic or ensures that the attached source plain table will be the only data in the target RT table.</p>
<p><code>ATTACH TABLE</code> comes with a number of restrictions. Most notably, the target RT table is currently required to be either empty or have the same settings as the source table. In case the source table gets attached to a non-empty RT table, the RT table data collected so far gets stored as a regular disk chunk, and the table being attached becomes the newest disk chunk, with documents having the same IDs getting killed. The complete list of restrictions is as follows:</p>
<ul>
<li>The target RT table needs to be either empty or have the same settings as the source table.</li>
<li>The source table needs to have <a href="../06-creating_a_table.html#phrase_boundary_step">phrase_boundary_step</a> set to 0 and <a href="../06-creating_a_table.html#stopword_step">stopword_step</a> set to 1.</li>
</ul>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
Example
</div>

<!-- request Example -->
Before the ATTACH, the RT table is empty and has 3 fields:


<div class="codehilite"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="n">rt</span><span class="p">;</span>
<span class="n">Empty</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">rt</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-----------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Field</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="k">Type</span><span class="w">    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-----------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">testfield</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">field</span><span class="w">   </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">testattr</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">uint</span><span class="w">    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-----------+---------+</span>
<span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



The plain table is not empty:


<div class="codehilite"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">plain</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>
<span class="o">+</span><span class="c1">------+--------+----------+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">weight</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">group_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">date_added</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+--------+----------+------------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">1304</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1313643256</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">1304</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1313643256</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">1304</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1313643256</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">1304</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1313643256</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+--------+----------+------------+</span>
<span class="mi">4</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



Attaching the plain table to the RT table:

<div class="codehilite"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ATTACH</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">plain</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">rt</span><span class="p">;</span>
<span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



The RT table now has 5 fields:


<div class="codehilite"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="n">rt</span><span class="p">;</span>
<span class="o">+</span><span class="c1">------------+-----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Field</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="k">Type</span><span class="w">      </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------------+-----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nb">integer</span><span class="w">   </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">title</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">field</span><span class="w">     </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">content</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">field</span><span class="w">     </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">group_id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">uint</span><span class="w">      </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">date_added</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------------+-----------+</span>
<span class="mi">5</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



And it's not empty:


<div class="codehilite"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">rt</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>
<span class="o">+</span><span class="c1">------+--------+----------+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">weight</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">group_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">date_added</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+--------+----------+------------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">1304</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1313643256</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">1304</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1313643256</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">1304</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1313643256</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">1304</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1313643256</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+--------+----------+------------+</span>
<span class="mi">4</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



After the ATTACH, the plain table is removed and no longer available for searching:


<div class="codehilite"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">plain</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>
<span class="n">ERROR</span><span class="w"> </span><span class="mi">1064</span><span class="w"> </span><span class="p">(</span><span class="mi">42000</span><span class="p">):</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="k">local</span><span class="w"> </span><span class="n">indexes</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">search</span>
</code></pre></div>


<!-- end -->

</div>

</div>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-12.02.06.04-importing_rt_table">
        <header>
            <a class="chapter-link" href="#toc-12.02.06.04-importing_rt_table"> ¶ 12.2.6.4</a>

            
            <h1 id="importing-table">Importing table</h1>
            
        </header>

        
        
<p>If you decide to migrate from <a href="../06-creating_a_table.html#defining-table-schema-in-config-%28plain mode%29">Plain mode</a> to <a href="../06-creating_a_table.html#online-schema-management-%28rt-mode%29">RT mode</a> or in some other cases, real-time and percolate tables built in Plain mode can be imported to Manticore running in RT mode using the <code>IMPORT TABLE</code> statement. The general syntax is as follows:</p>
<!-- example import -->

<div class="codehilite"><pre><span></span><code><span class="n">IMPORT</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s1">&#39;path&#39;</span>
</code></pre></div>

<p>where the 'path' parameter must be set as: <code>/your_backup_folder/your_backup_name/data/your_table_name/your_table_name</code></p>
<!-- request -->

<div class="codehilite"><pre><span></span><code>mysql<span class="w"> </span>-P9306<span class="w"> </span>-h0<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;create table t(f text)&#39;</span>

mysql<span class="w"> </span>-P9306<span class="w"> </span>-h0<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;backup table t to /tmp/&quot;</span>

mysql<span class="w"> </span>-P9306<span class="w"> </span>-h0<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;drop table t&quot;</span>

<span class="nv">BACKUP_NAME</span><span class="o">=</span><span class="k">$(</span>ls<span class="w"> </span>/tmp<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;backup-&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="k">)</span>

mysql<span class="w"> </span>-P9306<span class="w"> </span>-h0<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;import table t from &#39;/tmp/</span><span class="nv">$BACKUP_NAME</span><span class="s2">/data/t/t&#39;</span>

<span class="s2">mysql -P9306 -h0 -e &quot;</span>show<span class="w"> </span>tables<span class="s2">&quot;</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<p>Executing this command makes all the table files of the specified table copied to <a href="../20-server_settings.html#data_dir">data_dir</a>. All the external table files such as wordforms, exceptions and stopwords are also copied to the same <code>data_dir</code>.<br />
<code>IMPORT TABLE</code> has the following limitations:</p>
<ul>
<li>paths to the external files that were originally specified in the config file must be absolute</li>
<li>only real-time and percolate tables are supported</li>
<li>plain tables need to be preliminarily (in the plain mode) converted to real-time tables via <a href="../12-data_creation_and_modification.html#toc-12.02.06.03-attaching_a_plain_table_to_rt_table">ATTACH TABLE</a></li>
</ul>
<h2 id="indexer-print-rt">indexer --print-rt</h2>
<!-- example print_rt -->
<p>If the above method for migrating a plain table to an RT table is not possible, you may use <code>indexer --print-rt</code> to dump data from a plain table directly without the need to convert it to an RT type table and then import the dump into an RT table right from the command line.</p>
<p>This method has a few limitations though:</p>
<ul>
<li>Only SQL-based sources are supported</li>
<li>MVAs are not supported</li>
</ul>
<!-- request -->

<div class="codehilite"><pre><span></span><code>/usr/bin/indexer<span class="w"> </span>--rotate<span class="w"> </span>--config<span class="w"> </span>/etc/manticoresearch/manticore.conf<span class="w"> </span>--print-rt<span class="w"> </span>my_rt_index<span class="w"> </span>my_plain_index<span class="w"> </span>&gt;<span class="w"> </span>/tmp/dump_regular.sql

mysql<span class="w"> </span>-P<span class="w"> </span><span class="nv">$9306</span><span class="w"> </span>-h0<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;truncate table my_rt_index&quot;</span>

mysql<span class="w"> </span>-P<span class="w"> </span><span class="m">9306</span><span class="w"> </span>-h0<span class="w"> </span>&lt;<span class="w"> </span>/tmp/dump_regular.sql

rm<span class="w"> </span>/tmp/dump_regular.sql
</code></pre></div>

<!-- end -->

</div>
</div>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-12.02.07-rotating_a_table">
        <header>
            <a class="chapter-link" href="#toc-12.02.07-rotating_a_table"> ¶ 12.2.7</a>

            
            <h1 id="rotating-a-table">Rotating a table</h1>
            
        </header>

        
        
<p>Table rotation is a procedure in which the searchd server looks for new versions of defined tables in the configuration. Rotation is supported only in Plain mode of operation.</p>
<p>There can be two cases:</p>
<ul>
<li>for plain tables that are already loaded</li>
<li>tables added in configuration, but not loaded yet</li>
</ul>
<p>In the first case, the indexer cannot put the new version of the table online as the running copy is locked and loaded by <code>searchd</code>. In this case <code>indexer</code> needs to be called with the <a href="12-data_creation_and_modification.html#indexer-command-line-arguments">--rotate</a> parameter. If rotate is used, <code>indexer</code> creates new table files with <code>.new.</code> in their names and sends a <em>HUP</em> signal to <code>searchd</code> informing it about the new version. The <code>searchd</code> will perform a lookup and will put the new version of the table in place and discard the old one. In some cases, it might be desired to create the new version of the table but not perform rotate as soon as possible. For example, it might be desired to first check the health of the new table versions. In this case,  <code>indexer</code> can accept the<code>--nohup</code> parameter which will forbid sending the HUP signal to the server.</p>
<p>New tables can be loaded by rotation; however, the regular handling of the HUP signal is to check for new tables only if the configuration has changed since server startup. If the table was already defined in the configuration, the table should be first created by running <code>indexer</code> without rotation and perform the <a href="12-data_creation_and_modification.html#reload-tables">RELOAD TABLES</a> statement instead.</p>
<p>There are also two specialized statements that can be used to perform rotations on tables:</p>
<h2 id="reload-table">RELOAD TABLE</h2>
<div class="codehilite"><pre><span></span><code><span class="n">RELOAD</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">tbl</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s1">&#39;/path/to/table_files&#39;</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="k">OPTION</span><span class="w"> </span><span class="n">switchover</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">];</span>
</code></pre></div>

<p>The <code>RELOAD TABLE</code> command enables table rotation via SQL.</p>
<p>This command functions in three modes. In the first mode, without specifying a path, the Manticore server checks for new table files in the directory indicated by the <a href="06-creating_a_table.html#path">path</a>. New table files must be named as <code>tbl.new.sp?</code>.</p>
<p>If you specify a path, the server searches for table files in that directory, relocates them to the table <a href="06-creating_a_table.html#path">path</a>, renames them from <code>tbl.sp?</code> to <code>tbl.new.sp?</code>, and rotates them.</p>
<p>The third mode, activated by <code>OPTION switchover=1</code>, switches the index to the new path. Here, the daemon tries to load the table directly from the new path without moving the files. If loading is successful, this new index supersedes the old one.</p>
<p>Also, the daemon writes a unique link file (<code>tbl.link</code>) in the directory specified by <a href="06-creating_a_table.html#path">path</a>, maintaining persistent redirection.</p>
<p>If you revert a redirected index to the path specified in the configuration, the daemon will detect this and delete the link file.</p>
<p>Once redirected, the daemon retrieves the table from the newly linked path. When rotating, it looks for new table versions at the newly redirected path. Bear in mind, the daemon checks the configuration for common errors, like duplicate paths across different tables. However, it won't identify if multiple tables point to the same path via redirection. Under normal operations, tables are locked with the <code>.spl</code> file, but disabling the lock may cause problems. If there's an error (e.g., the path is inaccessible for any reason), you should manually correct (or simply delete) the link file.</p>
<p><code>indextool</code> follows the link file, but other tools (<code>indexer</code>, <code>index_converter</code>, etc.) do not recognize the link file and consistently use the path defined in the configuration file, ignoring any redirection. Thus, you can inspect the index with <code>indextool</code>, and it will read from the new location. However, more complex operations like merging will not acknowledge any link file.</p>
<div class="codehilite"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="n">RELOAD</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">plain_table</span><span class="p">;</span>
<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="n">RELOAD</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">plain_table</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s1">&#39;/home/mighty/new_table_files&#39;</span><span class="p">;</span>
<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="n">RELOAD</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">plain_table</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s1">&#39;/home/mighty/new/place/for/table/table_files&#39;</span><span class="w"> </span><span class="k">OPTION</span><span class="w"> </span><span class="n">switchover</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>

<h2 id="reload-tables">RELOAD TABLES</h2>
<div class="codehilite"><pre><span></span><code><span class="n">RELOAD</span><span class="w"> </span><span class="n">TABLES</span><span class="p">;</span>
</code></pre></div>

<p>This command functions similarly to the HUP system signal, triggering a rotation of tables. Nevertheless, it doesn't exactly mirror the typical HUP signal (which can come from a <code>kill -HUP</code> command or <code>indexer --rotate</code>). This command actively searches for any tables needing rotation and is capable of re-reading the configuration. Suppose you launch Manticore in plain mode with a config file that points to a nonexistent plain table. If you then attempt to <code>indexer --rotate</code> the table, the new table won't be recognized by the server until you execute <code>RELOAD TABLES</code> or restart the server.</p>
<p>Depending on the value of the <a href="20-server_settings.html#seamless_rotate">seamless_rotate</a> setting, new queries might be shortly stalled, and clients will receive temporary errors.</p>
<div class="codehilite"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="n">RELOAD</span><span class="w"> </span><span class="n">TABLES</span><span class="p">;</span>
<span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>

<h1 id="seamless-rotate">Seamless rotate</h1>
<p>The rotate assumes old table version is discarded and new table version is loaded and replaces the existing one. During this swapping, the server needs to also serve incoming queries made on the table that is going to be updated. To avoid stalls of the queries, the server implements a seamless rotate of the table by default, as described below.</p>
<p>Tables may contain data that needs to be precached in RAM. At the moment, <code>.spa</code>, <code>.spb</code>, <code>.spi</code> and <code>.spm</code> files are fully precached (they contain attribute data, blob attribute data, keyword table, and killed row map, respectively). Without seamless rotate, rotating a table tries to use as little RAM as possible and works as follows:</p>
<ol>
<li>New queries are temporarily rejected (with "retry" error code).</li>
<li><code>searchd</code> waits for all currently running queries to finish.</li>
<li>Old table is deallocated and its files are renamed.</li>
<li>New table files are renamed and required RAM is allocated.</li>
<li>New table attribute and dictionary data is preloaded to RAM.</li>
<li><code>searchd</code> resumes serving queries from the new table.</li>
</ol>
<p>However, if there's a lot of attribute or dictionary data, then the preloading step could take noticeable time - up to several minutes in case of preloading 1-5+ GB files.</p>
<p>With seamless rotate enabled, rotation works as follows:</p>
<ol>
<li>New table RAM storage is allocated.</li>
<li>New table attribute and dictionary data is asynchronously preloaded to RAM.</li>
<li>On success, old table is deallocated and both tables' files are renamed.</li>
<li>On failure, new table is deallocated.</li>
<li>At any given moment, queries are served either from old or new table copy.</li>
</ol>
<p>Seamless rotate comes at the cost of higher <strong>peak</strong> memory usage during the rotation (because both old and new copies of <code>.spa/.spb/.spi/.spm</code> data need to be in RAM while preloading the new copy). However, average usage stays the same.</p>
<p>Example:</p>
<div class="codehilite"><pre><span></span><code><span class="na">seamless_rotate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1</span>
</code></pre></div>

<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-12.03-updating_documents">
        <header>
            <a class="chapter-link" href="#toc-12.03-updating_documents"> ¶ 12.3</a>

            
            <h1>Updating documents</h1>
            
        </header>

        
    </section>
    
    <section class="chapter-section" id="toc-12.03.01-replace_vs_update">
        <header>
            <a class="chapter-link" href="#toc-12.03.01-replace_vs_update"> ¶ 12.3.1</a>

            
            <h1 id="replace-vs-update">REPLACE vs UPDATE</h1>
            
        </header>

        
        
<p>You can modify existing data in an RT or PQ table by either updating or replacing it.</p>
<p><a href="12-data_creation_and_modification.html#toc-12.03.03-update">UPDATE</a> replaces <a href="06-creating_a_table.html#row-wise-and-columnar-attribute-storages">row-wise</a> attribute values of existing documents with new values. Full-text fields and columnar attributes cannot be updated. If you need to change the content of a full-text field or columnar attributes, use <a href="12-data_creation_and_modification.html#toc-12.03.02-replace">REPLACE</a>.</p>
<p><a href="12-data_creation_and_modification.html#toc-12.03.02-replace">REPLACE</a> works similarly to <a href="12-data_creation_and_modification.html#toc-12.01.01-adding_documents_to_a_realtime_table">INSERT</a> except that if an old document has the same ID as the new document, the old document is marked as deleted before the new document is inserted. Note that the old document does not get physically deleted from the table. The deletion can only happen when chunks are merged in a table, e.g., as a result of an <a href="16-securing_and_compacting_a_table.html#toc-16.05-compacting_a_table">OPTIMIZE</a>.</p>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-12.03.02-replace">
        <header>
            <a class="chapter-link" href="#toc-12.03.02-replace"> ¶ 12.3.2</a>

            
            <h1 id="replace">REPLACE</h1>
            
        </header>

        
        
<!-- example replace -->

<p><code>REPLACE</code> works similarly to <a href="12-data_creation_and_modification.html#toc-12.01.01-adding_documents_to_a_realtime_table">INSERT</a>, but it marks the previous document with the same ID as deleted before inserting a new one.</p>
<p>If you are looking for in-place updates, please see <a href="12-data_creation_and_modification.html#toc-12.03.03-update">this section</a>.</p>
<h2 id="sql-replace">SQL REPLACE</h2>
<p>The syntax of the SQL <code>REPLACE</code> statement is as follows:</p>
<p><strong>To replace the whole document:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">REPLACE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="p">[(</span><span class="n">column1</span><span class="p">,</span><span class="w"> </span><span class="n">column2</span><span class="p">,</span><span class="w"> </span><span class="p">...)]</span>
<span class="w">    </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="n">value1</span><span class="p">,</span><span class="w"> </span><span class="n">value2</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span>
<span class="w">    </span><span class="p">[,</span><span class="w"> </span><span class="p">(...)]</span>
</code></pre></div>

<p><strong>To replace only selected fields:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">REPLACE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">table</span>
<span class="w">    </span><span class="k">SET</span><span class="w"> </span><span class="n">field1</span><span class="o">=</span><span class="n">value1</span><span class="p">[,</span><span class="w"> </span><span class="p">...,</span><span class="w"> </span><span class="n">fieldN</span><span class="o">=</span><span class="n">valueN</span><span class="p">]</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="n">id</span><span class="o">&gt;</span>
</code></pre></div>

<p>Note, you can filter only by id in this mode.</p>
<p>See the examples for more details.</p>
<h2 id="json-replace">JSON REPLACE</h2>
<ul>
<li>
<p><code>/replace</code>:<br />
<code>POST /replace
  {
    "index": "&lt;table name&gt;",
    "id": &lt;document id&gt;,
    "doc":
    {
      "&lt;field1&gt;": &lt;value1&gt;,
      ...
      "&lt;fieldN&gt;": &lt;valueN&gt;
    }
  }</code><br />
<code>/index</code> is an alias endpoint and works the same.</p>
</li>
<li>
<p>Elasticsearch-like endpoint <code>&lt;table&gt;/_doc/&lt;id&gt;</code>:<br />
<code>PUT/POST /&lt;table name&gt;/_doc/&lt;id&gt;
  {
    "&lt;field1&gt;": &lt;value1&gt;,
    ...
    "&lt;fieldN&gt;": &lt;valueN&gt;
  }</code></p>
</li>
<li>
<p>Partial replace:</p>
</li>
</ul>
<div class="codehilite"><pre><span></span><code>POST /&lt;table name&gt;/_update/&lt;id&gt;
{
  &quot;&lt;field1&gt;&quot;: &lt;value1&gt;,
  ...
  &quot;&lt;fieldN&gt;&quot;: &lt;valueN&gt;
}
</code></pre></div>

<p>See the examples for more details.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>
<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">REPLACE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;document one&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
</code></pre></div>



<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
REPLACE ... SET
</div>
<!-- request REPLACE ... SET -->


<div class="codehilite"><pre><span></span><code><span class="k">REPLACE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;HUAWEI Matebook 15&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">price</span><span class="o">=</span><span class="mi">10</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">55</span><span class="p">;</span>
</code></pre></div>



<!-- response REPLACE ... SET -->


<div class="codehilite"><pre><span></span><code><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/replace</span>
<span class="mi">-</span><span class="err">H</span><span class="w"> </span><span class="s2">&quot;Content-Type: application/x-ndjson&quot;</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;product one&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="mi">10</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
<span class="err">&#39;</span>
</code></pre></div>



<!-- response JSON -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;created&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="s2">&quot;updated&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="mi">200</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Elasticsearch-like
</div>

<!-- request Elasticsearch-like -->


<div class="codehilite"><pre><span></span><code><span class="err">PUT</span><span class="w"> </span><span class="err">/produc</span><span class="kc">ts</span><span class="err">/_doc/</span><span class="mi">2</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;product two&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span>
<span class="p">}</span>

<span class="err">POST</span><span class="w"> </span><span class="err">/produc</span><span class="kc">ts</span><span class="err">/_doc/</span><span class="mi">3</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;product three&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
<span class="p">}</span>
</code></pre></div>



<!-- response Elasticsearch-like -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
<span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="nt">&quot;_primary_term&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="nt">&quot;_seq_no&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="nt">&quot;_shards&quot;</span><span class="p">:{</span>
<span class="w">    </span><span class="nt">&quot;failed&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;successful&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="p">},</span>
<span class="nt">&quot;_type&quot;</span><span class="p">:</span><span class="s2">&quot;_doc&quot;</span><span class="p">,</span>
<span class="nt">&quot;_version&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="s2">&quot;updated&quot;</span>
<span class="p">}</span>

<span class="p">{</span>
<span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
<span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="nt">&quot;_primary_term&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="nt">&quot;_seq_no&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="nt">&quot;_shards&quot;</span><span class="p">:{</span>
<span class="w">    </span><span class="nt">&quot;failed&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;successful&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="p">},</span>
<span class="nt">&quot;_type&quot;</span><span class="p">:</span><span class="s2">&quot;_doc&quot;</span><span class="p">,</span>
<span class="nt">&quot;_version&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="s2">&quot;updated&quot;</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Elasticsearch-like partial replace
</div>

<!-- request Elasticsearch-like partial -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/produc</span><span class="kc">ts</span><span class="err">/_upda</span><span class="kc">te</span><span class="err">/</span><span class="mi">55</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;HUAWEI Matebook 15&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- response Elasticsearch-like partial -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="nt">&quot;updated&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="p">}</span>
</code></pre></div>




<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;replaceDocument([</span>
<span class="x">   &#39;title&#39; =&gt; &#39;document one&#39;,</span>
<span class="x">    &#39;price&#39; =&gt; 10</span>
<span class="x">],1);</span>
</code></pre></div>



<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Array(</span>
<span class="x">    [_index] =&gt; products</span>
<span class="x">    [_id] =&gt; 1</span>
<span class="x">    [created] =&gt; false</span>
<span class="x">    [result] =&gt; updated</span>
<span class="x">    [status] =&gt; 200</span>
<span class="x">)</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Python
</div>

<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">indexApi</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;doc&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span> <span class="p">:</span> <span class="s2">&quot;document one&quot;</span><span class="p">,</span><span class="s2">&quot;price&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">}})</span>
</code></pre></div>



<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;created&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;found&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;products&#39;</span><span class="p">,</span>
 <span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="s1">&#39;updated&#39;</span><span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Javascript
</div>

<!-- request javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">replace</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;document one&quot;</span><span class="p">,</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">10</span><span class="p">}});</span>
</code></pre></div>



<!-- response javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;updated&quot;</span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
java
</div>

<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">docRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InsertDocumentRequest</span><span class="p">();</span>
<span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">            </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span><span class="s">&quot;document one&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
<span class="p">}};</span>
<span class="n">docRequest</span><span class="p">.</span><span class="na">index</span><span class="p">(</span><span class="s">&quot;products&quot;</span><span class="p">).</span><span class="na">id</span><span class="p">(</span><span class="mi">1L</span><span class="p">).</span><span class="na">setDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">sqlresult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">indexApi</span><span class="p">.</span><span class="na">replace</span><span class="p">(</span><span class="n">docRequest</span><span class="p">);</span>
</code></pre></div>



<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">SuccessResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">index</span><span class="p">:</span><span class="w"> </span><span class="n">products</span>
<span class="w">    </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">created</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">result</span><span class="p">:</span><span class="w"> </span><span class="n">updated</span>
<span class="w">    </span><span class="n">found</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
C
</div>

<!-- request C# -->

<div class="codehilite"><pre><span></span><code><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">doc</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;document one&quot;</span><span class="p">);</span>
<span class="n">doc</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;price&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<span class="n">InsertDocumentRequest</span><span class="w"> </span><span class="n">docRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">InsertDocumentRequest</span><span class="p">(</span><span class="n">index</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">doc</span><span class="p">:</span><span class="w"> </span><span class="n">doc</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">sqlresult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">indexApi</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">docRequest</span><span class="p">);</span>
</code></pre></div>



<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">SuccessResponse</span> {
    <span class="n">index:</span> <span class="n">products</span>
    <span class="n">id:</span> <span class="mi">1</span>
    <span class="n">created:</span> <span class="n">false</span>
    <span class="n">result:</span> <span class="n">updated</span>
    <span class="n">found:</span> <span class="n">null</span>
}
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
TypeScript
</div>

<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">replace</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
<span class="w">  </span><span class="nx">doc</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Text 11&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Doc 11&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">cat</span><span class="o">:</span><span class="w"> </span><span class="kt">3</span><span class="w"> </span><span class="p">},</span>
<span class="p">});</span>
</code></pre></div>



<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;created&quot;</span><span class="p">:</span><span class="kc">false</span>
<span class="w">    </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="nt">&quot;updated&quot;</span>
<span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="mi">200</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Go
</div>

<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">replaceDoc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Text 11&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Doc 11&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cat&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span>
<span class="nx">replaceRequest</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewInsertDocumentRequest</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">replaceDoc</span><span class="p">)</span>
<span class="nx">replaceRequest</span><span class="p">.</span><span class="nx">SetId</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">IndexAPI</span><span class="p">.</span><span class="nx">Replace</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">InsertDocumentRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">replaceRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>



<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;_index&quot;</span><span class="p">:</span><span class="s">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;created&quot;</span><span class="p">:</span><span class="kc">false</span>
<span class="w">    </span><span class="s">&quot;result&quot;</span><span class="p">:</span><span class="s">&quot;updated&quot;</span>
<span class="w">    </span><span class="s">&quot;status&quot;</span><span class="p">:</span><span class="mi">200</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<p><code>REPLACE</code> is available for real-time and percolate tables. You can't replace data in a plain table.</p>
<p>When you run a <code>REPLACE</code>, the previous document is not removed, but it's marked as deleted, so the table size grows until chunk merging happens. To force a chunk merge, use the <a href="16-securing_and_compacting_a_table.html#toc-16.05-compacting_a_table">OPTIMIZE statement</a>.</p>
<h2 id="bulk-replace">Bulk replace</h2>
<!-- example bulk_replace -->

<p>You can replace multiple documents at once. Check <a href="12-data_creation_and_modification.html#bulk-adding-documents">bulk adding documents</a> for more information.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
HTTP
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">REPLACE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">products</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;doc one&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39; doc two&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">);</span>
</code></pre></div>



<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/bulk</span>
<span class="mi">-</span><span class="err">H</span><span class="w"> </span><span class="s2">&quot;Content-Type: application/x-ndjson&quot;</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span>
<span class="p">{</span><span class="w"> </span><span class="nt">&quot;replace&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;index&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;doc one&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;tag&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="p">{</span><span class="w"> </span><span class="nt">&quot;replace&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;index&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;doc two&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;tag&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="err">&#39;</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;items&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;replace&quot;</span><span class="p">:</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;created&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="s2">&quot;updated&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="mi">200</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;replace&quot;</span><span class="p">:</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;created&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="s2">&quot;updated&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="mi">200</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;errors&quot;</span><span class="p">:</span><span class="kc">false</span>
<span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;replaceDocuments([</span>
<span class="x">    [   </span>
<span class="x">        &#39;id&#39; =&gt; 1,</span>
<span class="x">        &#39;title&#39; =&gt; &#39;document one&#39;,</span>
<span class="x">        &#39;tag&#39; =&gt; 10</span>
<span class="x">    ],</span>
<span class="x">    [   </span>
<span class="x">        &#39;id&#39; =&gt; 2,</span>
<span class="x">        &#39;title&#39; =&gt; &#39;document one&#39;,</span>
<span class="x">        &#39;tag&#39; =&gt; 20</span>
<span class="x">    ]</span>
<span class="x">);</span>
</code></pre></div>



<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Array(</span>
<span class="x">    [items] =&gt;</span>
<span class="x">    Array(</span>
<span class="x">        Array(</span>
<span class="x">            [_index] =&gt; products</span>
<span class="x">            [_id] =&gt; 2</span>
<span class="x">            [created] =&gt; false</span>
<span class="x">            [result] =&gt; updated</span>
<span class="x">            [status] =&gt; 200</span>
<span class="x">        )</span>
<span class="x">        Array(</span>
<span class="x">            [_index] =&gt; products</span>
<span class="x">            [_id] =&gt; 2</span>
<span class="x">            [created] =&gt; false</span>
<span class="x">            [result] =&gt; updated</span>
<span class="x">            [status] =&gt; 200</span>
<span class="x">        )</span>
<span class="x">    )</span>
<span class="x">    [errors =&gt; false</span>
<span class="x">)</span>
</code></pre></div>


<!-- request Python -->


<div class="codehilite"><pre><span></span><code><span class="n">indexApi</span> <span class="o">=</span> <span class="n">manticoresearch</span><span class="o">.</span><span class="n">IndexApi</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">docs</span> <span class="o">=</span> <span class="p">[</span> \
    <span class="p">{</span><span class="s2">&quot;replace&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;doc&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span> <span class="p">:</span> <span class="s2">&quot;document one&quot;</span><span class="p">}}},</span> \
    <span class="p">{</span><span class="s2">&quot;replace&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;doc&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span> <span class="p">:</span> <span class="s2">&quot;document two&quot;</span><span class="p">}}}</span> <span class="p">]</span>
<span class="n">api_resp</span> <span class="o">=</span> <span class="n">indexApi</span><span class="o">.</span><span class="n">bulk</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">,</span><span class="n">docs</span><span class="p">)))</span>
</code></pre></div>



<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;items&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;replace&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                         <span class="sa">u</span><span class="s1">&#39;_index&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;products&#39;</span><span class="p">,</span>
                         <span class="sa">u</span><span class="s1">&#39;created&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="sa">u</span><span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;updated&#39;</span><span class="p">,</span>
                         <span class="sa">u</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">}},</span>
           <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;replace&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                         <span class="sa">u</span><span class="s1">&#39;_index&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;products&#39;</span><span class="p">,</span>
                         <span class="sa">u</span><span class="s1">&#39;created&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="sa">u</span><span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;updated&#39;</span><span class="p">,</span>
                         <span class="sa">u</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">}}]}</span>
</code></pre></div>


<!-- request javascript -->


<div class="codehilite"><pre><span></span><code><span class="nx">docs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="s2">&quot;replace&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;document one&quot;</span><span class="p">}}},</span>
<span class="w">    </span><span class="p">{</span><span class="s2">&quot;replace&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;document two&quot;</span><span class="p">}}}</span><span class="w"> </span><span class="p">];</span>
<span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">bulk</span><span class="p">(</span><span class="nx">docs</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">e</span><span class="p">=&gt;</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">e</span><span class="p">)).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">));</span>
</code></pre></div>



<!-- response javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;items&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;replace&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;created&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;updated&quot;</span><span class="p">,</span><span class="s2">&quot;status&quot;</span><span class="o">:</span><span class="mf">200</span><span class="p">}},{</span><span class="s2">&quot;replace&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">2</span><span class="p">,</span><span class="s2">&quot;created&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;updated&quot;</span><span class="p">,</span><span class="s2">&quot;status&quot;</span><span class="o">:</span><span class="mf">200</span><span class="p">}}],</span><span class="s2">&quot;errors&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">}</span>
</code></pre></div>



<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;{\&quot;replace\&quot;: {\&quot;index\&quot; : \&quot;products\&quot;, \&quot;id\&quot; : 1, \&quot;doc\&quot; : {\&quot;title\&quot; : \&quot;document one\&quot;}}}&quot;</span><span class="w"> </span><span class="o">+</span><span class="s">&quot;\n&quot;</span><span class="o">+</span>
<span class="w">    </span><span class="s">&quot;{\&quot;replace\&quot;: {\&quot;index\&quot; : \&quot;products\&quot;, \&quot;id\&quot; : 2, \&quot;doc\&quot; : {\&quot;title\&quot; : \&quot;document two\&quot;}}}&quot;</span><span class="o">+</span><span class="s">&quot;\n&quot;</span><span class="w"> </span><span class="p">;</span><span class="w">         </span>
<span class="n">indexApi</span><span class="p">.</span><span class="na">bulk</span><span class="p">(</span><span class="n">body</span><span class="p">);</span>
</code></pre></div>



<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">BulkResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">items</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="p">{</span><span class="n">replace</span><span class="o">=</span><span class="p">{</span><span class="n">_index</span><span class="o">=</span><span class="n">products</span><span class="p">,</span><span class="w"> </span><span class="n">_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">created</span><span class="o">=</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="o">=</span><span class="n">updated</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">replace</span><span class="o">=</span><span class="p">{</span><span class="n">_index</span><span class="o">=</span><span class="n">products</span><span class="p">,</span><span class="w"> </span><span class="n">_id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">created</span><span class="o">=</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="o">=</span><span class="n">updated</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">}}</span><span class="o">]</span>
<span class="w">    </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="n">additionalProperties</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">errors</span><span class="o">=</span><span class="kc">false</span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- request C# -->


<div class="codehilite"><pre><span></span><code>string body = &quot;{\&quot;replace\&quot;: {\&quot;index\&quot; : \&quot;products\&quot;, \&quot;id\&quot; : 1, \&quot;doc\&quot; : {\&quot;title\&quot; : \&quot;document one\&quot;}}}&quot; +&quot;\n&quot;+
    &quot;{\&quot;replace\&quot;: {\&quot;index\&quot; : \&quot;products\&quot;, \&quot;id\&quot; : 2, \&quot;doc\&quot; : {\&quot;title\&quot; : \&quot;document two\&quot;}}}&quot;+&quot;\n&quot; ;         
indexApi.Bulk(body);
</code></pre></div>



<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">BulkResponse</span> {
    <span class="n">items:</span> [{<span class="n">replace</span>={<span class="n">_index</span>=<span class="n">products</span>, <span class="n">_id</span>=<span class="mi">1</span>, <span class="n">created</span>=<span class="n">false</span>, <span class="nb">result</span>=<span class="n">updated</span>, <span class="nb">status</span>=<span class="mi">200</span>}}, {<span class="n">replace</span>={<span class="n">_index</span>=<span class="n">products</span>, <span class="n">_id</span>=<span class="mi">2</span>, <span class="n">created</span>=<span class="n">false</span>, <span class="nb">result</span>=<span class="n">updated</span>, <span class="nb">status</span>=<span class="mi">200</span>}}]
    <span class="n">error:</span> <span class="n">null</span>
    <span class="n">additionalProperties:</span> {<span class="n">errors</span>=<span class="n">false</span>}
}
</code></pre></div>



<!-- request TypeScript -->


<div class="codehilite"><pre><span></span><code><span class="nx">replaceDocs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">replace</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
<span class="w">      </span><span class="nx">doc</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Text 11&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">cat</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Doc 11&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">replace</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">2</span><span class="p">,</span>
<span class="w">      </span><span class="nx">doc</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Text 22&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">cat</span><span class="o">:</span><span class="w"> </span><span class="kt">9</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Doc 22&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">},</span>
<span class="p">];</span>

<span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">bulk</span><span class="p">(</span>
<span class="w">  </span><span class="nx">replaceDocs</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">e</span><span class="p">)).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>



<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;items&quot;</span><span class="o">:</span>
<span class="w">  </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;replace&quot;</span><span class="o">:</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;created&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;updated&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;status&quot;</span><span class="o">:</span><span class="mf">200</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;replace&quot;</span><span class="o">:</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">2</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;created&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;updated&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;status&quot;</span><span class="o">:</span><span class="mf">200</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="s2">&quot;errors&quot;</span><span class="o">:</span><span class="kc">false</span>
<span class="p">}</span>
</code></pre></div>



<!-- request Go -->


<div class="codehilite"><pre><span></span><code><span class="nx">body</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;{\&quot;replace\&quot;: {\&quot;index\&quot;: \&quot;test\&quot;, \&quot;id\&quot;: 1, \&quot;doc\&quot;: {\&quot;content\&quot;: \&quot;Text 11\&quot;, \&quot;name\&quot;: \&quot;Doc 11\&quot;, \&quot;cat\&quot;: 1 }}}&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="s">&quot;{\&quot;replace\&quot;: {\&quot;index\&quot;: \&quot;test\&quot;, \&quot;id\&quot;: 2, \&quot;doc\&quot;: {\&quot;content\&quot;: \&quot;Text 22\&quot;, \&quot;name\&quot;: \&quot;Doc 22\&quot;, \&quot;cat\&quot;: 9 }}}&quot;</span><span class="w"> </span><span class="o">+</span><span class="s">&quot;\n&quot;</span><span class="p">;</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">IndexAPI</span><span class="p">.</span><span class="nx">Bulk</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">Body</span><span class="p">(</span><span class="nx">body</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>



<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s">&quot;items&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="s">&quot;replace&quot;</span><span class="p">:</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;_index&quot;</span><span class="p">:</span><span class="s">&quot;test&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;created&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;result&quot;</span><span class="p">:</span><span class="s">&quot;updated&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;status&quot;</span><span class="p">:</span><span class="mi">200</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="s">&quot;replace&quot;</span><span class="p">:</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;_index&quot;</span><span class="p">:</span><span class="s">&quot;test&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;created&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;result&quot;</span><span class="p">:</span><span class="s">&quot;updated&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;status&quot;</span><span class="p">:</span><span class="mi">200</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="s">&quot;errors&quot;</span><span class="p">:</span><span class="kc">false</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-12.03.03-update">
        <header>
            <a class="chapter-link" href="#toc-12.03.03-update"> ¶ 12.3.3</a>

            
            <h1 id="update">UPDATE</h1>
            
        </header>

        
        
<!-- example update -->

<p>UPDATE changes <a href="06-creating_a_table.html#row-wise-and-columnar-attribute-storages">row-wise</a> attribute values of existing documents in a specified table with new values. Note that you can't update the contents of a fulltext field or a columnar attribute. If there's such a need, use <a href="12-data_creation_and_modification.html#toc-12.03.02-replace">REPLACE</a>.</p>
<p>Attribute updates are supported for RT, PQ, and plain tables. All attribute types can be updated as long as they are stored in the <a href="06-creating_a_table.html#row-wise-and-columnar-attribute-storages">traditional row-wise storage</a>.</p>
<p>Note that the document ID cannot be updated.</p>
<p>Note that when you update an attribute, its <a href="20-server_settings.html#secondary_indexes">secondary index</a> gets disabled, so consider <a href="12-data_creation_and_modification.html#toc-12.03.02-replace">replacing</a> the document instead.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>
<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">UPDATE</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">enabled</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">10</span><span class="p">;</span>
</code></pre></div>



<!-- response -->


<div class="codehilite"><pre><span></span><code><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/upda</span><span class="kc">te</span>

<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="mi">0</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;updated&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;updateDocument([</span>
<span class="x">    &#39;enabled&#39;=&gt;0</span>
<span class="x">],10);</span>
</code></pre></div>



<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Array(</span>
<span class="x">    [_index] =&gt; products</span>
<span class="x">    [_id] =&gt; 10</span>
<span class="x">    [result] =&gt; updated</span>
<span class="x">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Python
</div>

<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">indexApi</span> <span class="o">=</span> <span class="n">api</span> <span class="o">=</span> <span class="n">manticoresearch</span><span class="o">.</span><span class="n">IndexApi</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">indexApi</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;doc&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">}})</span>
</code></pre></div>



<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;products&#39;</span><span class="p">,</span> <span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="s1">&#39;updated&#39;</span><span class="p">,</span> <span class="s1">&#39;updated&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Javascript
</div>

<!-- request javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">10</span><span class="p">}});</span>
</code></pre></div>



<!-- response javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;updated&quot;</span><span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
java
</div>

<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">UpdateDocumentRequest</span><span class="w"> </span><span class="n">updateRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UpdateDocumentRequest</span><span class="p">();</span>
<span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
<span class="p">}};</span>
<span class="n">updateRequest</span><span class="p">.</span><span class="na">index</span><span class="p">(</span><span class="s">&quot;products&quot;</span><span class="p">).</span><span class="na">id</span><span class="p">(</span><span class="mi">1L</span><span class="p">).</span><span class="na">setDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">indexApi</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">updateRequest</span><span class="p">);</span>
</code></pre></div>



<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">UpdateResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">index</span><span class="p">:</span><span class="w"> </span><span class="n">products</span>
<span class="w">    </span><span class="n">updated</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">result</span><span class="p">:</span><span class="w"> </span><span class="n">updated</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->

<div class="codehilite"><pre><span></span><code><span class="nt">Dictionary</span><span class="o">&lt;</span><span class="nt">string</span><span class="o">,</span><span class="w"> </span><span class="nt">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">Dictionary</span><span class="o">&lt;</span><span class="nt">string</span><span class="o">,</span><span class="w"> </span><span class="nt">Object</span><span class="o">&gt;();</span><span class="w"> </span>
<span class="nt">doc</span><span class="p">.</span><span class="nc">Add</span><span class="o">(</span><span class="s2">&quot;price&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">10</span><span class="o">);</span>
<span class="nt">UpdateDocumentRequest</span><span class="w"> </span><span class="nt">updateRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">UpdateDocumentRequest</span><span class="o">(</span><span class="nt">index</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">id</span><span class="o">:</span><span class="w"> </span><span class="nt">1</span><span class="o">,</span><span class="w"> </span><span class="nt">doc</span><span class="o">:</span><span class="w"> </span><span class="nt">doc</span><span class="o">);</span>
<span class="nt">indexApi</span><span class="p">.</span><span class="nc">Update</span><span class="o">(</span><span class="nt">updateRequest</span><span class="o">);</span>
</code></pre></div>



<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">UpdateResponse</span> {
    <span class="n">index:</span> <span class="n">products</span>
    <span class="n">updated:</span> <span class="n">null</span>
    <span class="n">id:</span> <span class="mi">1</span>
    <span class="n">result:</span> <span class="n">updated</span>
}
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
TypeScript
</div>

<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="w"> </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">cat</span><span class="o">:</span><span class="w"> </span><span class="kt">10</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>



<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;updated&quot;</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Go
</div>

<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">updateDoc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;cat&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">}</span>
<span class="nx">updateRequest</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">openapiclient</span><span class="p">.</span><span class="nx">NewUpdateDocumentRequest</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">updateDoc</span><span class="p">)</span>
<span class="nx">updateRequest</span><span class="p">.</span><span class="nx">SetId</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">IndexAPI</span><span class="p">.</span><span class="nx">Update</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">UpdateDocumentRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">updateRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>



<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;_index&quot;</span><span class="p">:</span><span class="s">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;result&quot;</span><span class="p">:</span><span class="s">&quot;updated&quot;</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example update multiple attributes -->

<p>Multiple attributes can be updated in a single statement. Example:</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>
<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">UPDATE</span><span class="w"> </span><span class="n">products</span>
<span class="k">SET</span><span class="w"> </span><span class="n">price</span><span class="o">=</span><span class="mi">100000000000</span><span class="p">,</span>
<span class="w">    </span><span class="n">coeff</span><span class="o">=</span><span class="mi">3465</span><span class="p">.</span><span class="mi">23</span><span class="p">,</span>
<span class="w">    </span><span class="n">tags1</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>
<span class="w">    </span><span class="n">tags2</span><span class="o">=</span><span class="p">()</span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;phone&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">enabled</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>



<!-- response -->


<div class="codehilite"><pre><span></span><code><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">148</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/upda</span><span class="kc">te</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="mi">100000000000</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;coeff&quot;</span><span class="p">:</span><span class="mf">3465.23</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;tags1&quot;</span><span class="p">:[</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;tags2&quot;</span><span class="p">:[]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;phone&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;equals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;updated&quot;</span><span class="p">:</span><span class="mi">148</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$query= new BoolQuery();</span>
<span class="x">$query-&gt;must(new Match(&#39;phone&#39;,&#39;*&#39;));</span>
<span class="x">$query-&gt;must(new Equals(&#39;enabled&#39;,1));</span>
<span class="x">$index-&gt;updateDocuments([</span>
<span class="x">    &#39;price&#39; =&gt; 100000000000,</span>
<span class="x">    &#39;coeff&#39; =&gt; 3465.23,</span>
<span class="x">    &#39;tags1&#39; =&gt; [3,6,4],</span>
<span class="x">    &#39;tags2&#39; =&gt; []</span>
<span class="x">    ],</span>
<span class="x">    $query</span>
<span class="x">);</span>
</code></pre></div>



<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Array(</span>
<span class="x">    [_index] =&gt; products</span>
<span class="x">    [updated] =&gt; 148</span>
<span class="x">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Python
</div>

<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">indexApi</span> <span class="o">=</span> <span class="n">api</span> <span class="o">=</span> <span class="n">manticoresearch</span><span class="o">.</span><span class="n">IndexApi</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">indexApi</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;doc&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">100000000000</span><span class="p">,</span>
    <span class="s2">&quot;coeff&quot;</span><span class="p">:</span> <span class="mf">3465.23</span><span class="p">,</span>
    <span class="s2">&quot;tags1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
    <span class="s2">&quot;tags2&quot;</span><span class="p">:</span> <span class="p">[]}})</span>
</code></pre></div>



<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;products&#39;</span><span class="p">,</span> <span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="s1">&#39;updated&#39;</span><span class="p">,</span> <span class="s1">&#39;updated&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Javascript
</div>

<!-- request javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">100000000000</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;coeff&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">3465.23</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;tags1&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mf">3</span><span class="p">,</span><span class="mf">6</span><span class="p">,</span><span class="mf">4</span><span class="p">],</span>
<span class="w">    </span><span class="s2">&quot;tags2&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[]}});</span>
</code></pre></div>



<!-- response javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;updated&quot;</span><span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
java
</div>

<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">UpdateDocumentRequest</span><span class="w"> </span><span class="n">updateRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UpdateDocumentRequest</span><span class="p">();</span>
<span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;coeff&quot;</span><span class="p">,</span><span class="mf">3465.23</span><span class="p">);</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;tags1&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="o">[]</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">});</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;tags2&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="o">[]</span><span class="p">{});</span>
<span class="p">}};</span>
<span class="n">updateRequest</span><span class="p">.</span><span class="na">index</span><span class="p">(</span><span class="s">&quot;products&quot;</span><span class="p">).</span><span class="na">id</span><span class="p">(</span><span class="mi">1L</span><span class="p">).</span><span class="na">setDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">indexApi</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">updateRequest</span><span class="p">);</span>
</code></pre></div>



<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">UpdateResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">index</span><span class="p">:</span><span class="w"> </span><span class="n">products</span>
<span class="w">    </span><span class="n">updated</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">result</span><span class="p">:</span><span class="w"> </span><span class="n">updated</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->

<div class="codehilite"><pre><span></span><code><span class="nt">Dictionary</span><span class="o">&lt;</span><span class="nt">string</span><span class="o">,</span><span class="w"> </span><span class="nt">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">Dictionary</span><span class="o">&lt;</span><span class="nt">string</span><span class="o">,</span><span class="w"> </span><span class="nt">Object</span><span class="o">&gt;();</span><span class="w"> </span>
<span class="nt">doc</span><span class="p">.</span><span class="nc">Add</span><span class="o">(</span><span class="s2">&quot;price&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">10</span><span class="o">);</span>
<span class="nt">doc</span><span class="p">.</span><span class="nc">Add</span><span class="o">(</span><span class="s2">&quot;coeff&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">3465</span><span class="p">.</span><span class="nc">23</span><span class="o">);</span>
<span class="nt">doc</span><span class="p">.</span><span class="nc">Add</span><span class="o">(</span><span class="s2">&quot;tags1&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">List</span><span class="o">&lt;</span><span class="nt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="err">3,6,4</span><span class="p">}</span><span class="o">);</span>
<span class="nt">doc</span><span class="p">.</span><span class="nc">Add</span><span class="o">(</span><span class="s2">&quot;tags2&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">List</span><span class="o">&lt;</span><span class="nt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="o">);</span>
<span class="nt">UpdateDocumentRequest</span><span class="w"> </span><span class="nt">updateRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">UpdateDocumentRequest</span><span class="o">(</span><span class="nt">index</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">id</span><span class="o">:</span><span class="w"> </span><span class="nt">1</span><span class="o">,</span><span class="w"> </span><span class="nt">doc</span><span class="o">:</span><span class="w"> </span><span class="nt">doc</span><span class="o">);</span>
<span class="nt">indexApi</span><span class="p">.</span><span class="nc">Update</span><span class="o">(</span><span class="nt">updateRequest</span><span class="o">);</span>
</code></pre></div>



<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">UpdateResponse</span> {
    <span class="n">index:</span> <span class="n">products</span>
    <span class="n">updated:</span> <span class="n">null</span>
    <span class="n">id:</span> <span class="mi">1</span>
    <span class="n">result:</span> <span class="n">updated</span>
}
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
TypeScript
</div>

<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="w"> </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Doc 21&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">cat</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;10&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>



<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s">&quot;_index&quot;</span><span class="p">:</span><span class="s">&quot;test&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;result&quot;</span><span class="p">:</span><span class="s">&quot;updated&quot;</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Go
</div>

<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">updateDoc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="s">&quot;Doc 21&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cat&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">}</span>
<span class="nx">updateRequest</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewUpdateDocumentRequest</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">updateDoc</span><span class="p">)</span>
<span class="nx">updateRequest</span><span class="p">.</span><span class="nx">SetId</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">IndexAPI</span><span class="p">.</span><span class="nx">Update</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">UpdateDocumentRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">updateRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>



<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s">&quot;_index&quot;</span><span class="p">:</span><span class="s">&quot;test&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;result&quot;</span><span class="p">:</span><span class="s">&quot;updated&quot;</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<p>When assigning out-of-range values to 32-bit attributes, they will be trimmed to their lower 32 bits without a prompt. For example, if you try to update the 32-bit unsigned int with a value of 4294967297, the value of 1 will actually be stored, because the lower 32 bits of 4294967297 (0x100000001 in hex) amount to 1 (0x00000001 in hex).</p>
<!-- example partial JSON update -->

<p><code>UPDATE</code> can be used to perform partial JSON updates on numeric data types or arrays of numeric data types. Just make sure you don't update an integer value with a float value as it will be rounded off.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>
<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;{&quot;tags&quot;:[1,2,3]}&#39;</span><span class="p">);</span>

<span class="k">update</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">meta</span><span class="p">.</span><span class="n">tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">100</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>



<!-- response -->


<div class="codehilite"><pre><span></span><code><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/i</span><span class="kc">nsert</span>
<span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;tags&quot;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="err">POST</span><span class="w"> </span><span class="err">/upda</span><span class="kc">te</span>
<span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;meta.tags[0]&quot;</span><span class="p">:</span><span class="mi">100</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">   </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;created&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="s2">&quot;created&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="mi">201</span>
<span class="p">}</span>

<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;updated&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;insertDocument([</span>
<span class="x">    &#39;title&#39; =&gt; &#39;title&#39;,</span>
<span class="x">    &#39;meta&#39; =&gt; [&#39;tags&#39; =&gt; [1,2,3]]</span>
<span class="x">],1);</span>
<span class="x">$index-&gt;updateDocument([</span>
<span class="x">    &#39;meta.tags[0]&#39; =&gt; 100</span>
<span class="x">],1);</span>
</code></pre></div>



<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Array(</span>
<span class="x">    [_index] =&gt; products</span>
<span class="x">    [_id] =&gt; 1</span>
<span class="x">    [created] =&gt; true</span>
<span class="x">    [result] =&gt; created</span>
<span class="x">)</span>

<span class="x">Array(</span>
<span class="x">    [_index] =&gt; products</span>
<span class="x">    [updated] =&gt; 1</span>
<span class="x">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Python
</div>

<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">indexApi</span> <span class="o">=</span> <span class="n">api</span> <span class="o">=</span> <span class="n">manticoresearch</span><span class="o">.</span><span class="n">IndexApi</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">indexApi</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;doc&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;meta.tags[0]&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}})</span>
</code></pre></div>



<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;products&#39;</span><span class="p">,</span> <span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="s1">&#39;updated&#39;</span><span class="p">,</span> <span class="s1">&#39;updated&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Javascript
</div>

<!-- request javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="s2">&quot;meta.tags[0]&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">100</span><span class="p">}});</span>
</code></pre></div>



<!-- response javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;updated&quot;</span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
java
</div>

<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">UpdateDocumentRequest</span><span class="w"> </span><span class="n">updateRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UpdateDocumentRequest</span><span class="p">();</span>
<span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;meta.tags[0]&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>
<span class="p">}};</span>
<span class="n">updateRequest</span><span class="p">.</span><span class="na">index</span><span class="p">(</span><span class="s">&quot;products&quot;</span><span class="p">).</span><span class="na">id</span><span class="p">(</span><span class="mi">1L</span><span class="p">).</span><span class="na">setDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">indexApi</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">updateRequest</span><span class="p">);</span>
</code></pre></div>



<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">UpdateResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">index</span><span class="p">:</span><span class="w"> </span><span class="n">products</span>
<span class="w">    </span><span class="n">updated</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">result</span><span class="p">:</span><span class="w"> </span><span class="n">updated</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->

<div class="codehilite"><pre><span></span><code><span class="nt">Dictionary</span><span class="o">&lt;</span><span class="nt">string</span><span class="o">,</span><span class="w"> </span><span class="nt">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">Dictionary</span><span class="o">&lt;</span><span class="nt">string</span><span class="o">,</span><span class="w"> </span><span class="nt">Object</span><span class="o">&gt;();</span><span class="w"> </span>
<span class="nt">doc</span><span class="p">.</span><span class="nc">Add</span><span class="o">(</span><span class="s2">&quot;meta.tags</span><span class="cp">[</span><span class="mi">0</span><span class="cp">]</span><span class="s2">&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">100</span><span class="o">);</span>
<span class="nt">UpdateDocumentRequest</span><span class="w"> </span><span class="nt">updateRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">UpdateDocumentRequest</span><span class="o">(</span><span class="nt">index</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">id</span><span class="o">:</span><span class="w"> </span><span class="nt">1</span><span class="o">,</span><span class="w"> </span><span class="nt">doc</span><span class="o">:</span><span class="w"> </span><span class="nt">doc</span><span class="o">);</span>
<span class="nt">indexApi</span><span class="p">.</span><span class="nc">Update</span><span class="o">(</span><span class="nt">updateRequest</span><span class="o">);</span>
</code></pre></div>



<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">UpdateResponse</span> {
    <span class="n">index:</span> <span class="n">products</span>
    <span class="n">updated:</span> <span class="n">null</span>
    <span class="n">id:</span> <span class="mi">1</span>
    <span class="n">result:</span> <span class="n">updated</span>
}
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
TypeScript
</div>

<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;meta.tags[0]&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">100</span><span class="p">}</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>



<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;updated&quot;</span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Go
</div>

<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">updateDoc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;meta.tags[0]&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">}</span>
<span class="nx">updateRequest</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewUpdateDocumentRequest</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">updateDoc</span><span class="p">)</span>
<span class="nx">updateRequest</span><span class="p">.</span><span class="nx">SetId</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">IndexAPI</span><span class="p">.</span><span class="nx">Update</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">UpdateDocumentRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">updateRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>



<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;_index&quot;</span><span class="p">:</span><span class="s">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;result&quot;</span><span class="p">:</span><span class="s">&quot;updated&quot;</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example full JSON update -->

<p>Updating other data types or changing property type in a JSON attribute requires a full JSON update.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>
<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;{&quot;tags&quot;:[1,2,3]}&#39;</span><span class="p">);</span>

<span class="k">update</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="k">data</span><span class="o">=</span><span class="s1">&#39;{&quot;tags&quot;:[&quot;one&quot;,&quot;two&quot;,&quot;three&quot;]}&#39;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>



<!-- response -->


<div class="codehilite"><pre><span></span><code><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/i</span><span class="kc">nsert</span>
<span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="s2">&quot;{\&quot;tags\&quot;:[1,2,3]}&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="err">POST</span><span class="w"> </span><span class="err">/upda</span><span class="kc">te</span>
<span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="s2">&quot;{\&quot;tags\&quot;:[\&quot;one\&quot;,\&quot;two\&quot;,\&quot;three\&quot;]}&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;updated&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;insertDocument([</span>
<span class="x">    &#39;title&#39;=&gt; &#39;title&#39;,</span>
<span class="x">    &#39;data&#39; =&gt; [</span>
<span class="x">         &#39;tags&#39; =&gt; [1,2,3]</span>
<span class="x">    ]</span>
<span class="x">],1);</span>

<span class="x">$index-&gt;updateDocument([</span>
<span class="x">    &#39;data&#39; =&gt; [</span>
<span class="x">            &#39;one&#39;, &#39;two&#39;, &#39;three&#39;</span>
<span class="x">    ]</span>
<span class="x">],1);</span>
</code></pre></div>



<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Array(</span>
<span class="x">    [_index] =&gt; products</span>
<span class="x">    [_id] =&gt; 1</span>
<span class="x">    [created] =&gt; true</span>
<span class="x">    [result] =&gt; created</span>
<span class="x">)</span>

<span class="x">Array(</span>
<span class="x">    [_index] =&gt; products</span>
<span class="x">    [updated] =&gt; 1</span>
<span class="x">)</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Python
</div>

<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">indexApi</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;doc&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span> <span class="p">:</span> <span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;tags&quot;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]}}})</span>
<span class="n">indexApi</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;doc&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;meta&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;tags&quot;</span><span class="p">:[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span><span class="s1">&#39;two&#39;</span><span class="p">,</span><span class="s1">&#39;three&#39;</span><span class="p">]}}})</span>
</code></pre></div>



<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;created&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
 <span class="s1">&#39;found&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
 <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;products&#39;</span><span class="p">,</span>
 <span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="s1">&#39;created&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;products&#39;</span><span class="p">,</span> <span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="s1">&#39;updated&#39;</span><span class="p">,</span> <span class="s1">&#39;updated&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Javascript
</div>

<!-- request javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">100</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;meta&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="mf">3</span><span class="p">]}}});</span>
<span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">100</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;meta&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;tags&quot;</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span><span class="s1">&#39;two&#39;</span><span class="p">,</span><span class="s1">&#39;three&#39;</span><span class="p">]}}});</span>
</code></pre></div>



<!-- response javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">100</span><span class="p">,</span><span class="s2">&quot;created&quot;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;created&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">100</span><span class="p">,</span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;updated&quot;</span><span class="p">}</span>
</code></pre></div>




<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
java
</div>

<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">InsertDocumentRequest</span><span class="w"> </span><span class="n">newdoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InsertDocumentRequest</span><span class="p">();</span>
<span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span><span class="s">&quot;title&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;meta&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">            </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;tags&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="o">[]</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">});</span>
<span class="w">        </span><span class="p">}});</span>

<span class="p">}};</span>
<span class="n">newdoc</span><span class="p">.</span><span class="na">index</span><span class="p">(</span><span class="s">&quot;products&quot;</span><span class="p">).</span><span class="na">id</span><span class="p">(</span><span class="mi">100L</span><span class="p">).</span><span class="na">setDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span><span class="w">        </span>
<span class="n">indexApi</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">newdoc</span><span class="p">);</span>

<span class="n">updatedoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UpdateDocumentRequest</span><span class="p">();</span>
<span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;meta&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">            </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;tags&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="s">&quot;one&quot;</span><span class="p">,</span><span class="s">&quot;two&quot;</span><span class="p">,</span><span class="s">&quot;three&quot;</span><span class="p">});</span>
<span class="w">        </span><span class="p">}});</span>
<span class="p">}};</span>
<span class="n">updatedoc</span><span class="p">.</span><span class="na">index</span><span class="p">(</span><span class="s">&quot;products&quot;</span><span class="p">).</span><span class="na">id</span><span class="p">(</span><span class="mi">100L</span><span class="p">).</span><span class="na">setDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">indexApi</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">updatedoc</span><span class="p">);</span>
</code></pre></div>



<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">SuccessResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">index</span><span class="p">:</span><span class="w"> </span><span class="n">products</span>
<span class="w">    </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span>
<span class="w">    </span><span class="n">created</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">result</span><span class="p">:</span><span class="w"> </span><span class="n">created</span>
<span class="w">    </span><span class="n">found</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">UpdateResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">index</span><span class="p">:</span><span class="w"> </span><span class="n">products</span>
<span class="w">    </span><span class="n">updated</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span>
<span class="w">    </span><span class="n">result</span><span class="p">:</span><span class="w"> </span><span class="n">updated</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->

<div class="codehilite"><pre><span></span><code><span class="nt">Dictionary</span><span class="o">&lt;</span><span class="nt">string</span><span class="o">,</span><span class="w"> </span><span class="nt">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">Dictionary</span><span class="o">&lt;</span><span class="nt">string</span><span class="o">,</span><span class="w"> </span><span class="nt">Object</span><span class="o">&gt;();</span><span class="w"> </span>
<span class="nt">meta</span><span class="p">.</span><span class="nc">Add</span><span class="o">(</span><span class="s2">&quot;tags&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">List</span><span class="o">&lt;</span><span class="nt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="err">1,2,3</span><span class="p">}</span><span class="o">);</span>
<span class="nt">Dictionary</span><span class="o">&lt;</span><span class="nt">string</span><span class="o">,</span><span class="w"> </span><span class="nt">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">Dictionary</span><span class="o">&lt;</span><span class="nt">string</span><span class="o">,</span><span class="w"> </span><span class="nt">Object</span><span class="o">&gt;();</span><span class="w"> </span>
<span class="nt">doc</span><span class="p">.</span><span class="nc">Add</span><span class="o">(</span><span class="s2">&quot;title&quot;</span><span class="o">,</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="o">);</span>
<span class="nt">doc</span><span class="p">.</span><span class="nc">Add</span><span class="o">(</span><span class="s2">&quot;meta&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">meta</span><span class="o">);</span>
<span class="nt">InsertDocumentRequest</span><span class="w"> </span><span class="nt">newdoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">InsertDocumentRequest</span><span class="o">(</span><span class="nt">index</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">id</span><span class="o">:</span><span class="w"> </span><span class="nt">100</span><span class="o">,</span><span class="w"> </span><span class="nt">doc</span><span class="o">:</span><span class="w"> </span><span class="nt">doc</span><span class="o">);</span>
<span class="nt">indexApi</span><span class="p">.</span><span class="nc">Insert</span><span class="o">(</span><span class="nt">newdoc</span><span class="o">);</span>

<span class="nt">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">Dictionary</span><span class="o">&lt;</span><span class="nt">string</span><span class="o">,</span><span class="w"> </span><span class="nt">Object</span><span class="o">&gt;();</span>
<span class="nt">meta</span><span class="p">.</span><span class="nc">Add</span><span class="o">(</span><span class="s2">&quot;tags&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">List</span><span class="o">&lt;</span><span class="nt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="err">&quot;one&quot;,&quot;two&quot;,&quot;three&quot;</span><span class="p">}</span><span class="o">);</span><span class="w"> </span>
<span class="nt">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">Dictionary</span><span class="o">&lt;</span><span class="nt">string</span><span class="o">,</span><span class="w"> </span><span class="nt">Object</span><span class="o">&gt;();</span><span class="w"> </span>
<span class="nt">doc</span><span class="p">.</span><span class="nc">Add</span><span class="o">(</span><span class="s2">&quot;meta&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">meta</span><span class="o">);</span>
<span class="nt">UpdateDocumentRequest</span><span class="w"> </span><span class="nt">updatedoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">UpdateDocumentRequest</span><span class="o">(</span><span class="nt">index</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">id</span><span class="o">:</span><span class="w"> </span><span class="nt">100</span><span class="o">,</span><span class="w"> </span><span class="nt">doc</span><span class="o">:</span><span class="w"> </span><span class="nt">doc</span><span class="o">);</span>
<span class="nt">indexApi</span><span class="p">.</span><span class="nc">Update</span><span class="o">(</span><span class="nt">updatedoc</span><span class="o">);</span>
</code></pre></div>



<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">SuccessResponse</span> {
    <span class="n">index:</span> <span class="n">products</span>
    <span class="n">id:</span> <span class="mi">100</span>
    <span class="n">created:</span> <span class="n">true</span>
    <span class="n">result:</span> <span class="n">created</span>
    <span class="n">found:</span> <span class="n">null</span>
}

<span class="k">class</span> <span class="n">UpdateResponse</span> {
    <span class="n">index:</span> <span class="n">products</span>
    <span class="n">updated:</span> <span class="n">null</span>
    <span class="n">id:</span> <span class="mi">100</span>
    <span class="n">result:</span> <span class="n">updated</span>
}
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
TypeScript
</div>

<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
<span class="w">  </span><span class="nx">doc</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Text 1&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Doc 1&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">meta</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">tags</span><span class="o">:</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="mf">3</span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="p">})</span>
<span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="w"> </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">meta</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">tags</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span><span class="s1">&#39;two&#39;</span><span class="p">,</span><span class="s1">&#39;three&#39;</span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>



<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;created&quot;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;created&quot;</span>
<span class="p">}</span>

<span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;updated&quot;</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
TypeScript
</div>

<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">metaField</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">}}</span>
<span class="nx">insertDoc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Doc 1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">metaField</span><span class="p">}}</span>
<span class="nx">insertRequest</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewInsertDocumentRequest</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">insertDoc</span><span class="p">)</span>
<span class="nx">insertRequest</span><span class="p">.</span><span class="nx">SetId</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">IndexAPI</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">InsertDocumentRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">insertRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">();</span>

<span class="nx">metaField</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;one&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;two&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;three&quot;</span><span class="p">}}</span>
<span class="nx">updateDoc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">metaField</span><span class="p">}</span>
<span class="nx">updateRequest</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewUpdateDocumentRequest</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">updateDoc</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">IndexAPI</span><span class="p">.</span><span class="nx">Update</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">UpdateDocumentRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">updateRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>



<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;_index&quot;</span><span class="p">:</span><span class="s">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;created&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;result&quot;</span><span class="p">:</span><span class="s">&quot;created&quot;</span>
<span class="p">}</span>

<span class="p">{</span>
<span class="w">    </span><span class="s">&quot;_index&quot;</span><span class="p">:</span><span class="s">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;result&quot;</span><span class="p">:</span><span class="s">&quot;updated&quot;</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example cluster update -->

<p>When using replication, the table name should be prepended with <code>cluster_name:</code> (in SQL) so that updates will be propagated to all nodes in the cluster. For queries via HTTP, you should set a <code>cluster</code> property. See <a href="10-creating_a_cluster.html#toc-10.03-setting_up_replication">setting up replication</a> for more information.</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;cluster&quot;</span><span class="p">:</span><span class="s2">&quot;nodes4&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;gid&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;price&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>
<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">update</span><span class="w"> </span><span class="n">weekly</span><span class="p">:</span><span class="n">posts</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">enabled</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/upda</span><span class="kc">te</span>
<span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;cluster&quot;</span><span class="p">:</span><span class="s2">&quot;weekly&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="mi">0</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;setName(&#39;products&#39;)-&gt;setCluster(&#39;weekly&#39;);</span>
<span class="x">$index-&gt;updateDocument([&#39;enabled&#39;=&gt;0],1);</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Python
</div>

<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">indexApi</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;cluster&quot;</span><span class="p">:</span><span class="s2">&quot;weekly&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;doc&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;enabled&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">}})</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Javascript
</div>

<!-- request javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">wait</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="s2">&quot;cluster&quot;</span><span class="o">:</span><span class="s2">&quot;weekly&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;enabled&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">}});</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
java
</div>

<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">updatedoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UpdateDocumentRequest</span><span class="p">();</span>
<span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;enabled&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}};</span>
<span class="n">updatedoc</span><span class="p">.</span><span class="na">index</span><span class="p">(</span><span class="s">&quot;products&quot;</span><span class="p">).</span><span class="na">cluster</span><span class="p">(</span><span class="s">&quot;weekly&quot;</span><span class="p">).</span><span class="na">id</span><span class="p">(</span><span class="mi">1L</span><span class="p">).</span><span class="na">setDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">indexApi</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">updatedoc</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->

<div class="codehilite"><pre><span></span><code><span class="nt">Dictionary</span><span class="o">&lt;</span><span class="nt">string</span><span class="o">,</span><span class="w"> </span><span class="nt">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">Dictionary</span><span class="o">&lt;</span><span class="nt">string</span><span class="o">,</span><span class="w"> </span><span class="nt">Object</span><span class="o">&gt;();</span><span class="w"> </span>
<span class="nt">doc</span><span class="p">.</span><span class="nc">Add</span><span class="o">(</span><span class="s2">&quot;enabled&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">0</span><span class="o">);</span>
<span class="nt">UpdateDocumentRequest</span><span class="w"> </span><span class="nt">updatedoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">UpdateDocumentRequest</span><span class="o">(</span><span class="nt">index</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">cluster</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;weekly&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">id</span><span class="o">:</span><span class="w"> </span><span class="nt">1</span><span class="o">,</span><span class="w"> </span><span class="nt">doc</span><span class="o">:</span><span class="w"> </span><span class="nt">doc</span><span class="o">);</span>
<span class="nt">indexApi</span><span class="p">.</span><span class="nc">Update</span><span class="o">(</span><span class="nt">updatedoc</span><span class="o">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
TypeScript
</div>

<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">wait</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="nx">cluster</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test_cluster&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">name</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Doc 11&#39;</span><span class="p">}}</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Go
</div>

<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">updateDoc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="s">&quot;Doc 11&quot;</span><span class="p">}</span>
<span class="nx">updateRequest</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewUpdateDocumentRequest</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">updateDoc</span><span class="p">)</span>
<span class="nx">updateRequest</span><span class="p">.</span><span class="nx">SetCluster</span><span class="p">(</span><span class="s">&quot;test_cluster&quot;</span><span class="p">)</span>
<span class="nx">updateRequest</span><span class="p">.</span><span class="nx">SetId</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">IndexAPI</span><span class="p">.</span><span class="nx">Update</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">UpdateDocumentRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">updateRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<h2 id="updates-via-sql">Updates via SQL</h2>
<p>Here is the syntax for the SQL <code>UPDATE</code> statement:</p>
<div class="codehilite"><pre><span></span><code><span class="k">UPDATE</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">col1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newval1</span><span class="w"> </span><span class="p">[,</span><span class="w"> </span><span class="p">...]</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">where_condition</span><span class="w"> </span><span class="p">[</span><span class="k">OPTION</span><span class="w"> </span><span class="n">opt_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">opt_value</span><span class="w"> </span><span class="p">[,</span><span class="w"> </span><span class="p">...]]</span><span class="w"> </span><span class="p">[</span><span class="k">FORCE</span><span class="o">|</span><span class="k">IGNORE</span><span class="w"> </span><span class="k">INDEX</span><span class="p">(</span><span class="n">id</span><span class="p">)]</span>
</code></pre></div>

<p><code>where_condition</code> has the same syntax as in the <a href="13-searching.html#sql">SELECT</a> statement.</p>
<!-- example MVA empty update -->

<p>Multi-value attribute value sets must be specified as comma-separated lists in parentheses. To remove all values from a multi-value attribute, just assign <code>()</code> to it.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>
<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">UPDATE</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">tags1</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>

<span class="k">UPDATE</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">tags1</span><span class="o">=</span><span class="p">()</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>



<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/upda</span><span class="kc">te</span>

<span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;tags1&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;updated&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;updateDocument([&#39;tags1&#39;=&gt;[]],1);</span>
</code></pre></div>



<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Array(</span>
<span class="x">    [_index] =&gt; products</span>
<span class="x">    [updated] =&gt; 1</span>
<span class="x">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Python
</div>

<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">indexApi</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;doc&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;tags1&quot;</span><span class="p">:</span> <span class="p">[]}})</span>
</code></pre></div>



<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;products&#39;</span><span class="p">,</span> <span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="s1">&#39;updated&#39;</span><span class="p">,</span> <span class="s1">&#39;updated&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Javascript
</div>

<!-- request javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">indexApi</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;tags1&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[]}})</span>
</code></pre></div>



<!-- response javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;updated&quot;</span><span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
java
</div>

<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">updatedoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UpdateDocumentRequest</span><span class="p">();</span>
<span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;tags1&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="o">[]</span><span class="p">{});</span>
<span class="p">}};</span>
<span class="n">updatedoc</span><span class="p">.</span><span class="na">index</span><span class="p">(</span><span class="s">&quot;products&quot;</span><span class="p">).</span><span class="na">id</span><span class="p">(</span><span class="mi">1L</span><span class="p">).</span><span class="na">setDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">indexApi</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">updatedoc</span><span class="p">);</span>
</code></pre></div>



<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">UpdateResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">index</span><span class="p">:</span><span class="w"> </span><span class="n">products</span>
<span class="w">    </span><span class="n">updated</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">result</span><span class="p">:</span><span class="w"> </span><span class="n">updated</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->

<div class="codehilite"><pre><span></span><code><span class="nt">Dictionary</span><span class="o">&lt;</span><span class="nt">string</span><span class="o">,</span><span class="w"> </span><span class="nt">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">Dictionary</span><span class="o">&lt;</span><span class="nt">string</span><span class="o">,</span><span class="w"> </span><span class="nt">Object</span><span class="o">&gt;();</span><span class="w"> </span>
<span class="nt">doc</span><span class="p">.</span><span class="nc">Add</span><span class="o">(</span><span class="s2">&quot;tags1&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">List</span><span class="o">&lt;</span><span class="nt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="o">);</span>
<span class="nt">UpdateDocumentRequest</span><span class="w"> </span><span class="nt">updatedoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">UpdateDocumentRequest</span><span class="o">(</span><span class="nt">index</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">id</span><span class="o">:</span><span class="w"> </span><span class="nt">1</span><span class="o">,</span><span class="w"> </span><span class="nt">doc</span><span class="o">:</span><span class="w"> </span><span class="nt">doc</span><span class="o">);</span>
<span class="nt">indexApi</span><span class="p">.</span><span class="nc">Update</span><span class="o">(</span><span class="nt">updatedoc</span><span class="o">);</span>
</code></pre></div>



<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">UpdateResponse</span> {
    <span class="n">index:</span> <span class="n">products</span>
    <span class="n">updated:</span> <span class="n">null</span>
    <span class="n">id:</span> <span class="mi">1</span>
    <span class="n">result:</span> <span class="n">updated</span>
}
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
TypeScript
</div>

<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="w"> </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">cat</span><span class="o">:</span><span class="w"> </span><span class="kt">10</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>



<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;updated&quot;</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Go
</div>

<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">updateDoc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;cat&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">}</span>
<span class="nx">updateRequest</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewUpdateDocumentRequest</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">updateDoc</span><span class="p">)</span>
<span class="nx">updateRequest</span><span class="p">.</span><span class="nx">SetId</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">IndexAPI</span><span class="p">.</span><span class="nx">Update</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">UpdateDocumentRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">updateRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>



<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;_index&quot;</span><span class="p">:</span><span class="s">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;result&quot;</span><span class="p">:</span><span class="s">&quot;updated&quot;</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<p><code>OPTION</code> clause is a Manticore-specific extension that lets you control a number of per-update options. The syntax is:</p>
<div class="codehilite"><pre><span></span><code><span class="k">OPTION</span><span class="w"> </span><span class="o">&lt;</span><span class="n">optionname</span><span class="o">&gt;=&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">]</span>
</code></pre></div>

<p>The options are the same as for the <a href="13-searching.html#sql">SELECT</a> statement. Specifically for the <code>UPDATE</code> statement, you can use these options:</p>
<ul>
<li>'ignore_nonexistent_columns' - If set to <strong>1</strong>, it indicates that the update will silently ignore any warnings about trying to update a column which does not exist in the current table schema. The default value is <strong>0</strong>.</li>
<li>'strict' - This option is used in partial JSON attribute updates. By default (strict=1), <code>UPDATE</code> will result in an error if the <code>UPDATE</code> query tries to perform an update on non-numeric properties. With strict=0, if multiple properties are updated and some are not allowed, the <code>UPDATE</code> will not result in an error and will perform the changes only on allowed properties (with the rest being ignored). If none of the <code>SET</code> changes of the <code>UPDATE</code> re permitted, the command will result in an error even with strict=0.</li>
</ul>
<h3 id="query-optimizer-hints">Query optimizer hints</h3>
<p>In rare cases, Manticore's built-in query analyzer may be incorrect in understanding a query and determining whether a table by ID should be used. This can result in poor performance for queries like <code>UPDATE ... WHERE id = 123</code>.<br />
For information on how to force the optimizer to use a docid index, see <a href="13-searching.html#query optimizer hints">Query optimizer hints</a>.</p>
<h2 id="updates-via-http-json">Updates via HTTP JSON</h2>
<p>Updates using HTTP JSON protocol are performed via the <code>/update</code> endpoint. The syntax is similar to the <a href="12-data_creation_and_modification.html#toc-12.01.01-adding_documents_to_a_realtime_table">/insert endpoint</a>, but this time the <code>doc</code> property is mandatory.</p>
<p>The server will respond with a JSON object stating if the operation was successful or not.</p>
<!-- example JSON update -->

<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/upda</span><span class="kc">te</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span>
<span class="w">   </span><span class="p">{</span>
<span class="w">     </span><span class="nt">&quot;gid&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<span class="w">     </span><span class="nt">&quot;price&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;updated&quot;</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example JSON Example_2 -->

<p>The ID of the document that needs to be updated can be set directly using the <code>id</code> property, as shown in the previous example, or you can update documents by query and apply the update to all the documents that match the query:</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/upda</span><span class="kc">te</span>

<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;price&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;apple&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;updated&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<p>The query syntax is the same as in the <a href="13-searching.html#http-json">/search endpoint</a>. Note that you can't specify <code>id</code> and <code>query</code> at the same time.</p>
<h2 id="flushing-attributes">Flushing attributes</h2>
<div class="codehilite"><pre><span></span><code><span class="n">FLUSH</span><span class="w"> </span><span class="n">ATTRIBUTES</span>
</code></pre></div>

<p>The FLUSH ATTRIBUTES command flushes all in-memory attribute updates in all the active tables to disk. It returns a tag that identifies the result on-disk state, which represents the number of actual disk attribute saves performed since the server startup.</p>
<div class="codehilite"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="n">testindex</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">channel_id</span><span class="o">=</span><span class="mi">1107025</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">04</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="n">FLUSH</span><span class="w"> </span><span class="n">ATTRIBUTES</span><span class="p">;</span>
<span class="o">+</span><span class="c1">------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">tag</span><span class="w">  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">19</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>

<p>See also <a href="12-data_creation_and_modification.html#attr_flush_period">attr_flush_period</a> setting.</p>
<h2 id="bulk-updates">Bulk updates</h2>
<!-- example bulk update -->

<p>You can perform multiple update operations in a single call using the <code>/bulk</code> endpoint. This endpoint only works with data that has <code>Content-Type</code> set to <code>application/x-ndjson</code>. The data should be formatted as newline-delimited JSON (NDJSON). Essentially, this means that each line should contain exactly one JSON statement and end with a newline <code>\n</code> and, possibly, a <code>\r</code>.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>

<!-- request JSON --Content-type=application/x-ndjson -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/bulk</span>

<span class="p">{</span><span class="w"> </span><span class="nt">&quot;update&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;index&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;id&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;price&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="p">{</span><span class="w"> </span><span class="nt">&quot;update&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;index&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;id&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;price&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">   </span><span class="nt">&quot;items&quot;</span><span class="p">:</span>
<span class="w">   </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">         </span><span class="nt">&quot;update&quot;</span><span class="p">:</span>
<span class="w">         </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="s2">&quot;updated&quot;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">         </span><span class="nt">&quot;update&quot;</span><span class="p">:</span>
<span class="w">         </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="s2">&quot;updated&quot;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">   </span><span class="p">],</span>
<span class="w">   </span><span class="nt">&quot;errors&quot;</span><span class="p">:</span><span class="kc">false</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<p>The <code>/bulk</code> endpoint supports inserts, replaces, and deletes. Each statement begins with an action type (in this case, <code>update</code>). Here's a list of the supported actions:</p>
<ul>
<li><code>insert</code>: Inserts a document. The syntax is the same as in the <a href="04-quick_start_guide.html#add-documents">/insert endpoint</a>.</li>
<li><code>create</code>: a synonym for <code>insert</code></li>
<li><code>replace</code>: Replaces a document. The syntax is the same as in the <a href="12-data_creation_and_modification.html#toc-12.03.02-replace">/replace</a>.</li>
<li><code>index</code>: a synonym for <code>replace</code></li>
<li><code>update</code>: Updates a document. The syntax is the same as in the <a href="12-data_creation_and_modification.html#updates-via-http-json">/update</a>.</li>
<li><code>delete</code>: Deletes a document. The syntax is the same as in the <a href="12-data_creation_and_modification.html#toc-12.04-deleting_documents">/delete endpoint</a>.</li>
</ul>
<p>Updates by query and deletes by query are also supported.</p>
<!-- example bulk by query -->

<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>

<!-- request JSON --Content-type=application/x-ndjson -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/bulk</span>

<span class="p">{</span><span class="w"> </span><span class="nt">&quot;update&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;index&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;coeff&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;range&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;gte&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="p">{</span><span class="w"> </span><span class="nt">&quot;update&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;index&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;coeff&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;range&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;lt&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;items&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;update&quot;</span><span class="p">:</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;updated&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;update&quot;</span><span class="p">:</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;updated&quot;</span><span class="p">:</span><span class="mi">3</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;errors&quot;</span><span class="p">:</span><span class="kc">false</span>
<span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$client-&gt;bulk([</span>
<span class="x">    [&#39;update&#39;=&gt;[</span>
<span class="x">            &#39;index&#39; =&gt; &#39;products&#39;,</span>
<span class="x">             &#39;doc&#39; =&gt; [</span>
<span class="x">                &#39;coeff&#39; =&gt; 100</span>
<span class="x">            ],</span>
<span class="x">            &#39;query&#39; =&gt; [</span>
<span class="x">                &#39;range&#39; =&gt; [&#39;price&#39;=&gt;[&#39;gte&#39;=&gt;1000]]</span>
<span class="x">            ]   </span>
<span class="x">        ]</span>
<span class="x">    ],</span>
<span class="x">    [&#39;update&#39;=&gt;[</span>
<span class="x">            &#39;index&#39; =&gt; &#39;products&#39;,</span>
<span class="x">             &#39;doc&#39; =&gt; [</span>
<span class="x">                &#39;coeff&#39; =&gt; 0</span>
<span class="x">            ],</span>
<span class="x">            &#39;query&#39; =&gt; [</span>
<span class="x">                &#39;range&#39; =&gt; [&#39;price&#39;=&gt;[&#39;lt&#39;=&gt;1000]]</span>
<span class="x">            ]   </span>
<span class="x">        ]</span>
<span class="x">    ]</span>
<span class="x">]);</span>
</code></pre></div>



<!-- response PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">Array(</span>
<span class="x">    [items] =&gt; Array (</span>
<span class="x">        Array(</span>
<span class="x">            [update] =&gt; Array(</span>
<span class="x">                [_index] =&gt; products</span>
<span class="x">                [updated] =&gt; 1</span>
<span class="x">            )</span>
<span class="x">        )   </span>
<span class="x">        Array(</span>
<span class="x">             [update] =&gt; Array(</span>
<span class="x">                 [_index] =&gt; products</span>
<span class="x">                 [updated] =&gt; 3</span>
<span class="x">             )</span>
<span class="x">        )    </span>
<span class="x">)</span>
</code></pre></div>




<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Python
</div>

<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">docs</span> <span class="o">=</span> <span class="p">[</span> \
            <span class="p">{</span> <span class="s2">&quot;update&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span> <span class="s2">&quot;doc&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;coeff&quot;</span> <span class="p">:</span> <span class="mi">1000</span> <span class="p">},</span> <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;range&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;gte&quot;</span><span class="p">:</span> <span class="mi">1000</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">},</span> \
            <span class="p">{</span> <span class="s2">&quot;update&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span> <span class="s2">&quot;doc&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;coeff&quot;</span> <span class="p">:</span> <span class="mi">0</span> <span class="p">},</span> <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;range&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;lt&quot;</span><span class="p">:</span> <span class="mi">1000</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">]</span>
<span class="n">indexApi</span><span class="o">.</span><span class="n">bulk</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">,</span><span class="n">docs</span><span class="p">)))</span>
</code></pre></div>



<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;items&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;update&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_index&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;products&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;updated&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
           <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;update&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_index&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;products&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;updated&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}}]}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Javascript
</div>

<!-- request javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">docs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;update&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;coeff&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1000</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;range&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;gte&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1000</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;update&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;coeff&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;range&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;lt&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1000</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">];</span>
<span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">bulk</span><span class="p">(</span><span class="nx">docs</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">e</span><span class="p">=&gt;</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">e</span><span class="p">)).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">));</span>
</code></pre></div>



<!-- response javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;items&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;update&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="s2">&quot;updated&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">}},{</span><span class="s2">&quot;update&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="s2">&quot;updated&quot;</span><span class="o">:</span><span class="mf">3</span><span class="p">}}],</span><span class="s2">&quot;errors&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
java
</div>

<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">String</span><span class="w">   </span><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;{ \&quot;update\&quot; : { \&quot;index\&quot; : \&quot;products\&quot;, \&quot;doc\&quot;: { \&quot;coeff\&quot; : 1000 }, \&quot;query\&quot;: { \&quot;range\&quot;: { \&quot;price\&quot;: { \&quot;gte\&quot;: 1000 } } } }} &quot;</span><span class="o">+</span><span class="s">&quot;\n&quot;</span><span class="o">+</span>
<span class="w">    </span><span class="s">&quot;{ \&quot;update\&quot; : { \&quot;index\&quot; : \&quot;products\&quot;, \&quot;doc\&quot;: { \&quot;coeff\&quot; : 0 }, \&quot;query\&quot;: { \&quot;range\&quot;: { \&quot;price\&quot;: { \&quot;lt\&quot;: 1000 } } } } }&quot;</span><span class="o">+</span><span class="s">&quot;\n&quot;</span><span class="p">;</span><span class="w">         </span>
<span class="n">indexApi</span><span class="p">.</span><span class="na">bulk</span><span class="p">(</span><span class="n">body</span><span class="p">);</span>
</code></pre></div>



<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">BulkResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">items</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="p">{</span><span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="n">_index</span><span class="o">=</span><span class="n">products</span><span class="p">,</span><span class="w"> </span><span class="n">_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">created</span><span class="o">=</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="o">=</span><span class="n">updated</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="n">_index</span><span class="o">=</span><span class="n">products</span><span class="p">,</span><span class="w"> </span><span class="n">_id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">created</span><span class="o">=</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="o">=</span><span class="n">updated</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">}}</span><span class="o">]</span>
<span class="w">    </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="n">additionalProperties</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">errors</span><span class="o">=</span><span class="kc">false</span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->

<div class="codehilite"><pre><span></span><code>string   body = &quot;{ \&quot;update\&quot; : { \&quot;index\&quot; : \&quot;products\&quot;, \&quot;doc\&quot;: { \&quot;coeff\&quot; : 1000 }, \&quot;query\&quot;: { \&quot;range\&quot;: { \&quot;price\&quot;: { \&quot;gte\&quot;: 1000 } } } }} &quot;+&quot;\n&quot;+
    &quot;{ \&quot;update\&quot; : { \&quot;index\&quot; : \&quot;products\&quot;, \&quot;doc\&quot;: { \&quot;coeff\&quot; : 0 }, \&quot;query\&quot;: { \&quot;range\&quot;: { \&quot;price\&quot;: { \&quot;lt\&quot;: 1000 } } } } }&quot;+&quot;\n&quot;;         
indexApi.Bulk(body);
</code></pre></div>



<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">BulkResponse</span> {
    <span class="n">items:</span> [{<span class="n">update</span>={<span class="n">_index</span>=<span class="n">products</span>, <span class="n">_id</span>=<span class="mi">1</span>, <span class="n">created</span>=<span class="n">false</span>, <span class="nb">result</span>=<span class="n">updated</span>, <span class="nb">status</span>=<span class="mi">200</span>}}, {<span class="n">update</span>={<span class="n">_index</span>=<span class="n">products</span>, <span class="n">_id</span>=<span class="mi">2</span>, <span class="n">created</span>=<span class="n">false</span>, <span class="nb">result</span>=<span class="n">updated</span>, <span class="nb">status</span>=<span class="mi">200</span>}}]
    <span class="n">error:</span> <span class="n">null</span>
    <span class="n">additionalProperties:</span> {<span class="n">errors</span>=<span class="n">false</span>}
}
</code></pre></div>



<!-- request TypeScript -->


<div class="codehilite"><pre><span></span><code><span class="nx">updateDocs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">update</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
<span class="w">      </span><span class="nx">doc</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Text 11&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">cat</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Doc 11&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">update</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">2</span><span class="p">,</span>
<span class="w">      </span><span class="nx">doc</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Text 22&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">cat</span><span class="o">:</span><span class="w"> </span><span class="kt">9</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Doc 22&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">},</span>
<span class="p">];</span>

<span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">bulk</span><span class="p">(</span>
<span class="w">  </span><span class="nx">updateDocs</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">e</span><span class="p">)).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>



<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;items&quot;</span><span class="o">:</span>
<span class="w">  </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;update&quot;</span><span class="o">:</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;updated&quot;</span><span class="o">:</span><span class="mf">1</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;update&quot;</span><span class="o">:</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;updated&quot;</span><span class="o">:</span><span class="mf">1</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="s2">&quot;errors&quot;</span><span class="o">:</span><span class="kc">false</span>
<span class="p">}</span>
</code></pre></div>



<!-- request Go -->


<div class="codehilite"><pre><span></span><code><span class="nx">body</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;{\&quot;update\&quot;: {\&quot;index\&quot;: \&quot;test\&quot;, \&quot;id\&quot;: 1, \&quot;doc\&quot;: {\&quot;content\&quot;: \&quot;Text 11\&quot;, \&quot;name\&quot;: \&quot;Doc 11\&quot;, \&quot;cat\&quot;: 1 }}}&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="s">&quot;{\&quot;update\&quot;: {\&quot;index\&quot;: \&quot;test\&quot;, \&quot;id\&quot;: 2, \&quot;doc\&quot;: {\&quot;content\&quot;: \&quot;Text 22\&quot;, \&quot;name\&quot;: \&quot;Doc 22\&quot;, \&quot;cat\&quot;: 9 }}}&quot;</span><span class="w"> </span><span class="o">+</span><span class="s">&quot;\n&quot;</span><span class="p">;</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">IndexAPI</span><span class="p">.</span><span class="nx">Bulk</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">Body</span><span class="p">(</span><span class="nx">body</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>



<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s">&quot;items&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="s">&quot;update&quot;</span><span class="p">:</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;_index&quot;</span><span class="p">:</span><span class="s">&quot;test&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;updated&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="s">&quot;update&quot;</span><span class="p">:</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;_index&quot;</span><span class="p">:</span><span class="s">&quot;test&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;updated&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="s">&quot;errors&quot;</span><span class="p">:</span><span class="kc">false</span>
<span class="p">}</span>
</code></pre></div>




<!-- end -->

</div>

</div>

<p>Keep in mind that the bulk operation stops at the first query that results in an error.</p>
<h2 id="settings-related-with-updates">Settings related with updates</h2>
<h4 id="attr_update_reserve">attr_update_reserve</h4>
<div class="codehilite"><pre><span></span><code><span class="na">attr_update_reserve</span><span class="o">=</span><span class="s">size</span>
</code></pre></div>

<!-- example attr_update_reserve -->
<p><code>attr_update_reserve</code> is a per-table setting that determines the space reserved for blob attribute updates. This setting is optional, with a default value of 128k.</p>
<p>When blob attributes (MVAs, strings, JSON) are updated, their length may change. If the updated string (or MVA, or JSON) is shorter than the old one, it overwrites the old one in the <code>.spb</code> file. However, if the updated string is longer, updates are written to the end of the <code>.spb</code> file. This file is memory-mapped, which means resizing it may be a rather slow process, depending on the OS implementation of memory-mapped files.</p>
<p>To avoid frequent resizes, you can specify the extra space to be reserved at the end of the <code>.spb</code> file using this option.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">products</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="nb">float</span><span class="p">)</span><span class="w"> </span><span class="n">attr_update_reserve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;1M&#39;</span>
</code></pre></div>



<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/cli</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="s2">&quot;</span>
<span class="s2">create table products(title text, price float) attr_update_reserve = &#39;1M&#39;&quot;</span>
</code></pre></div>



<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$params = [</span>
<span class="x">    &#39;body&#39; =&gt; [</span>
<span class="x">        &#39;settings&#39; =&gt; [</span>
<span class="x">            &#39;attr_update_reserve&#39; =&gt; &#39;1M&#39;</span>
<span class="x">        ],</span>
<span class="x">        &#39;columns&#39; =&gt; [</span>
<span class="x">            &#39;title&#39;=&gt;[&#39;type&#39;=&gt;&#39;text&#39;],</span>
<span class="x">            &#39;price&#39;=&gt;[&#39;type&#39;=&gt;&#39;float&#39;]</span>
<span class="x">        ]</span>
<span class="x">    ],</span>
<span class="x">    &#39;index&#39; =&gt; &#39;products&#39;</span>
<span class="x">];</span>
<span class="x">$index = new \Manticoresearch\Index($client);</span>
<span class="x">$index-&gt;create($params);</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Python
</div>

<!-- request Python -->


<div class="codehilite"><pre><span></span><code><span class="n">utilsApi</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s1">&#39;create table products(title text, price float) attr_update_reserve = </span><span class="se">\&#39;</span><span class="s1">1M</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Javascript
</div>

<!-- request javascript -->


<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">utilsApi</span><span class="p">.</span><span class="nx">sql</span><span class="p">(</span><span class="s1">&#39;create table products(title text, price float) attr_update_reserve = \&#39;1M\&#39;&#39;</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Java
</div>
<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">utilsApi</span><span class="p">.</span><span class="na">sql</span><span class="p">(</span><span class="s">&quot;create table products(title text, price float) attr_update_reserve = &#39;1M&#39;&quot;</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>
<!-- request C# -->

<div class="codehilite"><pre><span></span><code>utilsApi.Sql(&quot;create table products(title text, price float) attr_update_reserve = &#39;1M&#39;&quot;);
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
TypeScript
</div>

<!-- request TypeScript -->


<div class="codehilite"><pre><span></span><code><span class="nx">utilsApi</span><span class="p">.</span><span class="nx">sql</span><span class="p">(</span><span class="s2">&quot;create table test(content text, name string, cat int) attr_update_reserve = &#39;1M&#39;&quot;</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Go
</div>

<!-- request Go -->


<div class="codehilite"><pre><span></span><code><span class="nx">apiClient</span><span class="p">.</span><span class="nx">UtilsAPI</span><span class="p">.</span><span class="nx">Sql</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">Body</span><span class="p">(</span><span class="s">&quot;create table test(content text, name string, cat int) attr_update_reserve = &#39;1M&#39;&quot;</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>



<!-- request CONFIG -->


<div class="codehilite"><pre><span></span><code><span class="na">table products {</span>
<span class="w">  </span><span class="na">attr_update_reserve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1M</span>
<span class="w">  </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">rt</span>
<span class="w">  </span><span class="na">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">tbl</span>
<span class="w">  </span><span class="na">rt_field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">title</span>
<span class="w">  </span><span class="na">rt_attr_uint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">price</span>
<span class="na">}</span>
</code></pre></div>


<!-- end -->

</div>

</div>

<h4 id="attr_flush_period">attr_flush_period</h4>
<div class="codehilite"><pre><span></span><code>attr_flush_period = 900 # persist updates to disk every 15 minutes
</code></pre></div>

<p>When updating attributes the changes are first written to in-memory copy of attributes. This setting allows to set the interval between flushing the updates to disk. It defaults to 0, which disables the periodic flushing, but flushing will still occur at normal shut-down.</p>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-12.04-deleting_documents">
        <header>
            <a class="chapter-link" href="#toc-12.04-deleting_documents"> ¶ 12.4</a>

            
            <h1 id="deleting-documents">Deleting documents</h1>
            
        </header>

        
        
<p>Deleting documents is only supported in <a href="02-read_this_first.html#real-time-mode-vs-plain-mode">RT mode</a> for the following table types:</p>
<ul>
<li><a href="../06-creating_a_table.html#toc-06.02.01-realtime_table">Real-time</a> tables</li>
<li><a href="../06-creating_a_table.html#toc-06.02.04-percolate_table">Percolate</a> tables</li>
<li>Distributed tables that only contain RT tables as local or remote agents.</li>
</ul>
<p>You can delete existing documents from a table based on either their ID or certain conditions.</p>
<p>Also, <a href="../12-data_creation_and_modification.html#bulk-deletion">bulk deletion</a> is available to delete multiple documents.</p>
<p>Deletion of documents can be accomplished via both SQL and JSON interfaces.</p>
<p>For SQL, the response for a successful operation will indicate the number of rows deleted.</p>
<p>For JSON, the <code>json/delete</code> endpoint is used. The server will respond with a JSON object indicating whether the operation was successful and the number of rows deleted.</p>
<p>It is recommended to use <a href="../09-emptying_a_table.html#toc-09-emptying_a_table">table truncation</a> instead of deletion to delete all documents from a table, as it is a much faster operation.</p>
<!-- example delete 2 -->
<p>In this example we delete all documents that match full-text query <code>test document</code> from the table named <code>test</code>:</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">TEST</span><span class="p">;</span>
<span class="o">+</span><span class="c1">------+------+-------------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">gid</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">mva1</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">mva2</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------+-------------+------+</span>
<span class="o">|</span><span class="w">  </span><span class="mi">100</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="mi">201</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="w">  </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">101</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">101</span><span class="p">,</span><span class="mi">202</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">101</span><span class="w">  </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">102</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1002</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">102</span><span class="p">,</span><span class="mi">203</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">102</span><span class="w">  </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">103</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1003</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">103</span><span class="p">,</span><span class="mi">204</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">103</span><span class="w">  </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">104</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1004</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">104</span><span class="p">,</span><span class="mi">204</span><span class="p">,</span><span class="mi">205</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">104</span><span class="w">  </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">105</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1005</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">105</span><span class="p">,</span><span class="mi">206</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">105</span><span class="w">  </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">106</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1006</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">106</span><span class="p">,</span><span class="mi">207</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">106</span><span class="w">  </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">107</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1007</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">107</span><span class="p">,</span><span class="mi">208</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">107</span><span class="w">  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------+-------------+------+</span>
<span class="mi">8</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">TEST</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;test document&#39;</span><span class="p">);</span>
<span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">TEST</span><span class="p">;</span>
<span class="o">+</span><span class="c1">------+------+-------------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">gid</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">mva1</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">mva2</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------+-------------+------+</span>
<span class="o">|</span><span class="w">  </span><span class="mi">100</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="mi">201</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="w">  </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">101</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">101</span><span class="p">,</span><span class="mi">202</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">101</span><span class="w">  </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">102</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1002</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">102</span><span class="p">,</span><span class="mi">203</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">102</span><span class="w">  </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">103</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1003</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">103</span><span class="p">,</span><span class="mi">204</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">103</span><span class="w">  </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">104</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1004</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">104</span><span class="p">,</span><span class="mi">204</span><span class="p">,</span><span class="mi">205</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">104</span><span class="w">  </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">105</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1005</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">105</span><span class="p">,</span><span class="mi">206</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">105</span><span class="w">  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------+-------------+------+</span>
<span class="mi">6</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/dele</span><span class="kc">te</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;query&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test document&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="err">&#39;</span>
</code></pre></div>



* `query` for JSON contains a clause for a full-text search; it has the same syntax as in the [JSON/update](../12-data_creation_and_modification.html#updates-via-http-json).

<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;deleted&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;deleteDocuments(new MatchPhrase(&#39;test document&#39;,&#39;*&#39;));</span>
</code></pre></div>



<!-- response json -->


<div class="codehilite"><pre><span></span><code><span class="x">Array(</span>
<span class="x">    [_index] =&gt; test</span>
<span class="x">    [deleted] =&gt; 2</span>
<span class="x">)</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Python
</div>

<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">indexApi</span><span class="o">.</span><span class="n">delete</span><span class="p">({</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;match&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;*&quot;</span><span class="p">:</span> <span class="s2">&quot;test document&quot;</span> <span class="p">}}})</span>
</code></pre></div>



<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;deleted&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Javascript
</div>

<!-- request javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="ow">delete</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;match&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test document&quot;</span><span class="w"> </span><span class="p">}}});</span>
</code></pre></div>



<!-- response javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="s2">&quot;deleted&quot;</span><span class="o">:</span><span class="mf">5</span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
java
</div>

<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">DeleteDocumentRequest</span><span class="w"> </span><span class="n">deleteRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DeleteDocumentRequest</span><span class="p">();</span>
<span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">query</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;match&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">,</span><span class="s">&quot;test document&quot;</span><span class="p">);</span>
<span class="p">}});</span>
<span class="n">deleteRequest</span><span class="p">.</span><span class="na">index</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">).</span><span class="na">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">indexApi</span><span class="p">.</span><span class="na">delete</span><span class="p">(</span><span class="n">deleteRequest</span><span class="p">);</span>
</code></pre></div>



<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">DeleteResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">index</span><span class="p">:</span><span class="w"> </span><span class="n">test</span>
<span class="w">    </span><span class="n">deleted</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span>
<span class="w">    </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="n">result</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
C
</div>

<!-- request C# -->

<div class="codehilite"><pre><span></span><code><span class="nt">Dictionary</span><span class="o">&lt;</span><span class="nt">string</span><span class="o">,</span><span class="w"> </span><span class="nt">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">Dictionary</span><span class="o">&lt;</span><span class="nt">string</span><span class="o">,</span><span class="w"> </span><span class="nt">Object</span><span class="o">&gt;();</span>
<span class="nt">match</span><span class="p">.</span><span class="nc">Add</span><span class="o">(</span><span class="s2">&quot;*&quot;</span><span class="o">,</span><span class="w"> </span><span class="s2">&quot;test document&quot;</span><span class="o">);</span>
<span class="nt">Dictionary</span><span class="o">&lt;</span><span class="nt">string</span><span class="o">,</span><span class="w"> </span><span class="nt">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">Dictionary</span><span class="o">&lt;</span><span class="nt">string</span><span class="o">,</span><span class="w"> </span><span class="nt">Object</span><span class="o">&gt;();</span>
<span class="nt">query</span><span class="p">.</span><span class="nc">Add</span><span class="o">(</span><span class="s2">&quot;match&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">match</span><span class="o">);</span>
<span class="nt">DeleteDocumentRequest</span><span class="w"> </span><span class="nt">deleteRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">DeleteDocumentRequest</span><span class="o">(</span><span class="nt">index</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">query</span><span class="o">:</span><span class="w"> </span><span class="nt">query</span><span class="o">);</span>
<span class="nt">indexApi</span><span class="p">.</span><span class="nc">Delete</span><span class="o">(</span><span class="nt">deleteRequest</span><span class="o">);</span>
</code></pre></div>



<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">DeleteResponse</span> {
    <span class="n">index:</span> <span class="n">test</span>
    <span class="n">deleted:</span> <span class="mi">5</span>
    <span class="n">id:</span> <span class="n">null</span>
    <span class="n">result:</span> <span class="n">null</span>
}
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
TypeScript
</div>

<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="ow">delete</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">match</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;*&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test document&#39;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="p">});</span>
</code></pre></div>



<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="nt">&quot;deleted&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Go
</div>

<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">deleteRequest</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoresearch</span><span class="p">.</span><span class="nx">NewDeleteDocumentRequest</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="nx">matchExpr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;test document&quot;</span><span class="p">}</span>
<span class="nx">deleteQuery</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">matchExpr</span><span class="w"> </span><span class="p">}</span>
<span class="nx">deleteRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">deleteQuery</span><span class="p">)</span>
</code></pre></div>



<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="nt">&quot;deleted&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example delete 3 -->
<p>Here - deleting a document with <code>id</code> equalling 1 from the table named <code>test</code>:</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">TEST</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/dele</span><span class="kc">te</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="p">}</span><span class="err">&#39;</span>
</code></pre></div>



* `id` for JSON is the row `id` which should be deleted.

<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;found&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;deleted&quot;</span><span class="w">      </span>
<span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;deleteDocument(1);</span>
</code></pre></div>



<!-- response json -->


<div class="codehilite"><pre><span></span><code><span class="x">Array(</span>
<span class="x">    [_index] =&gt; test</span>
<span class="x">    [_id] =&gt; 1</span>
<span class="x">    [found] =&gt; true</span>
<span class="x">    [result] =&gt; deleted</span>
<span class="x">)</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Python
</div>

<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">indexApi</span><span class="o">.</span><span class="n">delete</span><span class="p">({</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</code></pre></div>



<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;deleted&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="s1">&#39;deleted&#39;</span><span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Javascript
</div>

<!-- request javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="ow">delete</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">});</span>
</code></pre></div>



<!-- response javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;deleted&quot;</span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
java
</div>

<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">DeleteDocumentRequest</span><span class="w"> </span><span class="n">deleteRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DeleteDocumentRequest</span><span class="p">();</span>
<span class="n">deleteRequest</span><span class="p">.</span><span class="na">index</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">).</span><span class="na">setId</span><span class="p">(</span><span class="mi">1L</span><span class="p">);</span>
<span class="n">indexApi</span><span class="p">.</span><span class="na">delete</span><span class="p">(</span><span class="n">deleteRequest</span><span class="p">);</span>
</code></pre></div>



<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">DeleteResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">index</span><span class="p">:</span><span class="w"> </span><span class="n">test</span>
<span class="w">    </span><span class="n">_id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">result</span><span class="p">:</span><span class="w"> </span><span class="n">deleted</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
C
</div>

<!-- request C# -->

<div class="codehilite"><pre><span></span><code><span class="nt">DeleteDocumentRequest</span><span class="w"> </span><span class="nt">deleteRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">DeleteDocumentRequest</span><span class="o">(</span><span class="nt">index</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">id</span><span class="o">:</span><span class="w"> </span><span class="nt">1</span><span class="o">);</span>
<span class="nt">indexApi</span><span class="p">.</span><span class="nc">Delete</span><span class="o">(</span><span class="nt">deleteRequest</span><span class="o">);</span>
</code></pre></div>



<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">DeleteResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">index</span><span class="p">:</span><span class="w"> </span><span class="n">test</span>
<span class="w">    </span><span class="n">_id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">result</span><span class="p">:</span><span class="w"> </span><span class="n">deleted</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
TypeScript
</div>

<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="ow">delete</span><span class="p">({</span><span class="w"> </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>



<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="s2">&quot;deleted&quot;</span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Go
</div>

<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">deleteRequest</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoresearch</span><span class="p">.</span><span class="nx">NewDeleteDocumentRequest</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="nx">deleteRequest</span><span class="p">.</span><span class="nx">SetId</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>



<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="s2">&quot;deleted&quot;</span><span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example delete 4 -->
<p>Here, documents with <code>id</code> matching values from the table named <code>test</code> are deleted:</p>
<p>Note that the delete forms with <code>id=N</code> or <code>id IN (X,Y)</code> are the fastest, as they delete documents without performing a search.<br />
Also note that the response contains only the id of the first deleted document in the corresponding <code>_id</code> field.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">TEST</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
</code></pre></div>



<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/dele</span><span class="kc">te</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span><span class="err">&#39;</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;found&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="s2">&quot;deleted&quot;</span><span class="w">      </span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;deleteDocumentsByIds([1,2]);</span>
</code></pre></div>



<!-- response json -->


<div class="codehilite"><pre><span></span><code><span class="x">Array(</span>
<span class="x">    [_index] =&gt; test</span>
<span class="x">    [_id] =&gt; 1</span>
<span class="x">    [found] =&gt; true</span>
<span class="x">    [result] =&gt; deleted</span>
<span class="x">)</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example delete 5 -->
<p>Manticore SQL allows to use complex conditions for the <code>DELETE</code> statement.</p>
<p>For example here we are deleting documents that match full-text query <code>test document</code> and have attribute <code>mva1</code> with a value greater than 206 or <code>mva1</code> values 100 or 103 from table named <code>test</code>:</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">TEST</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;test document&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mva1</span><span class="o">&gt;</span><span class="mi">206</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">mva1</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">103</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>

<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">TEST</span><span class="p">;</span>
</code></pre></div>



<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="o">+</span><span class="c1">------+------+-------------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">gid</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">mva1</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">mva2</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------+-------------+------+</span>
<span class="o">|</span><span class="w">  </span><span class="mi">101</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">101</span><span class="p">,</span><span class="mi">202</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">101</span><span class="w">  </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">102</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1002</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">102</span><span class="p">,</span><span class="mi">203</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">102</span><span class="w">  </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">104</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1004</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">104</span><span class="p">,</span><span class="mi">204</span><span class="p">,</span><span class="mi">205</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">104</span><span class="w">  </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="mi">105</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1005</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">105</span><span class="p">,</span><span class="mi">206</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">105</span><span class="w">  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------+-------------+------+</span>
<span class="mi">6</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>


<!-- end -->

</div>

</div>

<!-- example delete 6 -->
<p>Here is an example of deleting documents in cluster <code>cluster</code>'s table <code>test</code>.  Note that we must provide the cluster name property along with table property to delete a row from a table within a replication cluster:</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">delete</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">cluster</span><span class="p">:</span><span class="n">test</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span>
</code></pre></div>



<!-- request JSON -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/dele</span><span class="kc">te</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;cluster&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span>
<span class="w">    </span><span class="p">}</span><span class="err">&#39;</span>
</code></pre></div>



* `cluster` for JSON is the name of the [replication cluster](../10-creating_a_cluster.html#replication-cluster). which contains the needed table

<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;setCluster(&#39;cluster&#39;);</span>
<span class="x">$index-&gt;deleteDocument(100);</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="x">Array(</span>
<span class="x">    [_index] =&gt; test</span>
<span class="x">    [_id] =&gt; 100</span>
<span class="x">    [found] =&gt; true</span>
<span class="x">    [result] =&gt; deleted</span>
<span class="x">)</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Python
</div>

<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">indexApi</span><span class="o">.</span><span class="n">delete</span><span class="p">({</span><span class="s2">&quot;cluster&quot;</span><span class="p">:</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</code></pre></div>



<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;deleted&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="s1">&#39;deleted&#39;</span><span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Javascript
</div>

<!-- request javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">indexApi</span><span class="p">.</span><span class="ow">delete</span><span class="p">({</span><span class="s2">&quot;cluster&quot;</span><span class="o">:</span><span class="s2">&quot;cluster_1&quot;</span><span class="p">,</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">})</span>
</code></pre></div>



<!-- response javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;deleted&quot;</span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
java
</div>

<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">DeleteDocumentRequest</span><span class="w"> </span><span class="n">deleteRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DeleteDocumentRequest</span><span class="p">();</span>
<span class="n">deleteRequest</span><span class="p">.</span><span class="na">cluster</span><span class="p">(</span><span class="s">&quot;cluster&quot;</span><span class="p">).</span><span class="na">index</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">).</span><span class="na">setId</span><span class="p">(</span><span class="mi">1L</span><span class="p">);</span>
<span class="n">indexApi</span><span class="p">.</span><span class="na">delete</span><span class="p">(</span><span class="n">deleteRequest</span><span class="p">);</span>
</code></pre></div>



<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">DeleteResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">index</span><span class="p">:</span><span class="w"> </span><span class="n">test</span>
<span class="w">    </span><span class="n">_id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">result</span><span class="p">:</span><span class="w"> </span><span class="n">deleted</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
C
</div>

<!-- request C# -->

<div class="codehilite"><pre><span></span><code><span class="nt">DeleteDocumentRequest</span><span class="w"> </span><span class="nt">deleteRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">DeleteDocumentRequest</span><span class="o">(</span><span class="nt">index</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">cluster</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;cluster&quot;</span><span class="o">,</span><span class="w"> </span><span class="nt">id</span><span class="o">:</span><span class="w"> </span><span class="nt">1</span><span class="o">);</span>
<span class="nt">indexApi</span><span class="p">.</span><span class="nc">Delete</span><span class="o">(</span><span class="nt">deleteRequest</span><span class="o">);</span>
</code></pre></div>



<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">DeleteResponse</span> {
    <span class="n">index:</span> <span class="n">test</span>
    <span class="n">_id:</span> <span class="mi">1</span>
    <span class="n">result:</span> <span class="n">deleted</span>
}
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
TypeScript
</div>

<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="ow">delete</span><span class="p">({</span><span class="w"> </span><span class="nx">cluster</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;cluster_1&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>



<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="s2">&quot;deleted&quot;</span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Go
</div>

<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">deleteRequest</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoresearch</span><span class="p">.</span><span class="nx">NewDeleteDocumentRequest</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="nx">deleteRequest</span><span class="p">.</span><span class="nx">SetCluster</span><span class="p">(</span><span class="s">&quot;cluster_1&quot;</span><span class="p">)</span>
<span class="nx">deleteRequest</span><span class="p">.</span><span class="nx">SetId</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>



<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="s2">&quot;deleted&quot;</span><span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<h2 id="bulk-deletion">Bulk deletion</h2>
<!-- example bulk delete -->

<p>You can also perform multiple delete operations in a single call using the <code>/bulk</code> endpoint. This endpoint only works with data that has <code>Content-Type</code> set to <code>application/x-ndjson</code>. The data should be formatted as newline-delimited JSON (NDJSON). Essentially, this means that each line should contain exactly one JSON statement and end with a newline <code>\n</code> and, possibly, a <code>\r</code>.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>

<!-- request JSON --Content-type=application/x-ndjson -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/bulk</span>

<span class="p">{</span><span class="w"> </span><span class="nt">&quot;delete&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;index&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;id&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="p">{</span><span class="w"> </span><span class="nt">&quot;delete&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;index&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;equals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;int_data&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">   </span><span class="nt">&quot;items&quot;</span><span class="p">:</span>
<span class="w">   </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">         </span><span class="nt">&quot;bulk&quot;</span><span class="p">:</span>
<span class="w">         </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;created&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;deleted&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;updated&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="s2">&quot;created&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="mi">201</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">   </span><span class="p">],</span>
<span class="w">   </span><span class="nt">&quot;errors&quot;</span><span class="p">:</span><span class="kc">false</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$client-&gt;bulk([</span>
<span class="x">    [&#39;delete&#39; =&gt; [</span>
<span class="x">            &#39;index&#39; =&gt; &#39;test&#39;,</span>
<span class="x">            &#39;id&#39; =&gt; 1</span>
<span class="x">        ]</span>
<span class="x">    ],</span>
<span class="x">    [&#39;delete&#39;=&gt;[</span>
<span class="x">            &#39;index&#39; =&gt; &#39;test&#39;,</span>
<span class="x">            &#39;query&#39; =&gt; [</span>
<span class="x">                &#39;equals&#39; =&gt; [&#39;int_data&#39; =&gt; 20]</span>
<span class="x">            ]</span>
<span class="x">        ]</span>
<span class="x">    ]</span>
<span class="x">]);</span>
</code></pre></div>



<!-- response PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">Array(</span>
<span class="x">    [items] =&gt; Array</span>
<span class="x">        (</span>
<span class="x">            [0] =&gt; Array</span>
<span class="x">                (</span>
<span class="x">                    [bulk] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [_index] =&gt; test</span>
<span class="x">                            [_id] =&gt; 0</span>
<span class="x">                            [created] =&gt; 0</span>
<span class="x">                            [deleted] =&gt; 2</span>
<span class="x">                            [updated] =&gt; 0</span>
<span class="x">                            [result] =&gt; created</span>
<span class="x">                            [status] =&gt; 201</span>
<span class="x">                        )</span>

<span class="x">                )</span>

<span class="x">        )</span>

<span class="x">    [current_line] =&gt; 3</span>
<span class="x">    [skipped_lines] =&gt; 0</span>
<span class="x">    [errors] =&gt;</span>
<span class="x">    [error] =&gt;</span>
<span class="x">)</span>
</code></pre></div>




<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Python
</div>

<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">docs</span> <span class="o">=</span> <span class="p">[</span> \
            <span class="p">{</span> <span class="s2">&quot;delete&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">},</span> \
            <span class="p">{</span> <span class="s2">&quot;delete&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;equals&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;int_data&quot;</span><span class="p">:</span> <span class="mi">20</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">]</span>
<span class="n">indexApi</span><span class="o">.</span><span class="n">bulk</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">,</span><span class="n">docs</span><span class="p">)))</span>
</code></pre></div>



<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
    <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s1">&#39;items&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;delete&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_index&#39;</span><span class="p">:</span> <span class="n">test</span><span class="s1">&#39;, u&#39;</span><span class="n">deleted</span><span class="s1">&#39;: 2}}]</span>
<span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Javascript
</div>

<!-- request javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">docs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;delete&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;delete&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;equals&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;int_data&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">20</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">];</span>
<span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">bulk</span><span class="p">(</span><span class="nx">docs</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">e</span><span class="p">=&gt;</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">e</span><span class="p">)).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">));</span>
</code></pre></div>



<!-- response javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;items&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;delete&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="s2">&quot;deleted&quot;</span><span class="o">:</span><span class="mf">2</span><span class="p">}}],</span><span class="s2">&quot;errors&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
java
</div>

<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">String</span><span class="w">   </span><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;{ &quot;</span><span class="n">delete</span><span class="s">&quot; : { &quot;</span><span class="n">index</span><span class="s">&quot; : &quot;</span><span class="n">test</span><span class="s">&quot;, &quot;</span><span class="n">id</span><span class="s">&quot;: 1 } } &quot;</span><span class="o">+</span><span class="s">&quot;\n&quot;</span><span class="o">+</span>
<span class="w">    </span><span class="s">&quot;{ &quot;</span><span class="n">delete</span><span class="s">&quot; : { &quot;</span><span class="n">index</span><span class="s">&quot; : &quot;</span><span class="n">test</span><span class="s">&quot;, &quot;</span><span class="n">query</span><span class="s">&quot;: { &quot;</span><span class="n">equals</span><span class="s">&quot;: { &quot;</span><span class="n">int_data</span><span class="s">&quot;: 20 } } } }&quot;</span><span class="o">+</span><span class="s">&quot;\n&quot;</span><span class="p">;</span><span class="w">         </span>
<span class="n">indexApi</span><span class="p">.</span><span class="na">bulk</span><span class="p">(</span><span class="n">body</span><span class="p">);</span>
</code></pre></div>



<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">BulkResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">items</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="p">{</span><span class="n">delete</span><span class="o">=</span><span class="p">{</span><span class="n">_index</span><span class="o">=</span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">created</span><span class="o">=</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">deleted</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="o">=</span><span class="n">created</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">}}</span><span class="o">]</span>
<span class="w">    </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="n">additionalProperties</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">errors</span><span class="o">=</span><span class="kc">false</span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->

<div class="codehilite"><pre><span></span><code>string   body = &quot;{ &quot;delete&quot; : { &quot;index&quot; : &quot;test&quot;, &quot;id&quot;: 1 } } &quot;+&quot;\n&quot;+
    &quot;{ &quot;delete&quot; : { &quot;index&quot; : &quot;test&quot;, &quot;query&quot;: { &quot;equals&quot;: { &quot;int_data&quot;: 20 } } } }&quot;+&quot;\n&quot;;         
indexApi.Bulk(body);
</code></pre></div>



<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">BulkResponse</span> {
    <span class="n">items:</span> [{<span class="n">replace</span>={<span class="n">_index</span>=<span class="n">test</span>, <span class="n">_id</span>=<span class="mi">0</span>, <span class="n">created</span>=<span class="n">false</span>, <span class="n">deleted</span>=<span class="mi">2</span>, <span class="nb">result</span>=<span class="n">created</span>, <span class="nb">status</span>=<span class="mi">200</span>}}]
    <span class="n">error:</span> <span class="n">null</span>
    <span class="n">additionalProperties:</span> {<span class="n">errors</span>=<span class="n">false</span>}
}
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
TypeScript
</div>

<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">docs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;delete&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;delete&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;equals&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;int_data&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">20</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="p">];</span>
<span class="nx">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">bulk</span><span class="p">(</span>
<span class="w">  </span><span class="nx">docs</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">e</span><span class="p">)).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">)</span>
<span class="p">);</span><span class="w">            </span>
<span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">bulk</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>
</code></pre></div>



<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="nt">&quot;items&quot;</span><span class="p">:[{</span><span class="nt">&quot;delete&quot;</span><span class="p">:{</span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="nt">&quot;deleted&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">}}],</span><span class="nt">&quot;errors&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Go
</div>

<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">docs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="s">`{ &quot;delete&quot; : { &quot;index&quot; : &quot;test&quot;, &quot;id&quot;: 1 } }`</span><span class="p">,</span>
<span class="w">  </span><span class="s">`{ &quot;delete&quot; : { &quot;index&quot; : &quot;test&quot;, &quot;query&quot;: { &quot;equals&quot;: { &quot;int_data&quot;: 20 } } } }`</span>
<span class="p">]</span>
<span class="nx">body</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">docs</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="nx">resp</span><span class="p">,</span><span class="w"> </span><span class="nx">httpRes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">IndexAPI</span><span class="p">.</span><span class="nx">Bulk</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">Body</span><span class="p">(</span><span class="nx">body</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>



<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="nt">&quot;items&quot;</span><span class="p">:[{</span><span class="nt">&quot;delete&quot;</span><span class="p">:{</span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="nt">&quot;deleted&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">}}],</span><span class="nt">&quot;errors&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- end -->
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-12.05-transactions">
        <header>
            <a class="chapter-link" href="#toc-12.05-transactions"> ¶ 12.5</a>

            
            <h1 id="transactions">Transactions</h1>
            
        </header>

        
        
<p>Manticore supports basic transactions for deleting and inserting data into real-time and percolate tables, except when attempting to write to a distributed table which includes a real-time or percolate table. Each change to a table is first saved in an internal changeset and then actually committed to the table. By default, each command is wrapped in an individual automatic transaction, making it transparent: you simply 'insert' something and can see the inserted result after it completes, without worrying about transactions. However, this behavior can be explicitly managed by starting and committing transactions manually.</p>
<p>Transactions are supported for the following commands:</p>
<ul>
<li><a href="../12-data_creation_and_modification.html#toc-12.01.01-adding_documents_to_a_realtime_table">INSERT</a></li>
<li><a href="../12-data_creation_and_modification.html#toc-12.03.02-replace">REPLACE</a></li>
<li><a href="../12-data_creation_and_modification.html#toc-12.04-deleting_documents">DELETE</a></li>
</ul>
<p>Transactions are not supported for:</p>
<ul>
<li>UPDATE (which is <a href="../12-data_creation_and_modification.html#toc-12.03.01-replace_vs_update">different</a> from REPLACE, as it performs an in-place attribute update)</li>
<li>ALTER - for <a href="../14-updating_table_schema_and_settings.html#toc-14-updating_table_schema_and_settings">updating table schema</a></li>
<li>TRUNCATE - for <a href="../09-emptying_a_table.html#toc-09-emptying_a_table">emptying a real-time table</a></li>
<li>ATTACH - for <a href="../12-data_creation_and_modification.html#toc-12.02.06.03-attaching_a_plain_table_to_rt_table">attaching a plain table to a real-time table</a></li>
<li>CREATE - <a href="../06-creating_a_table.html#toc-06.02-creating_a_local_table">for creating a table</a></li>
<li>DROP - <a href="../08-deleting_a_table.html#toc-08-deleting_a_table">for deleting a table</a></li>
</ul>
<p>Please note that transactions in Manticore do not aim to provide isolation. The purpose of transactions in Manticore is to allow you to accumulate multiple writes and execute them all at once upon commit, or to roll them all back if necessary. Transactions are integrated with <a href="../18-logging.html#toc-18.03-binary_logging">binary log</a> for durability and consistency.</p>
<h2 id="automatic-and-manual-mode">Automatic and manual mode</h2>
<div class="codehilite"><pre><span></span><code><span class="k">SET</span><span class="w"> </span><span class="n">AUTOCOMMIT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="err">}</span>
</code></pre></div>

<p><code>SET AUTOCOMMIT</code> controls the autocommit mode in the active session. <code>AUTOCOMMIT</code> is set to 1 by default. With the default setting, you don't have to worry about transactions, as every statement that makes any changes to any table is implicitly wrapped in a separate transaction. Setting it to 0 allows you to manage transactions manually, meaning they will not be visible until you explicitly commit them.</p>
<p>Transactions are limited to a single real-time or percolate table and are also limited in size. They are atomic, consistent, overly isolated, and durable. Overly isolated means that the changes are not only invisible to concurrent transactions but even to the current session itself.</p>
<h2 id="begin-commit-and-rollback">BEGIN, COMMIT, and ROLLBACK</h2>
<div class="codehilite"><pre><span></span><code><span class="k">START</span><span class="w"> </span><span class="k">TRANSACTION</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">BEGIN</span>
<span class="k">COMMIT</span>
<span class="k">ROLLBACK</span>
</code></pre></div>

<p>The <code>BEGIN</code> statement (or its <code>START TRANSACTION</code> alias) forcibly commits any pending transaction, if present, and starts a new one.</p>
<p>The <code>COMMIT</code> statement commits the current transaction, making all its changes permanent.</p>
<p>The <code>ROLLBACK</code> statement rolls back the current transaction, canceling all its changes.</p>
<h2 id="transactions-in-bulk">Transactions in /bulk</h2>
<p>When using one of the <code>/bulk</code> JSON endpoints ( <a href="../12-data_creation_and_modification.html#bulk-adding-documents">bulk insert</a>, <a href="../12-data_creation_and_modification.html#bulk-replace">bulk replace</a>, <a href="../12-data_creation_and_modification.html#bulk-deletion">bulk delete</a> ), you can force a batch of documents to be committed by adding an empty line after them.</p>
<h2 id="examples">Examples</h2>
<h3 id="automatic-commits-default">Automatic commits (default)</h3>
<div class="codehilite"><pre><span></span><code><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">indexrt</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">channel_id</span><span class="p">,</span><span class="w"> </span><span class="n">published</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;aa&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;blabla&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">indexrt</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="o">+</span><span class="c1">------+------------+-----------+--------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">channel_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">published</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">title</span><span class="w">  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------------+-----------+--------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">blabla</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------------+-----------+--------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>

<p>The inserted value is immediately visible in the following 'select' statement.</p>
<h3 id="manual-commits-autocommit0">Manual commits (autocommit=0)</h3>
<div class="codehilite"><pre><span></span><code><span class="k">set</span><span class="w"> </span><span class="n">autocommit</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">indexrt</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">channel_id</span><span class="p">,</span><span class="w"> </span><span class="n">published</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;aa&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;bb&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">indexrt</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">channel_id</span><span class="p">,</span><span class="w"> </span><span class="n">published</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;aa&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;bb&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">indexrt</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span>
<span class="n">Empty</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">indexrt</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">4</span><span class="p">;</span>
<span class="n">Empty</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>

<p>In this case, changes are NOT automatically committed. As a result, the insertions are not visible, even in the same session, since they have not been committed. Also, despite the absence of a <code>BEGIN</code> statement, a transaction is implicitly started.</p>
<p>To make the changes visible, you need to commit the transaction:</p>
<div class="codehilite"><pre><span></span><code><span class="k">commit</span><span class="p">;</span>
<span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">indexrt</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">4</span><span class="p">;</span>
<span class="o">+</span><span class="c1">------+------------+-----------+-------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">channel_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">published</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------------+-----------+-------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">bb</span><span class="w">    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------------+-----------+-------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">indexrt</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span>
<span class="o">+</span><span class="c1">------+------------+-----------+-------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">channel_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">published</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------------+-----------+-------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">bb</span><span class="w">    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------------+-----------+-------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>

<p>After the commit statement, the insertions are visible in the table.</p>
<h3 id="manual-transaction">Manual transaction</h3>
<p>By using <code>BEGIN</code> and <code>COMMIT</code>, you can define the bounds of a transaction explicitly, so there's no need to worry about autocommit in this case.</p>
<div class="codehilite"><pre><span></span><code><span class="k">begin</span><span class="p">;</span>
<span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">indexrt</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">channel_id</span><span class="p">,</span><span class="w"> </span><span class="n">published</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;aa&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;bb&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">indexrt</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
<span class="n">Empty</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="k">commit</span><span class="p">;</span>
<span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">indexrt</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
<span class="o">+</span><span class="c1">------+------------+-----------+-------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">channel_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">published</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------------+-----------+-------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">bb</span><span class="w">    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------------+-----------+-------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>

<!-- proofread -->
        
    </section>
    

    <script>
        const hide = (el) => el.style.display = 'none';
        const show = (el) => el.style.display = '';

        function gen(html) {
            const template = document.createElement('template');
            template.innerHTML = html.trim();
            return template.content;
        }

        function processCodeBlock(block) {
            block.append(gen(`<div class="selectors"></div><div class="codes"></div>`));

            let selectors = block.querySelector(".selectors");
            let codes = block.querySelector(".codes");

            function hideAllCodes() {
                for (let i = 0; i < codes.children.length; i++) {
                    hide(codes.children[i]);
                }
            }

            function clearSelection() {
                for (let i = 0; i < selectors.children.length; i++) {
                    selectors.children[i].classList.remove('selected');
                }
            }

            let items = block.querySelectorAll('.xcodeblock-item');
            for (let i = 0; i < items.length; i++) {
                let lang = items[i];

                lang.remove();

                let sel = lang.querySelector('.item-select');
                let code = lang.querySelector('.codehilite');

                if (!sel || !code) {
                    continue
                }

                sel.remove();
                code.remove();

                selectors.append(sel);
                codes.append(code);

                if (i == 0) {
                    sel.classList.add('selected');
                } else {
                    hide(code);
                }

                sel.addEventListener('click', () => {
                    hideAllCodes();
                    clearSelection();
                    show(code);
                    sel.classList.add('selected');
                });
            }
        }

        let codeBlocks = document.querySelectorAll('.xcodeblock');
        for (let i = 0; i < codeBlocks.length; i++) {
            processCodeBlock(codeBlocks[i]);
        }
    </script>
</body>