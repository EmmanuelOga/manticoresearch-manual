<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=PT+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="common.css" />
    <link rel="stylesheet" href="chapter.css" />
    <link rel="stylesheet" href="pygments.css" />

    <title>Searching - Manticore Search 6.2.12 (Aug 23, 2023)</title>
</head>

<body>
    
    <section class="chapter-section" id="toc-13-searching">
        <header>
            <a class="chapter-link" href="#toc-13-searching"> ¶ 13</a>

            
            <h1>Searching</h1>
            
        </header>

        
    </section>
    
    <section class="chapter-section" id="toc-13.01-intro">
        <header>
            <a class="chapter-link" href="#toc-13.01-intro"> ¶ 13.1</a>

            
            <h1 id="introduction-into-searching-with-manticore-search">Introduction into searching with Manticore Search</h1>
            
        </header>

        
        
<p>Searching is a core feature of Manticore Search. You can:</p>
<ul>
<li>Perform <a href="../13-searching.html#match">full-text search</a> and implement search result <a href="../13-searching.html#toc-13.07-highlighting">highlighting</a></li>
<li>Perform <a href="../13-searching.html#toc-13.22-k-nearest_neighbor_vector_search">k-nearest neighbor search</a></li>
<li>Apply <a href="../13-searching.html#toc-13.04-filters">non-full-text filtering</a></li>
<li>Use <a href="../13-searching.html#toc-13.05-expressions">expressions</a> for filtering</li>
<li>Utilize various <a href="../13-searching.html#toc-13.06-search_options">search options</a></li>
<li>Employ <a href="../13-searching.html#toc-13.11-multi-queries">multi-queries</a> and <a href="../13-searching.html#toc-13.12-sub-selects">sub-selects</a></li>
<li>Conduct <a href="../13-searching.html#toc-13.13-grouping">aggregations</a> and <a href="../13-searching.html#toc-13.14-faceted_search">faceting</a> of search results</li>
<li>And much more</li>
</ul>
<h2 id="general-syntax">General syntax</h2>
<p><strong>SQL</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">[</span><span class="k">OPTION</span><span class="w"> </span><span class="o">&lt;</span><span class="n">optionname</span><span class="o">&gt;=&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">]]</span>
</code></pre></div>

<p><strong>HTTP</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span><span class="w">   </span>
<span class="w">    </span><span class="nt">&quot;index&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;index_name&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;options&quot;</span><span class="p">:</span><span class="w">   </span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="err">...</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.02-full-text_matching">
        <header>
            <a class="chapter-link" href="#toc-13.02-full-text_matching"> ¶ 13.2</a>

            
            <h1>Full-text matching</h1>
            
        </header>

        
    </section>
    
    <section class="chapter-section" id="toc-13.02.01-basic_usage">
        <header>
            <a class="chapter-link" href="#toc-13.02.01-basic_usage"> ¶ 13.2.1</a>

            
            <h1 id="match">MATCH</h1>
            
        </header>

        
        
<p>The <code>MATCH</code> clause allows for full-text searches in text fields. The input query string is <a href="06-creating_a_table.html#toc-06.03.01-data_tokenization">tokenized</a> using the same settings applied to the text during indexing. In addition to the tokenization of input text, the query string supports a number of <a href="13-searching.html#toc-13.02.02-operators">full-text operators</a> that enforce various rules on how keywords should provide a valid match.</p>
<p>Full-text match clauses can be combined with attribute <a href="13-searching.html#toc-13.04-filters">filters</a> as an AND boolean. <strong>OR relations between full-text matches and attribute filters are not supported</strong>.</p>
<p>The match query is always executed first in the filtering process, followed by the <a href="13-searching.html#toc-13.04-filters">attribute filters</a>. The attribute filters are applied to the result set of the match query. A query without a match clause is called a fullscan.</p>
<p>There must be at most one <code>MATCH()</code> in the <code>SELECT</code> clause.</p>
<p>Using the <a href="13-searching.html#toc-13.02.02-operators">full-text query syntax</a>, matching is performed across all indexed text fields of a document, unless the expression requires a match within a field (like phrase search) or is limited by field operators.</p>
<h2 id="sql">SQL</h2>
<!-- example Example_1 -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">myindex</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;cats|birds&#39;</span><span class="p">);</span>
</code></pre></div>

<p>The <a href="13-searching.html#sql">SELECT</a> statement uses a <a href="13-searching.html#toc-13.02.01-basic_usage">MATCH</a> clause, which must come after WHERE, for performing full-text searches. <code>MATCH()</code> accepts an input string in which all <a href="13-searching.html#toc-13.02.02-operators">full-text operators</a> are available.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">myindex</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;&quot;find me fast&quot;/2&#39;</span><span class="p">);</span>
</code></pre></div>


<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">------+------+----------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">gid</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">title</span><span class="w">          </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------+----------------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">11</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">first</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="n">me</span><span class="w">  </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">12</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">second</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="n">me</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------+----------------+</span>
<span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- request MATCH with filters -->
An example of a more complex query using MATCH with WHERE filters.


<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">myindex</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;cats|birds&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">title</span><span class="o">`=</span><span class="s1">&#39;some title&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`=</span><span class="mi">123</span><span class="p">);</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<h2 id="http-json">HTTP JSON</h2>
<!-- example Example_11 -->

<p>Full-text matching is available in the <code>/search</code> endpoint and in HTTP-based clients. The following clauses can be used for performing full-text matches:</p>
<h3 id="match_1">match</h3>
<p>"match" is a simple query that matches the specified keywords in the specified fields.</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;query&quot;</span><span class="p">:</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;keyword&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>You can specify a list of fields:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;match&quot;</span><span class="p">:</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;field1,field2&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;keyword&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p>Or you can use <code>_all</code> or <code>*</code> to search all fields.</p>
<p>You can search all fields except one using "!field":</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;match&quot;</span><span class="p">:</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;!field1&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;keyword&quot;</span>
<span class="p">}</span>
</code></pre></div>

<p>By default, keywords are combined using the OR operator. However, you can change that behavior using the "operator" clause:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;query&quot;</span><span class="p">:</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;match&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;content,title&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="s2">&quot;keyword&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;operator&quot;</span><span class="p">:</span><span class="s2">&quot;or&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>"operator" can be set to "or" or "and".</p>
<h3 id="match_phrase">match_phrase</h3>
<p>"match_phrase" is a query that matches the entire phrase. It is similar to a phrase operator in SQL. Here's an example:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;query&quot;</span><span class="p">:</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;match_phrase&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;_all&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;had grown quite&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="query_string">query_string</h3>
<p>"query_string" accepts an input string as a full-text query in <code>MATCH()</code> syntax.</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;query&quot;</span><span class="p">:</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;query_string&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Church NOTNEAR/3 street&quot;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="match_all">match_all</h3>
<p>"match_all" accepts an empty object and returns documents from the table without performing any attribute filtering or full-text matching. Alternatively, you can just omit the <code>query</code> clause in the request which will have the same effect.</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;query&quot;</span><span class="p">:</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;match_all&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="combining-full-text-filtering-with-other-filters">Combining full-text filtering with other filters</h3>
<p>All full-text match clauses can be combined with <a href="13-searching.html#must">must</a>, <a href="13-searching.html#must_not">must_not</a>, and <a href="13-searching.html#should">should</a> operators of a <a href="13-searching.html#bool-query">JSON <code>bool</code> query</a>.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>
Examples:

<!-- request match -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="mi">-</span><span class="err">d</span>
<span class="err">&#39;</span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;index&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;hn_small&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;query&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;match&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;*&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;find joe&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;story_author&quot;</span><span class="p">,</span><span class="s2">&quot;comment_author&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="p">}</span><span class="err">&#39;</span>
</code></pre></div>



<!-- response match -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">   </span><span class="nt">&quot;took&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;timed_out&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;hits&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;hits&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">         </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;_id&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;668018&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_score&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">3579</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_source&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nt">&quot;story_author&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;IgorPartola&quot;</span><span class="p">,</span>
<span class="w">               </span><span class="nt">&quot;comment_author&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;joe_the_user&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;total&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">88063</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;total_relation&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eq&quot;</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- request match_phrase -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="mi">-</span><span class="err">d</span>
<span class="err">&#39;</span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;index&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;hn_small&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;query&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;match_phrase&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;*&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;find joe&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;story_author&quot;</span><span class="p">,</span><span class="s2">&quot;comment_author&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="p">}</span><span class="err">&#39;</span>
</code></pre></div>


<!-- response match_phrase -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">   </span><span class="nt">&quot;took&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;timed_out&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;hits&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;hits&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">         </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;_id&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;807160&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_score&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">2599</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_source&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nt">&quot;story_author&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rbanffy&quot;</span><span class="p">,</span>
<span class="w">               </span><span class="nt">&quot;comment_author&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;runjake&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;total&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;total_relation&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eq&quot;</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- request query_string -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="mi">-</span><span class="err">d</span>
<span class="err">&#39;</span><span class="p">{</span><span class="w">   </span><span class="nt">&quot;index&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;hn_small&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;query&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;query_string&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;@comment_text \&quot;find joe fast \&quot;/2&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;story_author&quot;</span><span class="p">,</span><span class="s2">&quot;comment_author&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="p">}</span><span class="err">&#39;</span>
</code></pre></div>


<!-- response query_string -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;hits&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">         </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;_id&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;807160&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_score&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">2566</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_source&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nt">&quot;story_author&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rbanffy&quot;</span><span class="p">,</span>
<span class="w">               </span><span class="nt">&quot;comment_author&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;runjake&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;total&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1864</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;total_relation&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eq&quot;</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- request PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">$search = new Search(new Client());</span>
<span class="x">$result = $search-&gt;(&#39;@title find me fast&#39;);</span>
<span class="x">foreach($result as $doc)</span>
<span class="x">{</span>
<span class="x">    echo &#39;Document: &#39;.$doc-&gt;getId();</span>
<span class="x">    foreach($doc-&gt;getData() as $field=&gt;$value)</span>
<span class="x">    {</span>
<span class="x">        echo $field.&#39;: &#39;.$value;</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>


<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Document: 1</span>
<span class="x">title: first find me fast</span>
<span class="x">gid: 11</span>
<span class="x">Document: 2</span>
<span class="x">title: second find me fast</span>
<span class="x">gid: 12</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
Python
<!-- request Python -->


<div class="codehilite"><pre><span></span><code><span class="n">searchApi</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;hn_small&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="p">:{</span><span class="s2">&quot;query_string&quot;</span><span class="p">:</span><span class="s2">&quot;@comment_text </span><span class="se">\&quot;</span><span class="s2">find joe fast </span><span class="se">\&quot;</span><span class="s2">/2&quot;</span><span class="p">},</span> <span class="s2">&quot;_source&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;story_author&quot;</span><span class="p">,</span><span class="s2">&quot;comment_author&quot;</span><span class="p">],</span> <span class="s2">&quot;limit&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;aggregations&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="s1">&#39;807160&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">2566</span><span class="p">,</span>
                    <span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;comment_author&#39;</span><span class="p">:</span> <span class="s1">&#39;runjake&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;story_author&#39;</span><span class="p">:</span> <span class="s1">&#39;rbanffy&#39;</span><span class="p">}}],</span>
          <span class="s1">&#39;max_score&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
          <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">1864</span><span class="p">,</span>
          <span class="s1">&#39;total_relation&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s1">&#39;warning&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
javascript
<!-- request javascript -->


<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="s2">&quot;hn_small&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;query_string&quot;</span><span class="o">:</span><span class="s2">&quot;@comment_text \&quot;find joe fast \&quot;/2&quot;</span><span class="p">},</span><span class="w"> </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;story_author&quot;</span><span class="p">,</span><span class="s2">&quot;comment_author&quot;</span><span class="p">],</span><span class="w"> </span><span class="s2">&quot;limit&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">});</span>
</code></pre></div>


<!-- response javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nx">took</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">  </span><span class="nx">timed_out</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nx">hits</span><span class="o">:</span>
<span class="w">   </span><span class="nx">exports</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="nx">total</span><span class="o">:</span><span class="w"> </span><span class="mf">1864</span><span class="p">,</span>
<span class="w">     </span><span class="nx">total_relation</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;eq&#39;</span><span class="p">,</span>
<span class="w">     </span><span class="nx">hits</span><span class="o">:</span>
<span class="w">      </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;807160&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">_score</span><span class="o">:</span><span class="w"> </span><span class="mf">2566</span><span class="p">,</span>
<span class="w">          </span><span class="nx">_source</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">story_author</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;rbanffy&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">comment_author</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;runjake&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
java
<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">query</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;query_string&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@comment_text \&quot;find joe fast \&quot;/2&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">();</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;hn_small&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">addSourceItem</span><span class="p">(</span><span class="s">&quot;story_author&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">addSourceItem</span><span class="p">(</span><span class="s">&quot;comment_author&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">took</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">aggregations</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">maxScore</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">        </span><span class="n">total</span><span class="p">:</span><span class="w"> </span><span class="mi">1864</span>
<span class="w">        </span><span class="n">totalRelation</span><span class="p">:</span><span class="w"> </span><span class="n">eq</span>
<span class="w">        </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">807160</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">2566</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">story_author</span><span class="o">=</span><span class="n">rbanffy</span><span class="p">,</span><span class="w"> </span><span class="n">comment_author</span><span class="o">=</span><span class="n">runjake</span><span class="p">}}</span><span class="o">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">profile</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="n">warning</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
C#
<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="n">object</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">new</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">query_string</span><span class="o">=</span><span class="s2">&quot;@comment_text </span><span class="se">\&quot;</span><span class="s2">find joe fast </span><span class="se">\&quot;</span><span class="s2">/2&quot;</span><span class="w"> </span><span class="p">};</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;hn_small&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;story_author&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;comment_author&quot;</span><span class="p">};</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">SearchResponse</span><span class="w"> </span><span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="o">.</span><span class="n">Search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="n">class</span><span class="w"> </span><span class="n">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">took:</span><span class="w"> </span><span class="mh">1</span>
<span class="w">    </span><span class="nl">timedOut:</span><span class="w"> </span><span class="n">false</span>
<span class="w">    </span><span class="nl">aggregations:</span><span class="w"> </span><span class="n">null</span>
<span class="w">    </span><span class="nl">hits:</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="n">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">maxScore:</span><span class="w"> </span><span class="n">null</span>
<span class="w">        </span><span class="nl">total:</span><span class="w"> </span><span class="mh">1864</span>
<span class="w">        </span><span class="nl">totalRelation:</span><span class="w"> </span><span class="n">eq</span>
<span class="w">        </span><span class="nl">hits:</span><span class="w"> </span><span class="p">[{</span><span class="n">_id</span><span class="o">=</span><span class="mh">807160</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mh">2566</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">story_author</span><span class="o">=</span><span class="n">rbanffy</span><span class="p">,</span><span class="w"> </span><span class="n">comment_author</span><span class="o">=</span><span class="n">runjake</span><span class="p">}}]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nl">profile:</span><span class="w"> </span><span class="n">null</span>
<span class="w">    </span><span class="nl">warning:</span><span class="w"> </span><span class="n">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
TypeScript
<!-- request TypeScript -->


<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">query_string</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test document 1&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="p">],</span>
<span class="w">  </span><span class="nx">limit</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span>
<span class="p">});</span>
</code></pre></div>


<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="kc">t</span><span class="err">ook</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="kc">t</span><span class="err">imed_ou</span><span class="kc">t</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="err">hi</span><span class="kc">ts</span><span class="p">:</span>
<span class="w">   </span><span class="err">expor</span><span class="kc">ts</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="kc">t</span><span class="err">o</span><span class="kc">tal</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">     </span><span class="kc">t</span><span class="err">o</span><span class="kc">tal</span><span class="err">_rela</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;eq&#39;</span><span class="p">,</span>
<span class="w">     </span><span class="err">hi</span><span class="kc">ts</span><span class="p">:</span>
<span class="w">      </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">_id</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="mi">1</span><span class="err">&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="err">_score</span><span class="p">:</span><span class="w"> </span><span class="mi">2566</span><span class="p">,</span>
<span class="w">          </span><span class="err">_source</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">co</span><span class="kc">ntent</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;This</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="kc">test</span><span class="w"> </span><span class="err">docume</span><span class="kc">nt</span><span class="w"> </span><span class="mi">1</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="kc">t</span><span class="err">i</span><span class="kc">tle</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;Doc</span><span class="w"> </span><span class="mi">1</span><span class="err">&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
Go
<!-- request Go -->


<div class="codehilite"><pre><span></span><code><span class="nx">searchRequest</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoresearch</span><span class="p">.</span><span class="nx">NewSearchRequest</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;query_string&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;test document 1&quot;</span><span class="p">}</span>
<span class="nx">searchReq</span><span class="p">.</span><span class="nx">SetSource</span><span class="p">([]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;content&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;title&quot;</span><span class="p">})</span>
<span class="nx">searchReq</span><span class="p">.</span><span class="nx">SetLimit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nx">resp</span><span class="p">,</span><span class="w"> </span><span class="nx">httpRes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">search</span><span class="p">.</span><span class="nx">SearchRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">searchRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>


<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2566</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;This is a test document 1&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Doc 1&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;total_relation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eq&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="p">}</span>
</code></pre></div>


<!-- end -->

</div>

</div>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.02.02-operators">
        <header>
            <a class="chapter-link" href="#toc-13.02.02-operators"> ¶ 13.2.2</a>

            
            <h1 id="full-text-operators">Full text operators</h1>
            
        </header>

        
        
<p>The query string can include specific operators that define the conditions for how the words from the query string should be matched.</p>
<h3 id="boolean-operators">Boolean operators</h3>
<h4 id="and-operator">AND operator</h4>
<p>An implicit logical AND operator is always present, so "hello world" implies that both "hello" and "world" must be found in the matching document.</p>
<div class="codehilite"><pre><span></span><code><span class="n">hello</span><span class="w">  </span><span class="n">world</span>
</code></pre></div>

<p>Note: There is no explicit <code>AND</code> operator.</p>
<h4 id="or-operator">OR operator</h4>
<p>The logical OR operator <code>|</code> has a higher precedence than AND, so <code>looking for cat | dog | mouse</code> means <code>looking for (cat | dog | mouse)</code> rather than <code>(looking for cat) | dog | mouse</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="n">hello</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">world</span>
</code></pre></div>

<p>Note: There is no operator <code>OR</code>. Please use <code>|</code> instead.</p>
<h3 id="maybe-operator">MAYBE operator</h3>
<div class="codehilite"><pre><span></span><code><span class="n">hello</span><span class="w"> </span><span class="n">MAYBE</span><span class="w"> </span><span class="n">world</span>
</code></pre></div>

<p>The <code>MAYBE</code> operator functions similarly to the <code>|</code> operator, but it does not return documents that match only the right subtree expression.</p>
<h3 id="negation-operator">Negation operator</h3>
<div class="codehilite"><pre><span></span><code><span class="n">hello</span><span class="w"> </span><span class="o">-</span><span class="n">world</span>
<span class="n">hello</span><span class="w"> </span><span class="o">!</span><span class="n">world</span>
</code></pre></div>

<p>The negation operator enforces a rule for a word to not exist.</p>
<p>Queries containing <strong>only</strong> negations are <strong>not</strong> supported by default. To enable, use the server option <a href="20-server_settings.html#not_terms_only_allowed">not_terms_only_allowed</a>.</p>
<h3 id="field-search-operator">Field search operator</h3>
<div class="codehilite"><pre><span></span><code><span class="o">@</span><span class="n">title</span><span class="w"> </span><span class="n">hello</span><span class="w"> </span><span class="o">@</span><span class="n">body</span><span class="w"> </span><span class="n">world</span>
</code></pre></div>

<p>The field limit operator restricts subsequent searches to a specified field. By default, the query will fail with an error message if the given field name does not exist in the searched table. However, this behavior can be suppressed by specifying the <code>@@relaxed</code> option at the beginning of the query:</p>
<div class="codehilite"><pre><span></span><code><span class="o">@@</span><span class="n">relaxed</span><span class="w"> </span><span class="o">@</span><span class="n">nosuchfield</span><span class="w"> </span><span class="n">my</span><span class="w"> </span><span class="n">query</span>
</code></pre></div>

<p>This can be useful when searching through heterogeneous tables with different schemas.</p>
<p>Field position limits additionally constrain the search to the first N positions within a given field (or fields). For example, <code>@body [50] hello</code> will not match documents where the keyword <code>hello</code> appears at position 51 or later in the body.</p>
<div class="codehilite"><pre><span></span><code><span class="o">@</span><span class="n">body</span><span class="p">[</span><span class="mi">50</span><span class="p">]</span><span class="w"> </span><span class="n">hello</span>
</code></pre></div>

<p>Multiple-field search operator:</p>
<div class="codehilite"><pre><span></span><code><span class="o">@</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">body</span><span class="p">)</span><span class="w"> </span><span class="n">hello</span><span class="w"> </span><span class="n">world</span>
</code></pre></div>

<p>Ignore field search operator (ignores any matches of 'hello world' from the 'title' field):</p>
<div class="codehilite"><pre><span></span><code><span class="o">@!</span><span class="n">title</span><span class="w"> </span><span class="n">hello</span><span class="w"> </span><span class="n">world</span>
</code></pre></div>

<p>Ignore multiple-field search operator (if there are fields 'title', 'subject', and 'body', then <code>@!(title)</code> is equivalent to <code>@(subject,body)</code>):</p>
<div class="codehilite"><pre><span></span><code><span class="o">@!</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">body</span><span class="p">)</span><span class="w"> </span><span class="n">hello</span><span class="w"> </span><span class="n">world</span>
</code></pre></div>

<p>All-field search operator:</p>
<div class="codehilite"><pre><span></span><code><span class="o">@*</span><span class="w"> </span><span class="n">hello</span>
</code></pre></div>

<h3 id="phrase-search-operator">Phrase search operator</h3>
<div class="codehilite"><pre><span></span><code><span class="ss">&quot;hello world&quot;</span>
</code></pre></div>

<p>The phrase operator mandates that the words be adjacent to each other.</p>
<p>The phrase search operator can incorporate a <code>match any term</code> modifier. Within the phrase operator, terms are positionally significant. When the 'match any term' modifier is employed, the positions of the subsequent terms in that phrase query will be shifted. As a result, the 'match any' modifier does not affect search performance.</p>
<div class="codehilite"><pre><span></span><code><span class="ss">&quot;exact * phrase * * for terms&quot;</span>
</code></pre></div>

<h3 id="proximity-search-operator">Proximity search operator</h3>
<div class="codehilite"><pre><span></span><code><span class="ss">&quot;hello world&quot;</span><span class="o">~</span><span class="mi">10</span>
</code></pre></div>

<p>Proximity distance is measured in words, accounting for word count, and applies to all words within quotes. For example, the query <code>"cat dog mouse"~5</code> indicates that there must be a span of fewer than 8 words containing all 3 words. Therefore, a document with <code>CAT aaa bbb ccc DOG eee fff MOUSE</code> will not match this query, as the span is exactly 8 words long.</p>
<h3 id="quorum-matching-operator">Quorum matching operator</h3>
<div class="codehilite"><pre><span></span><code><span class="ss">&quot;the world is a wonderful place&quot;</span><span class="o">/</span><span class="mi">3</span>
</code></pre></div>

<p>The quorum matching operator introduces a type of fuzzy matching. It will match only those documents that meet a given threshold of specified words. In the example above (<code>"the world is a wonderful place"/3</code>), it will match all documents containing at least 3 of the 6 specified words. The operator is limited to 255 keywords. Instead of an absolute number, you can also provide a value between 0.0 and 1.0 (representing 0% and 100%), and Manticore will match only documents containing at least the specified percentage of given words. The same example above could also be expressed as <code>"the world is a wonderful place"/0.5</code>, and it would match documents with at least 50% of the 6 words.</p>
<h3 id="strict-order-operator">Strict order operator</h3>
<div class="codehilite"><pre><span></span><code><span class="n">aaa</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">bbb</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ccc</span>
</code></pre></div>

<p>The strict order operator (also known as the "before" operator) matches a document only if its argument keywords appear in the document precisely in the order specified in the query. For example, the query <code>black &lt;&lt; cat</code> will match the document "black and white cat" but not the document "that cat was black". The order operator has the lowest priority. It can be applied to both individual keywords and more complex expressions. For instance, this is a valid query:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">bag</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">words</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="ss">&quot;exact phrase&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">red</span><span class="o">|</span><span class="n">green</span><span class="o">|</span><span class="n">blue</span>
</code></pre></div>

<h3 id="exact-form-modifier">Exact form modifier</h3>
<div class="codehilite"><pre><span></span><code><span class="n">raining</span><span class="w"> </span><span class="o">=</span><span class="n">cats</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="o">=</span><span class="n">dogs</span>
<span class="o">=</span><span class="ss">&quot;exact phrase&quot;</span>
</code></pre></div>

<p>The exact form keyword modifier matches a document only if the keyword appears in the exact form specified. By default, a document is considered a match if the stemmed/lemmatized keyword matches. For instance, the query "runs" will match both a document containing "runs" and one containing "running", because both forms stem to just "run". However, the <code>=runs</code> query will only match the first document. The exact form operator requires the <a href="06-creating_a_table.html#index_exact_words">index_exact_words</a> option to be enabled.</p>
<p>Another use case is to prevent <a href="06-creating_a_table.html#expand_keywords">expanding</a> a keyword to its <code>*keyword*</code> form. For example, with <code>index_exact_words=1</code> + <code>expand_keywords=1/star</code>, <code>bcd</code> will find a document containing <code>abcde</code>, but <code>=bcd</code> will not.</p>
<p>As a modifier affecting the keyword, it can be used within operators such as phrase, proximity, and quorum operators. Applying an exact form modifier to the phrase operator is possible, and in this case, it internally adds the exact form modifier to all terms in the phrase.</p>
<h3 id="wildcard-operators">Wildcard operators</h3>
<div class="codehilite"><pre><span></span><code><span class="n">nation</span><span class="o">*</span><span class="w"> </span><span class="o">*</span><span class="n">nation</span><span class="o">*</span><span class="w"> </span><span class="o">*</span><span class="k">national</span>
</code></pre></div>

<p>Requires <a href="06-creating_a_table.html#min_infix_len">min_infix_len</a> for prefix (expansion in trail) and/or suffix (expansion in head). If only prefixing is desired, <a href="06-creating_a_table.html#min_prefix_len">min_prefix_len</a> can be used instead.</p>
<p>The search will attempt to find all expansions of the wildcarded tokens, and each expansion is recorded as a matched hit. The number of expansions for a token can be controlled with the <a href="06-creating_a_table.html#expansion_limit">expansion_limit</a> table setting. Wildcarded tokens can have a significant impact on query search time, especially when tokens have short lengths. In such cases, it is desirable to use the expansion limit.</p>
<p>The wildcard operator can be automatically applied if the <a href="13-searching.html#expand_keywords">expand_keywords</a> table setting is used.</p>
<p>In addition, the following inline wildcard operators are supported:</p>
<ul>
<li><code>?</code> can match any single character: <code>t?st</code> will match <code>test</code>, but not <code>teast</code></li>
<li><code>%</code> can match zero or one character: <code>tes%</code> will match <code>tes</code> or <code>test</code>, but not <code>testing</code></li>
</ul>
<p>The inline operators require <code>dict=keywords</code> and infixing enabled.</p>
<h3 id="regex-operator">REGEX operator</h3>
<div class="codehilite"><pre><span></span><code><span class="n">REGEX</span><span class="p">(</span><span class="o">/</span><span class="n">t</span><span class="p">.</span><span class="o">?</span><span class="n">e</span><span class="o">/</span><span class="p">)</span>
</code></pre></div>

<p>Requires the <a href="06-creating_a_table.html#min_infix_len">min_infix_len</a> or <a href="06-creating_a_table.html#min_prefix_len">min_prefix_len</a> and <a href="06-creating_a_table.html#dict">dict</a>=keywords options to be set (which is a default).</p>
<p>Similarly to the <a href="13-searching.html#wildcard-operators">wildcard operators</a>, the REGEX operator attempts to find all tokens matching the provided pattern, and each expansion is recorded as a matched hit. Note, this can have a significant impact on query search time, as the entire dictionary is scanned, and every term in the dictionary undergoes matching with the REGEX pattern.</p>
<p>The patterns should adhere to the <a href="https://github.com/google/re2/wiki/Syntax">RE2 syntax</a>. The REGEX expression delimiter is the first symbol after the open bracket. In other words, all text between the open bracket followed by the delimiter and the delimiter and the closed bracket is considered as a RE2 expression.<br />
Please note that the terms stored in the dictionary undergo <code>charset_table</code> transformation, meaning that for example, REGEX may not be able to match uppercase characters if all characters are lowercased according to the <code>charset_table</code> (which happens by default). To successfully match a term using a REGEX expression, the pattern must correspond to the entire token. To achieve partial matching, place <code>.*</code> at the beginning and/or end of your pattern.</p>
<div class="codehilite"><pre><span></span><code><span class="n">REGEX</span><span class="p">(</span><span class="o">/</span><span class="p">.</span><span class="err">{</span><span class="mi">3</span><span class="err">}</span><span class="n">t</span><span class="o">/</span><span class="p">)</span>
<span class="n">REGEX</span><span class="p">(</span><span class="o">/</span><span class="n">t</span><span class="p">.</span><span class="o">*</span><span class="err">\</span><span class="n">d</span><span class="o">*/</span><span class="p">)</span>
</code></pre></div>

<h3 id="field-start-and-field-end-modifier">Field-start and field-end modifier</h3>
<div class="codehilite"><pre><span></span><code><span class="o">^</span><span class="n">hello</span><span class="w"> </span><span class="n">world$</span>
</code></pre></div>

<p>Field-start and field-end keyword modifiers ensure that a keyword only matches if it appears at the very beginning or the very end of a full-text field, respectively. For example, the query <code>"^hello world$"</code> (enclosed in quotes to combine the phrase operator with the start/end modifiers) will exclusively match documents containing at least one field with these two specific keywords.</p>
<h3 id="idf-boost-modifier">IDF boost modifier</h3>
<div class="codehilite"><pre><span></span><code><span class="n">boosted</span><span class="o">^</span><span class="mi">1</span><span class="p">.</span><span class="mi">234</span><span class="w"> </span><span class="n">boostedfieldend$</span><span class="o">^</span><span class="mi">1</span><span class="p">.</span><span class="mi">234</span>
</code></pre></div>

<p>The boost modifier raises the word IDF score by the indicated factor in ranking scores that incorporate IDF into their calculations. It does not impact the matching process in any manner.</p>
<h3 id="near-operator">NEAR operator</h3>
<div class="codehilite"><pre><span></span><code><span class="n">hello</span><span class="w"> </span><span class="n">NEAR</span><span class="o">/</span><span class="mi">3</span><span class="w"> </span><span class="n">world</span><span class="w"> </span><span class="n">NEAR</span><span class="o">/</span><span class="mi">4</span><span class="w"> </span><span class="ss">&quot;my test&quot;</span>
</code></pre></div>

<p>The <code>NEAR</code> operator is a more generalized version of the proximity operator. Its syntax is <code>NEAR/N</code>, which is case-sensitive and does not allow spaces between the <code>NEAR</code> keywords, slash sign, and distance value.</p>
<p>While the original proximity operator works only on sets of keywords, <code>NEAR</code> is more versatile and can accept arbitrary subexpressions as its two arguments. It matches a document when both subexpressions are found within N words of each other, regardless of their order. <code>NEAR</code> is left-associative and shares the same (lowest) precedence as <a href="13-searching.html#strict-order-operator">BEFORE</a>.</p>
<p>It is important to note that <code>one NEAR/7 two NEAR/7 three</code> is not exactly equivalent to <code>"one two three"~7</code>. The key difference is that the proximity operator allows up to 6 non-matching words between all three matching words, while the version with <code>NEAR</code> is less restrictive: it permits up to 6 words between <code>one</code> and <code>two</code>, and then up to 6 more between that two-word match and <code>three</code>.</p>
<h3 id="notnear-operator">NOTNEAR operator</h3>
<div class="codehilite"><pre><span></span><code><span class="n">Church</span><span class="w"> </span><span class="n">NOTNEAR</span><span class="o">/</span><span class="mi">3</span><span class="w"> </span><span class="n">street</span>
</code></pre></div>

<p>The <code>NOTNEAR</code> operator serves as a negative assertion. It matches a document when the left argument is present and either the right argument is absent from the document or the right argument is a specified distance away from the end of the left matched argument. The distance is denoted in words. The syntax is <code>NOTNEAR/N</code>, which is case-sensitive and does not permit spaces between the <code>NOTNEAR</code> keyword, slash sign, and distance value. Both arguments of this operator can be terms or any operators or group of operators.</p>
<h3 id="sentence-and-paragraph-operators">SENTENCE and PARAGRAPH operators</h3>
<div class="codehilite"><pre><span></span><code><span class="k">all</span><span class="w"> </span><span class="n">SENTENCE</span><span class="w"> </span><span class="n">words</span><span class="w"> </span><span class="n">SENTENCE</span><span class="w"> </span><span class="ss">&quot;in one sentence&quot;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="ss">&quot;Bill Gates&quot;</span><span class="w"> </span><span class="n">PARAGRAPH</span><span class="w"> </span><span class="ss">&quot;Steve Jobs&quot;</span>
</code></pre></div>

<p>The <code>SENTENCE</code> and <code>PARAGRAPH</code> operators match a document when both of their arguments are within the same sentence or the same paragraph of text, respectively. These arguments can be keywords, phrases, or instances of the same operator.</p>
<p>The order of the arguments within the sentence or paragraph is irrelevant. These operators function only with tables built with <a href="06-creating_a_table.html#index_sp">index_sp</a> (sentence and paragraph indexing feature) enabled and revert to a simple AND operation otherwise. For information on what constitutes a sentence and a paragraph, refer to the <a href="06-creating_a_table.html#index_sp">index_sp</a> directive documentation.</p>
<h3 id="zone-limit-operator">ZONE limit operator</h3>
<div class="codehilite"><pre><span></span><code><span class="k">ZONE</span><span class="p">:(</span><span class="n">h3</span><span class="p">,</span><span class="n">h4</span><span class="p">)</span>

<span class="k">only</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">these</span><span class="w"> </span><span class="n">titles</span>
</code></pre></div>

<p>The <code>ZONE limit</code> operator closely resembles the field limit operator but limits matching to a specified in-field zone or a list of zones. It is important to note that subsequent subexpressions do not need to match within a single continuous span of a given zone and may match across multiple spans. For example, the query <code>(ZONE:th hello world)</code> will match the following sample document:</p>
<div class="codehilite"><pre><span></span><code><span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Table 1. Local awareness of Hello Kitty brand.<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
.. some table data goes here ..
<span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Table 2. World-wide brand awareness.<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
</code></pre></div>

<p>The <code>ZONE</code> operator influences the query until the next field or <code>ZONE</code> limit operator, or until the closing parenthesis. It functions exclusively with tables built with zone support (refer to <a href="06-creating_a_table.html#index_zones">index_zones</a>) and will be disregarded otherwise.</p>
<h3 id="zonespan-limit-operator">ZONESPAN limit operator</h3>
<div class="codehilite"><pre><span></span><code><span class="n">ZONESPAN</span><span class="p">:(</span><span class="n">h2</span><span class="p">)</span>

<span class="k">only</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">(</span><span class="n">single</span><span class="p">)</span><span class="w"> </span><span class="n">title</span>
</code></pre></div>

<p>The <code>ZONESPAN</code> limit operator resembles the <code>ZONE</code> operator but mandates that the match occurs within a single continuous span. In the example provided earlier, <code>ZONESPAN:th hello world</code> would not match the document, as "hello" and "world" do not appear within the same span.</p>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.02.03-escaping">
        <header>
            <a class="chapter-link" href="#toc-13.02.03-escaping"> ¶ 13.2.3</a>

            
            <h1 id="escaping-characters-in-query-string">Escaping characters in query string</h1>
            
        </header>

        
        
<p>Since certain characters function as operators in the query string, they must be escaped to prevent query errors or unintended matching conditions.</p>
<p>The following characters should be escaped using a backslash (<code>\</code>):</p>
<div class="codehilite"><pre><span></span><code>!    &quot;    $    &#39;    (    )    -    /    &lt;    @    \    ^    |    ~
</code></pre></div>

<h2 id="in-mysql-command-line-client">In MySQL command line client</h2>
<p>To escape a single quote ('), use one backslash:</p>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">your_index</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;l\&#39;</span><span class="n">italiano</span><span class="err">&#39;</span><span class="p">);</span>
</code></pre></div>

<p>For the other characters in the list mentioned earlier, which are operators or query constructs, they must be treated as simple characters by the engine, with a preceding escape character.<br />
The backslash must also be escaped, resulting in two backslashes:</p>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">your_index</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;r\\&amp;b | \\(official video\\)&#39;</span><span class="p">);</span>
</code></pre></div>

<p>To use a backslash as a character, you must escape both the backslash as a character and the backslash as the escape operator, which requires four backslashes:</p>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">your_index</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;\\\\ABC&#39;</span><span class="p">);</span>
</code></pre></div>

<p>When you are working with JSON data in Manticore Search and need to include a double quote (<code>"</code>) within a JSON string, it's important to handle it with proper escaping. In JSON, a double quote within a string is escaped using a backslash (<code>\</code>). However, when inserting the JSON data through an SQL query, Manticore Search interprets the backslash (<code>\</code>) as an escape character within strings.</p>
<p>To ensure the double quote is correctly inserted into the JSON data, you need to escape the backslash itself. This results in using two backslashes (<code>\\</code>) before the double quote. For example:</p>
<div class="codehilite"><pre><span></span><code><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">tbl</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="s1">&#39;{&quot;a&quot;: &quot;\\&quot;abc\\&quot;&quot;}&#39;</span><span class="p">);</span>
</code></pre></div>

<h2 id="using-mysql-drivers">Using MySQL drivers</h2>
<p>MySQL drivers provide escaping functions (e.g., <code>mysqli_real_escape_string</code> in PHP or <code>conn.escape_string</code> in Python), but they only escape specific characters.<br />
You will still need to add escaping for the characters from the previously mentioned list that are not escaped by their respective functions.<br />
Because these functions will escape the backslash for you, you only need to add one backslash.</p>
<p>This also applies to drivers that support (client-side) prepared statements. For example, with PHP PDO prepared statements, you need to add a backslash for the <code>$</code> character:</p>
<div class="codehilite"><pre><span></span><code><span class="x">$statement = $ln_sph-&gt;prepare( &quot;SELECT * FROM index WHERE MATCH(:match)&quot;);</span>
<span class="x">$match = &#39;\$manticore&#39;;</span>
<span class="x">$statement-&gt;bindParam(&#39;:match&#39;,$match,PDO::PARAM_STR);</span>
<span class="x">$results = $statement-&gt;execute();</span>
</code></pre></div>

<p>This results in the final query <code>SELECT * FROM index WHERE MATCH('\\$manticore');</code></p>
<h2 id="in-http-json-api">In HTTP JSON API</h2>
<p>The same rules for the SQL protocol apply, with the exception that for JSON, the double quote must be escaped with a single backslash, while the rest of the characters require double escaping.</p>
<p>When using JSON libraries or functions that convert data structures to JSON strings, the double quote and single backslash are automatically escaped by these functions and do not need to be explicitly escaped.</p>
<h2 id="in-clients">In clients</h2>
<p>The <a href="https://github.com/manticoresoftware/">new official clients</a> (which use the HTTP protocol) utilize common JSON libraries/functions available in their respective programming languages under the hood. The same rules for escaping mentioned earlier apply.</p>
<h2 id="escaping-asterisk">Escaping asterisk</h2>
<p>The asterisk (<code>*</code>) is a unique character that serves two purposes:</p>
<ul>
<li>as a wildcard prefix/suffix expander</li>
<li>as an any-term modifier within a phrase search.</li>
</ul>
<p>Unlike other special characters that function as operators, the asterisk cannot be escaped when it's in a position to provide one of its functionalities.</p>
<p>In non-wildcard queries, the asterisk does not require escaping, whether it's in the <code>charset_table</code> or not.</p>
<p>In wildcard queries, an asterisk in the middle of a word does not require escaping. As a wildcard operator (either at the beginning or end of the word), the asterisk will always be interpreted as the wildcard operator, even if escaping is applied.</p>
<h2 id="escaping-json-node-names-in-sql">Escaping json node names in SQL</h2>
<p>To escape special characters in JSON nodes, use a backtick. For example:</p>
<div class="codehilite"><pre><span></span><code><span class="n">MySQL</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">json</span><span class="p">.</span><span class="o">`</span><span class="n">a</span><span class="o">=</span><span class="n">b</span><span class="o">`=</span><span class="mi">234</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------------------+-------------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">json</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+-------------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">8215557549554925578</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;a=b&quot;</span><span class="p">:</span><span class="mi">234</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+-------------+------+</span>

<span class="n">MySQL</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">json</span><span class="p">.</span><span class="o">`</span><span class="n">a</span><span class="p">:</span><span class="n">b</span><span class="o">`=</span><span class="mi">123</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------------------+-------------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">json</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+-------------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">8215557549554925577</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;a:b&quot;</span><span class="p">:</span><span class="mi">123</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+-------------+------+</span>
</code></pre></div>

<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.02.04-search_profiling">
        <header>
            <a class="chapter-link" href="#toc-13.02.04-search_profiling"> ¶ 13.2.4</a>

            
            <h1 id="search-profiling">Search profiling</h1>
            
        </header>

        
        
<h2 id="how-a-query-is-interpreted">How a query is interpreted</h2>
<p>Consider this complex query example:</p>
<div class="codehilite"><pre><span></span><code><span class="ss">&quot;hello world&quot;</span><span class="w"> </span><span class="o">@</span><span class="n">title</span><span class="w"> </span><span class="ss">&quot;example program&quot;</span><span class="o">~</span><span class="mi">5</span><span class="w"> </span><span class="o">@</span><span class="n">body</span><span class="w"> </span><span class="n">python</span><span class="w"> </span><span class="o">-</span><span class="p">(</span><span class="n">php</span><span class="o">|</span><span class="n">perl</span><span class="p">)</span><span class="w"> </span><span class="o">@*</span><span class="w"> </span><span class="n">code</span>
</code></pre></div>

<p>The full meaning of this search is:</p>
<ul>
<li>Locate the words 'hello' and 'world' adjacently in any field within a document;</li>
<li>Additionally, the same document must also contain the words 'example' and 'program' in the title field, with up to, but not including, 5 words between them; (For instance, "example PHP program" would match, but "example script to introduce outside data into the correct context for your program" would not, as there are 5 or more words between the two terms)</li>
<li>Furthermore, the same document must have the word 'python' in the body field, while excluding 'php' or 'perl';</li>
<li>Finally, the same document must include the word 'code' in any field.</li>
</ul>
<p>The OR operator takes precedence over AND, so "looking for cat | dog | mouse" means "looking for (cat | dog | mouse)" rather than "(looking for cat) | dog | mouse".</p>
<p>To comprehend how a query will be executed, Manticore Search provides query profiling tools to examine the query tree generated by a query expression.</p>
<!-- example profiling -->

<h2 id="profiling-the-query-tree-in-sql">Profiling the query tree in SQL</h2>
<p>To enable full-text query profiling with an SQL statement, you must activate it before executing the desired query:</p>
<div class="codehilite"><pre><span></span><code><span class="k">SET</span><span class="w"> </span><span class="n">profiling</span><span class="w"> </span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;@title abc* @body hey&#39;</span><span class="p">);</span>
</code></pre></div>

<p>To view the query tree, execute the <code>SHOW PLAN</code>  command immediately after running the query:</p>
<div class="codehilite"><pre><span></span><code><span class="k">SHOW</span><span class="w"> </span><span class="n">PLAN</span><span class="p">;</span>
</code></pre></div>

<p>This command will return the structure of the executed query. Keep in mind that the 3 statements - SET profiling, the query, and SHOW - must be executed within the same session.</p>
<h2 id="profiling-the-query-in-http-json">Profiling the query in HTTP JSON</h2>
<p>When using the HTTP JSON protocol we can just enable <code>"profile":true</code> to get in response the full-text query tree structure.</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;profile&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;match_phrase&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;_all&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;had grown quite&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>The response will include a <code>profile</code> object containing a <code>query</code> member.</p>
<p>The <code>query</code> property holds the transformed full-text query tree. Each node consists of:</p>
<ul>
<li><code>type</code>: node type, which can be AND, OR, PHRASE, KEYWORD, etc.</li>
<li><code>description</code>: query subtree for this node represented as a string (in <code>SHOW PLAN</code> format)</li>
<li><code>children</code>: any child nodes, if present</li>
<li><code>max_field_pos</code>: maximum position within a field</li>
</ul>
<p>A keyword node will additionally include:</p>
<ul>
<li><code>word</code>: the transformed keyword.</li>
<li><code>querypos</code>: position of this keyword in the query.</li>
<li><code>excluded</code>: keyword excluded from the query.</li>
<li><code>expanded</code>: keyword added by prefix expansion.</li>
<li><code>field_start</code>: keyword must appear at the beginning of the field.</li>
<li><code>field_end</code>: keyword must appear at the end of the field.</li>
<li><code>boost</code>: the keyword's IDF will be multiplied by this value.</li>
</ul>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">SET</span><span class="w"> </span><span class="n">profiling</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;@title abc* @body hey&#39;</span><span class="p">);</span>
<span class="k">SHOW</span><span class="w"> </span><span class="n">PLAN</span><span class="w"> </span><span class="err">\</span><span class="k">G</span>
</code></pre></div>


<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="o">***************************</span><span class="w"> </span><span class="mi">1</span><span class="err">\</span><span class="p">.</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="o">***************************</span>
<span class="k">Variable</span><span class="p">:</span><span class="w"> </span><span class="n">transformed_tree</span>
<span class="w">   </span><span class="n">Value</span><span class="p">:</span><span class="w"> </span><span class="k">AND</span><span class="p">(</span>
<span class="w">  </span><span class="k">OR</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="n">title</span><span class="p">),</span><span class="w"> </span><span class="n">KEYWORD</span><span class="p">(</span><span class="n">abcx</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">expanded</span><span class="p">),</span><span class="w"> </span><span class="n">KEYWORD</span><span class="p">(</span><span class="n">abcm</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">expanded</span><span class="p">)),</span>
<span class="w">  </span><span class="k">AND</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="n">body</span><span class="p">),</span><span class="w"> </span><span class="n">KEYWORD</span><span class="p">(</span><span class="n">hey</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">2</span><span class="p">)))</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;forum&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;query_string&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;i me&quot;</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;excludes&quot;</span><span class="p">:[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;profile&quot;</span><span class="p">:</span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="mi">1503</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="mi">406301</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">[</span>
<span class="w">       </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="s2">&quot;406443&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="mi">3493</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;_source&quot;</span><span class="p">:{}</span>
<span class="w">       </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;profile&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;query&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;AND&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="s2">&quot;AND( AND(KEYWORD(i, querypos=1)),  AND(KEYWORD(me, querypos=2)))&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;children&quot;</span><span class="p">:</span>
<span class="w">      </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;AND&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="s2">&quot;AND(KEYWORD(i, querypos=1))&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;children&quot;</span><span class="p">:</span>
<span class="w">          </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;KEYWORD&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;word&quot;</span><span class="p">:</span><span class="s2">&quot;i&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;querypos&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;AND&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="s2">&quot;AND(KEYWORD(me, querypos=2))&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;children&quot;</span><span class="p">:</span>
<span class="w">          </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;KEYWORD&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;word&quot;</span><span class="p">:</span><span class="s2">&quot;me&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;querypos&quot;</span><span class="p">:</span><span class="mi">2</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- request PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">$result = $index-&gt;search(&#39;i me&#39;)-&gt;setSource([&#39;excludes&#39;=&gt;[&#39;*&#39;]])-&gt;setLimit(1)-&gt;profile()-&gt;get();</span>
<span class="x">print_r($result-&gt;getProfile());</span>
</code></pre></div>


<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Array</span>
<span class="x">(</span>
<span class="x">    [query] =&gt; Array</span>
<span class="x">        (</span>
<span class="x">            [type] =&gt; AND</span>
<span class="x">            [description] =&gt; AND( AND(KEYWORD(i, querypos=1)),  AND(KEYWORD(me, querypos=2)))</span>
<span class="x">            [children] =&gt; Array</span>
<span class="x">                (</span>
<span class="x">                    [0] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [type] =&gt; AND</span>
<span class="x">                            [description] =&gt; AND(KEYWORD(i, querypos=1))</span>
<span class="x">                            [children] =&gt; Array</span>
<span class="x">                                (</span>
<span class="x">                                    [0] =&gt; Array</span>
<span class="x">                                        (</span>
<span class="x">                                            [type] =&gt; KEYWORD</span>
<span class="x">                                            [word] =&gt; i</span>
<span class="x">                                            [querypos] =&gt; 1</span>
<span class="x">                                        )</span>
<span class="x">                                )</span>
<span class="x">                        )</span>
<span class="x">                    [1] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [type] =&gt; AND</span>
<span class="x">                            [description] =&gt; AND(KEYWORD(me, querypos=2))</span>
<span class="x">                            [children] =&gt; Array</span>
<span class="x">                                (</span>
<span class="x">                                    [0] =&gt; Array</span>
<span class="x">                                        (</span>
<span class="x">                                            [type] =&gt; KEYWORD</span>
<span class="x">                                            [word] =&gt; me</span>
<span class="x">                                            [querypos] =&gt; 2</span>
<span class="x">                                        )</span>
<span class="x">                                )</span>
<span class="x">                        )</span>
<span class="x">                )</span>
<span class="x">        )</span>
<span class="x">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
Python
<!-- request Python -->


<div class="codehilite"><pre><span></span><code><span class="n">searchApi</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;forum&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="p">:{</span><span class="s2">&quot;query_string&quot;</span><span class="p">:</span><span class="s2">&quot;i me&quot;</span><span class="p">},</span><span class="s2">&quot;_source&quot;</span><span class="p">:{</span><span class="s2">&quot;excludes&quot;</span><span class="p">:[</span><span class="s2">&quot;*&quot;</span><span class="p">]},</span><span class="s2">&quot;limit&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;profile&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;100&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">2500</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{}}],</span>
          <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;children&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;children&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;querypos&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                                      <span class="sa">u</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;KEYWORD&#39;</span><span class="p">,</span>
                                                      <span class="sa">u</span><span class="s1">&#39;word&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;i&#39;</span><span class="p">}],</span>
                                       <span class="sa">u</span><span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;AND(KEYWORD(i, querypos=1))&#39;</span><span class="p">,</span>
                                       <span class="sa">u</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;AND&#39;</span><span class="p">},</span>
                                      <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;children&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;querypos&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                                                      <span class="sa">u</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;KEYWORD&#39;</span><span class="p">,</span>
                                                      <span class="sa">u</span><span class="s1">&#39;word&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;me&#39;</span><span class="p">}],</span>
                                       <span class="sa">u</span><span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;AND(KEYWORD(me, querypos=2))&#39;</span><span class="p">,</span>
                                       <span class="sa">u</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;AND&#39;</span><span class="p">}],</span>
                        <span class="sa">u</span><span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;AND( AND(KEYWORD(i, querypos=1)),  AND(KEYWORD(me, querypos=2)))&#39;</span><span class="p">,</span>
                        <span class="sa">u</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;AND&#39;</span><span class="p">}},</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
javascript
<!-- request javascript -->


<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="s2">&quot;forum&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;query_string&quot;</span><span class="o">:</span><span class="s2">&quot;i me&quot;</span><span class="p">},</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;excludes&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]},</span><span class="s2">&quot;limit&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;profile&quot;</span><span class="o">:</span><span class="kc">true</span><span class="p">});</span>
</code></pre></div>


<!-- response javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;100&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">2500</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{}}],</span>
<span class="w">          </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">},</span>
<span class="w"> </span><span class="s2">&quot;profile&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;children&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="s2">&quot;children&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="s2">&quot;querypos&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">                                                      </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;KEYWORD&quot;</span><span class="p">,</span>
<span class="w">                                                      </span><span class="s2">&quot;word&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;i&quot;</span><span class="p">}],</span>
<span class="w">                                       </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AND(KEYWORD(i, querypos=1))&quot;</span><span class="p">,</span>
<span class="w">                                       </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AND&quot;</span><span class="p">},</span>
<span class="w">                                      </span><span class="p">{</span><span class="s2">&quot;children&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="s2">&quot;querypos&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<span class="w">                                                      </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;KEYWORD&quot;</span><span class="p">,</span>
<span class="w">                                                      </span><span class="s2">&quot;word&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;me&quot;</span><span class="p">}],</span>
<span class="w">                                       </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AND(KEYWORD(me, querypos=2))&quot;</span><span class="p">,</span>
<span class="w">                                       </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AND&quot;</span><span class="p">}],</span>
<span class="w">                        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AND( AND(KEYWORD(i, querypos=1)),  AND(KEYWORD(me, querypos=2)))&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AND&quot;</span><span class="p">}},</span>
<span class="w"> </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">False</span><span class="p">,</span>
<span class="w"> </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
java
<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">query</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;query_string&quot;</span><span class="p">,</span><span class="s">&quot;i me&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">();</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;forum&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setProfile</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setLimit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setSort</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">add</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">);</span>
<span class="p">}});</span>
<span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">took</span><span class="p">:</span><span class="w"> </span><span class="mi">18</span>
<span class="w">    </span><span class="n">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">total</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">2500</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{}}</span><span class="o">]</span>
<span class="w">        </span><span class="n">aggregations</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">profile</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="n">type</span><span class="o">=</span><span class="n">AND</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="o">=</span><span class="n">AND</span><span class="p">(</span><span class="w"> </span><span class="n">AND</span><span class="p">(</span><span class="n">KEYWORD</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span><span class="w">  </span><span class="n">AND</span><span class="p">(</span><span class="n">KEYWORD</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">2</span><span class="p">))),</span><span class="w"> </span><span class="n">children</span><span class="o">=[</span><span class="p">{</span><span class="n">type</span><span class="o">=</span><span class="n">AND</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="o">=</span><span class="n">AND</span><span class="p">(</span><span class="n">KEYWORD</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span><span class="w"> </span><span class="n">children</span><span class="o">=[</span><span class="p">{</span><span class="n">type</span><span class="o">=</span><span class="n">KEYWORD</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="o">=</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">1</span><span class="p">}</span><span class="o">]</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">type</span><span class="o">=</span><span class="n">AND</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="o">=</span><span class="n">AND</span><span class="p">(</span><span class="n">KEYWORD</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span><span class="w"> </span><span class="n">children</span><span class="o">=[</span><span class="p">{</span><span class="n">type</span><span class="o">=</span><span class="n">KEYWORD</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="o">=</span><span class="n">me</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">2</span><span class="p">}</span><span class="o">]</span><span class="p">}</span><span class="o">]</span><span class="p">}}</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
C#
<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="n">object</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">new</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">query_string</span><span class="o">=</span><span class="s2">&quot;i me&quot;</span><span class="w"> </span><span class="p">};</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;forum&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Profile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">true</span><span class="p">;</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="w"> </span><span class="p">};</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="o">.</span><span class="n">Search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nx">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">took</span><span class="p">:</span><span class="w"> </span><span class="mi">18</span>
<span class="w">    </span><span class="nx">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="nx">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">total</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="nx">hits</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">_id</span><span class="p">=</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="nx">_score</span><span class="p">=</span><span class="mi">2500</span><span class="p">,</span><span class="w"> </span><span class="nx">_source</span><span class="p">={}}]</span>
<span class="w">        </span><span class="nx">aggregations</span><span class="p">:</span><span class="w"> </span><span class="nx">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">profile</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nx">query</span><span class="p">={</span><span class="k">type</span><span class="p">=</span><span class="nx">AND</span><span class="p">,</span><span class="w"> </span><span class="nx">description</span><span class="p">=</span><span class="nx">AND</span><span class="p">(</span><span class="w"> </span><span class="nx">AND</span><span class="p">(</span><span class="nx">KEYWORD</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">querypos</span><span class="p">=</span><span class="mi">1</span><span class="p">)),</span><span class="w">  </span><span class="nx">AND</span><span class="p">(</span><span class="nx">KEYWORD</span><span class="p">(</span><span class="nx">me</span><span class="p">,</span><span class="w"> </span><span class="nx">querypos</span><span class="p">=</span><span class="mi">2</span><span class="p">))),</span><span class="w"> </span><span class="nx">children</span><span class="p">=[{</span><span class="k">type</span><span class="p">=</span><span class="nx">AND</span><span class="p">,</span><span class="w"> </span><span class="nx">description</span><span class="p">=</span><span class="nx">AND</span><span class="p">(</span><span class="nx">KEYWORD</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">querypos</span><span class="p">=</span><span class="mi">1</span><span class="p">)),</span><span class="w"> </span><span class="nx">children</span><span class="p">=[{</span><span class="k">type</span><span class="p">=</span><span class="nx">KEYWORD</span><span class="p">,</span><span class="w"> </span><span class="nx">word</span><span class="p">=</span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">querypos</span><span class="p">=</span><span class="mi">1</span><span class="p">}]},</span><span class="w"> </span><span class="p">{</span><span class="k">type</span><span class="p">=</span><span class="nx">AND</span><span class="p">,</span><span class="w"> </span><span class="nx">description</span><span class="p">=</span><span class="nx">AND</span><span class="p">(</span><span class="nx">KEYWORD</span><span class="p">(</span><span class="nx">me</span><span class="p">,</span><span class="w"> </span><span class="nx">querypos</span><span class="p">=</span><span class="mi">2</span><span class="p">)),</span><span class="w"> </span><span class="nx">children</span><span class="p">=[{</span><span class="k">type</span><span class="p">=</span><span class="nx">KEYWORD</span><span class="p">,</span><span class="w"> </span><span class="nx">word</span><span class="p">=</span><span class="nx">me</span><span class="p">,</span><span class="w"> </span><span class="nx">querypos</span><span class="p">=</span><span class="mi">2</span><span class="p">}]}]}}</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
TypeScript
<!-- request TypeScript -->


<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">query_string</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Text&#39;</span><span class="w"> </span><span class="p">},</span><span class="w"> </span>
<span class="w">  </span><span class="nx">_source</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">excludes</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="nx">limit</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
<span class="w">  </span><span class="nx">profile</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span>
<span class="p">});</span>
</code></pre></div>


<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span>
<span class="w">        </span><span class="p">}],</span>
<span class="w">        </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;profile&quot;</span><span class="o">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;children&quot;</span><span class="o">:</span><span class="w"> </span>
<span class="w">            </span><span class="p">[{</span>
<span class="w">                </span><span class="s2">&quot;children&quot;</span><span class="o">:</span><span class="w"> </span>
<span class="w">                </span><span class="p">[{</span>
<span class="w">                    </span><span class="s2">&quot;querypos&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">                    </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;KEYWORD&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s2">&quot;word&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;i&quot;</span>
<span class="w">                </span><span class="p">}],</span>
<span class="w">                </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AND(KEYWORD(i, querypos=1))&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AND&quot;</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;children&quot;</span><span class="o">:</span><span class="w"> </span>
<span class="w">                </span><span class="p">[{</span>
<span class="w">                    </span><span class="s2">&quot;querypos&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<span class="w">                    </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;KEYWORD&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s2">&quot;word&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;me&quot;</span>
<span class="w">                </span><span class="p">}],</span>
<span class="w">                </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AND(KEYWORD(me, querypos=2))&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AND&quot;</span>
<span class="w">            </span><span class="p">}],</span>
<span class="w">            </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AND( AND(KEYWORD(i, querypos=1)),  AND(KEYWORD(me, querypos=2)))&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AND&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">False</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
Go
<!-- request Go -->


<div class="codehilite"><pre><span></span><code><span class="nx">searchRequest</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoresearch</span><span class="p">.</span><span class="nx">NewSearchRequest</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;query_string&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Text&quot;</span><span class="p">}</span>
<span class="nx">source</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;excludes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;*&quot;</span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetSource</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span>
<span class="nx">searchReq</span><span class="p">.</span><span class="nx">SetLimit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nx">searchReq</span><span class="p">.</span><span class="nx">SetProfile</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">SearchRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">searchRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>


<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="w">        </span><span class="p">}],</span>
<span class="w">        </span><span class="s">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s">&quot;profile&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span>
<span class="w">            </span><span class="p">[{</span>
<span class="w">                </span><span class="s">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span>
<span class="w">                </span><span class="p">[{</span>
<span class="w">                    </span><span class="s">&quot;querypos&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;KEYWORD&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;word&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;i&quot;</span>
<span class="w">                </span><span class="p">}],</span>
<span class="w">                </span><span class="s">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;AND(KEYWORD(i, querypos=1))&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;AND&quot;</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span>
<span class="w">                </span><span class="p">[{</span>
<span class="w">                    </span><span class="s">&quot;querypos&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;KEYWORD&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;word&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;me&quot;</span>
<span class="w">                </span><span class="p">}],</span>
<span class="w">                </span><span class="s">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;AND(KEYWORD(me, querypos=2))&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;AND&quot;</span>
<span class="w">            </span><span class="p">}],</span>
<span class="w">            </span><span class="s">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;AND( AND(KEYWORD(i, querypos=1)),  AND(KEYWORD(me, querypos=2)))&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;AND&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">False</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example SHOW PLAN EXPANSION -->

<p>In some instances, the evaluated query tree may significantly differ from the original one due to expansions and other transformations.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>
<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">SET</span><span class="w"> </span><span class="n">profiling</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>

<span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">forum</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;@title way* @content hey&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="k">SHOW</span><span class="w"> </span><span class="n">PLAN</span><span class="p">;</span>
</code></pre></div>



<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="o">+</span><span class="c1">--------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">     </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">711651</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">04</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="o">+</span><span class="c1">------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="k">Variable</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">Value</span><span class="w">                                                                                                                                                                                                                                                                                                                                                                                                                   </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">transformed_tree</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">AND</span><span class="p">(</span>
<span class="w">  </span><span class="k">OR</span><span class="p">(</span>
<span class="w">    </span><span class="k">OR</span><span class="p">(</span>
<span class="w">      </span><span class="k">AND</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="n">title</span><span class="p">),</span><span class="w"> </span><span class="n">KEYWORD</span><span class="p">(</span><span class="n">wayne</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">expanded</span><span class="p">)),</span>
<span class="w">      </span><span class="k">OR</span><span class="p">(</span>
<span class="w">        </span><span class="k">AND</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="n">title</span><span class="p">),</span><span class="w"> </span><span class="n">KEYWORD</span><span class="p">(</span><span class="n">ways</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">expanded</span><span class="p">)),</span>
<span class="w">        </span><span class="k">AND</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="n">title</span><span class="p">),</span><span class="w"> </span><span class="n">KEYWORD</span><span class="p">(</span><span class="n">wayyy</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">expanded</span><span class="p">)))),</span>
<span class="w">    </span><span class="k">AND</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="n">title</span><span class="p">),</span><span class="w"> </span><span class="n">KEYWORD</span><span class="p">(</span><span class="n">way</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">expanded</span><span class="p">)),</span>
<span class="w">    </span><span class="k">OR</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="n">title</span><span class="p">),</span><span class="w"> </span><span class="n">KEYWORD</span><span class="p">(</span><span class="n">way</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">expanded</span><span class="p">))),</span>
<span class="w">  </span><span class="k">AND</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="n">content</span><span class="p">),</span><span class="w"> </span><span class="n">KEYWORD</span><span class="p">(</span><span class="n">hey</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">2</span><span class="p">)))</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;forum&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;query_string&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;@title way* @content hey&quot;</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;excludes&quot;</span><span class="p">:[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;profile&quot;</span><span class="p">:</span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="mi">33</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="mi">105</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">[</span>
<span class="w">       </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="s2">&quot;711651&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="mi">2539</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;_source&quot;</span><span class="p">:{}</span>
<span class="w">       </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;profile&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;query&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;AND&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="s2">&quot;AND( OR( OR( AND(fields=(title), KEYWORD(wayne, querypos=1, expanded)),  OR( AND(fields=(title), KEYWORD(ways, querypos=1, expanded)),  AND(fields=(title), KEYWORD(wayyy, querypos=1, expanded)))),  AND(fields=(title), KEYWORD(way, querypos=1, expanded)),  OR(fields=(title), KEYWORD(way*, querypos=1, expanded))),  AND(fields=(content), KEYWORD(hey, querypos=2)))&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;children&quot;</span><span class="p">:</span>
<span class="w">      </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;OR&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="s2">&quot;OR( OR( AND(fields=(title), KEYWORD(wayne, querypos=1, expanded)),  OR( AND(fields=(title), KEYWORD(ways, querypos=1, expanded)),  AND(fields=(title), KEYWORD(wayyy, querypos=1, expanded)))),  AND(fields=(title), KEYWORD(way, querypos=1, expanded)),  OR(fields=(title), KEYWORD(way*, querypos=1, expanded)))&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;children&quot;</span><span class="p">:</span>
<span class="w">          </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;OR&quot;</span><span class="p">,</span>
<span class="w">               </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="s2">&quot;OR( AND(fields=(title), KEYWORD(wayne, querypos=1, expanded)),  OR( AND(fields=(title), KEYWORD(ways, querypos=1, expanded)),  AND(fields=(title), KEYWORD(wayyy, querypos=1, expanded))))&quot;</span><span class="p">,</span>
<span class="w">               </span><span class="nt">&quot;children&quot;</span><span class="p">:</span>
<span class="w">               </span><span class="p">[</span>
<span class="w">                 </span><span class="p">{</span>
<span class="w">                   </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;AND&quot;</span><span class="p">,</span>
<span class="w">                   </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="s2">&quot;AND(fields=(title), KEYWORD(wayne, querypos=1, expanded))&quot;</span><span class="p">,</span>
<span class="w">                   </span><span class="nt">&quot;fields&quot;</span><span class="p">:[</span><span class="s2">&quot;title&quot;</span><span class="p">],</span>
<span class="w">                   </span><span class="nt">&quot;max_field_pos&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">                   </span><span class="nt">&quot;children&quot;</span><span class="p">:</span>
<span class="w">                   </span><span class="p">[</span>
<span class="w">                     </span><span class="p">{</span>
<span class="w">                       </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;KEYWORD&quot;</span><span class="p">,</span>
<span class="w">                       </span><span class="nt">&quot;word&quot;</span><span class="p">:</span><span class="s2">&quot;wayne&quot;</span><span class="p">,</span>
<span class="w">                       </span><span class="nt">&quot;querypos&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">                       </span><span class="nt">&quot;expanded&quot;</span><span class="p">:</span><span class="kc">true</span>
<span class="w">                     </span><span class="p">}</span>
<span class="w">                   </span><span class="p">]</span>
<span class="w">                 </span><span class="p">},</span>
<span class="w">                 </span><span class="p">{</span>
<span class="w">                   </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;OR&quot;</span><span class="p">,</span>
<span class="w">                   </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="s2">&quot;OR( AND(fields=(title), KEYWORD(ways, querypos=1, expanded)),  AND(fields=(title), KEYWORD(wayyy, querypos=1, expanded)))&quot;</span><span class="p">,</span>
<span class="w">                   </span><span class="nt">&quot;children&quot;</span><span class="p">:</span>
<span class="w">                   </span><span class="p">[</span>
<span class="w">                     </span><span class="p">{</span>
<span class="w">                       </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;AND&quot;</span><span class="p">,</span>
<span class="w">                       </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="s2">&quot;AND(fields=(title), KEYWORD(ways, querypos=1, expanded))&quot;</span><span class="p">,</span>
<span class="w">                       </span><span class="nt">&quot;fields&quot;</span><span class="p">:[</span><span class="s2">&quot;title&quot;</span><span class="p">],</span>
<span class="w">                       </span><span class="nt">&quot;max_field_pos&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">                       </span><span class="nt">&quot;children&quot;</span><span class="p">:</span>
<span class="w">                       </span><span class="p">[</span>
<span class="w">                         </span><span class="p">{</span>
<span class="w">                           </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;KEYWORD&quot;</span><span class="p">,</span>
<span class="w">                           </span><span class="nt">&quot;word&quot;</span><span class="p">:</span><span class="s2">&quot;ways&quot;</span><span class="p">,</span>
<span class="w">                           </span><span class="nt">&quot;querypos&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">                           </span><span class="nt">&quot;expanded&quot;</span><span class="p">:</span><span class="kc">true</span>
<span class="w">                         </span><span class="p">}</span>
<span class="w">                       </span><span class="p">]</span>
<span class="w">                     </span><span class="p">},</span>
<span class="w">                     </span><span class="p">{</span>
<span class="w">                       </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;AND&quot;</span><span class="p">,</span>
<span class="w">                       </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="s2">&quot;AND(fields=(title), KEYWORD(wayyy, querypos=1, expanded))&quot;</span><span class="p">,</span>
<span class="w">                       </span><span class="nt">&quot;fields&quot;</span><span class="p">:[</span><span class="s2">&quot;title&quot;</span><span class="p">],</span>
<span class="w">                       </span><span class="nt">&quot;max_field_pos&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">                       </span><span class="nt">&quot;children&quot;</span><span class="p">:</span>
<span class="w">                       </span><span class="p">[</span>
<span class="w">                         </span><span class="p">{</span>
<span class="w">                           </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;KEYWORD&quot;</span><span class="p">,</span>
<span class="w">                           </span><span class="nt">&quot;word&quot;</span><span class="p">:</span><span class="s2">&quot;wayyy&quot;</span><span class="p">,</span>
<span class="w">                           </span><span class="nt">&quot;querypos&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">                           </span><span class="nt">&quot;expanded&quot;</span><span class="p">:</span><span class="kc">true</span>
<span class="w">                         </span><span class="p">}</span>
<span class="w">                       </span><span class="p">]</span>
<span class="w">                     </span><span class="p">}</span>
<span class="w">                   </span><span class="p">]</span>
<span class="w">                 </span><span class="p">}</span>
<span class="w">               </span><span class="p">]</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;AND&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="s2">&quot;AND(fields=(title), KEYWORD(way, querypos=1, expanded))&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;fields&quot;</span><span class="p">:[</span><span class="s2">&quot;title&quot;</span><span class="p">],</span>
<span class="w">              </span><span class="nt">&quot;max_field_pos&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;children&quot;</span><span class="p">:</span>
<span class="w">              </span><span class="p">[</span>
<span class="w">                 </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;KEYWORD&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;word&quot;</span><span class="p">:</span><span class="s2">&quot;way&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;querypos&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;expanded&quot;</span><span class="p">:</span><span class="kc">true</span>
<span class="w">                 </span><span class="p">}</span>
<span class="w">              </span><span class="p">]</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;OR&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="s2">&quot;OR(fields=(title), KEYWORD(way*, querypos=1, expanded))&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;fields&quot;</span><span class="p">:[</span><span class="s2">&quot;title&quot;</span><span class="p">],</span>
<span class="w">              </span><span class="nt">&quot;max_field_pos&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;children&quot;</span><span class="p">:</span>
<span class="w">              </span><span class="p">[</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;KEYWORD&quot;</span><span class="p">,</span>
<span class="w">                  </span><span class="nt">&quot;word&quot;</span><span class="p">:</span><span class="s2">&quot;way*&quot;</span><span class="p">,</span>
<span class="w">                  </span><span class="nt">&quot;querypos&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">                  </span><span class="nt">&quot;expanded&quot;</span><span class="p">:</span><span class="kc">true</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">              </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;AND&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="s2">&quot;AND(fields=(content), KEYWORD(hey, querypos=2))&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;fields&quot;</span><span class="p">:[</span><span class="s2">&quot;content&quot;</span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;max_field_pos&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;children&quot;</span><span class="p">:</span>
<span class="w">          </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;KEYWORD&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;word&quot;</span><span class="p">:</span><span class="s2">&quot;hey&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;querypos&quot;</span><span class="p">:</span><span class="mi">2</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$result = $index-&gt;search(&#39;@title way* @content hey&#39;)-&gt;setSource([&#39;excludes&#39;=&gt;[&#39;*&#39;]])-&gt;setLimit(1)-&gt;profile()-&gt;get();</span>
<span class="x">print_r($result-&gt;getProfile());</span>
</code></pre></div>



<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Array</span>
<span class="x">(</span>
<span class="x">    [query] =&gt; Array</span>
<span class="x">        (</span>
<span class="x">            [type] =&gt; AND</span>
<span class="x">            [description] =&gt; AND( OR( OR( AND(fields=(title), KEYWORD(wayne, querypos=1, expanded)),  OR( AND(fields=(title), KEYWORD(ways, querypos=1, expanded)),  AND(fields=(title), KEYWORD(wayyy, querypos=1, expanded)))),  AND(fields=(title), KEYWORD(way, querypos=1, expanded)),  OR(fields=(title), KEYWORD(way*, querypos=1, expanded))),  AND(fields=(content), KEYWORD(hey, querypos=2)))</span>
<span class="x">            [children] =&gt; Array</span>
<span class="x">                (</span>
<span class="x">                    [0] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [type] =&gt; OR</span>
<span class="x">                            [description] =&gt; OR( OR( AND(fields=(title), KEYWORD(wayne, querypos=1, expanded)),  OR( AND(fields=(title), KEYWORD(ways, querypos=1, expanded)),  AND(fields=(title), KEYWORD(wayyy, querypos=1, expanded)))),  AND(fields=(title), KEYWORD(way, querypos=1, expanded)),  OR(fields=(title), KEYWORD(way*, querypos=1, expanded)))</span>
<span class="x">                            [children] =&gt; Array</span>
<span class="x">                                (</span>
<span class="x">                                    [0] =&gt; Array</span>
<span class="x">                                        (</span>
<span class="x">                                            [type] =&gt; OR</span>
<span class="x">                                            [description] =&gt; OR( AND(fields=(title), KEYWORD(wayne, querypos=1, expanded)),  OR( AND(fields=(title), KEYWORD(ways, querypos=1, expanded)),  AND(fields=(title), KEYWORD(wayyy, querypos=1, expanded))))</span>
<span class="x">                                            [children] =&gt; Array</span>
<span class="x">                                                (</span>
<span class="x">                                                    [0] =&gt; Array</span>
<span class="x">                                                        (</span>
<span class="x">                                                            [type] =&gt; AND</span>
<span class="x">                                                            [description] =&gt; AND(fields=(title), KEYWORD(wayne, querypos=1, expanded))</span>
<span class="x">                                                            [fields] =&gt; Array</span>
<span class="x">                                                                (</span>
<span class="x">                                                                    [0] =&gt; title</span>
<span class="x">                                                                )</span>
<span class="x">                                                            [max_field_pos] =&gt; 0</span>
<span class="x">                                                            [children] =&gt; Array</span>
<span class="x">                                                                (</span>
<span class="x">                                                                    [0] =&gt; Array</span>
<span class="x">                                                                        (</span>
<span class="x">                                                                            [type] =&gt; KEYWORD</span>
<span class="x">                                                                            [word] =&gt; wayne</span>
<span class="x">                                                                            [querypos] =&gt; 1</span>
<span class="x">                                                                            [expanded] =&gt; 1</span>
<span class="x">                                                                        )</span>
<span class="x">                                                                )</span>
<span class="x">                                                        )</span>
<span class="x">                                                    [1] =&gt; Array</span>
<span class="x">                                                        (</span>
<span class="x">                                                            [type] =&gt; OR</span>
<span class="x">                                                            [description] =&gt; OR( AND(fields=(title), KEYWORD(ways, querypos=1, expanded)),  AND(fields=(title), KEYWORD(wayyy, querypos=1, expanded)))</span>
<span class="x">                                                            [children] =&gt; Array</span>
<span class="x">                                                                (</span>
<span class="x">                                                                    [0] =&gt; Array</span>
<span class="x">                                                                        (</span>
<span class="x">                                                                            [type] =&gt; AND</span>
<span class="x">                                                                            [description] =&gt; AND(fields=(title), KEYWORD(ways, querypos=1, expanded))</span>
<span class="x">                                                                            [fields] =&gt; Array</span>
<span class="x">                                                                                (</span>
<span class="x">                                                                                    [0] =&gt; title</span>
<span class="x">                                                                                )</span>

<span class="x">                                                                            [max_field_pos] =&gt; 0</span>
<span class="x">                                                                            [children] =&gt; Array</span>
<span class="x">                                                                                (</span>
<span class="x">                                                                                    [0] =&gt; Array</span>
<span class="x">                                                                                        (</span>
<span class="x">                                                                                            [type] =&gt; KEYWORD</span>
<span class="x">                                                                                            [word] =&gt; ways</span>
<span class="x">                                                                                            [querypos] =&gt; 1</span>
<span class="x">                                                                                            [expanded] =&gt; 1</span>
<span class="x">                                                                                        )</span>
<span class="x">                                                                                )</span>
<span class="x">                                                                        )</span>
<span class="x">                                                                    [1] =&gt; Array</span>
<span class="x">                                                                        (</span>
<span class="x">                                                                            [type] =&gt; AND</span>
<span class="x">                                                                            [description] =&gt; AND(fields=(title), KEYWORD(wayyy, querypos=1, expanded))</span>
<span class="x">                                                                            [fields] =&gt; Array</span>
<span class="x">                                                                                (</span>
<span class="x">                                                                                    [0] =&gt; title</span>
<span class="x">                                                                                )</span>
<span class="x">                                                                            [max_field_pos] =&gt; 0</span>
<span class="x">                                                                            [children] =&gt; Array</span>
<span class="x">                                                                                (</span>
<span class="x">                                                                                    [0] =&gt; Array</span>
<span class="x">                                                                                        (</span>
<span class="x">                                                                                            [type] =&gt; KEYWORD</span>
<span class="x">                                                                                            [word] =&gt; wayyy</span>
<span class="x">                                                                                            [querypos] =&gt; 1</span>
<span class="x">                                                                                            [expanded] =&gt; 1</span>
<span class="x">                                                                                        )</span>
<span class="x">                                                                                )</span>
<span class="x">                                                                        )</span>
<span class="x">                                                                )</span>
<span class="x">                                                        )</span>
<span class="x">                                                )</span>
<span class="x">                                        )</span>
<span class="x">                                    [1] =&gt; Array</span>
<span class="x">                                        (</span>
<span class="x">                                            [type] =&gt; AND</span>
<span class="x">                                            [description] =&gt; AND(fields=(title), KEYWORD(way, querypos=1, expanded))</span>
<span class="x">                                            [fields] =&gt; Array</span>
<span class="x">                                                (</span>
<span class="x">                                                    [0] =&gt; title</span>
<span class="x">                                                )</span>
<span class="x">                                            [max_field_pos] =&gt; 0</span>
<span class="x">                                            [children] =&gt; Array</span>
<span class="x">                                                (</span>
<span class="x">                                                    [0] =&gt; Array</span>
<span class="x">                                                        (</span>
<span class="x">                                                            [type] =&gt; KEYWORD</span>
<span class="x">                                                            [word] =&gt; way</span>
<span class="x">                                                            [querypos] =&gt; 1</span>
<span class="x">                                                            [expanded] =&gt; 1</span>
<span class="x">                                                        )</span>
<span class="x">                                                )</span>
<span class="x">                                        )</span>
<span class="x">                                    [2] =&gt; Array</span>
<span class="x">                                        (</span>
<span class="x">                                            [type] =&gt; OR</span>
<span class="x">                                            [description] =&gt; OR(fields=(title), KEYWORD(way*, querypos=1, expanded))</span>
<span class="x">                                            [fields] =&gt; Array</span>
<span class="x">                                                (</span>
<span class="x">                                                    [0] =&gt; title</span>
<span class="x">                                                )</span>
<span class="x">                                            [max_field_pos] =&gt; 0</span>
<span class="x">                                            [children] =&gt; Array</span>
<span class="x">                                                (</span>
<span class="x">                                                    [0] =&gt; Array</span>
<span class="x">                                                        (</span>
<span class="x">                                                            [type] =&gt; KEYWORD</span>
<span class="x">                                                            [word] =&gt; way*</span>
<span class="x">                                                            [querypos] =&gt; 1</span>
<span class="x">                                                            [expanded] =&gt; 1</span>
<span class="x">                                                        )</span>
<span class="x">                                                )</span>
<span class="x">                                        )</span>
<span class="x">                                )</span>
<span class="x">                        )</span>
<span class="x">                    [1] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [type] =&gt; AND</span>
<span class="x">                            [description] =&gt; AND(fields=(content), KEYWORD(hey, querypos=2))</span>
<span class="x">                            [fields] =&gt; Array</span>
<span class="x">                                (</span>
<span class="x">                                    [0] =&gt; content</span>
<span class="x">                                )</span>
<span class="x">                            [max_field_pos] =&gt; 0</span>
<span class="x">                            [children] =&gt; Array</span>
<span class="x">                                (</span>
<span class="x">                                    [0] =&gt; Array</span>
<span class="x">                                        (</span>
<span class="x">                                            [type] =&gt; KEYWORD</span>
<span class="x">                                            [word] =&gt; hey</span>
<span class="x">                                            [querypos] =&gt; 2</span>
<span class="x">                                        )</span>
<span class="x">                                )</span>
<span class="x">                        )</span>
<span class="x">                )</span>
<span class="x">        )</span>
<span class="x">)</span>
</code></pre></div>




<!-- intro -->

</div>

<div class='xcodeblock-item'>
Python
<!-- request Python -->


<div class="codehilite"><pre><span></span><code><span class="n">searchApi</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;forum&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="p">:{</span><span class="s2">&quot;query_string&quot;</span><span class="p">:</span><span class="s2">&quot;@title way* @content hey&quot;</span><span class="p">},</span><span class="s2">&quot;_source&quot;</span><span class="p">:{</span><span class="s2">&quot;excludes&quot;</span><span class="p">:[</span><span class="s2">&quot;*&quot;</span><span class="p">]},</span><span class="s2">&quot;limit&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;profile&quot;</span><span class="p">:</span><span class="n">true</span><span class="p">})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;2811025403043381551&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">2643</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{}}],</span>
          <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;children&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;children&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;expanded&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                                                      <span class="sa">u</span><span class="s1">&#39;querypos&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                                      <span class="sa">u</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;KEYWORD&#39;</span><span class="p">,</span>
                                                      <span class="sa">u</span><span class="s1">&#39;word&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;way*&#39;</span><span class="p">}],</span>
                                       <span class="sa">u</span><span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;AND(fields=(title), KEYWORD(way*, querypos=1, expanded))&#39;</span><span class="p">,</span>
                                       <span class="sa">u</span><span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">],</span>
                                       <span class="sa">u</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;AND&#39;</span><span class="p">},</span>
                                      <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;children&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;querypos&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                                                      <span class="sa">u</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;KEYWORD&#39;</span><span class="p">,</span>
                                                      <span class="sa">u</span><span class="s1">&#39;word&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;hey&#39;</span><span class="p">}],</span>
                                       <span class="sa">u</span><span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;AND(fields=(content), KEYWORD(hey, querypos=2))&#39;</span><span class="p">,</span>
                                       <span class="sa">u</span><span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">],</span>
                                       <span class="sa">u</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;AND&#39;</span><span class="p">}],</span>
                        <span class="sa">u</span><span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;AND( AND(fields=(title), KEYWORD(way*, querypos=1, expanded)),  AND(fields=(content), KEYWORD(hey, querypos=2)))&#39;</span><span class="p">,</span>
                        <span class="sa">u</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;AND&#39;</span><span class="p">}},</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
javascript
<!-- request javascript -->


<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="s2">&quot;forum&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;query_string&quot;</span><span class="o">:</span><span class="s2">&quot;@title way* @content hey&quot;</span><span class="p">},</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;excludes&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]},</span><span class="s2">&quot;limit&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;profile&quot;</span><span class="o">:</span><span class="kc">true</span><span class="p">});</span>
</code></pre></div>


<!-- response javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;2811025403043381551&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">2643</span><span class="p">,</span>
<span class="w">                    </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{}}],</span>
<span class="w">          </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">},</span>
<span class="w"> </span><span class="s2">&quot;profile&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;children&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="s2">&quot;children&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="s2">&quot;expanded&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">True</span><span class="p">,</span>
<span class="w">                                                      </span><span class="s2">&quot;querypos&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">                                                      </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;KEYWORD&quot;</span><span class="p">,</span>
<span class="w">                                                      </span><span class="s2">&quot;word&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;way*&quot;</span><span class="p">}],</span>
<span class="w">                                       </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AND(fields=(title), KEYWORD(way*, querypos=1, expanded))&quot;</span><span class="p">,</span>
<span class="w">                                       </span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">],</span>
<span class="w">                                       </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AND&quot;</span><span class="p">},</span>
<span class="w">                                      </span><span class="p">{</span><span class="s2">&quot;children&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="s2">&quot;querypos&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<span class="w">                                                      </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;KEYWORD&quot;</span><span class="p">,</span>
<span class="w">                                                      </span><span class="s2">&quot;word&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;hey&quot;</span><span class="p">}],</span>
<span class="w">                                       </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AND(fields=(content), KEYWORD(hey, querypos=2))&quot;</span><span class="p">,</span>
<span class="w">                                       </span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">],</span>
<span class="w">                                       </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AND&quot;</span><span class="p">}],</span>
<span class="w">                        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AND( AND(fields=(title), KEYWORD(way*, querypos=1, expanded)),  AND(fields=(content), KEYWORD(hey, querypos=2)))&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AND&quot;</span><span class="p">}},</span>
<span class="w"> </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">False</span><span class="p">,</span>
<span class="w"> </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
java
<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">query</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;query_string&quot;</span><span class="p">,</span><span class="s">&quot;@title way* @content hey&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">();</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;forum&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setProfile</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setLimit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setSort</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">add</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">);</span>
<span class="p">}});</span>
<span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">took</span><span class="p">:</span><span class="w"> </span><span class="mi">18</span>
<span class="w">    </span><span class="n">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">total</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">2811025403043381551</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">2643</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{}}</span><span class="o">]</span>
<span class="w">        </span><span class="n">aggregations</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">profile</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="n">type</span><span class="o">=</span><span class="n">AND</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="o">=</span><span class="n">AND</span><span class="p">(</span><span class="w"> </span><span class="n">AND</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="n">title</span><span class="p">),</span><span class="w"> </span><span class="n">KEYWORD</span><span class="p">(</span><span class="n">way</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">expanded</span><span class="p">)),</span><span class="w">  </span><span class="n">AND</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="n">content</span><span class="p">),</span><span class="w"> </span><span class="n">KEYWORD</span><span class="p">(</span><span class="n">hey</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">2</span><span class="p">))),</span><span class="w"> </span><span class="n">children</span><span class="o">=[</span><span class="p">{</span><span class="n">type</span><span class="o">=</span><span class="n">AND</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="o">=</span><span class="n">AND</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="n">title</span><span class="p">),</span><span class="w"> </span><span class="n">KEYWORD</span><span class="p">(</span><span class="n">way</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">expanded</span><span class="p">)),</span><span class="w"> </span><span class="n">fields</span><span class="o">=[</span><span class="n">title</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">children</span><span class="o">=[</span><span class="p">{</span><span class="n">type</span><span class="o">=</span><span class="n">KEYWORD</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="o">=</span><span class="n">way</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">expanded</span><span class="o">=</span><span class="kc">true</span><span class="p">}</span><span class="o">]</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">type</span><span class="o">=</span><span class="n">AND</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="o">=</span><span class="n">AND</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="n">content</span><span class="p">),</span><span class="w"> </span><span class="n">KEYWORD</span><span class="p">(</span><span class="n">hey</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span><span class="w"> </span><span class="n">fields</span><span class="o">=[</span><span class="n">content</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">children</span><span class="o">=[</span><span class="p">{</span><span class="n">type</span><span class="o">=</span><span class="n">KEYWORD</span><span class="p">,</span><span class="w"> </span><span class="n">word</span><span class="o">=</span><span class="n">hey</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">2</span><span class="p">}</span><span class="o">]</span><span class="p">}</span><span class="o">]</span><span class="p">}}</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
C#
<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="n">object</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">new</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">query_string</span><span class="o">=</span><span class="s2">&quot;@title way* @content hey&quot;</span><span class="w"> </span><span class="p">};</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;forum&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Profile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">true</span><span class="p">;</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="w"> </span><span class="p">};</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="o">.</span><span class="n">Search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="n">SearchResponse</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="nl">took</span><span class="p">:</span><span class="w"> </span><span class="mi">18</span>
<span class="w">    </span><span class="nl">timedOut</span><span class="p">:</span><span class="w"> </span><span class="k">false</span>
<span class="w">    </span><span class="nl">hits</span><span class="p">:</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">SearchResponseHits</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="nl">total</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="nl">hits</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">{_id=2811025403043381551, _score=2643, _source={}}</span><span class="o">]</span>
<span class="w">        </span><span class="nl">aggregations</span><span class="p">:</span><span class="w"> </span><span class="k">null</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">    </span><span class="nl">profile</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">query</span><span class="o">=</span><span class="err">{</span><span class="n">type</span><span class="o">=</span><span class="ow">AND</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="o">=</span><span class="ow">AND</span><span class="p">(</span><span class="w"> </span><span class="ow">AND</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="n">title</span><span class="p">),</span><span class="w"> </span><span class="n">KEYWORD</span><span class="p">(</span><span class="n">way</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">expanded</span><span class="p">)),</span><span class="w">  </span><span class="ow">AND</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="n">content</span><span class="p">),</span><span class="w"> </span><span class="n">KEYWORD</span><span class="p">(</span><span class="n">hey</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">2</span><span class="p">))),</span><span class="w"> </span><span class="n">children</span><span class="o">=[</span><span class="n">{type=AND, description=AND(fields=(title), KEYWORD(way*, querypos=1, expanded)), fields=[title</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">children</span><span class="o">=[</span><span class="n">{type=KEYWORD, word=way*, querypos=1, expanded=true}</span><span class="o">]</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="n">type</span><span class="o">=</span><span class="ow">AND</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="o">=</span><span class="ow">AND</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="n">content</span><span class="p">),</span><span class="w"> </span><span class="n">KEYWORD</span><span class="p">(</span><span class="n">hey</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span><span class="w"> </span><span class="n">fields</span><span class="o">=[</span><span class="n">content</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">children</span><span class="o">=[</span><span class="n">{type=KEYWORD, word=hey, querypos=2}</span><span class="o">]</span><span class="err">}]}}</span>
<span class="err">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
TypeScript
<!-- request TypeScript -->


<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">query_string</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;@content 1&#39;</span><span class="p">},</span>
<span class="w">  </span><span class="nx">_source</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">excludes</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="nx">limit</span><span class="o">:</span><span class="kt">1</span><span class="p">,</span>
<span class="w">  </span><span class="nx">profile</span><span class="err">&quot;</span><span class="o">:</span><span class="kc">true</span>
<span class="p">});</span>
</code></pre></div>


<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span>
<span class="w">        </span><span class="p">}],</span>
<span class="w">        </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;profile&quot;</span><span class="o">:</span><span class="w"> </span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;children&quot;</span><span class="o">:</span><span class="w"> </span>
<span class="w">            </span><span class="p">[{</span>
<span class="w">                </span><span class="s2">&quot;children&quot;</span><span class="o">:</span><span class="w"> </span>
<span class="w">                </span><span class="p">[{</span>
<span class="w">                    </span><span class="s2">&quot;expanded&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">True</span><span class="p">,</span>
<span class="w">                    </span><span class="s2">&quot;querypos&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">                    </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;KEYWORD&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s2">&quot;word&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1*&quot;</span>
<span class="w">                </span><span class="p">}],</span>
<span class="w">                </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AND(fields=(content), KEYWORD(1*, querypos=1, expanded))&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">],</span>
<span class="w">                </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AND&quot;</span>
<span class="w">            </span><span class="p">}],</span>
<span class="w">            </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AND(fields=(content), KEYWORD(1*, querypos=1))&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AND&quot;</span>
<span class="w">        </span><span class="p">}},</span>
<span class="w">    </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">False</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
Go
<!-- request Go -->


<div class="codehilite"><pre><span></span><code><span class="nx">searchRequest</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoresearch</span><span class="p">.</span><span class="nx">NewSearchRequest</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;query_string&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1*&quot;</span><span class="p">}</span>
<span class="nx">source</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;excludes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;*&quot;</span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetSource</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span>
<span class="nx">searchReq</span><span class="p">.</span><span class="nx">SetLimit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nx">searchReq</span><span class="p">.</span><span class="nx">SetProfile</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">SearchRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">searchRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>


<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="w">        </span><span class="p">}],</span>
<span class="w">        </span><span class="s">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s">&quot;profile&quot;</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span>
<span class="w">            </span><span class="p">[{</span>
<span class="w">                </span><span class="s">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span>
<span class="w">                </span><span class="p">[{</span>
<span class="w">                    </span><span class="s">&quot;expanded&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">True</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;querypos&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;KEYWORD&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;word&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1*&quot;</span>
<span class="w">                </span><span class="p">}],</span>
<span class="w">                </span><span class="s">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;AND(fields=(content), KEYWORD(1*, querypos=1, expanded))&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;content&quot;</span><span class="p">],</span>
<span class="w">                </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;AND&quot;</span>
<span class="w">            </span><span class="p">}],</span>
<span class="w">            </span><span class="s">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;AND(fields=(content), KEYWORD(1*, querypos=1))&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;AND&quot;</span>
<span class="w">        </span><span class="p">}},</span>
<span class="w">    </span><span class="s">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">False</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<h2 id="profiling-without-running-a-query">Profiling without running a query</h2>
<!-- example Explain_query -->
<p>The SQL statement <code>EXPLAIN QUERY</code> enables the display of the execution tree for a given full-text query without performing an actual search query on the table.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">EXPLAIN</span><span class="w"> </span><span class="n">QUERY</span><span class="w"> </span><span class="n">index_base</span><span class="w"> </span><span class="s1">&#39;@title running @body dog&#39;</span><span class="err">\</span><span class="k">G</span>
</code></pre></div>


<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="w"> </span><span class="k">EXPLAIN</span><span class="w"> </span><span class="n">QUERY</span><span class="w"> </span><span class="n">index_base</span><span class="w"> </span><span class="s1">&#39;@title running @body dog&#39;</span><span class="err">\</span><span class="k">G</span>

<span class="o">***************************</span><span class="w"> </span><span class="mi">1</span><span class="err">\</span><span class="p">.</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="o">***************************</span>
<span class="k">Variable</span><span class="p">:</span><span class="w"> </span><span class="n">transformed_tree</span>
<span class="w">   </span><span class="n">Value</span><span class="p">:</span><span class="w"> </span><span class="k">AND</span><span class="p">(</span>
<span class="w">      </span><span class="k">OR</span><span class="p">(</span>
<span class="w">            </span><span class="k">AND</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="n">title</span><span class="p">),</span><span class="w"> </span><span class="n">KEYWORD</span><span class="p">(</span><span class="n">run</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">morphed</span><span class="p">)),</span>
<span class="w">            </span><span class="k">AND</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="n">title</span><span class="p">),</span><span class="w"> </span><span class="n">KEYWORD</span><span class="p">(</span><span class="n">running</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">morphed</span><span class="p">))))</span>
<span class="w">  </span><span class="k">AND</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="n">body</span><span class="p">),</span><span class="w"> </span><span class="n">KEYWORD</span><span class="p">(</span><span class="n">dog</span><span class="p">,</span><span class="w"> </span><span class="n">querypos</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">morphed</span><span class="p">)))</span>
</code></pre></div>


<!-- end -->

</div>

</div>

<!-- example Explain_query_dot -->
<p><code>EXPLAIN QUERY ... option format=dot</code> allows displaying the execution tree of a provided full-text query in a hierarchical format suitable for visualization by existing tools, such as https://dreampuf.github.io/GraphvizOnline:</p>
<p><img alt="EXPLAIN QUERY graphviz example" src="graphviz.png" /></p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">EXPLAIN</span><span class="w"> </span><span class="n">QUERY</span><span class="w"> </span><span class="n">tbl</span><span class="w"> </span><span class="s1">&#39;i me&#39;</span><span class="w"> </span><span class="k">option</span><span class="w"> </span><span class="n">format</span><span class="o">=</span><span class="n">dot</span><span class="err">\</span><span class="k">G</span>
</code></pre></div>


<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">EXPLAIN</span><span class="w"> </span><span class="n">QUERY</span><span class="w"> </span><span class="n">tbl</span><span class="w"> </span><span class="s1">&#39;i me&#39;</span><span class="w"> </span><span class="k">option</span><span class="w"> </span><span class="n">format</span><span class="o">=</span><span class="n">dot</span><span class="err">\</span><span class="k">G</span>

<span class="o">***************************</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="o">***************************</span>
<span class="k">Variable</span><span class="p">:</span><span class="w"> </span><span class="n">transformed_tree</span>
<span class="w">   </span><span class="n">Value</span><span class="p">:</span><span class="w"> </span><span class="n">digraph</span><span class="w"> </span><span class="ss">&quot;transformed_tree&quot;</span>
<span class="err">{</span>

<span class="mi">0</span><span class="w"> </span><span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">record</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span><span class="n">bgcolor</span><span class="o">=</span><span class="ss">&quot;lightgrey&quot;</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="ss">&quot;AND&quot;</span><span class="p">]</span>
<span class="mi">0</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mi">1</span>
<span class="mi">1</span><span class="w"> </span><span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">record</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span><span class="n">bgcolor</span><span class="o">=</span><span class="ss">&quot;lightgrey&quot;</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="ss">&quot;AND&quot;</span><span class="p">]</span>
<span class="mi">1</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mi">2</span>
<span class="mi">2</span><span class="w"> </span><span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">record</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="ss">&quot;i | { querypos=1 }&quot;</span><span class="p">]</span>
<span class="mi">0</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mi">3</span>
<span class="mi">3</span><span class="w"> </span><span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">record</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="n">filled</span><span class="p">,</span><span class="n">bgcolor</span><span class="o">=</span><span class="ss">&quot;lightgrey&quot;</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="ss">&quot;AND&quot;</span><span class="p">]</span>
<span class="mi">3</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mi">4</span>
<span class="mi">4</span><span class="w"> </span><span class="p">[</span><span class="n">shape</span><span class="o">=</span><span class="n">record</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="ss">&quot;me | { querypos=2 }&quot;</span><span class="p">]</span>
<span class="err">}</span>
</code></pre></div>


<!-- end -->

</div>

</div>

<h2 id="viewing-the-match-factors-values">Viewing the match factors values</h2>
<!-- example factors -->
<p>When using an expression ranker, it's possible to reveal the values of the calculated factors with the <a href="15-functions.html#packedfactors">PACKEDFACTORS()</a> function.</p>
<p>The function returns:</p>
<ul>
<li>The values of document-level factors (such as bm25, field_mask, doc_word_count)</li>
<li>A list of each field that generated a hit (including lcs, hit_count, word_count, sum_idf, min_hit_pos, etc.)</li>
<li>A list of each keyword from the query along with their tf and idf values</li>
</ul>
<p>These values can be utilized to understand why certain documents receive lower or higher scores in a search or to refine the existing ranking expression.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>
Example:

<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">PACKEDFACTORS</span><span class="p">()</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">test1</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;test one&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">OPTION</span><span class="w"> </span><span class="n">ranker</span><span class="o">=</span><span class="n">expr</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span><span class="err">\</span><span class="k">G</span>
</code></pre></div>



<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="w">             </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="n">packedfactors</span><span class="p">():</span><span class="w"> </span><span class="n">bm25</span><span class="o">=</span><span class="mi">569</span><span class="p">,</span><span class="w"> </span><span class="n">bm25a</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">617197</span><span class="p">,</span><span class="w"> </span><span class="n">field_mask</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">doc_word_count</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="n">field1</span><span class="o">=</span><span class="p">(</span><span class="n">lcs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">hit_count</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">word_count</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">tf_idf</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">152356</span><span class="p">,</span>
<span class="w">        </span><span class="n">min_idf</span><span class="o">=-</span><span class="mi">0</span><span class="p">.</span><span class="mi">062982</span><span class="p">,</span><span class="w"> </span><span class="n">max_idf</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">215338</span><span class="p">,</span><span class="w"> </span><span class="n">sum_idf</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">152356</span><span class="p">,</span><span class="w"> </span><span class="n">min_hit_pos</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<span class="w">        </span><span class="n">min_best_span_pos</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">exact_hit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">max_window_hits</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">min_gaps</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="w">        </span><span class="n">exact_order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">lccs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">wlccs</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">215338</span><span class="p">,</span><span class="w"> </span><span class="n">atc</span><span class="o">=-</span><span class="mi">0</span><span class="p">.</span><span class="mi">003974</span><span class="p">),</span>
<span class="w">    </span><span class="n">word0</span><span class="o">=</span><span class="p">(</span><span class="n">tf</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">idf</span><span class="o">=-</span><span class="mi">0</span><span class="p">.</span><span class="mi">062982</span><span class="p">),</span>
<span class="w">    </span><span class="n">word1</span><span class="o">=</span><span class="p">(</span><span class="n">tf</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">idf</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">215338</span><span class="p">)</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>


<!-- end -->

</div>

</div>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.02.05-boolean_optimization">
        <header>
            <a class="chapter-link" href="#toc-13.02.05-boolean_optimization"> ¶ 13.2.5</a>

            
            <h1 id="boolean-optimization">Boolean optimization</h1>
            
        </header>

        
        
<p>Queries can be automatically optimized if <code>OPTION boolean_simplify=1</code> is specified. Some transformations performed by this optimization include:</p>
<ul>
<li>Excess brackets: <code>((A | B) | C)</code> becomes <code>(A | B | C)</code>; <code>((A B) C)</code> becomes <code>(A B C)</code></li>
<li>Excess AND NOT: <code>((A !N1) !N2)</code> becomes <code>(A !(N1 | N2))</code></li>
<li>Common NOT: <code>((A !N) | (B !N))</code> becomes <code>((A | B) !N)</code></li>
<li>Common Compound NOT: <code>((A !(N AA)) | (B !(N BB)))</code> becomes <code>(((A | B) !N) | (A !AA) | (B !BB))</code> if the cost of evaluating N is greater than the sum of evaluating A and B</li>
<li>Common subterm: <code>((A (N | AA)) | (B (N | BB)))</code> becomes <code>(((A | B) N) | (A AA) | (B BB))</code> if the cost of evaluating N is greater than the sum of evaluating A and B</li>
<li>Common keywords: <code>(A | "A B"~N)</code> becomes <code>A</code>; <code>("A B" | "A B C")</code> becomes <code>"A B"</code>; <code>("A B"~N | "A B C"~N)</code> becomes <code>("A B"~N)</code></li>
<li>Common phrase: <code>("X A B" | "Y A B")</code> becomes <code>("("X"|"Y") A B")</code></li>
<li>Common AND NOT: <code>((A !X) | (A !Y) | (A !Z))</code> becomes <code>(A !(X Y Z))</code></li>
<li>Common OR NOT: <code>((A !(N | N1)) | (B !(N | N2)))</code> becomes <code>(( (A !N1) | (B !N2) ) !N)</code><br />
Note that optimizing queries consumes CPU time, so for simple queries or hand-optimized queries, you'll achieve better results with the default <code>boolean_simplify=0</code> value. Simplifications often benefit complex queries or algorithmically generated queries.</li>
</ul>
<p>Queries like <code>-dog</code>, which could potentially include all documents from the collection are not allowed by default. To allow them, you must specify <code>not_terms_only_allowed=1</code> either as a <a href="20-server_settings.html#not_terms_only_allowed">global setting</a> or as a <a href="20-server_settings.html#not_terms_only_allowed">search option</a>.</p>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.03-search_results">
        <header>
            <a class="chapter-link" href="#toc-13.03-search_results"> ¶ 13.3</a>

            
            <h1 id="search-results">Search results</h1>
            
        </header>

        
        
<h2 id="sql">SQL</h2>
<!-- example sql1 -->
<p>When you run a query via SQL over the MySQL protocol, you receive the requested columns as a result or an empty result set if nothing is found.</p>
<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tbl</span><span class="p">;</span>
</code></pre></div>

<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">------+------+--------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">age</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">name</span><span class="w">   </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------+--------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">25</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">joe</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">25</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">mary</span><span class="w">   </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">33</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">albert</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------+--------+</span>
<span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<!-- example sql2 -->
<p>Additionally, you can use the <a href="../19-node_info_and_management.html#toc-19.02-show_meta">SHOW META</a> call to see extra meta-information about the latest query.</p>
<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="n">story_author</span><span class="p">,</span><span class="n">comment_author</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">hn_small</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">story_author</span><span class="o">=</span><span class="s1">&#39;joe&#39;</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="k">SHOW</span><span class="w"> </span><span class="n">META</span><span class="p">;</span>
</code></pre></div>

<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">++</span><span class="c1">--------+--------------+----------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">story_author</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">comment_author</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------+--------------+----------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">152841</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">joe</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">SwellJoe</span><span class="w">       </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">161323</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">joe</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">samb</span><span class="w">           </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">163735</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">joe</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">jsjenkins168</span><span class="w">   </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------+--------------+----------------+</span>
<span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="o">+</span><span class="c1">----------------+-------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Variable_name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Value</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------------+-------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">total</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="w">     </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">total_found</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">20</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">total_relation</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">gte</span><span class="w">   </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="k">time</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">010</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------------+-------+</span>
<span class="mi">4</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<!-- example sql3 -->
<p>In some cases, such as when performing a <a href="../13-searching.html#toc-13.14-faceted_search">faceted search</a>, you may receive multiple result sets as a response to your SQL query.</p>
<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tbl</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;joe&#39;</span><span class="p">)</span><span class="w"> </span><span class="n">FACET</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>
</code></pre></div>

<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">age</span><span class="w">  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">25</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="o">+</span><span class="c1">------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">age</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+----------+</span>
<span class="o">|</span><span class="w">   </span><span class="mi">25</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+----------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<!-- example sql4 -->
<p>In case of a warning, the result set will include a warning flag, and you can see the warning using <a href="../19-node_info_and_management.html#toc-19.07-show_warnings">SHOW WARNINGS</a>.</p>
<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">tbl</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">match</span><span class="p">(</span><span class="s1">&#39;&quot;joe&quot;/3&#39;</span><span class="p">);</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="n">warnings</span><span class="p">;</span>
</code></pre></div>

<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">------+------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">age</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------+------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">25</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">joe</span><span class="w">  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------+------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">warning</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="o">+</span><span class="c1">---------+------+--------------------------------------------------------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="k">Level</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Code</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Message</span><span class="w">                                                                                    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------+------+--------------------------------------------------------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">warning</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">quorum</span><span class="w"> </span><span class="n">threshold</span><span class="w"> </span><span class="n">too</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="p">(</span><span class="n">words</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">thresh</span><span class="o">=</span><span class="mi">3</span><span class="p">);</span><span class="w"> </span><span class="n">replacing</span><span class="w"> </span><span class="n">quorum</span><span class="w"> </span><span class="k">operator</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">operator</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------+------+--------------------------------------------------------------------------------------------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<!-- example sql5 -->
<p>If your query fails, you will receive an error:</p>
<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">tbl</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">match</span><span class="p">(</span><span class="s1">&#39;@surname joe&#39;</span><span class="p">);</span>
</code></pre></div>

<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="n">ERROR</span><span class="w"> </span><span class="mi">1064</span><span class="w"> </span><span class="p">(</span><span class="mi">42000</span><span class="p">):</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">idx</span><span class="p">:</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="s1">&#39;surname&#39;</span><span class="w"> </span><span class="k">found</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">schema</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<h2 id="http">HTTP</h2>
<p>Via the HTTP JSON interface, the query result is sent as a JSON document. Example:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;gid&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;gid&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li><code>took</code>: time in milliseconds it took to execute the search</li>
<li><code>timed_out</code>: whether the query timed out or not</li>
<li><code>hits</code>: search results, with the following properties:</li>
<li><code>total</code>: total number of matching documents</li>
<li><code>hits</code>: an array containing matches</li>
</ul>
<p>The query result can also include query profile information. See <a href="../19-node_info_and_management.html#toc-19.09.01-query_profiling">Query profile</a>.</p>
<p>Each match in the <code>hits</code> array has the following properties:</p>
<ul>
<li><code>_id</code>: match id</li>
<li><code>_score</code>: match weight, calculated by the ranker</li>
<li><code>_source</code>: an array containing the attributes of this match</li>
</ul>
<h3 id="source-selection">Source selection</h3>
<p>By default, all attributes are returned in the <code>_source</code> array. You can use the <code>_source</code> property in the request payload to select the fields you want to include in the result set. Example:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="s2">&quot;attr*&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;match_all&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>You can specify the attributes you want to include in the query result as a string (<code>"_source": "attr*"</code>) or as an array of strings (<code>"_source": [ "attr1", "attri*" ]"</code>). Each entry can be an attribute name or a wildcard (<code>*</code>, <code>%</code> and <code>?</code> symbols are supported).</p>
<p>You can also explicitly specify which attributes you want to include and which to exclude from the result set using the <code>includes</code> and <code>excludes</code> properties:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;_source&quot;</span><span class="p">:</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;includes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;attr1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;attri*&quot;</span><span class="w"> </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;excludes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;*desc*&quot;</span><span class="w"> </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p>An empty list of includes is interpreted as "include all attributes," while an empty list of excludes does not match anything. If an attribute matches both the includes and excludes, then the excludes win.</p>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.04-filters">
        <header>
            <a class="chapter-link" href="#toc-13.04-filters"> ¶ 13.4</a>

            
            <h1 id="filters">Filters</h1>
            
        </header>

        
        
<h2 id="where">WHERE</h2>
<p><code>WHERE</code> is an SQL clause that works for both full-text matching and additional filtering. The following operators are available:</p>
<ul>
<li><a href="../13-searching.html#comparison-operators">Comparison operators</a> <code>&lt;, &gt;, &lt;=, &gt;=, =, &lt;&gt;, BETWEEN, IN, IS NULL</code></li>
<li><a href="../13-searching.html#boolean-operators">Boolean operators</a> <code>AND, OR, NOT</code></li>
</ul>
<p><code>MATCH('query')</code> is supported and maps to a <a href="../13-searching.html#toc-13.02.02-operators">full-text query</a>.</p>
<p>The <code>{col_name | expr_alias} [NOT] IN @uservar</code> condition syntax is supported. Refer to the <a href="../20-server_settings.html#set">SET</a> syntax for a description of global user variables.</p>
<h2 id="http-json">HTTP JSON</h2>
<p>If you prefer the HTTP JSON interface, you can also apply filtering. It might seem more complex than SQL, but it is recommended for cases when you need to prepare a query programmatically, such as when a user fills out a form in your application.</p>
<!-- example json1 -->
<p>Here's an example of several filters in a <code>bool</code> query.</p>
<p>This full-text query matches all documents containing <code>product</code> in any field. These documents must have a price greater than or equal to 500 (<code>gte</code>) and less than or equal to 1000 (<code>lte</code>). All of these documents must not have a revision less than 15 (<code>lt</code>).</p>
<!-- request JSON -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;bool&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;must&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;match&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;_all&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;product&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;range&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;gte&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;lte&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;must_not&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;range&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;revision&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;lt&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<h3 id="bool-query">bool query</h3>
<!-- example bool -->
<p>The <code>bool</code> query matches documents based on boolean combinations of other queries and/or filters. Queries and filters must be specified in <code>must</code>, <code>should</code>, or <code>must_not</code> sections and can be <a href="../13-searching.html#nested-bool-query">nested</a>.</p>
<!-- request JSON -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;bool&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;must&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;_all&quot;</span><span class="p">:</span><span class="s2">&quot;keyword&quot;</span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;range&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;revision&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;gte&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<!-- example must_not -->
<h3 id="must">must</h3>
<p>Queries and filters specified in the <code>must</code> section are required to match the documents. If multiple fulltext queries or filters are specified, all of them must match. This is the equivalent of <code>AND</code> queries in SQL. Note that if you want to match against an array (<a href="06-creating_a_table.html#multi-value-integer-%28mva%29">multi-value attribute</a>), you can specify the attribute multiple times. The result will be positive only if all the queried values are found in the array, e.g.:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;must&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span><span class="nt">&quot;equals&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;product_codes&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">}},</span>
<span class="w">  </span><span class="p">{</span><span class="nt">&quot;equals&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;product_codes&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">}}</span>
<span class="p">]</span>
</code></pre></div>

<p>Note also, it may be better in terms of performance to use:</p>
<div class="codehilite"><pre><span></span><code><span class="w">  </span><span class="p">{</span><span class="nt">&quot;in&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;all(product_codes)&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span><span class="w"> </span><span class="p">}}</span>
</code></pre></div>

<p>(see details below).</p>
<h3 id="should">should</h3>
<p>Queries and filters specified in the <code>should</code> section should match the documents. If some queries are specified in <code>must</code> or <code>must_not</code>, <code>should</code> queries are ignored. On the other hand, if there are no queries other than <code>should</code>, then at least one of these queries must match a document for it to match the bool query. This is the equivalent of <code>OR</code> queries. Note, if you want to match against an array (<a href="06-creating_a_table.html#multi-value-integer-%28mva%29">multi-value attribute</a>) you can specify the attribute multiple times, e.g.:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;should&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span><span class="nt">&quot;equals&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;product_codes&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="p">}},</span>
<span class="w">  </span><span class="p">{</span><span class="nt">&quot;equals&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;product_codes&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="p">}}</span>
<span class="p">]</span>
</code></pre></div>

<p>Note also, it may be better in terms of performance to use:</p>
<div class="codehilite"><pre><span></span><code><span class="w">  </span><span class="p">{</span><span class="nt">&quot;in&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;any(product_codes)&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span><span class="w"> </span><span class="p">}}</span>
</code></pre></div>

<p>(see details below).</p>
<h3 id="must_not">must_not</h3>
<p>Queries and filters specified in the <code>must_not</code> section must not match the documents. If several queries are specified under <code>must_not</code>, the document matches if none of them match.</p>
<!-- request JSON -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;t&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;bool&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;should&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;equals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;b&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;equals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;b&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;must&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;equals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;must_not&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;equals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;b&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<h3 id="nested-bool-query">Nested bool query</h3>
<!-- example eq_and_or -->
<p>A bool query can be nested inside another bool so you can make more complex queries. To make a nested boolean query just use another <code>bool</code> instead of <code>must</code>, <code>should</code> or <code>must_not</code>. Here is how this query:</p>
<div class="codehilite"><pre><span></span><code>a = 2 and (a = 10 or b = 0)
</code></pre></div>

<p>should be presented in JSON.</p>
<!-- request JSON -->
<p>a = 2 and (a = 10 or b = 0)</p>
<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;t&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;bool&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;must&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;equals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;bool&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;should&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">              </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;equals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">              </span><span class="p">},</span>
<span class="w">              </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;equals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nt">&quot;b&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">              </span><span class="p">}</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<!-- example complex -->
<p>More complex query:</p>
<div class="codehilite"><pre><span></span><code>(a = 1 and b = 1) or (a = 10 and b = 2) or (b = 0)
</code></pre></div>

<!-- request JSON -->

<p>(a = 1 and b = 1) or (a = 10 and b = 2) or (b = 0)</p>
<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;t&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;bool&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;should&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;bool&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;must&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">              </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;equals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">              </span><span class="p">},</span>
<span class="w">              </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;equals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nt">&quot;b&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">              </span><span class="p">}</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;bool&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;must&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">              </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;equals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">              </span><span class="p">},</span>
<span class="w">              </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;equals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nt">&quot;b&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">              </span><span class="p">}</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;bool&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;must&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">              </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;equals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="nt">&quot;b&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">              </span><span class="p">}</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">          </span><span class="p">}</span>

<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<h3 id="queries-in-sql-format">Queries in SQL format</h3>
<!-- example query_string -->
<p>Queries in SQL format (<code>query_string</code>) can also be used in bool queries.</p>
<!-- request JSON -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;bool&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;must&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;query_string&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;product&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;query_string&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;good&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<h2 id="various-filters">Various filters</h2>
<h3 id="equality-filters">Equality filters</h3>
<!-- example equals -->
<p>Equality filters are the simplest filters that work with integer, float and string attributes.</p>
<!-- request JSON -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;equals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<!-- example equals_any -->
<p>Filter <code>equals</code> can be applied to a <a href="06-creating_a_table.html#multi-value-integer-%28mva%29">multi-value attribute</a> and you can use:</p>
<ul>
<li><code>any()</code> which will be positive if the attribute has at least one value which equals to the queried value;</li>
<li><code>all()</code> which will be positive if the attribute has a single value and it equals to the queried value</li>
</ul>
<!-- request JSON -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;equals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;any(price)&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<h3 id="set-filters">Set filters</h3>
<!-- example set -->
<p>Set filters check if attribute value is equal to any of the values in the specified set.</p>
<p>Set filters support integer, string and multi-value attributes.</p>
<!-- request JSON -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;in&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<!-- example set_any -->
<p>When applied to a <a href="06-creating_a_table.html#multi-value-integer-%28mva%29">multi-value attribute</a> you can use:</p>
<ul>
<li><code>any()</code> (equivalent to no function) which will be positive if there's at least one match between the attribute values and the queried values;</li>
<li><code>all()</code> which will be positive if all the attribute values are in the queried set</li>
</ul>
<!-- request JSON -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;in&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;all(price)&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<h3 id="range-filters">Range filters</h3>
<!-- example range -->
<p>Range filters match documents that have attribute values within a specified range.</p>
<p>Range filters support the following properties:</p>
<ul>
<li><code>gte</code>: greater than or equal to</li>
<li><code>gt</code>: greater than</li>
<li><code>lte</code>: less than or equal to</li>
<li><code>lt</code>: less than</li>
</ul>
<!-- request JSON -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;range&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;gte&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;lte&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<h3 id="geo-distance-filters">Geo distance filters</h3>
<!-- example geo -->
<p><code>geo_distance</code> filters are used to filter the documents that are within a specific distance from a geo location.</p>
<div class='item-select'>
location_anchor
</div>
<p>Specifies the pin location, in degrees. Distances are calculated from this point.</p>
<div class='item-select'>
location_source
</div>
<p>Specifies the attributes that contain latitude and longitude.</p>
<div class='item-select'>
distance_type
</div>
<p>Specifies distance calculation function. Can be either adaptive or haversine. adaptive is faster and more precise, for more details see <code>GEODIST()</code>. Optional, defaults to adaptive.</p>
<div class='item-select'>
distance
</div>
<p>Specifies the maximum distance from the pin locations. All documents within this distance match. The distance can be specified in various units. If no unit is specified, the distance is assumed to be in meters. Here is a list of supported distance units:</p>
<ul>
<li>Meter: <code>m</code> or <code>meters</code></li>
<li>Kilometer: <code>km</code> or <code>kilometers</code></li>
<li>Centimeter: <code>cm</code> or <code>centimeters</code></li>
<li>Millimeter: <code>mm</code> or <code>millimeters</code></li>
<li>Mile: <code>mi</code> or <code>miles</code></li>
<li>Yard: <code>yd</code> or <code>yards</code></li>
<li>Feet: <code>ft</code> or <code>feet</code></li>
<li>Inch: <code>in</code> or <code>inch</code></li>
<li>Nautical mile: <code>NM</code>, <code>nmi</code> or <code>nauticalmiles</code></li>
</ul>
<p><code>location_anchor</code> and <code>location_source</code> properties accept the following latitude/longitude formats:</p>
<ul>
<li>an object with lat and lon keys: <code>{ "lat": "attr_lat", "lon": "attr_lon" }</code></li>
<li>a string of the following structure: <code>"attr_lat, attr_lon"</code></li>
<li>an array with the latitude and longitude in the following order: <code>[attr_lon, attr_lat]</code></li>
</ul>
<p>Latitude and longitude are specified in degrees.</p>
<!-- request Basic example -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;geo_distance&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;location_anchor&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;lat&quot;</span><span class="p">:</span><span class="mi">49</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;lon&quot;</span><span class="p">:</span><span class="mi">15</span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;location_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;attr_lat, attr_lon&quot;</span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;distance_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;adaptive&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;distance&quot;</span><span class="p">:</span><span class="s2">&quot;100 km&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- request Advanced example -->
<p><code>geo_distance</code> can be used as a filter in bool queries along with matches or other attribute filters.</p>
<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;geodemo&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;bool&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;must&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;station&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;equals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;state_code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ENG&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;geo_distance&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;distance_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;adaptive&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;location_anchor&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;lat&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">52.396</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;lon&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">-1.774</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nt">&quot;location_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;latitude_deg,longitude_deg&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;distance&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;10000 m&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.05-expressions">
        <header>
            <a class="chapter-link" href="#toc-13.05-expressions"> ¶ 13.5</a>

            
            <h1 id="expressions-in-search">Expressions in search</h1>
            
        </header>

        
        
<p>Manticore enables the use of arbitrary arithmetic expressions through both SQL and HTTP, incorporating attribute values, internal attributes (document ID and relevance weight), arithmetic operations, several built-in functions, and user-defined functions. Below is the complete reference list for quick access.</p>
<h2 id="arithmetic-operators">Arithmetic operators</h2>
<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="o">/</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="p">,</span><span class="w"> </span><span class="n">DIV</span><span class="p">,</span><span class="w"> </span><span class="k">MOD</span>
</code></pre></div>

<p>Standard arithmetic operators are available. Arithmetic calculations involving these operators can be executed in three different modes:</p>
<ol>
<li>using single-precision, 32-bit IEEE 754 floating point values (default),</li>
<li>using signed 32-bit integers,</li>
<li>using 64-bit signed integers.</li>
</ol>
<p>The expression parser automatically switches to integer mode if no operations result in a floating point value. Otherwise, it uses the default floating point mode. For example, a+b will be computed using 32-bit integers if both arguments are 32-bit integers; or using 64-bit integers if both arguments are integers but one of them is 64-bit; or in floats otherwise. However, <code>a/b</code> or <code>sqrt(a)</code> will always be computed in floats, as these operations return a non-integer result. To avoid this, you can use <code>IDIV(a,b)</code> or a <code>DIV b</code> form. Additionally, <code>a*b</code> will not automatically promote to 64-bit when arguments are 32-bit. To enforce 64-bit results, use <a href="../15-functions.html#bigint">BIGINT()</a>, but note that if non-integer operations are present, BIGINT() will simply be ignored.</p>
<h2 id="comparison-operators">Comparison operators</h2>
<div class="codehilite"><pre><span></span><code><span class="o">&lt;</span><span class="p">,</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;=</span><span class="p">,</span><span class="w"> </span><span class="o">&gt;=</span><span class="p">,</span><span class="w"> </span><span class="o">=</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;&gt;</span>
</code></pre></div>

<p>The comparison operators return 1.0 when the condition is true and 0.0 otherwise. For example, <code>(a=b)+3</code> evaluates to 4 when attribute <code>a</code> is equal to attribute <code>b</code>, and to 3 when <code>a</code> is not. Unlike MySQL, the equality comparisons (i.e., <code>=</code> and <code>&lt;&gt;</code> operators) include a small equality threshold (1e-6 by default). If the difference between the compared values is within the threshold, they are considered equal.</p>
<p>The <code>BETWEEN</code> and <code>IN</code> operators, in the case of multi-value attributes, return true if at least one value matches the condition (similar to <a href="../15-functions.html#any">ANY()</a>). The <code>IN</code> operator does not support JSON attributes. The <code>IS (NOT) NULL</code> operator is supported only for JSON attributes.</p>
<h2 id="boolean-operators">Boolean operators</h2>
<div class="codehilite"><pre><span></span><code><span class="k">AND</span><span class="p">,</span><span class="w"> </span><span class="k">OR</span><span class="p">,</span><span class="w"> </span><span class="k">NOT</span>
</code></pre></div>

<p>Boolean operators (AND, OR, NOT) behave as expected. They are left-associative and have the lowest priority compared to other operators. NOT has higher priority than AND and OR but still less than any other operator. AND and OR share the same priority, so using parentheses is recommended to avoid confusion in complex expressions.</p>
<h2 id="bitwise-operators">Bitwise operators</h2>
<div class="codehilite"><pre><span></span><code><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="o">|</span>
</code></pre></div>

<p>These operators perform bitwise AND and OR respectively. The operands must be of integer types.</p>
<h2 id="functions">Functions:</h2>
<ul>
<li><a href="../15-functions.html#abs">ABS()</a></li>
<li><a href="../15-functions.html#all">ALL()</a></li>
<li><a href="../15-functions.html#any">ANY()</a></li>
<li><a href="../15-functions.html#atan2">ATAN2()</a></li>
<li><a href="../15-functions.html#bigint">BIGINT()</a></li>
<li><a href="../15-functions.html#bitdot">BITDOT()</a></li>
<li><a href="../15-functions.html#bm25f">BM25F()</a></li>
<li><a href="../15-functions.html#ceil">CEIL()</a></li>
<li><a href="../15-functions.html#concat">CONCAT()</a></li>
<li><a href="../15-functions.html#contains">CONTAINS()</a></li>
<li><a href="../15-functions.html#cos">COS()</a></li>
<li><a href="../15-functions.html#crc32">CRC32()</a></li>
<li><a href="../15-functions.html#date_histogram">DATE_HISTOGRAM()</a></li>
<li><a href="../15-functions.html#date_range">DATE_RANGE()</a></li>
<li><a href="../15-functions.html#day">DAY()</a></li>
<li><a href="../15-functions.html#double">DOUBLE()</a></li>
<li><a href="../15-functions.html#exp">EXP()</a></li>
<li><a href="../15-functions.html#fibonacci">FIBONACCI()</a></li>
<li><a href="../15-functions.html#floor">FLOOR()</a></li>
<li><a href="../15-functions.html#geodist">GEODIST()</a></li>
<li><a href="../15-functions.html#geopoly2d">GEOPOLY2D()</a></li>
<li><a href="../15-functions.html#greatest">GREATEST()</a></li>
<li><a href="../15-functions.html#hour">HOUR()</a></li>
<li><a href="../15-functions.html#histogram">HISTOGRAM()</a></li>
<li><a href="../15-functions.html#idiv">IDIV()</a></li>
<li><a href="../15-functions.html#if">IF()</a></li>
<li><a href="../15-functions.html#in">IN()</a></li>
<li><a href="../15-functions.html#indexof">INDEXOF()</a></li>
<li><a href="../15-functions.html#integer">INTEGER()</a></li>
<li><a href="../15-functions.html#interval">INTERVAL()</a></li>
<li><a href="../15-functions.html#last_insert_id">LAST_INSERT_ID()</a></li>
<li><a href="../15-functions.html#least">LEAST()</a></li>
<li><a href="../15-functions.html#length">LENGTH()</a></li>
<li><a href="../15-functions.html#ln">LN()</a></li>
<li><a href="../15-functions.html#log10">LOG10()</a></li>
<li><a href="../15-functions.html#log2">LOG2()</a></li>
<li><a href="../15-functions.html#max">MAX()</a></li>
<li><a href="../15-functions.html#min">MIN()</a></li>
<li><a href="../15-functions.html#minute">MINUTE()</a></li>
<li><a href="../15-functions.html#min_top_sortval">MIN_TOP_SORTVAL()</a></li>
<li><a href="../15-functions.html#min_top_weight">MIN_TOP_WEIGHT()</a></li>
<li><a href="../15-functions.html#month">MONTH()</a></li>
<li><a href="../15-functions.html#now">NOW()</a></li>
<li><a href="../15-functions.html#packedfactors">PACKEDFACTORS()</a></li>
<li><a href="../15-functions.html#poly2d">POLY2D()</a></li>
<li><a href="../15-functions.html#pow">POW()</a></li>
<li><a href="../15-functions.html#rand">RAND()</a></li>
<li><a href="../15-functions.html#range">RANGE()</a></li>
<li><a href="../15-functions.html#regex">REGEX()</a></li>
<li><a href="../15-functions.html#remap">REMAP()</a></li>
<li><a href="../15-functions.html#second">SECOND()</a></li>
<li><a href="../15-functions.html#sin">SIN()</a></li>
<li><a href="../15-functions.html#sint">SINT()</a></li>
<li><a href="../15-functions.html#sqrt">SQRT()</a></li>
<li><a href="../15-functions.html#substring_index">SUBSTRING_INDEX()</a></li>
<li><a href="../15-functions.html#to_string">TO_STRING()</a></li>
<li><a href="../15-functions.html#uint">UINT()</a></li>
<li><a href="../15-functions.html#year">YEAR()</a></li>
<li><a href="../15-functions.html#yearmonth">YEARMONTH()</a></li>
<li><a href="../15-functions.html#yearmonthday">YEARMONTHDAY()</a></li>
<li><a href="../15-functions.html#weight">WEIGHT()</a></li>
</ul>
<h2 id="expressions-in-http-json">Expressions in HTTP JSON</h2>
<p>In the HTTP JSON interface, expressions are supported via <code>script_fields</code> and <code>expressions</code>.</p>
<h3 id="script_fields">script_fields</h3>
<!-- example script_fields -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;match_all&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="nt">&quot;script_fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;add_all&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;script&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;inline&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;( gid * 10 ) | crc32(title)&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;title_len&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;script&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;inline&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;crc32(title)&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>In this example, two expressions are created: <code>add_all</code> and <code>title_len</code>. The first expression calculates <code>( gid * 10 ) | crc32(title)</code> and stores the result in the <code>add_all</code> attribute. The second expression calculates <code>crc32(title)</code> and stores the result in the <code>title_len</code> attribute.</p>
<p>Currently, only <code>inline</code> expressions are supported. The value of the <code>inline</code> property (the expression to compute) has the same syntax as SQL expressions.</p>
<p>The expression name can be utilized in filtering or sorting.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
script_fields
</div>

<!-- request script_fields -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;movies_rt&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;script_fields&quot;</span><span class="p">:{</span>
<span class="w">        </span><span class="nt">&quot;cond1&quot;</span><span class="p">:{</span>
<span class="w">            </span><span class="nt">&quot;script&quot;</span><span class="p">:{</span>
<span class="w">                </span><span class="nt">&quot;inline&quot;</span><span class="p">:</span><span class="s2">&quot;actor_2_facebook_likes =296 OR movie_facebook_likes =37000&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;cond2&quot;</span><span class="p">:{</span>
<span class="w">            </span><span class="nt">&quot;script&quot;</span><span class="p">:{</span>
<span class="w">                </span><span class="nt">&quot;inline&quot;</span><span class="p">:</span><span class="s2">&quot;IF (IN (content_rating,&#39;TV-PG&#39;,&#39;PG&#39;),2, IF(IN(content_rating,&#39;TV-14&#39;,&#39;PG-13&#39;),1,0))&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;sort&quot;</span><span class="p">:[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;cond2&quot;</span><span class="p">:</span><span class="s2">&quot;desc&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;actor_1_name&quot;</span><span class="p">:</span><span class="s2">&quot;asc&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;actor_2_name&quot;</span><span class="p">:</span><span class="s2">&quot;desc&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;profile&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;query&quot;</span><span class="p">:{</span>
<span class="w">        </span><span class="nt">&quot;bool&quot;</span><span class="p">:{</span>
<span class="w">            </span><span class="nt">&quot;must&quot;</span><span class="p">:[</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;match&quot;</span><span class="p">:{</span>
<span class="w">                        </span><span class="nt">&quot;*&quot;</span><span class="p">:</span><span class="s2">&quot;star&quot;</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;equals&quot;</span><span class="p">:{</span>
<span class="w">                        </span><span class="nt">&quot;cond1&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;must_not&quot;</span><span class="p">:[</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;equals&quot;</span><span class="p">:{</span>
<span class="w">                        </span><span class="nt">&quot;content_rating&quot;</span><span class="p">:</span><span class="s2">&quot;R&quot;</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<p>By default, expression values are included in the <code>_source</code> array of the result set. If the source is selective (see <a href="../13-searching.html#source-selection">Source selection</a>), the expression name can be added to the <code>_source</code> parameter in the request. Note, the names of the expressions must be in lowercase.</p>
<h3 id="expressions">expressions</h3>
<!-- example expressions -->

<p><code>expressions</code> is an alternative to <code>script_fields</code> with a simpler syntax. The example request adds two expressions and stores the results into <code>add_all</code> and <code>title_len</code> attributes. Note, the names of the expressions must be in lowercase.</p>
<!-- request expressions -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;match_all&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;expressions&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;add_all&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;( gid * 10 ) | crc32(title)&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;title_len&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;crc32(title)&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.06-search_options">
        <header>
            <a class="chapter-link" href="#toc-13.06-search_options"> ¶ 13.6</a>

            
            <h1 id="search-options">Search options</h1>
            
        </header>

        
        
<p>The SQL <a href="../13-searching.html#sql">SELECT</a> clause and the HTTP <a href="../13-searching.html#http-json">/search</a> endpoint support a number of options that can be used to fine-tune search behavior.</p>
<h2 id="option">OPTION</h2>
<h3 id="general-syntax">General syntax</h3>
<!-- example options -->

<p><strong>SQL</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">[</span><span class="k">OPTION</span><span class="w"> </span><span class="o">&lt;</span><span class="n">optionname</span><span class="o">&gt;=&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">]]</span><span class="w"> </span><span class="p">[</span><span class="cm">/*+ [NO_][ColumnarScan|DocidIndex|SecondaryIndex(&lt;attribute&gt;[,...])]] /*]</span>
</code></pre></div>

<p><strong>HTTP</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span><span class="w">   </span>
<span class="w">    </span><span class="nt">&quot;index&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;index_name&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;options&quot;</span><span class="p">:</span><span class="w">   </span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;optionname&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;optionname2&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">&lt;value</span><span class="mi">2</span><span class="err">&gt;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>
SQL:
<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;@title hello @body world&#39;</span><span class="p">)</span>
<span class="k">OPTION</span><span class="w"> </span><span class="n">ranker</span><span class="o">=</span><span class="n">bm25</span><span class="p">,</span><span class="w"> </span><span class="n">max_matches</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span>
<span class="n">field_weights</span><span class="o">=</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="n">agent_query_timeout</span><span class="o">=</span><span class="mi">10000</span>
</code></pre></div>



<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">------+-------+-------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">body</span><span class="w">  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-------+-------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">hello</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">world</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-------+-------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
JSON:
<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span><span class="w">   </span>
<span class="w">    </span><span class="nt">&quot;index&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;hello&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;body&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;world&quot;</span><span class="w">     </span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;options&quot;</span><span class="p">:</span><span class="w">   </span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;ranker&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bm25&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;max_matches&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3000</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;field_weights&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;body&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;agent_query_timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;total_relation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eq&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10500</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;hello&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;body&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;world&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<p>Supported options are:</p>
<h3 id="accurate_aggregation">accurate_aggregation</h3>
<p>Integer. Enables or disables guaranteed aggregate accuracy when running groupby queries in multiple threads. Default is 0.</p>
<p>When running a groupby query, it can be run in parallel on a plain table with several pseudo shards (if <code>pseudo_sharding</code> is on). A similar approach works on RT tables. Each shard/chunk executes the query, but the number of groups is limited by <code>max_matches</code>. If the result sets from different shards/chunks have different groups, the group counts and aggregates may be inaccurate. Note that Manticore tries to increase <code>max_matches</code> up to <a href="../13-searching.html#max_matches_increase_threshold"><code>max_matches_increase_threshold</code></a> based on the number of unique values of the groupby attribute (retrieved from secondary indexes). If it succeeds, there will be no loss in accuracy.</p>
<p>However, if the number of unique values of the groupby attribute is high, further increasing <code>max_matches</code> may not be a good strategy because it can lead to a loss in performance and higher memory usage. Setting <code>accurate_aggregation</code> to 1 forces groupby searches to run in a single thread, which fixes the accuracy issue. Note that running in a single thread is only enforced when <code>max_matches</code> cannot be set high enough; otherwise, searches with <code>accurate_aggregation=1</code> will still run in multiple threads.</p>
<p>Overall, setting <code>accurate_aggregation</code> to 1 ensures group count and aggregate accuracy in RT tables and plain tables with <code>pseudo_sharding=1</code>. The drawback is that searches will run slower since they will be forced to operate in a single thread.</p>
<p>However, if we have an RT table and a plain table containing the same data, and we run a query with <code>accurate_aggregation=1</code>, we might still receive different results. This occurs because the daemon might choose different <code>max_matches</code> settings for the RT and plain table due to the <a href="../13-searching.html#max_matches_increase_threshold"><code>max_matches_increase_threshold</code></a> setting.</p>
<h3 id="agent_query_timeout">agent_query_timeout</h3>
<p>Integer. Max time in milliseconds to wait for remote queries to complete, see <a href="../06-creating_a_table.html#agent_query_timeout">this section</a>.</p>
<h3 id="boolean_simplify">boolean_simplify</h3>
<p><code>0</code> or <code>1</code> (<code>0</code> by default). <code>boolean_simplify=1</code> enables <a href="../13-searching.html#toc-13.02.05-boolean_optimization">simplifying the query</a> to speed it up.</p>
<h3 id="comment">comment</h3>
<p>String, user comment that gets copied to a query log file.</p>
<h3 id="cutoff">cutoff</h3>
<p>Integer. Max found matches threshold. The value is selected automatically if not specified.</p>
<ul>
<li><code>N</code> = 0 disables the threshold</li>
<li><code>N &gt; 0</code>: instructs Manticore to stop looking for results as soon as it finds <code>N</code> documents.</li>
<li>not set: Manticore will decide automatically what the value should be.</li>
</ul>
<p>In case Manticore cannot calculate the exact matching documents count, you will see <code>total_relation: gte</code> in the query <a href="../19-node_info_and_management.html#show-meta">meta information</a>, which means that the actual count is <strong>Greater Than or Equal</strong> to the total (<code>total_found</code> in <code>SHOW META</code> via SQL, <code>hits.total</code> in JSON via HTTP). If the total value is precise, you'll get <code>total_relation: eq</code>.</p>
<h3 id="distinct_precision_threshold">distinct_precision_threshold</h3>
<p>Integer. Default is <code>3500</code>. This option sets the threshold below which counts returned by <code>count distinct</code> are guaranteed to be exact within a plain table.</p>
<p>Accepted values range from <code>500</code> to <code>15500</code>. Values outside this range will be clamped.</p>
<p>When this option is set to 0, it enables an algorithm that ensures exact counts. This algorithm collects <code>{group, value}</code> pairs, sorts them, and periodically eliminates duplicates. The result is precise counts within a plain table. However, this approach is not suitable for high-cardinality datasets due to its high memory consumption and slow query execution.</p>
<p>When <code>distinct_precision_threshold</code> is set to a value greater than <code>0</code>, Manticore employs a different algorithm. It loads counts into a hash table and returns the size of the table. If the hash table becomes too large, its contents are moved into a <code>HyperLogLog</code> data structure. At this point, the counts become approximate because HyperLogLog is a probabilistic algorithm. This approach maintains a fixed maximum memory usage per group, but there is a tradeoff in count accuracy.</p>
<p>The accuracy of the <code>HyperLogLog</code> and the threshold for converting from the hash table to HyperLogLog are derived from the <code>distinct_precision_threshold</code> setting. It's important to use this option with caution since doubling its value will also double the maximum memory required to calculate counts. The maximum memory usage can be roughly estimated using this formula: <code>64 * max_matches * distinct_precision_threshold</code>, although in practice, count calculations often use less memory than the worst-case scenario.</p>
<h3 id="expand_keywords">expand_keywords</h3>
<p><code>0</code> or <code>1</code> (<code>0</code> by default). Expands keywords with exact forms and/or stars when possible. Refer to <a href="../06-creating_a_table.html#expand_keywords">expand_keywords</a> for more details.</p>
<h3 id="field_weights">field_weights</h3>
<p>Named integer list (per-field user weights for ranking).</p>
<p>Example:</p>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">OPTION</span><span class="w"> </span><span class="n">field_weights</span><span class="o">=</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>

<h3 id="global_idf">global_idf</h3>
<p>Use global statistics (frequencies) from the <a href="../06-creating_a_table.html#global_idf">global_idf</a> file for IDF computations.</p>
<h3 id="idf">idf</h3>
<p>Quoted, comma-separated list of IDF computation flags. Known flags are:</p>
<ul>
<li><code>normalized</code>: BM25 variant, idf = log((N-n+1)/n), as per Robertson et al</li>
<li><code>plain</code>: plain variant, idf = log(N/n), as per Sparck-Jones</li>
<li><code>tfidf_normalized</code>: additionally divide IDF by query word count, so that <code>TF*IDF</code> fits into [0, 1] range</li>
<li><code>tfidf_unnormalized</code>: do not additionally divide IDF by query word count where N is the collection size and n is the number of matched documents</li>
</ul>
<p>The historically default IDF (Inverse Document Frequency) in Manticore is equivalent to <code>OPTION idf='normalized,tfidf_normalized'</code>, and those normalizations may cause several undesired effects.</p>
<p>First, <code>idf=normalized</code> causes keyword penalization. For instance, if you search for <code>the | something</code> and <code>the</code> occurs in more than 50% of the documents, then documents with both keywords <code>the</code> and <code>something</code> will get less weight than documents with just one keyword <code>something</code>. Using <code>OPTION idf=plain</code> avoids this. Plain IDF varies in <code>[0, log(N)]</code> range, and keywords are never penalized; while the normalized IDF varies in <code>[-log(N), log(N)]</code> range, and too frequent keywords are penalized.</p>
<p>Second, <code>idf=tfidf_normalized</code> leads to IDF drift across queries. Historically, IDF was also divided by the query keyword count, ensuring the entire <code>sum(tf*idf)</code> across all keywords remained within the [0,1] range. However, this meant that queries like <code>word1</code> and <code>word1 | nonmatchingword2</code> would assign different weights to the exact same result set, as the IDFs for both <code>word1</code> and <code>nonmatchingword2</code> would be divided by 2. Using <code>OPTION idf='tfidf_unnormalized'</code> resolves this issue. Keep in mind that BM25, BM25A, BM25F() ranking factors will be adjusted accordingly when you disable this normalization.</p>
<p>IDF flags can be combined; <code>plain</code> and <code>normalized</code> are mutually exclusive; <code>tfidf_unnormalized</code> and <code>tfidf_normalized</code> are also mutually exclusive; and unspecified flags in such mutually exclusive groups default to their original settings. This means <code>OPTION idf=plain</code> is the same as specifying <code>OPTION idf='plain,tfidf_normalized'</code> in its entirety.</p>
<h3 id="index_weights">index_weights</h3>
<p>Named integer list. Per-table user weights for ranking.</p>
<h3 id="local_df">local_df</h3>
<p><code>0</code> or <code>1</code>, automatically sum DFs over all local parts of a distributed table, ensuring consistent (and accurate) IDF across a locally sharded table. Enabled dy default for disk chunks of the RT table.</p>
<h3 id="low-priority">Low Priority</h3>
<p><code>0</code> or <code>1</code> (<code>0</code> by default). Setting <code>low_priority=1</code> executes the query with a lower priority, rescheduling its jobs 10 times less frequently than other queries with normal priority.</p>
<h3 id="max_matches">max_matches</h3>
<p>Integer. Per-query max matches value.</p>
<p>The maximum number of matches that the server retains in RAM for each table and can return to the client. The default is 1000.</p>
<p>Introduced to control and limit RAM usage, the <code>max_matches</code> setting determines how many matches will be kept in RAM while searching each table. Every match found is still processed, but only the best N of them will be retained in memory and returned to the client in the end. For example, suppose a table contains 2,000,000 matches for a query. It's rare that you would need to retrieve all of them. Instead, you need to scan all of them but only choose the "best" 500, for instance, based on some criteria (e.g., sorted by relevance, price, or other factors) and display those 500 matches to the end user in pages of 20 to 100 matches. Tracking only the best 500 matches is much more RAM and CPU efficient than keeping all 2,000,000 matches, sorting them, and then discarding everything but the first 20 needed for the search results page. <code>max_matches</code> controls the N in that "best N" amount.</p>
<p>This parameter significantly impacts per-query RAM and CPU usage. Values of 1,000 to 10,000 are generally acceptable, but higher limits should be used with caution. Carelessly increasing max_matches to 1,000,000 means that <code>searchd</code> will have to allocate and initialize a 1-million-entry matches buffer for every query. This will inevitably increase per-query RAM usage and, in some cases, can noticeably affect performance.</p>
<p>Refer to <a href="../13-searching.html#max_matches_increase_threshold">max_matches_increase_threshold</a> for additional information on how it can influence the behavior of the <code>max_matches</code> option.</p>
<h3 id="max_matches_increase_threshold">max_matches_increase_threshold</h3>
<p>Integer. Sets the threshold that <code>max_matches</code> can be increased to. Default is 16384.</p>
<p>Manticore may increase <code>max_matches</code> to enhance groupby and/or aggregation accuracy when <code>pseudo_sharding</code> is enabled, and if it detects that the number of unique values of the groupby attribute is less than this threshold. Loss of accuracy may occur when pseudo-sharding executes the query in multiple threads or when an RT table conducts parallel searches in disk chunks.</p>
<p>If the number of unique values of the groupby attribute is less than the threshold, <code>max_matches</code> will be set to this number. Otherwise, the default <code>max_matches</code> will be used.</p>
<p>If <code>max_matches</code> was explicitly set in query options, this threshold has no effect.</p>
<p>Keep in mind that if this threshold is set too high, it will result in increased memory consumption and general performance degradation.</p>
<p>You can also enforce a guaranteed groupby/aggregate accuracy mode using the <a href="../13-searching.html#accurate_aggregation">accurate_aggregation</a> option.</p>
<h3 id="max_query_time">max_query_time</h3>
<p>Sets the maximum search query time in milliseconds. Must be a non-negative integer. The default value is 0, which means "do not limit." Local search queries will be stopped once the specified time has elapsed. Note that if you're performing a search that queries multiple local tables, this limit applies to each table separately. Be aware that this may slightly increase the query's response time due to the overhead caused by constantly tracking whether it's time to stop the query.</p>
<h3 id="max_predicted_time">max_predicted_time</h3>
<p>Integer. Maximum predicted search time; see <a href="../20-server_settings.html#predicted_time_costs">predicted_time_costs</a>.</p>
<h3 id="morphology">morphology</h3>
<p><code>none</code> allows replacing all query terms with their exact forms if the table was built with <a href="../06-creating_a_table.html#index_exact_words">index_exact_words</a> enabled. This is useful for preventing stemming or lemmatizing query terms.</p>
<h3 id="not_terms_only_allowed">not_terms_only_allowed</h3>
<!-- example not_terms_only_allowed -->
<p><code>0</code> or <code>1</code> allows standalone <a href="../13-searching.html#negation-operator">negation</a> for the query. The default is 0. See also the corresponding <a href="../20-server_settings.html#not_terms_only_allowed">global setting</a>.</p>
<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="n">MySQL</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">tbl</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">match</span><span class="p">(</span><span class="s1">&#39;-donald&#39;</span><span class="p">);</span>
<span class="n">ERROR</span><span class="w"> </span><span class="mi">1064</span><span class="w"> </span><span class="p">(</span><span class="mi">42000</span><span class="p">):</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">t</span><span class="p">:</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">non</span><span class="o">-</span><span class="n">computable</span><span class="w"> </span><span class="p">(</span><span class="n">single</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">operator</span><span class="p">)</span>
<span class="n">MySQL</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">match</span><span class="p">(</span><span class="s1">&#39;-donald&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">option</span><span class="w"> </span><span class="n">not_terms_only_allowed</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------------------+-----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">field</span><span class="w">     </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+-----------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1658178727135150081</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">smth</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+-----------+</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<h3 id="ranker">ranker</h3>
<p>Choose from the following options:</p>
<ul>
<li><code>proximity_bm25</code></li>
<li><code>bm25</code></li>
<li><code>none</code></li>
<li><code>wordcount</code></li>
<li><code>proximity</code></li>
<li><code>matchany</code></li>
<li><code>fieldmask</code></li>
<li><code>sph04</code></li>
<li><code>expr</code></li>
<li><code>export</code></li>
</ul>
<p>For more details on each ranker, refer to <a href="../13-searching.html#toc-13.08-sorting_and_ranking">Search results ranking</a>.</p>
<h3 id="rand_seed">rand_seed</h3>
<p>Allows you to specify a specific integer seed value for an <code>ORDER BY RAND()</code> query, for example: <code>... OPTION rand_seed=1234</code>. By default, a new and different seed value is autogenerated for every query.</p>
<h3 id="retry_count">retry_count</h3>
<p>Integer. Distributed retries count.</p>
<h3 id="retry_delay">retry_delay</h3>
<p>Integer. Distributed retry delay, in milliseconds.</p>
<h3 id="sort_method">sort_method</h3>
<ul>
<li><code>pq</code> - priority queue, set by default</li>
<li><code>kbuffer</code> - provides faster sorting for already pre-sorted data, e.g., table data sorted by id<br />
The result set is the same in both cases; choosing one option or the other may simply improve (or worsen) performance.</li>
</ul>
<h3 id="threads">threads</h3>
<p>Limits the max number of threads used for current query processing. Default - no limit (the query can occupy all <a href="../20-server_settings.html#threads">threads</a> as defined globally).<br />
For a batch of queries, the option must be attached to the very first query in the batch, and it is then applied when the working queue is created and is effective for the entire batch. This option has the same meaning as the option <a href="../20-server_settings.html#max_threads_per_query">max_threads_per_query</a>, but is applied only to the current query or batch of queries.</p>
<h3 id="token_filter">token_filter</h3>
<p>Quoted, colon-separated string of <code>library name:plugin name:optional string of settings</code>. A query-time token filter is created for each search when full-text is invoked by every table involved, allowing you to implement a custom tokenizer that generates tokens according to custom rules.</p>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;yes@no&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">OPTION</span><span class="w"> </span><span class="n">token_filter</span><span class="o">=</span><span class="s1">&#39;mylib.so:blend:@&#39;</span>
</code></pre></div>

<h3 id="expansion_limit">expansion_limit</h3>
<p>Restricts the maximum number of expanded keywords for a single wildcard, with a default value of 0 indicating no limit. For additional details, refer to <a href="../20-server_settings.html#expansion_limit">expansion_limit</a>.</p>
<h2 id="query-optimizer-hints">Query optimizer hints</h2>
<!-- example options_force -->

<p>In rare cases, Manticore's built-in query analyzer may be incorrect in understanding a query and determining whether a docid index, secondary indexes, or columnar scan should be used. To override the query optimizer's decisions, you can use the following hints in your query:</p>
<ul>
<li><code>/*+ DocidIndex(id) */</code>  to force the use of a docid index, <code>/*+ NO_DocidIndex(id) */</code> to tell the optimizer to ignore it</li>
<li><code>/*+ SecondaryIndex(&lt;attr_name1&gt;[, &lt;attr_nameN&gt;]) */</code> to force the use of a secondary index (if available), <code>/*+ NO_SecondaryIndex(id) */</code>  to tell the optimizer to ignore it</li>
<li><code>/*+ ColumnarScan(&lt;attr_name1&gt;[, &lt;attr_nameN&gt;]) */</code>  to force the use of a columnar scan (if the attribute is columnar), <code>/*+ NO_ColumnarScan(id) */</code> to tell the optimizer to ignore it</li>
</ul>
<p>Note that when executing a full-text query with filters, the query optimizer decides between intersecting the results of the full-text tree with the filter results or using a standard match-then-filter approach. Specifying <em>any</em> hint will force the daemon to use the code path that performs the intersection of the full-text tree results with the filter results.</p>
<p>For more information on how the query optimizer works, refer to the <a href="../13-searching.html#toc-13.21-cost-based_optimizer">Cost based optimizer</a> page.</p>
<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">students</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">21</span><span class="w"> </span><span class="cm">/*+ SecondaryIndex(age) */</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<!-- example comments -->
<p>When using a MySQL/MariaDB client, make sure to include the <code>--comments</code> flag to enable the hints in your queries.</p>
<!-- request mysql -->

<div class="codehilite"><pre><span></span><code>mysql<span class="w"> </span>-P9306<span class="w"> </span>-h0<span class="w"> </span>--comments
</code></pre></div>

<!-- end -->

</div>
</div>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.07-highlighting">
        <header>
            <a class="chapter-link" href="#toc-13.07-highlighting"> ¶ 13.7</a>

            
            <h1 id="highlighting">Highlighting</h1>
            
        </header>

        
        
<!-- example highlighting -->

<p>Highlighting enables you to obtain highlighted text fragments (referred to as snippets) from documents containing matching keywords.</p>
<p>The SQL <code>HIGHLIGHT()</code> function, the <code>"highlight"</code> property in JSON queries via HTTP, and the <code>highlight()</code> function in the PHP client all utilize the built-in document storage to retrieve the original field contents (enabled by default).</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">HIGHLIGHT</span><span class="p">()</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;try&#39;</span><span class="p">);</span>
</code></pre></div>



<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">----------------------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">highlight</span><span class="p">()</span><span class="w">                                              </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------------------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Don</span><span class="o">`</span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">try</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">compete</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">childishness</span><span class="p">,</span><span class="w"> </span><span class="n">said</span><span class="w"> </span><span class="n">Bliss</span><span class="p">.</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------------------------------------------------------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;books&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w">  </span><span class="p">{</span><span class="w">  </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;*&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;try&quot;</span><span class="w"> </span><span class="p">}</span><span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;highlight&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="s2">&quot;4&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="mi">1704</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;Book four&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="s2">&quot;Don`t try to compete in childishness, said Bliss.&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Book four&quot;</span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Don`t &lt;b&gt;try&lt;/b&gt; to compete in childishness, said Bliss.&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$results = $index-&gt;search(&#39;try&#39;)-&gt;highlight()-&gt;get();</span>
<span class="x">foreach($results as $doc)</span>
<span class="x">{</span>
<span class="x">    echo &#39;Document: &#39;.$doc-&gt;getId();</span>
<span class="x">    foreach($doc-&gt;getData() as $field=&gt;$value)</span>
<span class="x">    {</span>
<span class="x">        echo $field.&#39;: &#39;.$value;</span>
<span class="x">    }</span>
<span class="x">    foreach($doc-&gt;getHighlight() as $field=&gt;$snippets)</span>
<span class="x">    {</span>
<span class="x">        echo &quot;Highlight for &quot;.$field.&quot;:\n&quot;;</span>
<span class="x">        foreach($snippets as $snippet)</span>
<span class="x">        {</span>
<span class="x">            echo &quot;- &quot;.$snippet.&quot;\n&quot;;</span>
<span class="x">        }</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>



<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Document: 14</span>
<span class="x">title: Book four</span>
<span class="x">content: Don`t try to compete in childishness, said Bliss.</span>
<span class="x">Highlight for title:</span>
<span class="x">- Book four</span>
<span class="x">Highlight for content:</span>
<span class="x">- Don`t &lt;b&gt;try&lt;/b&gt; to compete in childishness, said Bliss.</span>
</code></pre></div>



<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">res</span> <span class="o">=</span> <span class="n">searchApi</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;books&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="p">:{</span><span class="s2">&quot;match&quot;</span><span class="p">:{</span><span class="s2">&quot;*&quot;</span><span class="p">:</span><span class="s2">&quot;try&quot;</span><span class="p">}},</span><span class="s2">&quot;highlight&quot;</span><span class="p">:{}})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;aggregations&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;4&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">1695</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Don`t try to compete in childishness, said Bliss.&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Book four&#39;</span><span class="p">},</span>
                    <span class="sa">u</span><span class="s1">&#39;highlight&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Don`t &lt;b&gt;try&lt;/b&gt; to compete in childishness, said Bliss.&#39;</span><span class="p">],</span>
                                   <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Book four&#39;</span><span class="p">]}}],</span>
          <span class="s1">&#39;max_score&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
          <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>



<!-- request Javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="s2">&quot;books&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;match&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;*&quot;</span><span class="o">:</span><span class="s2">&quot;try&quot;</span><span class="p">}},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{}});</span>
</code></pre></div>


<!-- response Javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;4&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1695</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Book four&quot;</span><span class="p">,</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;Don`t try to compete in childishness, said Bliss.&quot;</span><span class="p">},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;Book four&quot;</span><span class="p">],</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;Don`t &lt;b&gt;try&lt;/b&gt; to compete in childishness, said Bliss.&quot;</span><span class="p">]}}]}}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Java
</div>

<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">();</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;books&quot;</span><span class="p">);</span>
<span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">query</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;match&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">,</span><span class="s">&quot;try|gets|down|said&quot;</span><span class="p">);</span>
<span class="p">}});</span><span class="w">        </span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>

<span class="p">}};</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setHighlight</span><span class="p">(</span><span class="n">highlight</span><span class="p">);</span>
<span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>



<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">took</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">total</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="n">maxScore</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">        </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1597</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=</span><span class="n">Book</span><span class="w"> </span><span class="n">three</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="n">Trevize</span><span class="w"> </span><span class="n">whispered</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;It gets infantile pleasure out of display. I`d love to knock it down.&quot;</span><span class="p">},</span><span class="w"> </span><span class="n">highlight</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=[</span><span class="n">Book</span><span class="w"> </span><span class="n">three</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="o">=[</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;It &lt;b&gt;gets&lt;/b&gt; infantile pleasure ,  to knock it &lt;b&gt;down&lt;/b&gt;.&quot;</span><span class="o">]</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1563</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=</span><span class="n">Book</span><span class="w"> </span><span class="n">four</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="n">Don</span><span class="err">`</span><span class="n">t</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">compete</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">childishness</span><span class="p">,</span><span class="w"> </span><span class="n">said</span><span class="w"> </span><span class="n">Bliss</span><span class="p">.},</span><span class="w"> </span><span class="n">highlight</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=[</span><span class="n">Book</span><span class="w"> </span><span class="n">four</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="o">=[</span><span class="n">Don</span><span class="err">`</span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="k">try</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">compete</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">childishness</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">said</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Bliss</span><span class="p">.</span><span class="o">]</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1514</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=</span><span class="n">Books</span><span class="w"> </span><span class="n">two</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="n">A</span><span class="w"> </span><span class="n">door</span><span class="w"> </span><span class="n">opened</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">them</span><span class="p">,</span><span class="w"> </span><span class="n">revealing</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="n">room</span><span class="p">.</span><span class="w"> </span><span class="n">Bander</span><span class="w"> </span><span class="n">said</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Come, half-humans, I want to show you how we live.&quot;</span><span class="p">},</span><span class="w"> </span><span class="n">highlight</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=[</span><span class="n">Books</span><span class="w"> </span><span class="n">two</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="o">=[</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="n">room</span><span class="p">.</span><span class="w"> </span><span class="n">Bander</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">said</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Come, half-humans, I]}}]</span>
<span class="s">        aggregations: null</span>
<span class="s">    }</span>
<span class="s">    profile: null</span>
<span class="s">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;books&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">FulltextFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MatchFilter</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;try|gets|down|said&quot;</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Highlight</span><span class="p">();</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">highlight</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="o">.</span><span class="n">Search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>



<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="n">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">took</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="nl">timedOut</span><span class="p">:</span><span class="w"> </span><span class="nb">false</span>
<span class="w">    </span><span class="nl">hits</span><span class="p">:</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">total</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="nl">maxScore</span><span class="p">:</span><span class="w"> </span><span class="n">null</span>
<span class="w">        </span><span class="nl">hits</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="n">_id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1597</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=</span><span class="n">Book</span><span class="w"> </span><span class="n">three</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="n">Trevize</span><span class="w"> </span><span class="n">whispered</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;It gets infantile pleasure out of display. I`d love to knock it down.&quot;</span><span class="p">},</span><span class="w"> </span><span class="n">highlight</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=</span><span class="p">[</span><span class="n">Book</span><span class="w"> </span><span class="n">three</span><span class="p">],</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="p">[,</span><span class="w"> </span><span class="s">&quot;It &lt;b&gt;gets&lt;/b&gt; infantile pleasure ,  to knock it &lt;b&gt;down&lt;/b&gt;.&quot;</span><span class="p">]}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1563</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=</span><span class="n">Book</span><span class="w"> </span><span class="n">four</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="n">Don</span><span class="err">`</span><span class="n">t</span><span class="w"> </span><span class="n">try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">compete</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">childishness</span><span class="p">,</span><span class="w"> </span><span class="n">said</span><span class="w"> </span><span class="n">Bliss</span><span class="p">.},</span><span class="w"> </span><span class="n">highlight</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=</span><span class="p">[</span><span class="n">Book</span><span class="w"> </span><span class="n">four</span><span class="p">],</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="p">[</span><span class="n">Don</span><span class="err">`</span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">try</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">compete</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">childishness</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">said</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Bliss</span><span class="p">.]}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1514</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=</span><span class="n">Books</span><span class="w"> </span><span class="n">two</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="n">A</span><span class="w"> </span><span class="n">door</span><span class="w"> </span><span class="n">opened</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">them</span><span class="p">,</span><span class="w"> </span><span class="n">revealing</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="n">room</span><span class="p">.</span><span class="w"> </span><span class="n">Bander</span><span class="w"> </span><span class="n">said</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Come, half-humans, I want to show you how we live.&quot;</span><span class="p">},</span><span class="w"> </span><span class="n">highlight</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=</span><span class="p">[</span><span class="n">Books</span><span class="w"> </span><span class="n">two</span><span class="p">],</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="p">[</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="n">room</span><span class="p">.</span><span class="w"> </span><span class="n">Bander</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">said</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Come, half-humans, I]}}]</span>
<span class="w">        </span><span class="nl">aggregations</span><span class="p">:</span><span class="w"> </span><span class="n">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nl">profile</span><span class="p">:</span><span class="w"> </span><span class="n">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">match</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="o">*:</span><span class="w"> </span><span class="s1">&#39;Text 1&#39;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">highlight</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span>
<span class="p">});</span>
</code></pre></div>


<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;Text 1&quot;</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="o">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s2">&quot;&lt;b&gt;Text 1&lt;/b&gt;&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">matchClause</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Text 1&quot;</span><span class="p">};</span>
<span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">matchClause</span><span class="p">};</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
<span class="nx">highlight</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewHighlight</span><span class="p">()</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetHighlight</span><span class="p">(</span><span class="nx">highlight</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">SearchRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">searchRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>


<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;took&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;timed_out&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;total&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="mi">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_source&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="s">&quot;Text 1&quot;</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;content&quot;</span><span class="p">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s">&quot;&lt;b&gt;Text 1&lt;/b&gt;&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<p>When using SQL for highlighting search results, you will receive snippets from various fields combined into a single string due to the limitations of the MySQL protocol. You can adjust the concatenation separators with the <code>field_separator</code> and <code>snippet_separator</code> options, as detailed below.</p>
<p>When executing JSON queries through HTTP or using the PHP client, there are no such constraints, and the result set includes an array of fields containing arrays of snippets (without separators).</p>
<p>Keep in mind that snippet generation options like <code>limit</code>, <code>limit_words</code>, and <code>limit_snippets</code> apply to each field individually by default. You can alter this behavior using the <code>limits_per_field</code> option, but it could lead to unwanted results. For example, one field may have matching keywords, but no snippets from that field are included in the result set because they didn't rank as high as snippets from other fields in the highlighting engine.</p>
<p>The highlighting algorithm currently prioritizes better snippets (with closer phrase matches) and then snippets with keywords not yet included in the result. Generally, it aims to highlight the best match for the query and to highlight all query keywords, as allowed by the limits. If no matches are found in the current field, the beginning of the document will be trimmed according to the limits and returned by default. To return an empty string instead, set the <code>allow_empty</code> option to 1.</p>
<p>Highlighting is performed during the so-called <code>post limit</code> stage, which means that snippet generation is deferred not only until the entire final result set is prepared but also after the LIMIT clause is applied. For instance, with a LIMIT 20,10 clause, the <code>HIGHLIGHT()</code> function will be called a maximum of 10 times.</p>
<h2 id="highlighting-options">Highlighting options</h2>
<!-- example highlighting options -->

<p>There are several optional highlighting options that can be used to fine-tune snippet generation, which are common to SQL, HTTP, and PHP clients.</p>
<h4 id="before_match">before_match</h4>
<p>A string to insert before a keyword match. The <code>%SNIPPET_ID%</code> macro can be used in this string. The first occurrence of the macro is replaced with an incrementing snippet number within the current snippet. Numbering starts at 1 by default but can be overridden with the <code>start_snippet_id</code> option. %SNIPPET_ID% restarts at the beginning of each new document. The default is <code>&lt;b&gt;</code>.</p>
<h4 id="after_match">after_match</h4>
<p>A string to insert after a keyword match. The default is <code>&lt;/b&gt;</code>.</p>
<h4 id="limit">limit</h4>
<p>The maximum snippet size, in symbols (codepoints). The default is 256. This is applied per-field by default, see <code>limits_per_field</code>.</p>
<h4 id="limit_words">limit_words</h4>
<p>Limits the maximum number of words that can be included in the result. Note that this limit applies to all words, not just the matched keywords to highlight. For example, if highlighting <code>Mary</code> and a snippet <code>Mary had a little lamb</code> is selected, it contributes 5 words to this limit, not just 1. The default is 0 (no limit). This is applied per-field by default, see <code>limits_per_field</code>.</p>
<h4 id="limit_snippets">limit_snippets</h4>
<p>Limits the maximum number of snippets that can be included in the result. The default is 0 (no limit). This is applied per-field by default, see <code>limits_per_field</code>.</p>
<h4 id="limits_per_field">limits_per_field</h4>
<p>Determines whether <code>limit</code>, <code>limit_words</code>, and <code>limit_snippets</code> operate as individual limits in each field of the document being highlighted or as global limits for the entire document. Setting this option to 0 means that all combined highlighting results for one document must be within the specified limits. The downside is that you may have several snippets highlighted in one field and none in another if the highlighting engine decides they are more relevant. The default is 1 (use per-field limits).</p>
<h4 id="around">around</h4>
<p>The number of words to select around each matching keyword block. The default is 5.</p>
<h4 id="use_boundaries">use_boundaries</h4>
<p>Determines whether to additionally break snippets by phrase boundary characters, as configured in table settings with the <a href="../06-creating_a_table.html#phrase_boundary">phrase_boundary</a> directive. The default is 0 (don't use boundaries).</p>
<h4 id="weight_order">weight_order</h4>
<p>Specifies whether to sort the extracted snippets in order of relevance (decreasing weight) or in order of appearance in the document (increasing position). The default is 0 (don't use weight order).</p>
<h4 id="force_all_words">force_all_words</h4>
<p>Ignores the length limit until the result includes all keywords. The default is 0 (don't force all keywords).</p>
<h4 id="start_snippet_id">start_snippet_id</h4>
<p>Sets the starting value of the <code>%SNIPPET_ID%</code> macro (which is detected and expanded in <code>before_match</code>, <code>after_match</code> strings). The default is 1.</p>
<h4 id="html_strip_mode">html_strip_mode</h4>
<p>Defines the HTML stripping mode setting. Defaults to <code>index</code>, meaning that table settings will be used. Other values include <code>none</code> and <code>strip</code>, which forcibly skip or apply stripping regardless of table settings; and <code>retain</code>, which retains HTML markup and protects it from highlighting. The <code>retain</code> mode can only be used when highlighting full documents and therefore requires that no snippet size limits are set. The allowed string values are <code>none</code>, <code>strip</code>, <code>index</code>, and <code>retain</code>.</p>
<h4 id="allow_empty">allow_empty</h4>
<p>Permits an empty string to be returned as the highlighting result when no snippets could be generated in the current field (no keyword match or no snippets fit the limit). By default, the beginning of the original text would be returned instead of an empty string. The default is 0 (don't allow an empty result).</p>
<h4 id="snippet_boundary">snippet_boundary</h4>
<p>Ensures that snippets do not cross a sentence, paragraph, or zone boundary (when used with a table that has the respective indexing settings enabled). The allowed values are <code>sentence</code>, <code>paragraph</code>, and <code>zone</code>.</p>
<h4 id="emit_zones">emit_zones</h4>
<p>Emits an HTML tag with the enclosing zone name before each snippet. The default is 0 (don't emit zone names).</p>
<h4 id="force_snippets">force_snippets</h4>
<p>Determines whether to force snippet generation even if limits allow highlighting the entire text. The default is 0 (don't force snippet generation).</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>
<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">HIGHLIGHT</span><span class="p">(</span><span class="err">{</span><span class="k">limit</span><span class="o">=</span><span class="mi">50</span><span class="err">}</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;try|gets|down|said&#39;</span><span class="p">);</span>
</code></pre></div>



<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">---------------------------------------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">highlight</span><span class="p">(</span><span class="err">{</span><span class="k">limit</span><span class="o">=</span><span class="mi">50</span><span class="err">}</span><span class="p">)</span><span class="w">                                                     </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------------------------------------------------------------+</span>
<span class="o">|</span><span class="w">  </span><span class="p">...</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;It &lt;b&gt;gets&lt;/b&gt; infantile pleasure  ...  to knock it &lt;b&gt;down&lt;/b&gt;.&quot;</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Don</span><span class="o">`</span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">try</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">compete</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">childishness</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">said</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Bliss</span><span class="p">.</span><span class="w">           </span><span class="o">|</span>
<span class="o">|</span><span class="w">  </span><span class="p">...</span><span class="w">  </span><span class="n">a</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="n">room</span><span class="p">.</span><span class="w"> </span><span class="n">Bander</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">said</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="err">&quot;</span><span class="n">Come</span><span class="p">,</span><span class="w"> </span><span class="n">half</span><span class="o">-</span><span class="n">humans</span><span class="p">,</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="p">...</span><span class="w">         </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------------------------------------------------------------+</span>
<span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;books&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;query_string&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;try|gets|down|said&quot;</span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;highlight&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="mi">50</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="s2">&quot;3&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="mi">1602</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;Book three&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="s2">&quot;Trevize whispered, \&quot;It gets infantile pleasure out of display. I`d love to knock it down.\&quot;&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span>
<span class="w">          </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;Book three&quot;</span>
<span class="w">          </span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;content&quot;</span><span class="p">:</span>
<span class="w">          </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;, \&quot;It &lt;b&gt;gets&lt;/b&gt; infantile pleasure &quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot; to knock it &lt;b&gt;down&lt;/b&gt;.\&quot;&quot;</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="s2">&quot;4&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="mi">1573</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;Book four&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="s2">&quot;Don`t try to compete in childishness, said Bliss.&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span>
<span class="w">          </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;Book four&quot;</span>
<span class="w">          </span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;content&quot;</span><span class="p">:</span>
<span class="w">          </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;Don`t &lt;b&gt;try&lt;/b&gt; to compete in childishness, &lt;b&gt;said&lt;/b&gt; Bliss.&quot;</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="s2">&quot;2&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="mi">1521</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;Book two&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="s2">&quot;A door opened before them, revealing a small room. Bander said, \&quot;Come, half-humans, I want to show you how we live.\&quot;&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span>
<span class="w">          </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;Book two&quot;</span>
<span class="w">          </span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;content&quot;</span><span class="p">:</span>
<span class="w">          </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot; a small room. Bander &lt;b&gt;said&lt;/b&gt;, \&quot;Come, half-humans, I&quot;</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$results = $index-&gt;search(&#39;try|gets|down|said&#39;)-&gt;highlight([],[&#39;limit&#39;=&gt;50])-&gt;get();</span>
<span class="x">foreach($results as $doc)</span>
<span class="x">{</span>
<span class="x">    echo &#39;Document: &#39;.$doc-&gt;getId();</span>
<span class="x">    foreach($doc-&gt;getData() as $field=&gt;$value)</span>
<span class="x">    {</span>
<span class="x">        echo $field.&#39;: &#39;.$value;</span>
<span class="x">    }</span>
<span class="x">    foreach($doc-&gt;getHighlight() as $field=&gt;$snippets)</span>
<span class="x">    {</span>
<span class="x">        echo &quot;Highlight for &quot;.$field.&quot;:\n&quot;;</span>
<span class="x">        foreach($snippets as $snippet)</span>
<span class="x">        {</span>
<span class="x">            echo  $snippet.&quot;\n&quot;;</span>
<span class="x">        }</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>



<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Document: 3</span>
<span class="x">title: Book three</span>
<span class="x">content: Trevize whispered, &quot;It gets infantile pleasure out of display. I`d love to knock it down.&quot;</span>
<span class="x">Highlight for title:</span>
<span class="x">- Book four</span>
<span class="x">Highlight for content:</span>
<span class="x">, &quot;It &lt;b&gt;gets&lt;/b&gt; infantile pleasure</span>
<span class="x">to knock it &lt;b&gt;down&lt;/b&gt;.&quot;</span>

<span class="x">Document: 4</span>
<span class="x">title: Book four</span>
<span class="x">content: Don`t try to compete in childishness, said Bliss.</span>
<span class="x">Highlight for title:</span>
<span class="x">- Book four</span>
<span class="x">Highlight for content:</span>
<span class="x">Don`t &lt;b&gt;try&lt;/b&gt; to compete in childishness, &lt;b&gt;said&lt;/b&gt; Bliss.</span>

<span class="x">Document: 2</span>
<span class="x">title: Book two</span>
<span class="x">content: A door opened before them, revealing a small room. Bander said, &quot;Come, half-humans, I want to show you how we live.</span>
<span class="x">Highlight for title:</span>
<span class="x">- Book two</span>
<span class="x">Highlight for content:</span>
<span class="x"> a small room. Bander &lt;b&gt;said&lt;/b&gt;, \&quot;Come, half-humans, I</span>
</code></pre></div>



<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">res</span> <span class="o">=</span> <span class="n">searchApi</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;books&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="p">:{</span><span class="s2">&quot;match&quot;</span><span class="p">:{</span><span class="s2">&quot;*&quot;</span><span class="p">:</span><span class="s2">&quot;try&quot;</span><span class="p">}},</span><span class="s2">&quot;highlight&quot;</span><span class="p">:{</span><span class="s2">&quot;limit&quot;</span><span class="p">:</span><span class="mi">50</span><span class="p">}})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;aggregations&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;4&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">1695</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Don`t try to compete in childishness, said Bliss.&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Book four&#39;</span><span class="p">},</span>
                    <span class="sa">u</span><span class="s1">&#39;highlight&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Don`t &lt;b&gt;try&lt;/b&gt; to compete in childishness, said Bliss.&#39;</span><span class="p">],</span>
                                   <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Book four&#39;</span><span class="p">]}}],</span>
          <span class="s1">&#39;max_score&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
          <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>



<!-- request Javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="s2">&quot;books&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;query_string&quot;</span><span class="o">:</span><span class="s2">&quot;try|gets|down|said&quot;</span><span class="p">},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;limit&quot;</span><span class="o">:</span><span class="mf">50</span><span class="p">}});</span>
</code></pre></div>


<!-- response Javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">3</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;3&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1597</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Book three&quot;</span><span class="p">,</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;Trevize whispered, \&quot;It gets infantile pleasure out of display. I`d love to knock it down.\&quot;&quot;</span><span class="p">},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;Book three&quot;</span><span class="p">],</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;, \&quot;It &lt;b&gt;gets&lt;/b&gt; infantile pleasure &quot;</span><span class="p">,</span><span class="s2">&quot; to knock it &lt;b&gt;down&lt;/b&gt;.\&quot;&quot;</span><span class="p">]}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;4&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1563</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Book four&quot;</span><span class="p">,</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;Don`t try to compete in childishness, said Bliss.&quot;</span><span class="p">},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;Book four&quot;</span><span class="p">],</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;Don`t &lt;b&gt;try&lt;/b&gt; to compete in childishness, &lt;b&gt;said&lt;/b&gt; Bliss.&quot;</span><span class="p">]}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;5&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1514</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Books two&quot;</span><span class="p">,</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;A door opened before them, revealing a small room. Bander said, \&quot;Come, half-humans, I want to show you how we live.\&quot;&quot;</span><span class="p">},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;Books two&quot;</span><span class="p">],</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot; a small room. Bander &lt;b&gt;said&lt;/b&gt;, \&quot;Come, half-humans, I&quot;</span><span class="p">]}}]}}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Java
</div>

<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">();</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;books&quot;</span><span class="p">);</span>
<span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">query</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;match&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">,</span><span class="s">&quot;try|gets|down|said&quot;</span><span class="p">);</span>
<span class="p">}});</span><span class="w">        </span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;limit&quot;</span><span class="p">,</span><span class="mi">50</span><span class="p">);</span>
<span class="p">}};</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setHighlight</span><span class="p">(</span><span class="n">highlight</span><span class="p">);</span>
<span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>



<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">took</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">total</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="n">maxScore</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">        </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1597</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=</span><span class="n">Book</span><span class="w"> </span><span class="n">three</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="n">Trevize</span><span class="w"> </span><span class="n">whispered</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;It gets infantile pleasure out of display. I`d love to knock it down.&quot;</span><span class="p">},</span><span class="w"> </span><span class="n">highlight</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=[</span><span class="n">Book</span><span class="w"> </span><span class="n">three</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="o">=[</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;It &lt;b&gt;gets&lt;/b&gt; infantile pleasure ,  to knock it &lt;b&gt;down&lt;/b&gt;.&quot;</span><span class="o">]</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1563</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=</span><span class="n">Book</span><span class="w"> </span><span class="n">four</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="n">Don</span><span class="err">`</span><span class="n">t</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">compete</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">childishness</span><span class="p">,</span><span class="w"> </span><span class="n">said</span><span class="w"> </span><span class="n">Bliss</span><span class="p">.},</span><span class="w"> </span><span class="n">highlight</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=[</span><span class="n">Book</span><span class="w"> </span><span class="n">four</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="o">=[</span><span class="n">Don</span><span class="err">`</span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="k">try</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">compete</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">childishness</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">said</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Bliss</span><span class="p">.</span><span class="o">]</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1514</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=</span><span class="n">Books</span><span class="w"> </span><span class="n">two</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="n">A</span><span class="w"> </span><span class="n">door</span><span class="w"> </span><span class="n">opened</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">them</span><span class="p">,</span><span class="w"> </span><span class="n">revealing</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="n">room</span><span class="p">.</span><span class="w"> </span><span class="n">Bander</span><span class="w"> </span><span class="n">said</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Come, half-humans, I want to show you how we live.&quot;</span><span class="p">},</span><span class="w"> </span><span class="n">highlight</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=[</span><span class="n">Books</span><span class="w"> </span><span class="n">two</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="o">=[</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="n">room</span><span class="p">.</span><span class="w"> </span><span class="n">Bander</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">said</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Come, half-humans, I]}}]</span>
<span class="s">        aggregations: null</span>
<span class="s">    }</span>
<span class="s">    profile: null</span>
<span class="s">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;books&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">FulltextFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MatchFilter</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;try|gets|down|said&quot;</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Highlight</span><span class="p">();</span>
<span class="n">highlight</span><span class="o">.</span><span class="n">Limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">highlight</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="o">.</span><span class="n">Search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>



<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="n">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">took</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="nl">timedOut</span><span class="p">:</span><span class="w"> </span><span class="nb">false</span>
<span class="w">    </span><span class="nl">hits</span><span class="p">:</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">total</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="nl">maxScore</span><span class="p">:</span><span class="w"> </span><span class="n">null</span>
<span class="w">        </span><span class="nl">hits</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="n">_id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1597</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=</span><span class="n">Book</span><span class="w"> </span><span class="n">three</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="n">Trevize</span><span class="w"> </span><span class="n">whispered</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;It gets infantile pleasure out of display. I`d love to knock it down.&quot;</span><span class="p">},</span><span class="w"> </span><span class="n">highlight</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=</span><span class="p">[</span><span class="n">Book</span><span class="w"> </span><span class="n">three</span><span class="p">],</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="p">[,</span><span class="w"> </span><span class="s">&quot;It &lt;b&gt;gets&lt;/b&gt; infantile pleasure ,  to knock it &lt;b&gt;down&lt;/b&gt;.&quot;</span><span class="p">]}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1563</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=</span><span class="n">Book</span><span class="w"> </span><span class="n">four</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="n">Don</span><span class="err">`</span><span class="n">t</span><span class="w"> </span><span class="n">try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">compete</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">childishness</span><span class="p">,</span><span class="w"> </span><span class="n">said</span><span class="w"> </span><span class="n">Bliss</span><span class="p">.},</span><span class="w"> </span><span class="n">highlight</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=</span><span class="p">[</span><span class="n">Book</span><span class="w"> </span><span class="n">four</span><span class="p">],</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="p">[</span><span class="n">Don</span><span class="err">`</span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">try</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">compete</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">childishness</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">said</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Bliss</span><span class="p">.]}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1514</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=</span><span class="n">Books</span><span class="w"> </span><span class="n">two</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="n">A</span><span class="w"> </span><span class="n">door</span><span class="w"> </span><span class="n">opened</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">them</span><span class="p">,</span><span class="w"> </span><span class="n">revealing</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="n">room</span><span class="p">.</span><span class="w"> </span><span class="n">Bander</span><span class="w"> </span><span class="n">said</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Come, half-humans, I want to show you how we live.&quot;</span><span class="p">},</span><span class="w"> </span><span class="n">highlight</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=</span><span class="p">[</span><span class="n">Books</span><span class="w"> </span><span class="n">two</span><span class="p">],</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="p">[</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="n">room</span><span class="p">.</span><span class="w"> </span><span class="n">Bander</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">said</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Come, half-humans, I]}}]</span>
<span class="w">        </span><span class="nl">aggregations</span><span class="p">:</span><span class="w"> </span><span class="n">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nl">profile</span><span class="p">:</span><span class="w"> </span><span class="n">null</span>
<span class="p">}</span>
</code></pre></div>


<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">match</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">*:</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">Text</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="nx">highlight</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">limit</span><span class="o">:</span><span class="w"> </span><span class="kt">2</span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>


<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">2</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;cat&quot;</span><span class="o">:</span><span class="mf">1</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="o">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s2">&quot;&lt;b&gt;Text 1&lt;/b&gt;&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;2&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;Text 2&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;Doc 2&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;cat&quot;</span><span class="o">:</span><span class="mf">2</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="o">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s2">&quot;&lt;b&gt;Text 2&lt;/b&gt;&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">matchClause</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Text 1&quot;</span><span class="p">};</span>
<span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">matchClause</span><span class="p">};</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
<span class="nx">highlight</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewHighlight</span><span class="p">()</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetHighlight</span><span class="p">(</span><span class="nx">highlight</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">SearchRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">searchRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>


<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;took&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;timed_out&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;total&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="mi">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_source&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="s">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="s">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;cat&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;content&quot;</span><span class="p">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s">&quot;&lt;b&gt;Text 1&lt;/b&gt;&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="s">&quot;2&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="mi">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_source&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="s">&quot;Text 2&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="s">&quot;Doc 2&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;cat&quot;</span><span class="p">:</span><span class="mi">2</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;content&quot;</span><span class="p">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s">&quot;&lt;b&gt;Text 2&lt;/b&gt;&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>




<!-- end -->

</div>

</div>

<h2 id="highlighting-via-sql">Highlighting via SQL</h2>
<p>The <code>HIGHLIGHT()</code> function can be used to highlight search results. Here's the syntax:</p>
<div class="codehilite"><pre><span></span><code><span class="n">HIGHLIGHT</span><span class="p">([</span><span class="k">options</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="n">field_list</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="n">query</span><span class="p">]</span><span class="w"> </span><span class="p">)</span>
</code></pre></div>

<!-- example highlight() no args -->
<p>By default, it works with no arguments.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">HIGHLIGHT</span><span class="p">()</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;before&#39;</span><span class="p">);</span>
</code></pre></div>



<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">-----------------------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">highlight</span><span class="p">()</span><span class="w">                                               </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-----------------------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">door</span><span class="w"> </span><span class="n">opened</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="k">before</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">them</span><span class="p">,</span><span class="w"> </span><span class="n">revealing</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="n">room</span><span class="p">.</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-----------------------------------------------------------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example highlight() field syntax -->

<p><code>HIGHLIGHT()</code> retrieves all available full-text fields from document storage and highlights them against the provided query. Field syntax in queries is supported. Field text is separated by <code>field_separator</code>, which can be modified in the options.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">HIGHLIGHT</span><span class="p">()</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;@title one&#39;</span><span class="p">);</span>
</code></pre></div>



<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">-----------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">highlight</span><span class="p">()</span><span class="w">     </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-----------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Book</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">one</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-----------------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example highlight() options -->
<p>Optional first argument in <code>HIGHLIGHT()</code> is the list of options.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">HIGHLIGHT</span><span class="p">(</span><span class="err">{</span><span class="n">before_match</span><span class="o">=</span><span class="s1">&#39;[match]&#39;</span><span class="p">,</span><span class="n">after_match</span><span class="o">=</span><span class="s1">&#39;[/match]&#39;</span><span class="err">}</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;@title one&#39;</span><span class="p">);</span>
</code></pre></div>



<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">------------------------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">highlight</span><span class="p">(</span><span class="err">{</span><span class="n">before_match</span><span class="o">=</span><span class="s1">&#39;[match]&#39;</span><span class="p">,</span><span class="n">after_match</span><span class="o">=</span><span class="s1">&#39;[/match]&#39;</span><span class="err">}</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------------------------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Book</span><span class="w"> </span><span class="p">[</span><span class="k">match</span><span class="p">]</span><span class="n">one</span><span class="p">[</span><span class="o">/</span><span class="k">match</span><span class="p">]</span><span class="w">                                    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------------------------------------------------------------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example highlight() field list -->

<p>The optional second argument is a string containing a single field or a comma-separated list of fields. If this argument is present, only the specified fields will be fetched from document storage and highlighted. An empty string as the second argument signifies "fetch all available fields."</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">HIGHLIGHT</span><span class="p">(</span><span class="err">{}</span><span class="p">,</span><span class="s1">&#39;title,content&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;one|robots&#39;</span><span class="p">);</span>
</code></pre></div>



<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">highlight</span><span class="p">(</span><span class="err">{}</span><span class="p">,</span><span class="s1">&#39;title,content&#39;</span><span class="p">)</span><span class="w">                                                                                                                                                         </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Book</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">one</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">They</span><span class="w"> </span><span class="n">followed</span><span class="w"> </span><span class="n">Bander</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">robots</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">remained</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">polite</span><span class="w"> </span><span class="n">distance</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">their</span><span class="w"> </span><span class="n">presence</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">constantly</span><span class="w"> </span><span class="n">felt</span><span class="w"> </span><span class="n">threat</span><span class="p">.</span><span class="w">                                             </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Bander</span><span class="w"> </span><span class="n">ushered</span><span class="w"> </span><span class="k">all</span><span class="w"> </span><span class="n">three</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">room</span><span class="p">.</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">One</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">robots</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">followed</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">well</span><span class="p">.</span><span class="w"> </span><span class="n">Bander</span><span class="w"> </span><span class="n">gestured</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">robots</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">away</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">entered</span><span class="w"> </span><span class="n">itself</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">door</span><span class="w"> </span><span class="n">closed</span><span class="w"> </span><span class="n">behind</span><span class="w"> </span><span class="n">it</span><span class="p">.</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example highlight() string attr -->

<p>Alternatively, you can use the second argument to specify a string attribute or field name without quotes. In this case, the supplied string will be highlighted against the provided query, but field syntax will be ignored.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">HIGHLIGHT</span><span class="p">(</span><span class="err">{}</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">);</span>
</code></pre></div>



<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">highlight</span><span class="p">(</span><span class="err">{}</span><span class="p">,</span><span class="n">title</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Book</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">one</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w">     </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Book</span><span class="w"> </span><span class="n">five</span><span class="w">           </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+</span>
<span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example highlight() query -->

<p>The optional third argument is the query. This is used to highlight search results against a query different from the one used for searching.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">HIGHLIGHT</span><span class="p">(</span><span class="err">{}</span><span class="p">,</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;five&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">);</span>
</code></pre></div>



<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">-------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">highlight</span><span class="p">(</span><span class="err">{}</span><span class="p">,</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;five&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Book</span><span class="w"> </span><span class="n">one</span><span class="w">                      </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Book</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">five</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w">              </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------------------------+</span>
<span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example HIGHLIGHT TO_STRING -->

<p>Although <code>HIGHLIGHT()</code> is designed to work with stored full-text fields and string attributes, it can also be used to highlight arbitrary text. Keep in mind that if the query contains any field search operators (e.g., <code>@title hello @body world</code>), the field part of them is ignored in this case.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">HIGHLIGHT</span><span class="p">(</span><span class="err">{}</span><span class="p">,</span><span class="n">TO_STRING</span><span class="p">(</span><span class="s1">&#39;some text to highlight&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;highlight&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;@title one&#39;</span><span class="p">);</span>
</code></pre></div>



<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">----------------------------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">highlight</span><span class="p">(</span><span class="err">{}</span><span class="p">,</span><span class="n">TO_STRING</span><span class="p">(</span><span class="s1">&#39;some text to highlight&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;highlight&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------------------------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="k">some</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">highlight</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w">                                  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------------------------------------------------------------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<p>Several options are relevant only when generating a single string as a result (not an array of snippets). This applies exclusively to the SQL <code>HIGHLIGHT()</code> function:</p>
<h4 id="snippet_separator">snippet_separator</h4>
<p>A string to insert between snippets. The default is <code>...</code>.</p>
<h4 id="field_separator">field_separator</h4>
<p>A string to insert between fields. The default is <code>|</code>.</p>
<p>Another way to highlight text is to use the <a href="../13-searching.html#call-snippets">CALL SNIPPETS</a> statement. This mostly duplicates the <code>HIGHLIGHT()</code> functionality but cannot use built-in document storage. However, it can load source text from files.</p>
<h2 id="highlighting-via-http">Highlighting via HTTP</h2>
<!-- example highlight in JSON -->

<p>To highlight full-text search results in JSON queries via HTTP, field contents must be stored in document storage (enabled by default). In the example, full-text fields <code>content</code> and <code>title</code> are fetched from document storage and highlighted against the query specified in the <code>query</code> clause.</p>
<p>Highlighted snippets are returned in the <code>highlight</code> property of the <code>hits</code> array.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;books&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;one|robots&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2788</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Books one&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it. &quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;highlight&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;They followed Bander. The &lt;b&gt;robots&lt;/b&gt; remained at a polite distance, &quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot; three into the room. &lt;b&gt;One&lt;/b&gt; of the &lt;b&gt;robots&lt;/b&gt; followed as well. Bander&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot; gestured the other &lt;b&gt;robots&lt;/b&gt; away and entered itself. The&quot;</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;setName(&#39;books&#39;);</span>
<span class="x">$results = $index-&gt;search(&#39;one|robots&#39;)-&gt;highlight([&#39;content&#39;])-&gt;get();</span>
<span class="x">foreach($results as $doc)</span>
<span class="x">{</span>
<span class="x">    echo &#39;Document: &#39;.$doc-&gt;getId().&quot;\n&quot;;</span>
<span class="x">    foreach($doc-&gt;getData() as $field=&gt;$value)</span>
<span class="x">    {</span>
<span class="x">        echo $field.&#39; : &#39;.$value.&quot;\n&quot;;</span>
<span class="x">    }</span>
<span class="x">    foreach($doc-&gt;getHighlight() as $field=&gt;$snippets)</span>
<span class="x">    {</span>
<span class="x">        echo &quot;Highlight for &quot;.$field.&quot;:\n&quot;;</span>
<span class="x">        foreach($snippets as $snippet)</span>
<span class="x">        {</span>
<span class="x">            echo &quot;- &quot;.$snippet.&quot;\n&quot;;</span>
<span class="x">        }</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>



<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Document: 1</span>
<span class="x">title : Books one</span>
<span class="x">content : They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it.</span>
<span class="x">Highlight for content:</span>
<span class="x">- They followed Bander. The &lt;b&gt;robots&lt;/b&gt; remained at a polite distance,</span>
<span class="x">-  three into the room. &lt;b&gt;One&lt;/b&gt; of the &lt;b&gt;robots&lt;/b&gt; followed as well. Bander</span>
<span class="x">-  gestured the other &lt;b&gt;robots&lt;/b&gt; away and entered itself. The</span>
</code></pre></div>


<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">res</span> <span class="o">=</span> <span class="n">searchApi</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;books&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="p">:{</span><span class="s2">&quot;match&quot;</span><span class="p">:{</span><span class="s2">&quot;*&quot;</span><span class="p">:</span><span class="s2">&quot;one|robots&quot;</span><span class="p">}},</span><span class="s2">&quot;highlight&quot;</span><span class="p">:{</span><span class="s2">&quot;fields&quot;</span><span class="p">:[</span><span class="s2">&quot;content&quot;</span><span class="p">]}}))</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;aggregations&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">2788</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it. &#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Books one&#39;</span><span class="p">},</span>
                    <span class="sa">u</span><span class="s1">&#39;highlight&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;They followed Bander. The &lt;b&gt;robots&lt;/b&gt; remained at a polite distance, &#39;</span><span class="p">,</span>
                                                <span class="sa">u</span><span class="s1">&#39; three into the room. &lt;b&gt;One&lt;/b&gt; of the &lt;b&gt;robots&lt;/b&gt; followed as well. Bander&#39;</span><span class="p">,</span>
                                                <span class="sa">u</span><span class="s1">&#39; gestured the other &lt;b&gt;robots&lt;/b&gt; away and entered itself. The&#39;</span><span class="p">]}}],</span>
          <span class="s1">&#39;max_score&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
          <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>


<!-- request Javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="s2">&quot;books&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;match&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;*&quot;</span><span class="o">:</span><span class="s2">&quot;one|robots&quot;</span><span class="p">}},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]}});</span>
</code></pre></div>


<!-- response Javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">2788</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Books one&quot;</span><span class="p">,</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it. &quot;</span><span class="p">},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;They followed Bander. The &lt;b&gt;robots&lt;/b&gt; remained at a polite distance, &quot;</span><span class="p">,</span><span class="s2">&quot; three into the room. &lt;b&gt;One&lt;/b&gt; of the &lt;b&gt;robots&lt;/b&gt; followed as well. Bander&quot;</span><span class="p">,</span><span class="s2">&quot; gestured the other &lt;b&gt;robots&lt;/b&gt; away and entered itself. The&quot;</span><span class="p">]}}]}}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Java
</div>

<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">();</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;books&quot;</span><span class="p">);</span>
<span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">query</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;match&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">,</span><span class="s">&quot;one|robots&quot;</span><span class="p">);</span>
<span class="p">}});</span><span class="w">        </span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;fields&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;content&quot;</span><span class="p">});</span>
<span class="p">}};</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setHighlight</span><span class="p">(</span><span class="n">highlight</span><span class="p">);</span>
<span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>



<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">took</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">total</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="n">maxScore</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">        </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">2788</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=</span><span class="n">Books</span><span class="w"> </span><span class="n">one</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="n">They</span><span class="w"> </span><span class="n">followed</span><span class="w"> </span><span class="n">Bander</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">robots</span><span class="w"> </span><span class="n">remained</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">polite</span><span class="w"> </span><span class="n">distance</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">their</span><span class="w"> </span><span class="n">presence</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">constantly</span><span class="w"> </span><span class="n">felt</span><span class="w"> </span><span class="n">threat</span><span class="p">.</span><span class="w"> </span><span class="n">Bander</span><span class="w"> </span><span class="n">ushered</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">three</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">room</span><span class="p">.</span><span class="w"> </span><span class="n">One</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">robots</span><span class="w"> </span><span class="n">followed</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">well</span><span class="p">.</span><span class="w"> </span><span class="n">Bander</span><span class="w"> </span><span class="n">gestured</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">robots</span><span class="w"> </span><span class="n">away</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">entered</span><span class="w"> </span><span class="n">itself</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">door</span><span class="w"> </span><span class="n">closed</span><span class="w"> </span><span class="n">behind</span><span class="w"> </span><span class="n">it</span><span class="p">.</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">highlight</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=[</span><span class="n">Books</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">one</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;]</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="o">=[</span><span class="n">They</span><span class="w"> </span><span class="n">followed</span><span class="w"> </span><span class="n">Bander</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">robots</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">remained</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">polite</span><span class="w"> </span><span class="n">distance</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w">  </span><span class="n">three</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">room</span><span class="p">.</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">One</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">robots</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">followed</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">well</span><span class="p">.</span><span class="w"> </span><span class="n">Bander</span><span class="p">,</span><span class="w">  </span><span class="n">gestured</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">robots</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">away</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">entered</span><span class="w"> </span><span class="n">itself</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="o">]</span><span class="p">}}</span><span class="o">]</span>
<span class="w">        </span><span class="n">aggregations</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">profile</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;books&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">FulltextFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MatchFilter</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;one|robots&quot;</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Highlight</span><span class="p">();</span>
<span class="n">highlight</span><span class="o">.</span><span class="n">Fieldnames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">};</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">highlight</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="o">.</span><span class="n">Search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>



<!-- response C# -->

<div class="codehilite"><pre><span></span><code>class<span class="w"> </span>SearchResponse<span class="w"> </span>{
<span class="w">    </span>took:<span class="w"> </span>0
<span class="w">    </span>timedOut:<span class="w"> </span>false
<span class="w">    </span>hits:<span class="w"> </span>class<span class="w"> </span>SearchResponseHits<span class="w"> </span>{
<span class="w">        </span>total:<span class="w"> </span>1
<span class="w">        </span>maxScore:<span class="w"> </span>null
<span class="w">        </span>hits:<span class="w"> </span>[{_id=1,<span class="w"> </span>_score=2788,<span class="w"> </span>_source={title=Books<span class="w"> </span>one,<span class="w"> </span>content=They<span class="w"> </span>followed<span class="w"> </span>Bander.<span class="w"> </span>The<span class="w"> </span>robots<span class="w"> </span>remained<span class="w"> </span>at<span class="w"> </span>a<span class="w"> </span>polite<span class="w"> </span>distance,<span class="w"> </span>but<span class="w"> </span>their<span class="w"> </span>presence<span class="w"> </span>was<span class="w"> </span>a<span class="w"> </span>constantly<span class="w"> </span>felt<span class="w"> </span>threat.<span class="w"> </span>Bander<span class="w"> </span>ushered<span class="w"> </span>all<span class="w"> </span>three<span class="w"> </span>into<span class="w"> </span>the<span class="w"> </span>room.<span class="w"> </span>One<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>robots<span class="w"> </span>followed<span class="w"> </span>as<span class="w"> </span>well.<span class="w"> </span>Bander<span class="w"> </span>gestured<span class="w"> </span>the<span class="w"> </span>other<span class="w"> </span>robots<span class="w"> </span>away<span class="w"> </span>and<span class="w"> </span>entered<span class="w"> </span>itself.<span class="w"> </span>The<span class="w"> </span>door<span class="w"> </span>closed<span class="w"> </span>behind<span class="w"> </span>it.<span class="w"> </span>},<span class="w"> </span>highlight={title=[Books<span class="w"> </span><span class="nt">&lt;b&gt;</span>one<span class="nt">&lt;/b&gt;</span>],<span class="w"> </span>content=[They<span class="w"> </span>followed<span class="w"> </span>Bander.<span class="w"> </span>The<span class="w"> </span><span class="nt">&lt;b&gt;</span>robots<span class="nt">&lt;/b&gt;</span><span class="w"> </span>remained<span class="w"> </span>at<span class="w"> </span>a<span class="w"> </span>polite<span class="w"> </span>distance,<span class="w"> </span>,<span class="w">  </span>three<span class="w"> </span>into<span class="w"> </span>the<span class="w"> </span>room.<span class="w"> </span><span class="nt">&lt;b&gt;</span>One<span class="nt">&lt;/b&gt;</span><span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span><span class="nt">&lt;b&gt;</span>robots<span class="nt">&lt;/b&gt;</span><span class="w"> </span>followed<span class="w"> </span>as<span class="w"> </span>well.<span class="w"> </span>Bander,<span class="w">  </span>gestured<span class="w"> </span>the<span class="w"> </span>other<span class="w"> </span><span class="nt">&lt;b&gt;</span>robots<span class="nt">&lt;/b&gt;</span><span class="w"> </span>away<span class="w"> </span>and<span class="w"> </span>entered<span class="w"> </span>itself.<span class="w"> </span>The]}}]
<span class="w">        </span>aggregations:<span class="w"> </span>null
<span class="w">    </span>}
<span class="w">    </span>profile:<span class="w"> </span>null
}
</code></pre></div>



<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">match</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="o">*:</span><span class="w"> </span><span class="s1">&#39;Text 1|Text 9&#39;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">highlight</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span>
<span class="p">});</span>
</code></pre></div>


<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;cat&quot;</span><span class="o">:</span><span class="mf">1</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="o">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s2">&quot;&lt;b&gt;Text 1&lt;/b&gt;&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">matchClause</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Text 1|Text 9&quot;</span><span class="p">};</span>
<span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">matchClause</span><span class="p">};</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
<span class="nx">highlight</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewHighlight</span><span class="p">()</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetHighlight</span><span class="p">(</span><span class="nx">highlight</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">SearchRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">searchRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>


<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;took&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;timed_out&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;total&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="mi">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_source&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="s">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="s">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;cat&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;content&quot;</span><span class="p">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s">&quot;&lt;b&gt;Text 1&lt;/b&gt;&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example highlight JSON all field  -->

<p>To highlight all possible fields, pass an empty object as the <code>highlight</code> property.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>
<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;books&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;one|robots&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;highlight&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2788</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Books one&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it. &quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;highlight&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;Books &lt;b&gt;one&lt;/b&gt;&quot;</span>
<span class="w">          </span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;They followed Bander. The &lt;b&gt;robots&lt;/b&gt; remained at a polite distance, &quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot; three into the room. &lt;b&gt;One&lt;/b&gt; of the &lt;b&gt;robots&lt;/b&gt; followed as well. Bander&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot; gestured the other &lt;b&gt;robots&lt;/b&gt; away and entered itself. The&quot;</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;setName(&#39;books&#39;);</span>
<span class="x">$results = $index-&gt;search(&#39;one|robots&#39;)-&gt;highlight()-&gt;get();</span>
<span class="x">foreach($results as $doc)</span>
<span class="x">{</span>
<span class="x">    echo &#39;Document: &#39;.$doc-&gt;getId().&quot;\n&quot;;</span>
<span class="x">    foreach($doc-&gt;getData() as $field=&gt;$value)</span>
<span class="x">    {</span>
<span class="x">        echo $field.&#39; : &#39;.$value.&quot;\n&quot;;</span>
<span class="x">    }</span>
<span class="x">    foreach($doc-&gt;getHighlight() as $field=&gt;$snippets)</span>
<span class="x">    {</span>
<span class="x">        echo &quot;Highlight for &quot;.$field.&quot;:\n&quot;;</span>
<span class="x">        foreach($snippets as $snippet)</span>
<span class="x">        {</span>
<span class="x">            echo &quot;- &quot;.$snippet.&quot;\n&quot;;</span>
<span class="x">        }</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>



<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Document: 1</span>
<span class="x">title : Books one</span>
<span class="x">content : They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it.</span>
<span class="x">Highlight for title:</span>
<span class="x">- Books &lt;b&gt;one&lt;/b&gt;</span>
<span class="x">Highlight for content:</span>
<span class="x">- They followed Bander. The &lt;b&gt;robots&lt;/b&gt; remained at a polite distance,</span>
<span class="x">-  three into the room. &lt;b&gt;One&lt;/b&gt; of the &lt;b&gt;robots&lt;/b&gt; followed as well. Bander</span>
<span class="x">-  gestured the other &lt;b&gt;robots&lt;/b&gt; away and entered itself. The</span>
</code></pre></div>


<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">res</span> <span class="o">=</span> <span class="n">searchApi</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;books&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="p">:{</span><span class="s2">&quot;match&quot;</span><span class="p">:{</span><span class="s2">&quot;*&quot;</span><span class="p">:</span><span class="s2">&quot;one|robots&quot;</span><span class="p">}},</span><span class="s2">&quot;highlight&quot;</span><span class="p">:{}})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;aggregations&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">2788</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it. &#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Books one&#39;</span><span class="p">},</span>
                    <span class="sa">u</span><span class="s1">&#39;highlight&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;They followed Bander. The &lt;b&gt;robots&lt;/b&gt; remained at a polite distance, &#39;</span><span class="p">,</span>
                                                <span class="sa">u</span><span class="s1">&#39; three into the room. &lt;b&gt;One&lt;/b&gt; of the &lt;b&gt;robots&lt;/b&gt; followed as well. Bander&#39;</span><span class="p">,</span>
                                                <span class="sa">u</span><span class="s1">&#39; gestured the other &lt;b&gt;robots&lt;/b&gt; away and entered itself. The&#39;</span><span class="p">],</span>
                                   <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Books &lt;b&gt;one&lt;/b&gt;&#39;</span><span class="p">]}}],</span>
          <span class="s1">&#39;max_score&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
          <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>


<!-- request Javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="s2">&quot;books&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;match&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;*&quot;</span><span class="o">:</span><span class="s2">&quot;one|robots&quot;</span><span class="p">}},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{}});</span>
</code></pre></div>


<!-- response Javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">2788</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Books one&quot;</span><span class="p">,</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it. &quot;</span><span class="p">},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;Books &lt;b&gt;one&lt;/b&gt;&quot;</span><span class="p">],</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;They followed Bander. The &lt;b&gt;robots&lt;/b&gt; remained at a polite distance, &quot;</span><span class="p">,</span><span class="s2">&quot; three into the room. &lt;b&gt;One&lt;/b&gt; of the &lt;b&gt;robots&lt;/b&gt; followed as well. Bander&quot;</span><span class="p">,</span><span class="s2">&quot; gestured the other &lt;b&gt;robots&lt;/b&gt; away and entered itself. The&quot;</span><span class="p">]}}]}}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Java
</div>

<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">();</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;books&quot;</span><span class="p">);</span>
<span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">query</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;match&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">,</span><span class="s">&quot;one|robots&quot;</span><span class="p">);</span>
<span class="p">}});</span><span class="w">        </span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="p">}};</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setHighlight</span><span class="p">(</span><span class="n">highlight</span><span class="p">);</span>
<span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>



<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">took</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">total</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="n">maxScore</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">        </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">2788</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=</span><span class="n">Books</span><span class="w"> </span><span class="n">one</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="n">They</span><span class="w"> </span><span class="n">followed</span><span class="w"> </span><span class="n">Bander</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">robots</span><span class="w"> </span><span class="n">remained</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">polite</span><span class="w"> </span><span class="n">distance</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">their</span><span class="w"> </span><span class="n">presence</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">constantly</span><span class="w"> </span><span class="n">felt</span><span class="w"> </span><span class="n">threat</span><span class="p">.</span><span class="w"> </span><span class="n">Bander</span><span class="w"> </span><span class="n">ushered</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">three</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">room</span><span class="p">.</span><span class="w"> </span><span class="n">One</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">robots</span><span class="w"> </span><span class="n">followed</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">well</span><span class="p">.</span><span class="w"> </span><span class="n">Bander</span><span class="w"> </span><span class="n">gestured</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">robots</span><span class="w"> </span><span class="n">away</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">entered</span><span class="w"> </span><span class="n">itself</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">door</span><span class="w"> </span><span class="n">closed</span><span class="w"> </span><span class="n">behind</span><span class="w"> </span><span class="n">it</span><span class="p">.</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">highlight</span><span class="o">=</span><span class="p">{</span><span class="n">title</span><span class="o">=[</span><span class="n">Books</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">one</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;]</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="o">=[</span><span class="n">They</span><span class="w"> </span><span class="n">followed</span><span class="w"> </span><span class="n">Bander</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">robots</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">remained</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">polite</span><span class="w"> </span><span class="n">distance</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w">  </span><span class="n">three</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">room</span><span class="p">.</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">One</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">robots</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">followed</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">well</span><span class="p">.</span><span class="w"> </span><span class="n">Bander</span><span class="p">,</span><span class="w">  </span><span class="n">gestured</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">robots</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">away</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">entered</span><span class="w"> </span><span class="n">itself</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="o">]</span><span class="p">}}</span><span class="o">]</span>
<span class="w">        </span><span class="n">aggregations</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">profile</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;books&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">FulltextFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MatchFilter</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;one|robots&quot;</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Highlight</span><span class="p">();</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">highlight</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="o">.</span><span class="n">Search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>



<!-- response C# -->

<div class="codehilite"><pre><span></span><code>class<span class="w"> </span>SearchResponse<span class="w"> </span>{
<span class="w">    </span>took:<span class="w"> </span>0
<span class="w">    </span>timedOut:<span class="w"> </span>false
<span class="w">    </span>hits:<span class="w"> </span>class<span class="w"> </span>SearchResponseHits<span class="w"> </span>{
<span class="w">        </span>total:<span class="w"> </span>1
<span class="w">        </span>maxScore:<span class="w"> </span>null
<span class="w">        </span>hits:<span class="w"> </span>[{_id=1,<span class="w"> </span>_score=2788,<span class="w"> </span>_source={title=Books<span class="w"> </span>one,<span class="w"> </span>content=They<span class="w"> </span>followed<span class="w"> </span>Bander.<span class="w"> </span>The<span class="w"> </span>robots<span class="w"> </span>remained<span class="w"> </span>at<span class="w"> </span>a<span class="w"> </span>polite<span class="w"> </span>distance,<span class="w"> </span>but<span class="w"> </span>their<span class="w"> </span>presence<span class="w"> </span>was<span class="w"> </span>a<span class="w"> </span>constantly<span class="w"> </span>felt<span class="w"> </span>threat.<span class="w"> </span>Bander<span class="w"> </span>ushered<span class="w"> </span>all<span class="w"> </span>three<span class="w"> </span>into<span class="w"> </span>the<span class="w"> </span>room.<span class="w"> </span>One<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>robots<span class="w"> </span>followed<span class="w"> </span>as<span class="w"> </span>well.<span class="w"> </span>Bander<span class="w"> </span>gestured<span class="w"> </span>the<span class="w"> </span>other<span class="w"> </span>robots<span class="w"> </span>away<span class="w"> </span>and<span class="w"> </span>entered<span class="w"> </span>itself.<span class="w"> </span>The<span class="w"> </span>door<span class="w"> </span>closed<span class="w"> </span>behind<span class="w"> </span>it.<span class="w"> </span>},<span class="w"> </span>highlight={title=[Books<span class="w"> </span><span class="nt">&lt;b&gt;</span>one<span class="nt">&lt;/b&gt;</span>],<span class="w"> </span>content=[They<span class="w"> </span>followed<span class="w"> </span>Bander.<span class="w"> </span>The<span class="w"> </span><span class="nt">&lt;b&gt;</span>robots<span class="nt">&lt;/b&gt;</span><span class="w"> </span>remained<span class="w"> </span>at<span class="w"> </span>a<span class="w"> </span>polite<span class="w"> </span>distance,<span class="w"> </span>,<span class="w">  </span>three<span class="w"> </span>into<span class="w"> </span>the<span class="w"> </span>room.<span class="w"> </span><span class="nt">&lt;b&gt;</span>One<span class="nt">&lt;/b&gt;</span><span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span><span class="nt">&lt;b&gt;</span>robots<span class="nt">&lt;/b&gt;</span><span class="w"> </span>followed<span class="w"> </span>as<span class="w"> </span>well.<span class="w"> </span>Bander,<span class="w">  </span>gestured<span class="w"> </span>the<span class="w"> </span>other<span class="w"> </span><span class="nt">&lt;b&gt;</span>robots<span class="nt">&lt;/b&gt;</span><span class="w"> </span>away<span class="w"> </span>and<span class="w"> </span>entered<span class="w"> </span>itself.<span class="w"> </span>The]}}]
<span class="w">        </span>aggregations:<span class="w"> </span>null
<span class="w">    </span>}
<span class="w">    </span>profile:<span class="w"> </span>null
}
</code></pre></div>



<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">match</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="o">*:</span><span class="w"> </span><span class="s1">&#39;Text 1|Doc 1&#39;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">highlight</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span>
<span class="p">});</span>
</code></pre></div>


<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;cat&quot;</span><span class="o">:</span><span class="mf">1</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="o">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s2">&quot;&lt;b&gt;Text 1&lt;/b&gt;&quot;</span>
<span class="w">                </span><span class="p">],</span>
<span class="w">                </span><span class="s2">&quot;name&quot;</span><span class="o">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s2">&quot;&lt;b&gt;Doc 1&lt;/b&gt;&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">matchClause</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Text 1|Doc 1&quot;</span><span class="p">};</span>
<span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">matchClause</span><span class="p">};</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
<span class="nx">highlight</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewHighlight</span><span class="p">()</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetHighlight</span><span class="p">(</span><span class="nx">highlight</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">SearchRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">searchRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>


<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;took&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;timed_out&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;total&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="mi">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_source&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="s">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="s">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;cat&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;content&quot;</span><span class="p">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s">&quot;&lt;b&gt;Text 1&lt;/b&gt;&quot;</span>
<span class="w">                </span><span class="p">],</span>
<span class="w">                </span><span class="s">&quot;name&quot;</span><span class="p">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s">&quot;&lt;b&gt;Doc 1&lt;/b&gt;&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>




<!-- end -->

</div>

</div>

<p>In addition to common highlighting options, several synonyms are available for JSON queries via HTTP:</p>
<h4 id="fields">fields</h4>
<p>The <code>fields</code> object contains attribute names with options. It can also be an array of field names (without any options).</p>
<p>Note that by default, highlighting attempts to highlight the results following the full-text query. In a general case, when you don't specify fields to highlight, the highlight is based on your full-text query. However, if you specify fields to highlight, it highlights only if the full-text query matches the selected fields.</p>
<h4 id="encoder">encoder</h4>
<p>The <code>encoder</code> can be set to <code>default</code> or <code>html</code>. When set to <code>html</code>, it retains HTML markup when highlighting. This works similarly to the <code>html_strip_mode=retain</code> option.</p>
<!-- example highlight_query -->
<h4 id="highlight_query">highlight_query</h4>
<p>The <code>highlight_query</code> option allows you to highlight against a query other than your search query. The syntax is the same as in the main <code>query</code>.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>
<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;books&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;one|robots&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;content&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;highlight_query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;*&quot;</span><span class="p">:</span><span class="s2">&quot;polite distance&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;setName(&#39;books&#39;);</span>
<span class="x">$bool = new \Manticoresearch\Query\BoolQuery();</span>
<span class="x">$bool-&gt;must(new \Manticoresearch\Query\Match([&#39;query&#39; =&gt; &#39;one|robots&#39;], &#39;content&#39;));</span>

<span class="x">$results = $index-&gt;search($bool)-&gt;highlight([&#39;content&#39;],[&#39;highlight_query&#39;=&gt;[&#39;match&#39;=&gt;[&#39;*&#39;=&gt;&#39;polite distance&#39;]]])-&gt;get();</span>
<span class="x">foreach($results as $doc)</span>
<span class="x">{</span>
<span class="x">    echo &#39;Document: &#39;.$doc-&gt;getId().&quot;\n&quot;;</span>
<span class="x">    foreach($doc-&gt;getData() as $field=&gt;$value)</span>
<span class="x">    {</span>
<span class="x">        echo $field.&#39; : &#39;.$value.&quot;\n&quot;;</span>
<span class="x">    }</span>
<span class="x">    foreach($doc-&gt;getHighlight() as $field=&gt;$snippets)</span>
<span class="x">    {</span>
<span class="x">        echo &quot;Highlight for &quot;.$field.&quot;:\n&quot;;</span>
<span class="x">        foreach($snippets as $snippet)</span>
<span class="x">        {</span>
<span class="x">            echo &quot;- &quot;.$snippet.&quot;\n&quot;;</span>
<span class="x">        }</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>



<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">res</span> <span class="o">=</span> <span class="n">searchApi</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;books&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="p">:{</span><span class="s2">&quot;match&quot;</span><span class="p">:{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span><span class="s2">&quot;one|robots&quot;</span><span class="p">}},</span><span class="s2">&quot;highlight&quot;</span><span class="p">:{</span><span class="s2">&quot;fields&quot;</span><span class="p">:[</span><span class="s2">&quot;content&quot;</span><span class="p">],</span><span class="s2">&quot;highlight_query&quot;</span><span class="p">:{</span><span class="s2">&quot;match&quot;</span><span class="p">:{</span><span class="s2">&quot;*&quot;</span><span class="p">:</span><span class="s2">&quot;polite distance&quot;</span><span class="p">}}}})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;aggregations&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">1788</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it. &#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Books one&#39;</span><span class="p">},</span>
                    <span class="sa">u</span><span class="s1">&#39;highlight&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;. The robots remained at a &lt;b&gt;polite distance&lt;/b&gt;, but their presence was a&#39;</span><span class="p">]}}],</span>
          <span class="s1">&#39;max_score&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
          <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>



<!-- request Javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="s2">&quot;books&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;match&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;one|robots&quot;</span><span class="p">}},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">],</span><span class="s2">&quot;highlight_query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;match&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;*&quot;</span><span class="o">:</span><span class="s2">&quot;polite distance&quot;</span><span class="p">}}}});</span>
</code></pre></div>


<!-- response Javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1788</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Books one&quot;</span><span class="p">,</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it. &quot;</span><span class="p">},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;. The robots remained at a &lt;b&gt;polite distance&lt;/b&gt;, but their presence was a&quot;</span><span class="p">]}}]}}</span>
</code></pre></div>




<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Java
</div>

<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">();</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;books&quot;</span><span class="p">);</span>
<span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">query</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;match&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">,</span><span class="s">&quot;one|robots&quot;</span><span class="p">);</span>
<span class="p">}});</span><span class="w">        </span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="n">put</span><span class="p">(</span><span class="s">&quot;fields&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;content&quot;</span><span class="p">,</span><span class="s">&quot;title&quot;</span><span class="p">});</span>
<span class="n">put</span><span class="p">(</span><span class="s">&quot;highlight_query&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;match&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">            </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">,</span><span class="s">&quot;polite distance&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}});</span>
<span class="w">    </span><span class="p">}});</span>
<span class="p">}};</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setHighlight</span><span class="p">(</span><span class="n">highlight</span><span class="p">);</span>
<span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;books&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">FulltextFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MatchFilter</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;one|robots&quot;</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Highlight</span><span class="p">();</span>
<span class="n">highlight</span><span class="o">.</span><span class="n">Fieldnames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="p">};</span>
<span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="p">();</span><span class="w"> </span>
<span class="k">match</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;polite distance&quot;</span><span class="p">);</span>
<span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">highlightQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="p">();</span><span class="w"> </span>
<span class="n">highlightQuery</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;match&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">match</span><span class="p">);</span>
<span class="n">highlight</span><span class="o">.</span><span class="n">HighlightQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">highlightQuery</span><span class="p">;</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">highlight</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="o">.</span><span class="n">Search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>



<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">match</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="o">*:</span><span class="w"> </span><span class="s1">&#39;Text 1&#39;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">highlight</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fields</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">],</span>
<span class="w">    </span><span class="nx">highlight_query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">match</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="o">*:</span><span class="w"> </span><span class="s1">&#39;Text&#39;</span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>


<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;cat&quot;</span><span class="o">:</span><span class="mf">1</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="o">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s2">&quot;&lt;b&gt;Text&lt;/b&gt; 1&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">matchClause</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Text 1&quot;</span><span class="p">};</span>
<span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">matchClause</span><span class="p">};</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
<span class="nx">highlight</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewHighlight</span><span class="p">()</span>
<span class="nx">highlightField</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NetHighlightField</span><span class="p">(</span><span class="s">&quot;content&quot;</span><span class="p">)</span>
<span class="nx">highlightFields</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">highlightField</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<span class="nx">highlight</span><span class="p">.</span><span class="nx">SetFields</span><span class="p">(</span><span class="nx">highlightFields</span><span class="p">)</span>
<span class="nx">queryMatchClause</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Text&quot;</span><span class="p">};</span>
<span class="nx">highlightQuery</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">queryMatchClause</span><span class="p">};</span>
<span class="nx">highlight</span><span class="p">.</span><span class="nx">SetHighlightQuery</span><span class="p">(</span><span class="nx">highlightQuery</span><span class="p">)</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetHighlight</span><span class="p">(</span><span class="nx">highlight</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">SearchRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">searchRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>


<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;took&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;timed_out&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;total&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="mi">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_source&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="s">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="s">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;cat&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;content&quot;</span><span class="p">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s">&quot;&lt;b&gt;Text&lt;/b&gt; 1&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example pre_tags  -->

<h4 id="pre_tags-and-post_tags">pre_tags and post_tags</h4>
<p><code>pre_tags</code> and <code>post_tags</code> set the opening and closing tags for highlighted text snippets. They function similarly to the <code>before_match</code> and <code>after_match</code> options. These are optional, with default values of <code>&lt;b&gt;</code> and <code>&lt;/b&gt;</code>.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>
<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;books&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;one|robots&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;content&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;pre_tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;before_&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;post_tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;_after&quot;</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;setName(&#39;books&#39;);</span>
<span class="x">$bool = new \Manticoresearch\Query\BoolQuery();</span>
<span class="x">$bool-&gt;must(new \Manticoresearch\Query\Match([&#39;query&#39; =&gt; &#39;one|robots&#39;], &#39;*&#39;));</span>

<span class="x">$results = $index-&gt;search($bool)-&gt;highlight([&#39;content&#39;,&#39;title&#39;],[&#39;pre_tags&#39;=&gt;&#39;before_&#39;,&#39;post_tags&#39;=&gt;&#39;_after&#39;])-&gt;get();</span>
<span class="x">foreach($results as $doc)</span>
<span class="x">{</span>
<span class="x">    echo &#39;Document: &#39;.$doc-&gt;getId().&quot;\n&quot;;</span>
<span class="x">    foreach($doc-&gt;getData() as $field=&gt;$value)</span>
<span class="x">    {</span>
<span class="x">        echo $field.&#39; : &#39;.$value.&quot;\n&quot;;</span>
<span class="x">    }</span>
<span class="x">    foreach($doc-&gt;getHighlight() as $field=&gt;$snippets)</span>
<span class="x">    {</span>
<span class="x">        echo &quot;Highlight for &quot;.$field.&quot;:\n&quot;;</span>
<span class="x">        foreach($snippets as $snippet)</span>
<span class="x">        {</span>
<span class="x">            echo &quot;- &quot;.$snippet.&quot;\n&quot;;</span>
<span class="x">        }</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>


<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Document: 1</span>
<span class="x">title : Books one</span>
<span class="x">content : They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it.</span>
<span class="x">Highlight for content:</span>
<span class="x">- They followed Bander. The before_robots_after remained at a polite distance,</span>
<span class="x">-  three into the room. before_One_after of the before_robots_after followed as well. Bander</span>
<span class="x">-  gestured the other before_robots_after away and entered itself. The</span>
<span class="x">Highlight for title:</span>
<span class="x">- Books before_one_after</span>
</code></pre></div>


<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">res</span> <span class="o">=</span> <span class="n">searchApi</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;books&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="p">:{</span><span class="s2">&quot;match&quot;</span><span class="p">:{</span><span class="s2">&quot;*&quot;</span><span class="p">:</span><span class="s2">&quot;one|robots&quot;</span><span class="p">}},</span><span class="s2">&quot;highlight&quot;</span><span class="p">:{</span><span class="s2">&quot;fields&quot;</span><span class="p">:[</span><span class="s2">&quot;content&quot;</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">],</span><span class="s2">&quot;pre_tags&quot;</span><span class="p">:</span><span class="s2">&quot;before_&quot;</span><span class="p">,</span><span class="s2">&quot;post_tags&quot;</span><span class="p">:</span><span class="s2">&quot;_after&quot;</span><span class="p">}})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;aggregations&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">2788</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it. &#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Books one&#39;</span><span class="p">},</span>
                    <span class="sa">u</span><span class="s1">&#39;highlight&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;They followed Bander. The before_robots_after remained at a polite distance, &#39;</span><span class="p">,</span>
                                                <span class="sa">u</span><span class="s1">&#39; three into the room. before_One_after of the before_robots_after followed as well. Bander&#39;</span><span class="p">,</span>
                                                <span class="sa">u</span><span class="s1">&#39; gestured the other before_robots_after away and entered itself. The&#39;</span><span class="p">],</span>
                                   <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Books before_one_after&#39;</span><span class="p">]}}],</span>
          <span class="s1">&#39;max_score&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
          <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>



<!-- request Javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="s2">&quot;books&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;match&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;*&quot;</span><span class="o">:</span><span class="s2">&quot;one|robots&quot;</span><span class="p">}},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">],</span><span class="s2">&quot;pre_tags&quot;</span><span class="o">:</span><span class="s2">&quot;before_&quot;</span><span class="p">,</span><span class="s2">&quot;post_tags&quot;</span><span class="o">:</span><span class="s2">&quot;_after&quot;</span><span class="p">}});</span>
</code></pre></div>


<!-- response Javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">2788</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Books one&quot;</span><span class="p">,</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it. &quot;</span><span class="p">},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;They followed Bander. The before_robots_after remained at a polite distance, &quot;</span><span class="p">,</span><span class="s2">&quot; three into the room. before_One_after of the before_robots_after followed as well. Bander&quot;</span><span class="p">,</span><span class="s2">&quot; gestured the other before_robots_after away and entered itself. The&quot;</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;Books before_one_after&quot;</span><span class="p">]}}]}}</span>
</code></pre></div>




<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Java
</div>

<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">();</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;books&quot;</span><span class="p">);</span>
<span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">query</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;match&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">,</span><span class="s">&quot;one|robots&quot;</span><span class="p">);</span>
<span class="p">}});</span><span class="w">        </span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;fields&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;content&quot;</span><span class="p">,</span><span class="s">&quot;title&quot;</span><span class="p">});</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;pre_tags&quot;</span><span class="p">,</span><span class="s">&quot;before_&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;post_tags&quot;</span><span class="p">,</span><span class="s">&quot;_after&quot;</span><span class="p">);</span>
<span class="p">}};</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setHighlight</span><span class="p">(</span><span class="n">highlight</span><span class="p">);</span>
<span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;books&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">FulltextFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MatchFilter</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;one|robots&quot;</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Highlight</span><span class="p">();</span>
<span class="n">highlight</span><span class="o">.</span><span class="n">Fieldnames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="p">};</span>
<span class="n">highlight</span><span class="o">.</span><span class="n">PreTags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;before_&quot;</span><span class="p">;</span>
<span class="n">highlight</span><span class="o">.</span><span class="n">PostTags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;_after&quot;</span><span class="p">;</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">highlight</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="o">.</span><span class="n">Search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>



<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">match</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="o">*:</span><span class="w"> </span><span class="s1">&#39;Text 1&#39;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">highlight</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">pre_tags</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;before_&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">post_tags</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;_after&#39;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>


<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;cat&quot;</span><span class="o">:</span><span class="mf">1</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="o">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s2">&quot;before_Text 1_after&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">matchClause</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Text 1&quot;</span><span class="p">}</span>
<span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">matchClause</span><span class="p">}</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
<span class="nx">highlight</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewHighlight</span><span class="p">()</span>
<span class="nx">highlight</span><span class="p">.</span><span class="nx">SetPreTags</span><span class="p">(</span><span class="s">&quot;before_&quot;</span><span class="p">)</span>
<span class="nx">highlight</span><span class="p">.</span><span class="nx">SetPostTags</span><span class="p">(</span><span class="s">&quot;_after&quot;</span><span class="p">)</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetHighlight</span><span class="p">(</span><span class="nx">highlight</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">SearchRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">searchRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>


<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;took&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;timed_out&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;total&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="mi">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_source&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="s">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="s">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;cat&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;content&quot;</span><span class="p">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s">&quot;before_Text 1_after&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example no_match_size  -->
<h4 id="no_match_size">no_match_size</h4>
<p><code>no_match_size</code> functions similarly to the <code>allow_empty</code> option. If set to 0, it acts as <code>allow_empty=1</code>, allowing an empty string to be returned as a highlighting result when a snippet could not be generated. Otherwise, the beginning of the field will be returned. This is optional, with a default value of 1.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>
<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;books&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;one|robots&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;content&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;no_match_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;setName(&#39;books&#39;);</span>
<span class="x">$bool = new \Manticoresearch\Query\BoolQuery();</span>
<span class="x">$bool-&gt;must(new \Manticoresearch\Query\Match([&#39;query&#39; =&gt; &#39;one|robots&#39;], &#39;*&#39;));</span>

<span class="x">$results = $index-&gt;search($bool)-&gt;highlight([&#39;content&#39;,&#39;title&#39;],[&#39;no_match_size&#39;=&gt;0])-&gt;get();</span>
<span class="x">foreach($results as $doc)</span>
<span class="x">{</span>
<span class="x">    echo &#39;Document: &#39;.$doc-&gt;getId().&quot;\n&quot;;</span>
<span class="x">    foreach($doc-&gt;getData() as $field=&gt;$value)</span>
<span class="x">    {</span>
<span class="x">        echo $field.&#39; : &#39;.$value.&quot;\n&quot;;</span>
<span class="x">    }</span>
<span class="x">    foreach($doc-&gt;getHighlight() as $field=&gt;$snippets)</span>
<span class="x">    {</span>
<span class="x">        echo &quot;Highlight for &quot;.$field.&quot;:\n&quot;;</span>
<span class="x">        foreach($snippets as $snippet)</span>
<span class="x">        {</span>
<span class="x">            echo &quot;- &quot;.$snippet.&quot;\n&quot;;</span>
<span class="x">        }</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>


<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Document: 1</span>
<span class="x">title : Books one</span>
<span class="x">content : They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it.</span>
<span class="x">Highlight for content:</span>
<span class="x">- They followed Bander. The &lt;b&gt;robots&lt;/b&gt; remained at a polite distance,</span>
<span class="x">-  three into the room. &lt;b&gt;One&lt;/b&gt; of the &lt;b&gt;robots&lt;/b&gt; followed as well. Bander</span>
<span class="x">-  gestured the other &lt;b&gt;robots&lt;/b&gt; away and entered itself. The</span>
<span class="x">Highlight for title:</span>
<span class="x">- Books &lt;b&gt;one&lt;/b&gt;</span>
</code></pre></div>


<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">res</span> <span class="o">=</span> <span class="n">searchApi</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;books&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="p">:{</span><span class="s2">&quot;match&quot;</span><span class="p">:{</span><span class="s2">&quot;*&quot;</span><span class="p">:</span><span class="s2">&quot;one|robots&quot;</span><span class="p">}},</span><span class="s2">&quot;highlight&quot;</span><span class="p">:{</span><span class="s2">&quot;fields&quot;</span><span class="p">:[</span><span class="s2">&quot;content&quot;</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">],</span><span class="s2">&quot;no_match_size&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">}})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;aggregations&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">2788</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it. &#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Books one&#39;</span><span class="p">},</span>
                    <span class="sa">u</span><span class="s1">&#39;highlight&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;They followed Bander. The &lt;b&gt;robots&lt;/b&gt; remained at a polite distance, &#39;</span><span class="p">,</span>
                                                <span class="sa">u</span><span class="s1">&#39; three into the room. &lt;b&gt;One&lt;/b&gt; of the &lt;b&gt;robots&lt;/b&gt; followed as well. Bander&#39;</span><span class="p">,</span>
                                                <span class="sa">u</span><span class="s1">&#39; gestured the other &lt;b&gt;robots&lt;/b&gt; away and entered itself. The&#39;</span><span class="p">],</span>
                                   <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Books &lt;b&gt;one&lt;/b&gt;&#39;</span><span class="p">]}}],</span>
          <span class="s1">&#39;max_score&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
          <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>



<!-- request Javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="s2">&quot;books&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;match&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;*&quot;</span><span class="o">:</span><span class="s2">&quot;one|robots&quot;</span><span class="p">}},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">],</span><span class="s2">&quot;no_match_size&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">}});</span>
</code></pre></div>


<!-- response Javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">2788</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Books one&quot;</span><span class="p">,</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it. &quot;</span><span class="p">},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;They followed Bander. The &lt;b&gt;robots&lt;/b&gt; remained at a polite distance, &quot;</span><span class="p">,</span><span class="s2">&quot; three into the room. &lt;b&gt;One&lt;/b&gt; of the &lt;b&gt;robots&lt;/b&gt; followed as well. Bander&quot;</span><span class="p">,</span><span class="s2">&quot; gestured the other &lt;b&gt;robots&lt;/b&gt; away and entered itself. The&quot;</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;Books &lt;b&gt;one&lt;/b&gt;&quot;</span><span class="p">]}}]}}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Java
</div>

<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">();</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;books&quot;</span><span class="p">);</span>
<span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">query</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;match&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">,</span><span class="s">&quot;one|robots&quot;</span><span class="p">);</span>
<span class="p">}});</span><span class="w">        </span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;fields&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;content&quot;</span><span class="p">,</span><span class="s">&quot;title&quot;</span><span class="p">});</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;no_match_size&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}};</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setHighlight</span><span class="p">(</span><span class="n">highlight</span><span class="p">);</span>
<span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;books&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">FulltextFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MatchFilter</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;one|robots&quot;</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Highlight</span><span class="p">();</span>
<span class="n">highlight</span><span class="o">.</span><span class="n">Fieldnames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="p">};</span>
<span class="n">highlight</span><span class="o">.</span><span class="n">NoMatchSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">highlight</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="o">.</span><span class="n">Search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>



<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">match</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="o">*:</span><span class="w"> </span><span class="s1">&#39;Text 1&#39;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">highlight</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">no_match_size</span><span class="o">:</span><span class="w"> </span><span class="kt">0</span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>


<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;cat&quot;</span><span class="o">:</span><span class="mf">1</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="o">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s2">&quot;&lt;b&gt;Text 1&lt;/b&gt;&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">matchClause</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Text 1&quot;</span><span class="p">};</span>
<span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">matchClause</span><span class="p">};</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
<span class="nx">highlight</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewHighlight</span><span class="p">()</span>
<span class="nx">highlight</span><span class="p">.</span><span class="nx">SetNoMatchSize</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetHighlight</span><span class="p">(</span><span class="nx">highlight</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">SearchRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">searchRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>


<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;took&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;timed_out&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;total&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="mi">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_source&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="s">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="s">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;cat&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;content&quot;</span><span class="p">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s">&quot;&lt;b&gt;Text 1&lt;/b&gt;&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example order  -->
<h4 id="order">order</h4>
<p><code>order</code> sets the sorting order of extracted snippets. If set to <code>"score"</code>, it sorts the extracted snippets in order of relevance. This is optional and works similarly to the <code>weight_order</code> option.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>
<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;books&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;one|robots&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;content&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;order&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;score&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;setName(&#39;books&#39;);</span>
<span class="x">$bool = new \Manticoresearch\Query\BoolQuery();</span>
<span class="x">$bool-&gt;must(new \Manticoresearch\Query\Match([&#39;query&#39; =&gt; &#39;one|robots&#39;], &#39;*&#39;));</span>

<span class="x">$results = $index-&gt;search($bool)-&gt;highlight([&#39;content&#39;,&#39;title&#39;],[&#39;order&#39;=&gt;&quot;score&quot;])-&gt;get();</span>
<span class="x">foreach($results as $doc)</span>
<span class="x">{</span>
<span class="x">    echo &#39;Document: &#39;.$doc-&gt;getId().&quot;\n&quot;;</span>
<span class="x">    foreach($doc-&gt;getData() as $field=&gt;$value)</span>
<span class="x">    {</span>
<span class="x">        echo $field.&#39; : &#39;.$value.&quot;\n&quot;;</span>
<span class="x">    }</span>
<span class="x">    foreach($doc-&gt;getHighlight() as $field=&gt;$snippets)</span>
<span class="x">    {</span>
<span class="x">        echo &quot;Highlight for &quot;.$field.&quot;:\n&quot;;</span>
<span class="x">        foreach($snippets as $snippet)</span>
<span class="x">        {</span>
<span class="x">            echo &quot;- &quot;.$snippet.&quot;\n&quot;;</span>
<span class="x">        }</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>


<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Document: 1</span>
<span class="x">title : Books one</span>
<span class="x">content : They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it.</span>
<span class="x">Highlight for content:</span>
<span class="x">-  three into the room. &lt;b&gt;One&lt;/b&gt; of the &lt;b&gt;robots&lt;/b&gt; followed as well. Bander</span>
<span class="x">-  gestured the other &lt;b&gt;robots&lt;/b&gt; away and entered itself. The</span>
<span class="x">- They followed Bander. The &lt;b&gt;robots&lt;/b&gt; remained at a polite distance,</span>
<span class="x">Highlight for title:</span>
<span class="x">- Books &lt;b&gt;one&lt;/b&gt;</span>
</code></pre></div>


<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">res</span> <span class="o">=</span> <span class="n">searchApi</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;books&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="p">:{</span><span class="s2">&quot;match&quot;</span><span class="p">:{</span><span class="s2">&quot;*&quot;</span><span class="p">:</span><span class="s2">&quot;one|robots&quot;</span><span class="p">}},</span><span class="s2">&quot;highlight&quot;</span><span class="p">:{</span><span class="s2">&quot;fields&quot;</span><span class="p">:[</span><span class="s2">&quot;content&quot;</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">],</span><span class="s2">&quot;order&quot;</span><span class="p">:</span><span class="s2">&quot;score&quot;</span><span class="p">}})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;aggregations&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">2788</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it. &#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Books one&#39;</span><span class="p">},</span>
                    <span class="sa">u</span><span class="s1">&#39;highlight&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39; three into the room. &lt;b&gt;One&lt;/b&gt; of the &lt;b&gt;robots&lt;/b&gt; followed as well. Bander&#39;</span><span class="p">,</span>
                                                <span class="sa">u</span><span class="s1">&#39; gestured the other &lt;b&gt;robots&lt;/b&gt; away and entered itself. The&#39;</span><span class="p">,</span>
                                                <span class="sa">u</span><span class="s1">&#39;They followed Bander. The &lt;b&gt;robots&lt;/b&gt; remained at a polite distance, &#39;</span><span class="p">],</span>
                                   <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Books &lt;b&gt;one&lt;/b&gt;&#39;</span><span class="p">]}}],</span>
          <span class="s1">&#39;max_score&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
          <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>



<!-- request Javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="s2">&quot;books&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;match&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;*&quot;</span><span class="o">:</span><span class="s2">&quot;one|robots&quot;</span><span class="p">}},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">],</span><span class="s2">&quot;order&quot;</span><span class="o">:</span><span class="s2">&quot;score&quot;</span><span class="p">}});</span>
</code></pre></div>


<!-- response Javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">2788</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Books one&quot;</span><span class="p">,</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it. &quot;</span><span class="p">},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot; three into the room. &lt;b&gt;One&lt;/b&gt; of the &lt;b&gt;robots&lt;/b&gt; followed as well. Bander&quot;</span><span class="p">,</span><span class="s2">&quot; gestured the other &lt;b&gt;robots&lt;/b&gt; away and entered itself. The&quot;</span><span class="p">,</span><span class="s2">&quot;They followed Bander. The &lt;b&gt;robots&lt;/b&gt; remained at a polite distance, &quot;</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;Books &lt;b&gt;one&lt;/b&gt;&quot;</span><span class="p">]}}]}}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Java
</div>

<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">();</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;books&quot;</span><span class="p">);</span>
<span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">query</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;match&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">,</span><span class="s">&quot;one|robots&quot;</span><span class="p">);</span>
<span class="p">}});</span><span class="w">        </span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;fields&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;content&quot;</span><span class="p">,</span><span class="s">&quot;title&quot;</span><span class="p">});</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;order&quot;</span><span class="p">,</span><span class="s">&quot;score&quot;</span><span class="p">);</span>
<span class="p">}};</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setHighlight</span><span class="p">(</span><span class="n">highlight</span><span class="p">);</span>
<span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;books&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">FulltextFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MatchFilter</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;one|robots&quot;</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Highlight</span><span class="p">();</span>
<span class="n">highlight</span><span class="o">.</span><span class="n">Fieldnames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="p">};</span>
<span class="n">highlight</span><span class="o">.</span><span class="n">Order</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s2">&quot;score&quot;</span><span class="p">;</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">highlight</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="o">.</span><span class="n">Search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>



<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">match</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="o">*:</span><span class="w"> </span><span class="s1">&#39;Text 1&#39;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">highlight</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">order</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;score&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>


<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;cat&quot;</span><span class="o">:</span><span class="mf">1</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="o">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s2">&quot;&lt;b&gt;Text 1&lt;/b&gt;&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">matchClause</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Text 1&quot;</span><span class="p">};</span>
<span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">matchClause</span><span class="p">};</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
<span class="nx">highlight</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewHighlight</span><span class="p">()</span>
<span class="nx">highlight</span><span class="p">.</span><span class="nx">SetOrder</span><span class="p">(</span><span class="s">&quot;score&quot;</span><span class="p">)</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetHighlight</span><span class="p">(</span><span class="nx">highlight</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">SearchRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">searchRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>


<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;took&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;timed_out&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;total&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="mi">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_source&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="s">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="s">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;cat&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;content&quot;</span><span class="p">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s">&quot;&lt;b&gt;Text 1&lt;/b&gt;&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>




<!-- end -->

</div>

</div>

<!-- example fragment_size -->
<h4 id="fragment_size">fragment_size</h4>
<p><code>fragment_size</code> sets the maximum snippet size in symbols. It can be global or per-field. Per-field options override global options. This is optional, with a default value of 256. It works similarly to the <code>limit</code> option.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>
<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;books&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;one|robots&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;content&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;fragment_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;setName(&#39;books&#39;);</span>
<span class="x">$bool = new \Manticoresearch\Query\BoolQuery();</span>
<span class="x">$bool-&gt;must(new \Manticoresearch\Query\Match([&#39;query&#39; =&gt; &#39;one|robots&#39;], &#39;*&#39;));</span>

<span class="x">$results = $index-&gt;search($bool)-&gt;highlight([&#39;content&#39;,&#39;title&#39;],[&#39;fragment_size&#39;=&gt;100])-&gt;get();</span>
<span class="x">foreach($results as $doc)</span>
<span class="x">{</span>
<span class="x">    echo &#39;Document: &#39;.$doc-&gt;getId().&quot;\n&quot;;</span>
<span class="x">    foreach($doc-&gt;getData() as $field=&gt;$value)</span>
<span class="x">    {</span>
<span class="x">        echo $field.&#39; : &#39;.$value.&quot;\n&quot;;</span>
<span class="x">    }</span>
<span class="x">    foreach($doc-&gt;getHighlight() as $field=&gt;$snippets)</span>
<span class="x">    {</span>
<span class="x">        echo &quot;Highlight for &quot;.$field.&quot;:\n&quot;;</span>
<span class="x">        foreach($snippets as $snippet)</span>
<span class="x">        {</span>
<span class="x">            echo &quot;- &quot;.$snippet.&quot;\n&quot;;</span>
<span class="x">        }</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>


<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Document: 1</span>
<span class="x">title : Books one</span>
<span class="x">content : They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it.</span>
<span class="x">Highlight for content:</span>
<span class="x">-  the room. &lt;b&gt;One&lt;/b&gt; of the &lt;b&gt;robots&lt;/b&gt; followed as well</span>
<span class="x">- Bander gestured the other &lt;b&gt;robots&lt;/b&gt; away and entered</span>
<span class="x">Highlight for title:</span>
<span class="x">- Books &lt;b&gt;one&lt;/b&gt;</span>
</code></pre></div>


<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">res</span> <span class="o">=</span> <span class="n">searchApi</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;books&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="p">:{</span><span class="s2">&quot;match&quot;</span><span class="p">:{</span><span class="s2">&quot;*&quot;</span><span class="p">:</span><span class="s2">&quot;one|robots&quot;</span><span class="p">}},</span><span class="s2">&quot;highlight&quot;</span><span class="p">:{</span><span class="s2">&quot;fields&quot;</span><span class="p">:[</span><span class="s2">&quot;content&quot;</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">],</span><span class="s2">&quot;fragment_size&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">}})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;aggregations&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">2788</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it. &#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Books one&#39;</span><span class="p">},</span>
                    <span class="sa">u</span><span class="s1">&#39;highlight&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39; the room. &lt;b&gt;One&lt;/b&gt; of the &lt;b&gt;robots&lt;/b&gt; followed as well&#39;</span><span class="p">,</span>
                                                <span class="sa">u</span><span class="s1">&#39;Bander gestured the other &lt;b&gt;robots&lt;/b&gt; away and entered &#39;</span><span class="p">],</span>
                                   <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Books &lt;b&gt;one&lt;/b&gt;&#39;</span><span class="p">]}}],</span>
          <span class="s1">&#39;max_score&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
          <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>



<!-- request Javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="s2">&quot;books&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;match&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;*&quot;</span><span class="o">:</span><span class="s2">&quot;one|robots&quot;</span><span class="p">}},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">],</span><span class="s2">&quot;fragment_size&quot;</span><span class="o">:</span><span class="mf">100</span><span class="p">}});</span>
</code></pre></div>


<!-- response Javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">2788</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Books one&quot;</span><span class="p">,</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it. &quot;</span><span class="p">},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot; the room. &lt;b&gt;One&lt;/b&gt; of the &lt;b&gt;robots&lt;/b&gt; followed as well&quot;</span><span class="p">,</span><span class="s2">&quot;Bander gestured the other &lt;b&gt;robots&lt;/b&gt; away and entered &quot;</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;Books &lt;b&gt;one&lt;/b&gt;&quot;</span><span class="p">]}}]}}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Java
</div>

<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">();</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;books&quot;</span><span class="p">);</span>
<span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">query</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;match&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">,</span><span class="s">&quot;one|robots&quot;</span><span class="p">);</span>
<span class="p">}});</span><span class="w">        </span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;fields&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;content&quot;</span><span class="p">,</span><span class="s">&quot;title&quot;</span><span class="p">});</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;fragment_size&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>
<span class="p">}};</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setHighlight</span><span class="p">(</span><span class="n">highlight</span><span class="p">);</span>
<span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;books&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">FulltextFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MatchFilter</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;one|robots&quot;</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Highlight</span><span class="p">();</span>
<span class="n">highlight</span><span class="o">.</span><span class="n">Fieldnames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="p">};</span>
<span class="n">highlight</span><span class="o">.</span><span class="n">FragmentSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">highlight</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="o">.</span><span class="n">Search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>



<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">match</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="o">*:</span><span class="w"> </span><span class="s1">&#39;Text 1&#39;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">highlight</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">fragment_size</span><span class="o">:</span><span class="w"> </span><span class="kt">4</span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>


<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;cat&quot;</span><span class="o">:</span><span class="mf">1</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="o">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s2">&quot;&lt;b&gt;Text&lt;/b&gt;&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">matchClause</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Text 1&quot;</span><span class="p">};</span>
<span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">matchClause</span><span class="p">};</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
<span class="nx">highlight</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewHighlight</span><span class="p">()</span>
<span class="nx">highlight</span><span class="p">.</span><span class="nx">SetFragmentSize</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetHighlight</span><span class="p">(</span><span class="nx">highlight</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">SearchRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">searchRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>


<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;took&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;timed_out&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;total&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="mi">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_source&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="s">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="s">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;cat&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;content&quot;</span><span class="p">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s">&quot;&lt;b&gt;Text&lt;/b&gt;&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example number_of_fragments -->
<h4 id="number_of_fragments">number_of_fragments</h4>
<p><code>number_of_fragments</code> limits the maximum number of snippets in the result. Like <code>fragment_size</code>, it can be global or per-field. This is optional, with a default value of 0 (no limit). It works similarly to the <code>limit_snippets</code> option.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>
<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;books&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;one|robots&quot;</span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;content&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="w"> </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;number_of_fragments&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;setName(&#39;books&#39;);</span>
<span class="x">$bool = new \Manticoresearch\Query\BoolQuery();</span>
<span class="x">$bool-&gt;must(new \Manticoresearch\Query\Match([&#39;query&#39; =&gt; &#39;one|robots&#39;], &#39;*&#39;));</span>

<span class="x">$results = $index-&gt;search($bool)-&gt;highlight([&#39;content&#39;,&#39;title&#39;],[&#39;number_of_fragments&#39;=&gt;10])-&gt;get();</span>
<span class="x">foreach($results as $doc)</span>
<span class="x">{</span>
<span class="x">    echo &#39;Document: &#39;.$doc-&gt;getId().&quot;\n&quot;;</span>
<span class="x">    foreach($doc-&gt;getData() as $field=&gt;$value)</span>
<span class="x">    {</span>
<span class="x">        echo $field.&#39; : &#39;.$value.&quot;\n&quot;;</span>
<span class="x">    }</span>
<span class="x">    foreach($doc-&gt;getHighlight() as $field=&gt;$snippets)</span>
<span class="x">    {</span>
<span class="x">        echo &quot;Highlight for &quot;.$field.&quot;:\n&quot;;</span>
<span class="x">        foreach($snippets as $snippet)</span>
<span class="x">        {</span>
<span class="x">            echo &quot;- &quot;.$snippet.&quot;\n&quot;;</span>
<span class="x">        }</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>


<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Document: 1</span>
<span class="x">title : Books one</span>
<span class="x">content : They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it.</span>
<span class="x">Highlight for content:</span>
<span class="x">- They followed Bander. The &lt;b&gt;robots&lt;/b&gt; remained at a polite distance,</span>
<span class="x">-  three into the room. &lt;b&gt;One&lt;/b&gt; of the &lt;b&gt;robots&lt;/b&gt; followed as well. Bander</span>
<span class="x">-  gestured the other &lt;b&gt;robots&lt;/b&gt; away and entered itself. The</span>
<span class="x">Highlight for title:</span>
<span class="x">- Books &lt;b&gt;one&lt;/b&gt;</span>
</code></pre></div>



<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">res</span> <span class="o">=</span><span class="n">searchApi</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;books&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="p">:{</span><span class="s2">&quot;match&quot;</span><span class="p">:{</span><span class="s2">&quot;*&quot;</span><span class="p">:</span><span class="s2">&quot;one|robots&quot;</span><span class="p">}},</span><span class="s2">&quot;highlight&quot;</span><span class="p">:{</span><span class="s2">&quot;fields&quot;</span><span class="p">:[</span><span class="s2">&quot;content&quot;</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">],</span><span class="s2">&quot;number_of_fragments&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">}})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;aggregations&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">2788</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it. &#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Books one&#39;</span><span class="p">},</span>
                    <span class="sa">u</span><span class="s1">&#39;highlight&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;They followed Bander. The &lt;b&gt;robots&lt;/b&gt; remained at a polite distance, &#39;</span><span class="p">,</span>
                                                <span class="sa">u</span><span class="s1">&#39; three into the room. &lt;b&gt;One&lt;/b&gt; of the &lt;b&gt;robots&lt;/b&gt; followed as well. Bander&#39;</span><span class="p">,</span>
                                                <span class="sa">u</span><span class="s1">&#39; gestured the other &lt;b&gt;robots&lt;/b&gt; away and entered itself. The&#39;</span><span class="p">],</span>
                                   <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Books &lt;b&gt;one&lt;/b&gt;&#39;</span><span class="p">]}}],</span>
          <span class="s1">&#39;max_score&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
          <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>



<!-- request Javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="s2">&quot;books&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;match&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;*&quot;</span><span class="o">:</span><span class="s2">&quot;one|robots&quot;</span><span class="p">}},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">],</span><span class="s2">&quot;number_of_fragments&quot;</span><span class="o">:</span><span class="mf">10</span><span class="p">}});</span>
</code></pre></div>


<!-- response Javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">2788</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Books one&quot;</span><span class="p">,</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it. &quot;</span><span class="p">},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;They followed Bander. The &lt;b&gt;robots&lt;/b&gt; remained at a polite distance, &quot;</span><span class="p">,</span><span class="s2">&quot; three into the room. &lt;b&gt;One&lt;/b&gt; of the &lt;b&gt;robots&lt;/b&gt; followed as well. Bander&quot;</span><span class="p">,</span><span class="s2">&quot; gestured the other &lt;b&gt;robots&lt;/b&gt; away and entered itself. The&quot;</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;Books &lt;b&gt;one&lt;/b&gt;&quot;</span><span class="p">]}}]}}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Java
</div>

<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">();</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;books&quot;</span><span class="p">);</span>
<span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">query</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;match&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">,</span><span class="s">&quot;one|robots&quot;</span><span class="p">);</span>
<span class="p">}});</span><span class="w">        </span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;fields&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;content&quot;</span><span class="p">,</span><span class="s">&quot;title&quot;</span><span class="p">});</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;number_of_fragments&quot;</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
<span class="p">}};</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setHighlight</span><span class="p">(</span><span class="n">highlight</span><span class="p">);</span>
<span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;books&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">FulltextFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MatchFilter</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;one|robots&quot;</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Highlight</span><span class="p">();</span>
<span class="n">highlight</span><span class="o">.</span><span class="n">Fieldnames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="p">};</span>
<span class="n">highlight</span><span class="o">.</span><span class="n">NumberOfFragments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">highlight</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="o">.</span><span class="n">Search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>



<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">match</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="o">*:</span><span class="w"> </span><span class="s1">&#39;Text 1&#39;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">highlight</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">number_of_fragments</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>


<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;cat&quot;</span><span class="o">:</span><span class="mf">1</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="o">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s2">&quot;&lt;b&gt;Text 1&lt;/b&gt;&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">matchClause</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Text 1&quot;</span><span class="p">};</span>
<span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">matchClause</span><span class="p">};</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
<span class="nx">highlight</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewHighlight</span><span class="p">()</span>
<span class="nx">highlight</span><span class="p">.</span><span class="nx">SetNumberOfFragments</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetHighlight</span><span class="p">(</span><span class="nx">highlight</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">SearchRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">searchRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>


<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;took&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;timed_out&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;total&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="mi">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_source&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="s">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="s">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;cat&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;content&quot;</span><span class="p">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s">&quot;&lt;b&gt;Text 1&lt;/b&gt;&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example highlight json per-field limits -->

<h4 id="limit-limit_words-limit_snippets">limit, limit_words, limit_snippets</h4>
<p>Options like <code>limit</code>, <code>limit_words</code>, and <code>limit_snippets</code> can be set as global or per-field options. Global options are used as per-field limits unless per-field options override them. In the example, the <code>title</code> field is highlighted with default limit settings, while the <code>content</code> field uses a different limit.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>
<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;books&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;one|robots&quot;</span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
<span class="w">            </span><span class="nt">&quot;content&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;setName(&#39;books&#39;);</span>
<span class="x">$bool = new \Manticoresearch\Query\BoolQuery();</span>
<span class="x">$bool-&gt;must(new \Manticoresearch\Query\Match([&#39;query&#39; =&gt; &#39;one|robots&#39;], &#39;*&#39;));</span>

<span class="x">$results = $index-&gt;search($bool)-&gt;highlight([&#39;content&#39;=&gt;[&#39;limit&#39;=&gt;50],&#39;title&#39;=&gt;new \stdClass])-&gt;get();</span>
<span class="x">foreach($results as $doc)</span>
<span class="x">{</span>
<span class="x">    echo &#39;Document: &#39;.$doc-&gt;getId().&quot;\n&quot;;</span>
<span class="x">    foreach($doc-&gt;getData() as $field=&gt;$value)</span>
<span class="x">    {</span>
<span class="x">        echo $field.&#39; : &#39;.$value.&quot;\n&quot;;</span>
<span class="x">    }</span>
<span class="x">    foreach($doc-&gt;getHighlight() as $field=&gt;$snippets)</span>
<span class="x">    {</span>
<span class="x">        echo &quot;Highlight for &quot;.$field.&quot;:\n&quot;;</span>
<span class="x">        foreach($snippets as $snippet)</span>
<span class="x">        {</span>
<span class="x">            echo &quot;- &quot;.$snippet.&quot;\n&quot;;</span>
<span class="x">        }</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>


<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Document: 1</span>
<span class="x">title : Books one</span>
<span class="x">content : They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it.</span>
<span class="x">Highlight for content:</span>
<span class="x">-  into the room. &lt;b&gt;One&lt;/b&gt; of the &lt;b&gt;robots&lt;/b&gt; followed as well</span>
<span class="x">Highlight for title:</span>
<span class="x">- Books &lt;b&gt;one&lt;/b&gt;</span>
</code></pre></div>


<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">res</span> <span class="o">=</span><span class="n">searchApi</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;books&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="p">:{</span><span class="s2">&quot;match&quot;</span><span class="p">:{</span><span class="s2">&quot;*&quot;</span><span class="p">:</span><span class="s2">&quot;one|robots&quot;</span><span class="p">}},</span><span class="s2">&quot;highlight&quot;</span><span class="p">:{</span><span class="s2">&quot;fields&quot;</span><span class="p">:{</span><span class="s2">&quot;title&quot;</span><span class="p">:{},</span><span class="s2">&quot;content&quot;</span><span class="p">:{</span><span class="s2">&quot;limit&quot;</span><span class="p">:</span><span class="mi">50</span><span class="p">}}}})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;aggregations&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">2788</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it. &#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Books one&#39;</span><span class="p">},</span>
                    <span class="sa">u</span><span class="s1">&#39;highlight&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39; into the room. &lt;b&gt;One&lt;/b&gt; of the &lt;b&gt;robots&lt;/b&gt; followed as well&#39;</span><span class="p">],</span>
                                   <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Books &lt;b&gt;one&lt;/b&gt;&#39;</span><span class="p">]}}],</span>
          <span class="s1">&#39;max_score&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
          <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>



<!-- request Javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="s2">&quot;books&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;match&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;*&quot;</span><span class="o">:</span><span class="s2">&quot;one|robots&quot;</span><span class="p">}},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="p">{},</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;limit&quot;</span><span class="o">:</span><span class="mf">50</span><span class="p">}}}});</span>
</code></pre></div>


<!-- response Javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">2788</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Books one&quot;</span><span class="p">,</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it. &quot;</span><span class="p">},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;Books &lt;b&gt;one&lt;/b&gt;&quot;</span><span class="p">],</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot; into the room. &lt;b&gt;One&lt;/b&gt; of the &lt;b&gt;robots&lt;/b&gt; followed as well&quot;</span><span class="p">]}}]}}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Java
</div>

<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">();</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;books&quot;</span><span class="p">);</span>
<span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">query</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;match&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">,</span><span class="s">&quot;one|robots&quot;</span><span class="p">);</span>
<span class="p">}});</span><span class="w">        </span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;fields&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">            </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{}});</span>
<span class="w">            </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;content&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">                </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;limit&quot;</span><span class="p">,</span><span class="mi">50</span><span class="p">);</span>
<span class="w">            </span><span class="p">}});</span>
<span class="w">        </span><span class="p">}}</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}};</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setHighlight</span><span class="p">(</span><span class="n">highlight</span><span class="p">);</span>
<span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;books&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">FulltextFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MatchFilter</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;one|robots&quot;</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Highlight</span><span class="p">();</span>
<span class="k">var</span><span class="w"> </span><span class="n">highlightField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">HighlightField</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">);</span>
<span class="n">highlightField</span><span class="o">.</span><span class="n">Limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span>
<span class="n">highlight</span><span class="o">.</span><span class="n">Fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="n">highlightField</span><span class="p">};</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">highlight</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="o">.</span><span class="n">Search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>



<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">match</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="o">*:</span><span class="w"> </span><span class="s1">&#39;Text 1&#39;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">highlight</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">fields</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">limit</span><span class="o">:</span><span class="kt">1</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>


<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;cat&quot;</span><span class="o">:</span><span class="mf">1</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;content&quot;</span><span class="o">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s2">&quot;&lt;b&gt;Text&lt;/b&gt;&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">matchClause</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Text 1&quot;</span><span class="p">};</span>
<span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">matchClause</span><span class="p">};</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
<span class="nx">highlight</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewHighlight</span><span class="p">()</span>
<span class="nx">highlightField</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NetHighlightField</span><span class="p">(</span><span class="s">&quot;content&quot;</span><span class="p">)</span>
<span class="nx">highlightField</span><span class="p">.</span><span class="nx">SetLimit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nx">highlightFields</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">highlightField</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
<span class="nx">highlight</span><span class="p">.</span><span class="nx">SetFields</span><span class="p">(</span><span class="nx">highlightFields</span><span class="p">)</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetHighlight</span><span class="p">(</span><span class="nx">highlight</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">SearchRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">searchRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>


<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;took&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;timed_out&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;total&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="mi">1480</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;_source&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="s">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="s">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;cat&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;content&quot;</span><span class="p">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="s">&quot;&lt;b&gt;Text&lt;/b&gt;&quot;</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example highlight json global limits -->

<h4 id="limits_per_field_1">limits_per_field</h4>
<p>Global limits can also be enforced by specifying <code>limits_per_field=0</code>. Setting this option means that all combined highlighting results must be within the specified limits. The downside is that you may get several snippets highlighted in one field and none in another if the highlighting engine decides that they are more relevant.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>
<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;books&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;and first&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;highlight&quot;</span><span class="p">:</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;limits_per_field&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;content&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;setName(&#39;books&#39;);</span>
<span class="x">$bool = new \Manticoresearch\Query\BoolQuery();</span>
<span class="x">$bool-&gt;must(new \Manticoresearch\Query\Match([&#39;query&#39; =&gt; &#39;and first&#39;], &#39;content&#39;));</span>

<span class="x">$results = $index-&gt;search($bool)-&gt;highlight([&#39;content&#39;=&gt;[&#39;limit&#39;=&gt;50]],[&#39;limits_per_field&#39;=&gt;false])-&gt;get();</span>
<span class="x">foreach($results as $doc)</span>
<span class="x">{</span>
<span class="x">    echo &#39;Document: &#39;.$doc-&gt;getId().&quot;\n&quot;;</span>
<span class="x">    foreach($doc-&gt;getData() as $field=&gt;$value)</span>
<span class="x">    {</span>
<span class="x">        echo $field.&#39; : &#39;.$value.&quot;\n&quot;;</span>
<span class="x">    }</span>
<span class="x">    foreach($doc-&gt;getHighlight() as $field=&gt;$snippets)</span>
<span class="x">    {</span>
<span class="x">        echo &quot;Highlight for &quot;.$field.&quot;:\n&quot;;</span>
<span class="x">        foreach($snippets as $snippet)</span>
<span class="x">        {</span>
<span class="x">            echo &quot;- &quot;.$snippet.&quot;\n&quot;;</span>
<span class="x">        }</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>


<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Document: 1</span>
<span class="x">title : Books one</span>
<span class="x">content : They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it.</span>
<span class="x">Highlight for content:</span>
<span class="x">-  gestured the other robots away &lt;b&gt;and&lt;/b&gt; entered itself. The door closed</span>
</code></pre></div>


<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">res</span> <span class="o">=</span><span class="n">searchApi</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;books&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="p">:{</span><span class="s2">&quot;match&quot;</span><span class="p">:{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span><span class="s2">&quot;and first&quot;</span><span class="p">}},</span><span class="s2">&quot;highlight&quot;</span><span class="p">:{</span><span class="s2">&quot;fields&quot;</span><span class="p">:{</span><span class="s2">&quot;content&quot;</span><span class="p">:{</span><span class="s2">&quot;limit&quot;</span><span class="p">:</span><span class="mi">50</span><span class="p">}},</span><span class="s2">&quot;limits_per_field&quot;</span><span class="p">:</span><span class="kc">False</span><span class="p">}})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;aggregations&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">1597</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it. &#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Books one&#39;</span><span class="p">},</span>
                    <span class="sa">u</span><span class="s1">&#39;highlight&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39; gestured the other robots away &lt;b&gt;and&lt;/b&gt; entered itself. The door closed&#39;</span><span class="p">]}}],</span>
          <span class="s1">&#39;max_score&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
          <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>



<!-- request Javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="s2">&quot;books&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;match&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;and first&quot;</span><span class="p">}},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;limit&quot;</span><span class="o">:</span><span class="mf">50</span><span class="p">}},</span><span class="s2">&quot;limits_per_field&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">}});</span>
</code></pre></div>


<!-- response Javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1597</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Books one&quot;</span><span class="p">,</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;They followed Bander. The robots remained at a polite distance, but their presence was a constantly felt threat. Bander ushered all three into the room. One of the robots followed as well. Bander gestured the other robots away and entered itself. The door closed behind it. &quot;</span><span class="p">},</span><span class="s2">&quot;highlight&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot; gestured the other robots away &lt;b&gt;and&lt;/b&gt; entered itself. The door closed&quot;</span><span class="p">]}}]}}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Java
</div>

<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">();</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;books&quot;</span><span class="p">);</span>
<span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">query</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;match&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">,</span><span class="s">&quot;one|robots&quot;</span><span class="p">);</span>
<span class="p">}});</span><span class="w">        </span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;limits_per_field&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;fields&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">            </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;content&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">                </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;limit&quot;</span><span class="p">,</span><span class="mi">50</span><span class="p">);</span>
<span class="w">            </span><span class="p">}});</span>
<span class="w">        </span><span class="p">}}</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}};</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setHighlight</span><span class="p">(</span><span class="n">highlight</span><span class="p">);</span>
<span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;books&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">FulltextFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MatchFilter</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;one|robots&quot;</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Highlight</span><span class="p">();</span>
<span class="n">highlight</span><span class="o">.</span><span class="n">LimitsPerField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">highlightField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">HighlightField</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">);</span>
<span class="n">highlight</span><span class="o">.</span><span class="n">Fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="n">highlightField</span><span class="p">};</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Highlight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">highlight</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="o">.</span><span class="n">Search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>



<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">match</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="o">*:</span><span class="w"> </span><span class="s1">&#39;Text 1&#39;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">highlight</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">limits_per_field</span><span class="o">:</span><span class="w"> </span><span class="kt">0</span><span class="w"> </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>



<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">matchClause</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Text 1&quot;</span><span class="p">};</span>
<span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">matchClause</span><span class="p">};</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
<span class="nx">highlight</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewHighlight</span><span class="p">()</span>
<span class="nx">highlight</span><span class="p">.</span><span class="nx">SetLimitsPerField</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetHighlight</span><span class="p">(</span><span class="nx">highlight</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">SearchRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">searchRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>


<!-- end -->

</div>

</div>

<h1 id="call-snippets">CALL SNIPPETS</h1>
<!-- example CALL SNIPPETS -->

<p>The <code>CALL SNIPPETS</code> statement builds a snippet from provided data and query using specified table settings. It can't access built-in document storage, which is why it's recommended to use the <a href="../13-searching.html#toc-13.07-highlighting">HIGHLIGHT() function</a> instead.</p>
<p>The syntax is:</p>
<div class="codehilite"><pre><span></span><code><span class="k">CALL</span><span class="w"> </span><span class="n">SNIPPETS</span><span class="p">(</span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="k">table</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">[,</span><span class="w"> </span><span class="n">opt_value</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">opt_name</span><span class="p">[,</span><span class="w"> </span><span class="p">...]])</span>
</code></pre></div>

<h4 id="data">data</h4>
<p><code>data</code> serves as the source from which a snippet is extracted. It can either be a single string or a list of strings enclosed in curly brackets.</p>
<h4 id="table">table</h4>
<p><code>table</code> refers to the name of the table that provides the text processing settings for snippet generation.</p>
<h4 id="query">query</h4>
<p><code>query</code> is the full-text query used to build the snippets.</p>
<h4 id="opt_value-and-opt_name">opt_value and opt_name</h4>
<p><code>opt_value</code> and <code>opt_name</code> represent the <a href="../13-searching.html#toc-13.07-highlighting">snippet generation options</a>.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>
<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">CALL</span><span class="w"> </span><span class="n">SNIPPETS</span><span class="p">((</span><span class="s1">&#39;this is my document text&#39;</span><span class="p">,</span><span class="s1">&#39;this is my another text&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;forum&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;is text&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">around</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">limit</span><span class="p">);</span>
</code></pre></div>


<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">----------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">snippet</span><span class="w">                                </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="k">is</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">my</span><span class="w"> </span><span class="n">document</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="nb">text</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="k">is</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">my</span><span class="w"> </span><span class="n">another</span><span class="w"> </span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="nb">text</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="w">  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------------------------------------+</span>
<span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">02</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<p>Most options are the same as in the <a href="../13-searching.html#toc-13.07-highlighting">HIGHLIGHT() function</a>. There are, however, several options that can only be used with <code>CALL SNIPPETS</code>.</p>
<!-- example CALL SNIPPETS load files -->
<p>The following options can be used to highlight text stored in separate files:</p>
<h4 id="load_files">load_files</h4>
<p>This option, when enabled, treats the first argument as file names instead of data to extract snippets from. The specified files on the server side will be loaded for data. Up to <a href="../20-server_settings.html#max_threads_per_query">max_threads_per_query</a> worker threads per request will be used to parallelize the work when this flag is enabled. Default is 0 (no limit). To distribute snippet generation between remote agents, invoke snippets generation in a distributed table containing only one(!) local agent and several remotes. The <a href="../06-creating_a_table.html#snippets_file_prefix">snippets_file_prefix</a> option is used to generate the final file name. For example, when searchd is configured with <code>snippets_file_prefix = /var/data_</code> and <code>text.txt</code> is provided as a file name, snippets will be generated from the content of <code>/var/data_text.txt</code>.</p>
<h4 id="load_files_scattered">load_files_scattered</h4>
<p>This option only works with distributed snippets generation with remote agents. Source files for snippet generation can be distributed among different agents, and the main server will merge all non-erroneous results. For example, if one agent of the distributed table has <code>file1.txt</code>, another agent has <code>file2.txt</code>, and you use <code>CALL SNIPPETS</code> with both of these files, searchd will merge agent results, so you will get results from both <code>file1.txt</code> and <code>file2.txt</code>. Default is 0.</p>
<p>If the <code>load_files</code> option is also enabled, the request will return an error if any of the files is not available anywhere. Otherwise (if <code>load_files</code> is not enabled), it will return empty strings for all absent files. Searchd does not pass this flag to agents, so agents do not generate a critical error if the file does not exist. If you want to be sure that all source files are loaded, set both <code>load_files_scattered</code> and <code>load_files</code> to 1. If the absence of some source files on some agent is not critical, set only <code>load_files_scattered</code> to 1.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>
<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">CALL</span><span class="w"> </span><span class="n">SNIPPETS</span><span class="p">((</span><span class="s1">&#39;data/doc1.txt&#39;</span><span class="p">,</span><span class="s1">&#39;data/doc2.txt&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;forum&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;is text&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">load_files</span><span class="p">);</span>
</code></pre></div>



<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="nb">+----------------------------------------+</span>
<span class="c">| snippet                                |</span>
<span class="nb">+----------------------------------------+</span>
<span class="c">| this </span><span class="nv">&lt;</span><span class="c">b</span><span class="nv">&gt;</span><span class="c">is</span><span class="nv">&lt;</span><span class="c">/b</span><span class="nv">&gt;</span><span class="c"> my document </span><span class="nv">&lt;</span><span class="c">b</span><span class="nv">&gt;</span><span class="c">text</span><span class="nv">&lt;</span><span class="c">/b</span><span class="nv">&gt;</span><span class="c"> |</span>
<span class="c">| this </span><span class="nv">&lt;</span><span class="c">b</span><span class="nv">&gt;</span><span class="c">is</span><span class="nv">&lt;</span><span class="c">/b</span><span class="nv">&gt;</span><span class="c"> my another </span><span class="nv">&lt;</span><span class="c">b</span><span class="nv">&gt;</span><span class="c">text</span><span class="nv">&lt;</span><span class="c">/b</span><span class="nv">&gt;</span><span class="c">  |</span>
<span class="nb">+----------------------------------------+</span>
<span class="c">2 rows in set (0</span><span class="nt">.</span><span class="c">02 sec)</span>
</code></pre></div>



<!-- end -->

</div>

</div>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.08-sorting_and_ranking">
        <header>
            <a class="chapter-link" href="#toc-13.08-sorting_and_ranking"> ¶ 13.8</a>

            
            <h1 id="sorting-and-ranking">Sorting and ranking</h1>
            
        </header>

        
        
<p>Query results can be sorted by full-text ranking weight, one or more attributes or expressions.</p>
<p><strong>Full-text</strong> queries return matches sorted by default. If nothing is specified, they are sorted by relevance, which is equivalent to <code>ORDER BY weight() DESC</code> in SQL format.</p>
<p><strong>Non-full-text</strong> queries do not perform any sorting by default.</p>
<h2 id="advanced-sorting">Advanced sorting</h2>
<p>Extended mode is automatically enabled when you explicitly provide sorting rules by adding the <code>ORDER BY</code> clause in SQL format or using the <code>sort</code> option via HTTP JSON.</p>
<h3 id="sorting-via-sql">Sorting via SQL</h3>
<p>General syntax:</p>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span>
<span class="err">{</span><span class="n">attribute_name</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">expr_alias</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">weight</span><span class="p">()</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">random</span><span class="p">()</span><span class="w"> </span><span class="err">}</span><span class="w"> </span><span class="p">[</span><span class="k">ASC</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">DESC</span><span class="p">],</span>
<span class="p">...</span>
<span class="err">{</span><span class="n">attribute_name</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">expr_alias</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">weight</span><span class="p">()</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">random</span><span class="p">()</span><span class="w"> </span><span class="err">}</span><span class="w"> </span><span class="p">[</span><span class="k">ASC</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">DESC</span><span class="p">]</span>
</code></pre></div>

<!-- example alias -->

<p>In the sort clause, you can use any combination of up to 5 columns, each followed by <code>asc</code> or <code>desc</code>. Functions and expressions are not allowed as arguments for the sort clause, except for the <code>weight()</code> and <code>random()</code> functions (the latter can only be used via SQL in the form of <code>ORDER BY random()</code>). However, you can use any expression in the SELECT list and sort by its alias.</p>
<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">alias</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">alias</span><span class="w"> </span><span class="k">desc</span><span class="p">;</span>
</code></pre></div>

<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="nb">+------+------+------+----------+-------+</span>
<span class="c">| id   | a    | b    | f        | alias |</span>
<span class="nb">+------+------+------+----------+-------+</span>
<span class="c">|    1 |    2 |    3 | document |     5 |</span>
<span class="nb">+------+------+------+----------+-------+</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<h2 id="sorting-via-json">Sorting via JSON</h2>
<!-- example sorting 1 -->
<p><code>"sort"</code> specifies an array where each element can be an attribute name or <code>_score</code> if you want to sort by match weights. In that case, the sort order defaults to ascending for attributes and descending for <code>_score</code>.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Test document&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;sort&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;_score&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="w"> </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;total_relation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5406864699109146628&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2319</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Test document 1&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5406864699109146629&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2319</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Test document 2&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5406864699109146630&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2319</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Test document 3&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$search-&gt;setIndex(&quot;test&quot;)-&gt;match(&#39;Test document&#39;)-&gt;sort(&#39;_score&#39;)-&gt;sort(&#39;id&#39;);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Python
</div>

<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">search_request</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span>
<span class="n">search_request</span><span class="o">.</span><span class="n">fulltext_filter</span> <span class="o">=</span> <span class="n">manticoresearch</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">QueryFilter</span><span class="p">(</span><span class="s1">&#39;Test document&#39;</span><span class="p">)</span>
<span class="n">search_request</span><span class="o">.</span><span class="n">sort</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;_score&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">]</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Javascript
</div>

<!-- request javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">searchRequest</span><span class="p">.</span><span class="nx">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">;</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">fulltext_filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Manticoresearch</span><span class="p">.</span><span class="nx">QueryFilter</span><span class="p">(</span><span class="s1">&#39;Test document&#39;</span><span class="p">);</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;_score&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id&#39;</span><span class="p">];</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
java
</div>

<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">);</span>
<span class="n">QueryFilter</span><span class="w"> </span><span class="n">queryFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">QueryFilter</span><span class="p">();</span>
<span class="n">queryFilter</span><span class="p">.</span><span class="na">setQueryString</span><span class="p">(</span><span class="s">&quot;Test document&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setFulltextFilter</span><span class="p">(</span><span class="n">queryFilter</span><span class="p">);</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;_score&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;id&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setSort</span><span class="p">(</span><span class="n">sort</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
C
</div>

<!-- request C# -->

<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">FulltextFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">QueryFilter</span><span class="p">(</span><span class="s2">&quot;Test document&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;_score&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="p">};</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Typescript
</div>

<!-- request typescript -->

<div class="codehilite"><pre><span></span><code><span class="nx">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">query_string</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;Test document&#39;</span><span class="p">},</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">sort</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;_score&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Go
</div>

<!-- request go -->

<div class="codehilite"><pre><span></span><code><span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetIndex</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;query_string&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Test document&quot;</span><span class="p">}</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
<span class="nx">sort</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;asc&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;asc&quot;</span><span class="p">}</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetSort</span><span class="p">(</span><span class="nx">sort</span><span class="p">)</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example sorting 2 -->
<p>You can also specify the sort order explicitly:</p>
<ul>
<li><code>asc</code>: sort in ascending order</li>
<li><code>desc</code>: sort in descending order</li>
</ul>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Test document&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;sort&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;desc&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;_score&quot;</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;total_relation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5406864699109146632&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2319</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Test document 5&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5406864699109146631&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2319</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Test document 4&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5406864699109146630&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2319</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Test document 3&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$search-&gt;setIndex(&quot;test&quot;)-&gt;match(&#39;Test document&#39;)-&gt;sort(&#39;id&#39;, &#39;desc&#39;)-&gt;sort(&#39;_score&#39;);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Python
</div>

<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">search_request</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span>
<span class="n">search_request</span><span class="o">.</span><span class="n">fulltext_filter</span> <span class="o">=</span> <span class="n">manticoresearch</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">QueryFilter</span><span class="p">(</span><span class="s1">&#39;Test document&#39;</span><span class="p">)</span>
<span class="n">sort_by_id</span> <span class="o">=</span> <span class="n">manticoresearch</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">SortOrder</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">)</span>
<span class="n">search_request</span><span class="o">.</span><span class="n">sort</span> <span class="o">=</span> <span class="p">[</span><span class="n">sort_by_id</span><span class="p">,</span> <span class="s1">&#39;_score&#39;</span><span class="p">]</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Javascript
</div>

<!-- request javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">searchRequest</span><span class="p">.</span><span class="nx">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">;</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">fulltext_filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Manticoresearch</span><span class="p">.</span><span class="nx">QueryFilter</span><span class="p">(</span><span class="s1">&#39;Test document&#39;</span><span class="p">);</span>
<span class="nx">sortById</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Manticoresearch</span><span class="p">.</span><span class="nx">SortOrder</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;desc&#39;</span><span class="p">);</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nx">sortById</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id&#39;</span><span class="p">];</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
java
</div>

<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">);</span>
<span class="n">QueryFilter</span><span class="w"> </span><span class="n">queryFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">QueryFilter</span><span class="p">();</span>
<span class="n">queryFilter</span><span class="p">.</span><span class="na">setQueryString</span><span class="p">(</span><span class="s">&quot;Test document&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setFulltextFilter</span><span class="p">(</span><span class="n">queryFilter</span><span class="p">);</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">SortOrder</span><span class="w"> </span><span class="n">sortById</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SortOrder</span><span class="p">();</span>
<span class="n">sortById</span><span class="p">.</span><span class="na">setAttr</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">);</span>
<span class="n">sortById</span><span class="p">.</span><span class="na">setOrder</span><span class="p">(</span><span class="n">SortOrder</span><span class="p">.</span><span class="na">OrderEnum</span><span class="p">.</span><span class="na">DESC</span><span class="p">);</span>
<span class="n">sort</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">sortById</span><span class="p">);</span>
<span class="n">sort</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;_score&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setSort</span><span class="p">(</span><span class="n">sort</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
C
</div>

<!-- request C# -->

<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">FulltextFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">QueryFilter</span><span class="p">(</span><span class="s2">&quot;Test document&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="k">var</span><span class="w"> </span><span class="n">sortById</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SortOrder</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SortOrder</span><span class="o">.</span><span class="n">OrderEnum</span><span class="o">.</span><span class="n">Desc</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Sort</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">sortById</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Sort</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;_score&quot;</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Typescript
</div>

<!-- request typescript -->

<div class="codehilite"><pre><span></span><code><span class="nx">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">query_string</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;Test document&#39;</span><span class="p">},</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">sort</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="s1">&#39;id&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;desc&#39;</span><span class="p">},</span><span class="w"> </span><span class="s1">&#39;_score&#39;</span><span class="p">],</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Go
</div>

<!-- request go -->

<div class="codehilite"><pre><span></span><code><span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetIndex</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;query_string&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Test document&quot;</span><span class="p">}</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
<span class="nx">sortById</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;desc&quot;</span><span class="p">}</span>
<span class="nx">sort</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;desc&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;asc&quot;</span><span class="p">}</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetSort</span><span class="p">(</span><span class="nx">sort</span><span class="p">)</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example sorting 3 -->
<p>You can also use another syntax and specify the sort order via the <code>order</code> property:</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Test document&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;sort&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;order&quot;</span><span class="p">:</span><span class="s2">&quot;desc&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;total_relation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5406864699109146632&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2319</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Test document 5&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5406864699109146631&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2319</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Test document 4&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5406864699109146630&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2319</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Test document 3&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$search-&gt;setIndex(&quot;test&quot;)-&gt;match(&#39;Test document&#39;)-&gt;sort(&#39;id&#39;, &#39;desc&#39;);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Python
</div>

<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">search_request</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span>
<span class="n">search_request</span><span class="o">.</span><span class="n">fulltext_filter</span> <span class="o">=</span> <span class="n">manticoresearch</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">QueryFilter</span><span class="p">(</span><span class="s1">&#39;Test document&#39;</span><span class="p">)</span>
<span class="n">sort_by_id</span> <span class="o">=</span> <span class="n">manticoresearch</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">SortOrder</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">)</span>
<span class="n">search_request</span><span class="o">.</span><span class="n">sort</span> <span class="o">=</span> <span class="p">[</span><span class="n">sort_by_id</span><span class="p">]</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Javascript
</div>

<!-- request javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">searchRequest</span><span class="p">.</span><span class="nx">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">;</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">fulltext_filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Manticoresearch</span><span class="p">.</span><span class="nx">QueryFilter</span><span class="p">(</span><span class="s1">&#39;Test document&#39;</span><span class="p">);</span>
<span class="nx">sortById</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Manticoresearch</span><span class="p">.</span><span class="nx">SortOrder</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;desc&#39;</span><span class="p">);</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nx">sortById</span><span class="p">];</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
java
</div>

<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">);</span>
<span class="n">QueryFilter</span><span class="w"> </span><span class="n">queryFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">QueryFilter</span><span class="p">();</span>
<span class="n">queryFilter</span><span class="p">.</span><span class="na">setQueryString</span><span class="p">(</span><span class="s">&quot;Test document&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setFulltextFilter</span><span class="p">(</span><span class="n">queryFilter</span><span class="p">);</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">SortOrder</span><span class="w"> </span><span class="n">sortById</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SortOrder</span><span class="p">();</span>
<span class="n">sortById</span><span class="p">.</span><span class="na">setAttr</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">);</span>
<span class="n">sortById</span><span class="p">.</span><span class="na">setOrder</span><span class="p">(</span><span class="n">SortOrder</span><span class="p">.</span><span class="na">OrderEnum</span><span class="p">.</span><span class="na">DESC</span><span class="p">);</span>
<span class="n">sort</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">sortById</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setSort</span><span class="p">(</span><span class="n">sort</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
C
</div>

<!-- request C# -->

<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">FulltextFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">QueryFilter</span><span class="p">(</span><span class="s2">&quot;Test document&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="k">var</span><span class="w"> </span><span class="n">sortById</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SortOrder</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SortOrder</span><span class="o">.</span><span class="n">OrderEnum</span><span class="o">.</span><span class="n">Desc</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Sort</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">sortById</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Typescript
</div>

<!-- request typescript -->

<div class="codehilite"><pre><span></span><code><span class="nx">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">query_string</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;Test document&#39;</span><span class="p">},</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">sort</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;order&#39;</span><span class="o">:</span><span class="s1">&#39;desc&#39;</span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Go
</div>

<!-- request go -->

<div class="codehilite"><pre><span></span><code><span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetIndex</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;query_string&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Test document&quot;</span><span class="p">}</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
<span class="nx">sort</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;order&quot;</span><span class="p">:</span><span class="s">&quot;desc&quot;</span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetSort</span><span class="p">(</span><span class="nx">sort</span><span class="p">)</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example sorting 4 -->
<p>Sorting by MVA attributes is also supported in JSON queries. Sorting mode can be set via the <code>mode</code> property. The following modes are supported:</p>
<ul>
<li><code>min</code>: sort by minimum value</li>
<li><code>max</code>: sort by maximum value</li>
</ul>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Test document&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;sort&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;attr_mva&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;order&quot;</span><span class="p">:</span><span class="s2">&quot;desc&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;mode&quot;</span><span class="p">:</span><span class="s2">&quot;max&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;total_relation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5406864699109146631&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2319</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Test document 4&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5406864699109146629&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2319</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Test document 2&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5406864699109146628&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2319</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Test document 1&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$search-&gt;setIndex(&quot;test&quot;)-&gt;match(&#39;Test document&#39;)-&gt;sort(&#39;id&#39;,&#39;desc&#39;,&#39;max&#39;);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Python
</div>

<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">search_request</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span>
<span class="n">search_request</span><span class="o">.</span><span class="n">fulltext_filter</span> <span class="o">=</span> <span class="n">manticoresearch</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">QueryFilter</span><span class="p">(</span><span class="s1">&#39;Test document&#39;</span><span class="p">)</span>
<span class="n">sort</span> <span class="o">=</span> <span class="n">manticoresearch</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">SortMVA</span><span class="p">(</span><span class="s1">&#39;attr_mva&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">)</span>
<span class="n">search_request</span><span class="o">.</span><span class="n">sort</span> <span class="o">=</span> <span class="p">[</span><span class="n">sort</span><span class="p">]</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Javascript
</div>

<!-- request javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">searchRequest</span><span class="p">.</span><span class="nx">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">;</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">fulltext_filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Manticoresearch</span><span class="p">.</span><span class="nx">QueryFilter</span><span class="p">(</span><span class="s1">&#39;Test document&#39;</span><span class="p">);</span>
<span class="nx">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Manticoresearch</span><span class="p">.</span><span class="nx">SortMVA</span><span class="p">(</span><span class="s1">&#39;attr_mva&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;desc&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;max&#39;</span><span class="p">);</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nx">sort</span><span class="p">];</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
java
</div>

<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">);</span>
<span class="n">QueryFilter</span><span class="w"> </span><span class="n">queryFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">QueryFilter</span><span class="p">();</span>
<span class="n">queryFilter</span><span class="p">.</span><span class="na">setQueryString</span><span class="p">(</span><span class="s">&quot;Test document&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setFulltextFilter</span><span class="p">(</span><span class="n">queryFilter</span><span class="p">);</span>
<span class="n">SortMVA</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SortMVA</span><span class="p">();</span>
<span class="n">sort</span><span class="p">.</span><span class="na">setAttr</span><span class="p">(</span><span class="s">&quot;attr_mva&quot;</span><span class="p">);</span>
<span class="n">sort</span><span class="p">.</span><span class="na">setOrder</span><span class="p">(</span><span class="n">SortMVA</span><span class="p">.</span><span class="na">OrderEnum</span><span class="p">.</span><span class="na">DESC</span><span class="p">);</span>
<span class="n">sort</span><span class="p">.</span><span class="na">setMode</span><span class="p">(</span><span class="n">SortMVA</span><span class="p">.</span><span class="na">ModeEnum</span><span class="p">.</span><span class="na">MAX</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setSort</span><span class="p">(</span><span class="n">sort</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
C
</div>

<!-- request C# -->

<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">FulltextFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">QueryFilter</span><span class="p">(</span><span class="s2">&quot;Test document&quot;</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SortMVA</span><span class="p">(</span><span class="s2">&quot;attr_mva&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SortMVA</span><span class="o">.</span><span class="n">OrderEnum</span><span class="o">.</span><span class="n">Desc</span><span class="p">,</span><span class="w"> </span><span class="n">SortMVA</span><span class="o">.</span><span class="n">ModeEnum</span><span class="o">.</span><span class="n">Max</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Sort</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">sort</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Typescript
</div>

<!-- request typescript -->

<div class="codehilite"><pre><span></span><code><span class="nx">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">query_string</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;Test document&#39;</span><span class="p">},</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">sort</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;attr_mva&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;order&quot;</span><span class="o">:</span><span class="s2">&quot;desc&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;mode&quot;</span><span class="o">:</span><span class="s2">&quot;max&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Go
</div>

<!-- request go -->

<div class="codehilite"><pre><span></span><code><span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetIndex</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;query_string&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Test document&quot;</span><span class="p">}</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
<span class="nx">sort</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;attr_mva&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;order&quot;</span><span class="p">:</span><span class="s">&quot;desc&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mode&quot;</span><span class="p">:</span><span class="s">&quot;max&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetSort</span><span class="p">(</span><span class="nx">sort</span><span class="p">)</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example sorting 5 -->
<p>When sorting on an attribute, match weight (score) calculation is disabled by default (no ranker is used). You can enable weight calculation by setting the <code>track_scores</code> property to <code>true</code>:</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;track_scores&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Test document&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;sort&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;attr_mva&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;order&quot;</span><span class="p">:</span><span class="s2">&quot;desc&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;mode&quot;</span><span class="p">:</span><span class="s2">&quot;max&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;total_relation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5406864699109146631&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2319</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Test document 4&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5406864699109146629&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2319</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Test document 2&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5406864699109146628&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2319</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Test document 1&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$search-&gt;setIndex(&quot;test&quot;)-&gt;match(&#39;Test document&#39;)-&gt;sort(&#39;id&#39;,&#39;desc&#39;,&#39;max&#39;)-&gt;trackScores(true);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Python
</div>

<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">search_request</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span>
<span class="n">search_request</span><span class="o">.</span><span class="n">track_scores</span> <span class="o">=</span> <span class="n">true</span>
<span class="n">search_request</span><span class="o">.</span><span class="n">fulltext_filter</span> <span class="o">=</span> <span class="n">manticoresearch</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">QueryFilter</span><span class="p">(</span><span class="s1">&#39;Test document&#39;</span><span class="p">)</span>
<span class="n">sort</span> <span class="o">=</span> <span class="n">manticoresearch</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">SortMVA</span><span class="p">(</span><span class="s1">&#39;attr_mva&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">)</span>
<span class="n">search_request</span><span class="o">.</span><span class="n">sort</span> <span class="o">=</span> <span class="p">[</span><span class="n">sort</span><span class="p">]</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Javascript
</div>

<!-- request javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">searchRequest</span><span class="p">.</span><span class="nx">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">;</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">trackScores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">fulltext_filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Manticoresearch</span><span class="p">.</span><span class="nx">QueryFilter</span><span class="p">(</span><span class="s1">&#39;Test document&#39;</span><span class="p">);</span>
<span class="nx">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Manticoresearch</span><span class="p">.</span><span class="nx">SortMVA</span><span class="p">(</span><span class="s1">&#39;attr_mva&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;desc&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;max&#39;</span><span class="p">);</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nx">sort</span><span class="p">];</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
java
</div>

<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setTrackScores</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="n">QueryFilter</span><span class="w"> </span><span class="n">queryFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">QueryFilter</span><span class="p">();</span>
<span class="n">queryFilter</span><span class="p">.</span><span class="na">setQueryString</span><span class="p">(</span><span class="s">&quot;Test document&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setFulltextFilter</span><span class="p">(</span><span class="n">queryFilter</span><span class="p">);</span>
<span class="n">SortMVA</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SortMVA</span><span class="p">();</span>
<span class="n">sort</span><span class="p">.</span><span class="na">setAttr</span><span class="p">(</span><span class="s">&quot;attr_mva&quot;</span><span class="p">);</span>
<span class="n">sort</span><span class="p">.</span><span class="na">setOrder</span><span class="p">(</span><span class="n">SortMVA</span><span class="p">.</span><span class="na">OrderEnum</span><span class="p">.</span><span class="na">DESC</span><span class="p">);</span>
<span class="n">sort</span><span class="p">.</span><span class="na">setMode</span><span class="p">(</span><span class="n">SortMVA</span><span class="p">.</span><span class="na">ModeEnum</span><span class="p">.</span><span class="na">MAX</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setSort</span><span class="p">(</span><span class="n">sort</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
C
</div>

<!-- request C# -->

<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">SetTrackScores</span><span class="p">(</span><span class="bp">true</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">FulltextFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">QueryFilter</span><span class="p">(</span><span class="s2">&quot;Test document&quot;</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SortMVA</span><span class="p">(</span><span class="s2">&quot;attr_mva&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SortMVA</span><span class="o">.</span><span class="n">OrderEnum</span><span class="o">.</span><span class="n">Desc</span><span class="p">,</span><span class="w"> </span><span class="n">SortMVA</span><span class="o">.</span><span class="n">ModeEnum</span><span class="o">.</span><span class="n">Max</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Sort</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">sort</span><span class="p">);</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Typescript
</div>

<!-- request typescript -->

<div class="codehilite"><pre><span></span><code><span class="nx">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">track_scores</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">query_string</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;Test document&#39;</span><span class="p">},</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nx">sort</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;attr_mva&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;order&quot;</span><span class="o">:</span><span class="s2">&quot;desc&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;mode&quot;</span><span class="o">:</span><span class="s2">&quot;max&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>


<div class='item-select'>
Go
</div>

<!-- request go -->

<div class="codehilite"><pre><span></span><code><span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetIndex</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetTrackScores</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;query_string&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Test document&quot;</span><span class="p">}</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
<span class="nx">sort</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;attr_mva&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;order&quot;</span><span class="p">:</span><span class="s">&quot;desc&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mode&quot;</span><span class="p">:</span><span class="s">&quot;max&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetSort</span><span class="p">(</span><span class="nx">sort</span><span class="p">)</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<h2 id="ranking-overview">Ranking overview</h2>
<p>Ranking (also known as weighting) of search results can be defined as a process of computing a so-called relevance (weight) for every given matched document regards to a given query that matched it. So relevance is, in the end, just a number attached to every document that estimates how relevant the document is to the query. Search results can then be sorted based on this number and/or some additional parameters, so that the most sought-after results would appear higher on the results page.</p>
<p>There is no single standard one-size-fits-all way to rank any document in any scenario. Moreover, there can never be such a way, because relevance is <em>subjective</em>. As in, what seems relevant to you might not seem relevant to me. Hence, in general cases, it's not just hard to compute; it's theoretically impossible.</p>
<p>So ranking in Manticore is configurable. It has a notion of a so-called <strong>ranker</strong>. A ranker can formally be defined as a function that takes a document and a query as its input and produces a relevance value as output. In layman's terms, a ranker controls exactly how (using which specific algorithm) Manticore will assign weights to the documents.</p>
<h2 id="available-built-in-rankers">Available built-in rankers</h2>
<p>Manticore ships with several built-in rankers suited for different purposes. Many of them use two factors: phrase proximity (also known as LCS) and BM25. Phrase proximity works on keyword positions, while BM25 works on keyword frequencies. Essentially, the better the degree of phrase match between the document body and the query, the higher the phrase proximity (it maxes out when the document contains the entire query as a verbatim quote). And BM25 is higher when the document contains more rare words. We'll save the detailed discussion for later.</p>
<p>The currently implemented rankers are:</p>
<ul>
<li><code>proximity_bm25</code>, the default ranking mode that uses and combines both phrase proximity and BM25 ranking.</li>
<li><code>bm25</code>, a statistical ranking mode that uses BM25 ranking only (similar to most other full-text engines). This mode is faster but may result in worse quality for queries containing more than one keyword.</li>
<li><code>none</code>, a no-ranking mode. This mode is obviously the fastest. A weight of 1 is assigned to all matches. This is sometimes called boolean searching, which just matches the documents but does not rank them.</li>
<li><code>wordcount</code>, ranking by the keyword occurrences count. This ranker computes the per-field keyword occurrence counts, then multiplies them by field weights, and sums the resulting values.</li>
<li><code>proximity</code> returns the raw phrase proximity value as a result. This mode is internally used to emulate <code>SPH_MATCH_ALL</code> queries.</li>
<li><code>matchany</code> returns rank as it was computed in <code>SPH_MATCH_ANY</code> mode earlier and is internally used to emulate <code>SPH_MATCH_ANY</code> queries.</li>
<li><code>fieldmask</code> returns a 32-bit mask with the N-th bit corresponding to the N-th full-text field, numbering from 0. The bit will only be set when the respective field has any keyword occurrences satisfying the query.</li>
<li><code>sph04</code> is generally based on the default 'proximity_bm25' ranker, but additionally boosts matches when they occur at the very beginning or the very end of a text field. Thus, if a field equals the exact query, <code>sph04</code> should rank it higher than a field that contains the exact query but is not equal to it. (For instance, when the query is "Hyde Park", a document titled "Hyde Park" should be ranked higher than one titled "Hyde Park, London" or "The Hyde Park Cafe".)</li>
<li><code>expr</code> allows you to specify the ranking formula at runtime. It exposes several internal text factors and lets you define how the final weight should be computed from those factors. You can find more details about its syntax and a reference of available factors in a <a href="../13-searching.html#quick-summary-of-the-ranking-factors">subsection below</a>.</li>
</ul>
<p>The ranker name is case-insensitive. Example:</p>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">OPTION</span><span class="w"> </span><span class="n">ranker</span><span class="o">=</span><span class="n">sph04</span><span class="p">;</span>
</code></pre></div>

<h2 id="quick-summary-of-the-ranking-factors">Quick summary of the ranking factors</h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Level</th>
<th>Type</th>
<th>Summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>max_lcs</td>
<td>query</td>
<td>int</td>
<td>maximum possible LCS value for the current query</td>
</tr>
<tr>
<td>bm25</td>
<td>document</td>
<td>int</td>
<td>quick estimate of BM25(1.2, 0)</td>
</tr>
<tr>
<td>bm25a(k1, b)</td>
<td>document</td>
<td>int</td>
<td>precise BM25() value with configurable K1, B constants and syntax support</td>
</tr>
<tr>
<td>bm25f(k1, b, {field=weight, ...})</td>
<td>document</td>
<td>int</td>
<td>precise BM25F() value with extra configurable field weights</td>
</tr>
<tr>
<td>field_mask</td>
<td>document</td>
<td>int</td>
<td>bit mask of matched fields</td>
</tr>
<tr>
<td>query_word_count</td>
<td>document</td>
<td>int</td>
<td>number of unique inclusive keywords in a query</td>
</tr>
<tr>
<td>doc_word_count</td>
<td>document</td>
<td>int</td>
<td>number of unique keywords matched in the document</td>
</tr>
<tr>
<td>lcs</td>
<td>field</td>
<td>int</td>
<td>Longest Common Subsequence between query and document, in words</td>
</tr>
<tr>
<td>user_weight</td>
<td>field</td>
<td>int</td>
<td>user field weight</td>
</tr>
<tr>
<td>hit_count</td>
<td>field</td>
<td>int</td>
<td>total number of keyword occurrences</td>
</tr>
<tr>
<td>word_count</td>
<td>field</td>
<td>int</td>
<td>number of unique matched keywords</td>
</tr>
<tr>
<td>tf_idf</td>
<td>field</td>
<td>float</td>
<td>sum(tf*idf) over matched keywords == sum(idf) over occurrences</td>
</tr>
<tr>
<td>min_hit_pos</td>
<td>field</td>
<td>int</td>
<td>first matched occurrence position, in words, 1-based</td>
</tr>
<tr>
<td>min_best_span_pos</td>
<td>field</td>
<td>int</td>
<td>first maximum LCS span position, in words, 1-based</td>
</tr>
<tr>
<td>exact_hit</td>
<td>field</td>
<td>bool</td>
<td>whether query == field</td>
</tr>
<tr>
<td>min_idf</td>
<td>field</td>
<td>float</td>
<td>min(idf) over matched keywords</td>
</tr>
<tr>
<td>max_idf</td>
<td>field</td>
<td>float</td>
<td>max(idf) over matched keywords</td>
</tr>
<tr>
<td>sum_idf</td>
<td>field</td>
<td>float</td>
<td>sum(idf) over matched keywords</td>
</tr>
<tr>
<td>exact_order</td>
<td>field</td>
<td>bool</td>
<td>whether all query keywords were a) matched and b) in query order</td>
</tr>
<tr>
<td>min_gaps</td>
<td>field</td>
<td>int</td>
<td>minimum number of gaps between the matched keywords over the matching spans</td>
</tr>
<tr>
<td>lccs</td>
<td>field</td>
<td>int</td>
<td>Longest Common Contiguous Subsequence between query and document, in words</td>
</tr>
<tr>
<td>wlccs</td>
<td>field</td>
<td>float</td>
<td>Weighted Longest Common Contiguous Subsequence, sum(idf) over contiguous keyword spans</td>
</tr>
<tr>
<td>atc</td>
<td>field</td>
<td>float</td>
<td>Aggregate Term Closeness, log(1+sum(idf1<em>idf2</em>pow(distance, -1.75)) over the best pairs of keywords</td>
</tr>
</tbody>
</table>
<h3 id="document-level-ranking-factors">Document-level Ranking Factors</h3>
<p>A <strong>document-level factor</strong> is a numeric value computed by the ranking engine for every matched document with regards to the current query. So it differs from a plain document attribute in that the attribute does not depend on the full text query, while factors might. These factors can be used anywhere in the ranking expression. Currently implemented document-level factors are:</p>
<ul>
<li><code>bm25</code> (integer), a document-level BM25 estimate (computed without keyword occurrence filtering).</li>
<li><code>max_lcs</code> (integer), a query-level maximum possible value that the <code>sum(lcs*user_weight)</code> expression can ever take. This can be useful for weight boost scaling. For instance, <code>MATCHANY</code> ranker formula uses this to guarantee that a full phrase match in any field ranks higher than any combination of partial matches in all fields.</li>
<li><code>field_mask</code> (integer), a document-level 32-bit mask of matched fields.</li>
<li><code>query_word_count</code> (integer), the number of unique keywords in a query, adjusted for the number of excluded keywords. For instance, both <code>(one one one one)</code> and <code>(one !two)</code> queries should assign a value of 1 to this factor, because there is just one unique non-excluded keyword.</li>
<li><code>doc_word_count</code> (integer), the number of unique keywords matched in the entire document.</li>
</ul>
<h3 id="field-level-ranking-factors">Field-level Ranking Factors</h3>
<p>A <strong>field-level factor</strong> is a numeric value computed by the ranking engine for every matched in-document text field regards to the current query. As more than one field can be matched by a query, but the final weight needs to be a single integer value, these values need to be folded into a single one. To achieve that, field-level factors can only be used within a field aggregation function, they can <strong>not</strong> be used anywhere in the expression. For example, you cannot use <code>(lcs+bm25)</code> as your ranking expression, as <code>lcs</code> takes multiple values (one in every matched field). You should use <code>(sum(lcs)+bm25)</code> instead, that expression sums <code>lcs</code> over all matching fields, and then adds <code>bm25</code> to that per-field sum. Currently implemented field-level factors are:</p>
<ul>
<li><code>lcs</code> (integer), the length of a maximum verbatim match between the document and the query, counted in words. LCS stands for Longest Common Subsequence (or Subset). Takes a minimum value of 1 when only stray keywords were matched in a field, and a maximum value of query keywords count when the entire query was matched in a field verbatim (in the exact query keywords order). For example, if the query is 'hello world' and the field contains these two words quoted from the query (that is, adjacent to each other, and exactly in the query order), <code>lcs</code> will be 2. For example, if the query is 'hello world program' and the field contains 'hello world', <code>lcs</code> will be 2. Note that any subset of the query keyword works, not just a subset of adjacent keywords. For example, if the query is 'hello world program' and the field contains 'hello (test program)', <code>lcs</code> will be 2 just as well, because both 'hello' and 'program' matched in the same respective positions as they were in the query. Finally, if the query is 'hello world program' and the field contains 'hello world program', <code>lcs</code> will be 3. (Hopefully that is unsurprising at this point.)</li>
<li><code>user_weight</code> (integer), the user specified per-field weight (refer to <a href="../13-searching.html#field_weights">OPTION field_weights</a> in SQL). The weights default to 1 if not specified explicitly.</li>
<li><code>hit_count</code> (integer), the number of keyword occurrences that matched in the field. Note that a single keyword may occur multiple times. For example, if 'hello' occurs 3 times in a field and 'world' occurs 5 times, <code>hit_count</code> will be 8.</li>
<li><code>word_count</code> (integer), the number of unique keywords matched in the field. For example, if 'hello' and 'world' occur anywhere in a field, <code>word_count</code> will be 2, regardless of how many times both keywords occur.</li>
<li><code>tf_idf</code> (float), the sum of TF/IDF over all the keywords matched in the field. IDF is the Inverse Document Frequency, a floating point value between 0 and 1 that describes how frequent the keyword is (basically, 0 for a keyword that occurs in every document indexed, and 1 for a unique keyword that occurs in just a single document). TF is the Term Frequency, the number of matched keyword occurrences in the field. As a side note, <code>tf_idf</code> is actually computed by summing IDF over all matched occurrences. That's by construction equivalent to summing TF*IDF over all matched keywords.</li>
<li><code>min_hit_pos</code> (integer), the position of the first matched keyword occurrence, counted in words</li>
</ul>
<p>Therefore, this is a relatively low-level, "raw" factor that you'll likely want to <em>adjust</em> before using it for ranking. The specific adjustments depend heavily on your data and the resulting formula, but here are a few ideas to start with: (a) any min_gaps-based boosts could be simply ignored when word_count&lt;2;</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="n">non</span><span class="o">-</span><span class="n">trivial</span><span class="w"> </span><span class="n">min_gaps</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="p">,</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">word_count</span><span class="o">&gt;=</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">could</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">clamped</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">certain</span><span class="w"> </span><span class="s2">&quot;worst-case&quot;</span><span class="w"> </span><span class="n">constant</span><span class="p">,</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">trivial</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="p">,</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">min_gaps</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">word_count</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">could</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">replaced</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">constant</span><span class="p">;</span>

<span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">transfer</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">min_gaps</span><span class="p">)</span><span class="w"> </span><span class="n">could</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">applied</span><span class="w"> </span><span class="p">(</span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">better</span><span class="p">,</span><span class="w"> </span><span class="n">smaller</span><span class="w"> </span><span class="n">min_gaps</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="n">would</span><span class="w"> </span><span class="n">maximize</span><span class="w"> </span><span class="n">it</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">worse</span><span class="p">,</span><span class="w"> </span><span class="n">larger</span><span class="w"> </span><span class="n">min_gaps</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="n">would</span><span class="w"> </span><span class="n">fall</span><span class="w"> </span><span class="n">off</span><span class="w"> </span><span class="n">slowly</span><span class="p">);</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">on</span><span class="o">.</span>
</code></pre></div>

<ul>
<li>
<p><code>lccs</code> (integer). Longest Common Contiguous Subsequence. The length of the longest subphrase common between the query and the document, computed in keywords.</p>
<p>The LCCS factor is somewhat similar to LCS but more restrictive. While LCS can be greater than 1 even if no two query words are matched next to each other, LCCS will only be greater than 1 if there are <em>exact</em>, contiguous query subphrases in the document. For example, (one two three four five) query vs (one hundred three hundred five hundred) document would yield lcs=3, but lccs=1, because although the mutual dispositions of 3 keywords (one, three, five) match between the query and the document, no 2 matching positions are actually adjacent.</p>
<p>Note that LCCS still doesn't differentiate between frequent and rare keywords; for that, see WLCCS.</p>
</li>
<li>
<p><code>wlccs</code> (float). Weighted Longest Common Contiguous Subsequence. The sum of IDFs of the keywords of the longest subphrase common between the query and the document.</p>
<p>WLCCS is calculated similarly to LCCS, but every "suitable" keyword occurrence increases it by the keyword IDF instead of just by 1 (as with LCS and LCCS). This allows ranking sequences of rarer and more important keywords higher than sequences of frequent keywords, even if the latter are longer. For example, a query <code>(Zanzibar bed and breakfast)</code> would yield lccs=1 for a <code>(hotels of Zanzibar)</code> document, but lccs=3 against <code>(London bed and breakfast)</code>, even though "Zanzibar" is actually somewhat rarer than the entire "bed and breakfast" phrase. The WLCCS factor addresses this issue by using keyword frequencies.</p>
</li>
<li>
<p><code>atc</code> (float). Aggregate Term Closeness. A proximity-based measure that increases when the document contains more groups of more closely located and more important (rare) query keywords.</p>
<p><strong>WARNING:</strong> you should use ATC with OPTION idf='plain,tfidf_unnormalized' (see <a href="../13-searching.html#configuration-of-idf-formula">below</a>); otherwise, you may get unexpected results.</p>
<p>ATC essentially operates as follows. For each keyword <em>occurrence</em> in the document, we compute the so-called <em>term closeness</em>. To do this, we examine all the other closest occurrences of all the query keywords (including the keyword itself) to the left and right of the subject occurrence, calculate a distance dampening coefficient as k = pow(distance, -1.75) for these occurrences, and sum the dampened IDFs. As a result, for every occurrence of each keyword, we obtain a "closeness" value that describes the "neighbors" of that occurrence. We then multiply these per-occurrence closenesses by their respective subject keyword IDF, sum them all, and finally compute a logarithm of that sum.</p>
</li>
</ul>
<p>In other words, we process the best (closest) matched keyword pairs in the document, and compute pairwise "closenesses" as the product of their IDFs scaled by the distance coefficient:</p>
<div class="codehilite"><pre><span></span><code>pair_tc = idf(pair_word1) <span class="gs">* idf(pair_word2) *</span> pow(pair_distance, -1.75)
</code></pre></div>

<p>We then sum such closenesses, and compute the final, log-dampened ATC value:</p>
<div class="codehilite"><pre><span></span><code>atc = log(1+sum(pair_tc))
</code></pre></div>

<p>Note that this final dampening logarithm is precisely the reason you should use OPTION idf=plain because, without it, the expression inside the log() could be negative.</p>
<p>Having closer keyword occurrences contributes <em>much</em> more to ATC than having more frequent keywords. Indeed, when the keywords are right next to each other, distance=1 and k=1; when there's just one word in between them, distance=2 and k=0.297, with two words between, distance=3 and k=0.146, and so on. At the same time, IDF attenuates somewhat slower. For example, in a 1 million document collection, the IDF values for keywords that match in 10, 100, and 1000 documents would be respectively 0.833, 0.667, and 0.500. So a keyword pair with two rather rare keywords that occur in just 10 documents each but with 2 other words in between would yield pair_tc = 0.101 and thus barely outweigh a pair with a 100-doc and a 1000-doc keyword with 1 other word between them and pair_tc = 0.099. Moreover, a pair of two <em>unique</em>, 1-doc keywords with 3 words between them would get a pair_tc = 0.088 and lose to a pair of two 1000-doc keywords located right next to each other and yielding a pair_tc = 0.25. So, basically, while ATC does combine both keyword frequency and proximity, it still somewhat favors proximity.</p>
<h3 id="ranking-factor-aggregation-functions">Ranking factor aggregation functions</h3>
<p>A <strong>field aggregation function</strong> is a single-argument function that accepts an expression with field-level factors, iterates over all matched fields, and computes the final results. The currently implemented field aggregation functions include:</p>
<ul>
<li><code>sum</code>, which adds the argument expression over all matched fields. For example <code>sum(1)</code> should return the number of matched fields.</li>
<li><code>top</code>, which returns the highest value of the argument across all matched fields.</li>
</ul>
<h3 id="formula-expressions-for-all-the-built-in-rankers">Formula expressions for all the built-in rankers</h3>
<p>Most other rankers can actually be emulated using the expression-based ranker. You just need to provide an appropriate expression. While this emulation will likely be slower than using the built-in, compiled ranker, it may still be interesting if you want to fine-tune your ranking formula starting with one of the existing ones. Additionally, the formulas describe the ranker details in a clear, readable manner.</p>
<ul>
<li>proximity_bm25 (default ranker) = <code>sum(lcs*user_weight)*1000+bm25</code></li>
<li>bm25 = <code>sum(user_weight)*1000+bm25</code></li>
<li>none = <code>1</code></li>
<li>wordcount = <code>sum(hit_count*user_weight)</code></li>
<li>proximity = <code>sum(lcs*user_weight)</code></li>
<li>matchany = <code>sum((word_count+(lcs-1)*max_lcs)*user_weight)</code></li>
<li>fieldmask = <code>field_mask</code></li>
<li>sph04 = <code>sum((4*lcs+2*(min_hit_pos==1)+exact_hit)*user_weight)*1000+bm25</code></li>
</ul>
<h3 id="configuration-of-idf-formula">Configuration of IDF formula</h3>
<p>The historically default IDF (Inverse Document Frequency) in Manticore is equivalent to <code>OPTION idf='normalized,tfidf_normalized'</code>, and those normalizations may cause several undesired effects.</p>
<p>First, <code>idf=normalized</code> causes keyword penalization. For instance, if you search for <code>the | something</code> and <code>the</code> occurs in more than 50% of the documents, then documents with both keywords <code>the</code> and<code>[something</code> will get less weight than documents with just one keyword  <code>something</code>. Using <code>OPTION idf=plain</code> avoids this.</p>
<p>Plain IDF varies in <code>[0, log(N)]</code> range, and keywords are never penalized; while the normalized IDF varies in <code>[-log(N), log(N)]</code> range, and too frequent keywords are penalized.</p>
<p>Second, <code>idf=tfidf_normalized</code> causes IDF drift over queries. Historically, we additionally divided IDF by query keyword count, so that the entire <code>sum(tf*idf)</code> over all keywords would still fit into <code>[0,1]</code> range. However, that means that queries <code>word1</code> and <code>word1 | nonmatchingword2</code> would assign different weights to the exactly same result set, because the IDFs for both <code>word1</code> and <code>nonmatchingword2</code> would be divided by 2. <code>OPTION idf='tfidf_unnormalized'</code> fixes that. Note that BM25, BM25A, BM25F() ranking factors will be scale accordingly  once you disable this normalization.</p>
<p>IDF flags can be mixed; <code>plain</code> and <code>normalized</code> are mutually exclusive;<code>tfidf_unnormalized</code> and <code>tfidf_normalized</code> are mutually exclusive; and unspecified flags in such a mutually exclusive group take their defaults. That means that <code>OPTION idf=plain</code> is equivalent to a complete <code>OPTION idf='plain,tfidf_normalized'</code> specification.    </p>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.09-pagination">
        <header>
            <a class="chapter-link" href="#toc-13.09-pagination"> ¶ 13.9</a>

            
            <h1 id="pagination-of-search-results">Pagination of search results</h1>
            
        </header>

        
        
<!-- example general -->

<p>Manticore Search returns the top 20 matched documents in the result set by default.</p>
<h4 id="sql">SQL</h4>
<p>In SQL, you can navigate through the result set using the <code>LIMIT</code> clause.</p>
<p><code>LIMIT</code> can accept either one number as the size of the returned set with a zero offset, or a pair of offset and size values.</p>
<h4 id="http-json">HTTP JSON</h4>
<p>When using HTTP JSON, the nodes <code>offset</code> and <code>limit</code> control the offset of the result set and the size of the returned set. Alternatively, you can use the pair <code>size</code> and <code>from</code> instead.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w">  </span><span class="p">...</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="p">...</span><span class="w">  </span><span class="p">[</span><span class="k">LIMIT</span><span class="w"> </span><span class="p">[</span><span class="k">offset</span><span class="p">,]</span><span class="w"> </span><span class="k">row_count</span><span class="p">]</span>
<span class="k">SELECT</span><span class="w">  </span><span class="p">...</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="p">...</span><span class="w">  </span><span class="p">[</span><span class="k">LIMIT</span><span class="w"> </span><span class="k">row_count</span><span class="p">][</span><span class="w"> </span><span class="k">OFFSET</span><span class="w"> </span><span class="k">offset</span><span class="p">]</span>
</code></pre></div>




<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;index_name&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">...</span>
<span class="w">  </span><span class="err">...</span><span class="w">  </span>
<span class="w">  </span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;offset&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="p">}</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;index_name&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">...</span>
<span class="w">  </span><span class="err">...</span><span class="w">  </span>
<span class="w">  </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;from&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example maxMatches -->
<h3 id="result-set-window">Result set window</h3>
<p>By default, Manticore Search uses a result set window of 1000 best-ranked documents that can be returned in the result set. If the result set is paginated beyond this value, the query will end in error.</p>
<p>This limitation can be adjusted with the query option <a href="../13-searching.html#max_matches">max_matches</a>.</p>
<p>Increasing the <code>max_matches</code> to very high values should only be done if it's necessary for the navigation to reach such points. A high <code>max_matches</code> value requires more memory and can increase the query response time. One way to work with deep result sets is to set <code>max_matches</code> as the sum of the offset and limit.</p>
<p>Lowering <code>max_matches</code> below 1000 has the benefit of reducing the memory used by the query. It can also reduce the query time, but in most cases, it might not be a noticeable gain.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>


<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w">  </span><span class="p">...</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="p">...</span><span class="w">   </span><span class="k">OPTION</span><span class="w"> </span><span class="n">max_matches</span><span class="o">=&lt;</span><span class="n">value</span><span class="o">&gt;</span>
</code></pre></div>




<!-- request JSON -->



<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;index_name&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">...</span>
<span class="w">  </span><span class="err">...</span>
<span class="w">  </span><span class="nt">&quot;max_matches&quot;</span><span class="p">:</span><span class="err">&lt;value&gt;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.10-distributed_searching">
        <header>
            <a class="chapter-link" href="#toc-13.10-distributed_searching"> ¶ 13.10</a>

            
            <h1 id="distributed-searching">Distributed searching</h1>
            
        </header>

        
        
<p>Manticore is designed to scale effectively through its distributed searching capabilities. Distributed searching is beneficial for improving query latency (i.e., search time) and throughput (i.e., max queries/sec) in multi-server, multi-CPU, or multi-core environments. This is crucial for applications that need to search through vast amounts of data (i.e., billions of records and terabytes of text).</p>
<p>The primary concept is to horizontally partition the searched data across search nodes and process it in parallel.</p>
<p>Partitioning is done manually. To set it up, you should:</p>
<ul>
<li>Set up multiple instances of Manticore on different servers</li>
<li>Distribute different parts of your dataset to different instances</li>
<li>Configure a special <a href="../06-creating_a_table.html#toc-06.04-creating_a_distributed_table">distributed table</a> on some of the <code>searchd</code> instances</li>
<li>Route your queries to the distributed table</li>
</ul>
<p>This type of table only contains references to other local and remote tables - so it cannot be directly reindexed. Instead, you should reindex the tables that it references.</p>
<p>When Manticore receives a query against a distributed table, it performs the following steps:</p>
<ol>
<li>Connects to the configured remote agents</li>
<li>Sends the query to them</li>
<li>Simultaneously searches the configured local tables (while the remote agents are searching)</li>
<li>Retrieves the search results from the remote agents</li>
<li>Merges all the results together, removing duplicates</li>
<li>Sends the merged results to the client</li>
</ol>
<p>From the application's perspective, there are no differences between searching through a regular table or a distributed table. In other words, distributed tables are fully transparent to the application, and there's no way to tell whether the table you queried was distributed or local.</p>
<p>Learn more about <a href="../10-creating_a_cluster.html#toc-10.02-remote_nodes">remote nodes</a>.</p>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.11-multi-queries">
        <header>
            <a class="chapter-link" href="#toc-13.11-multi-queries"> ¶ 13.11</a>

            
            <h1 id="multi-queries">Multi-queries</h1>
            
        </header>

        
        
<p>Multi-queries, or query batches, allow you to send multiple search queries to Manticore in a single network request.</p>
<p>👍 Why use multi-queries?</p>
<p>The primary reason is performance. By sending requests to Manticore in a batch instead of one by one, you save time by reducing network round-trips. Additionally, sending queries in a batch allows Manticore to perform certain internal optimizations. If no batch optimizations can be applied, queries will be processed individually.</p>
<p>⛔ When not to use multi-queries?</p>
<p>Multi-queries require all search queries in a batch to be independent, which isn't always the case. Sometimes query B depends on query A's results, meaning query B can only be set up after executing query A. For example, you might want to display results from a secondary index only if no results were found in the primary table, or you may want to specify an offset into the 2nd result set based on the number of matches in the 1st result set. In these cases, you'll need to use separate queries (or separate batches).</p>
<!-- example multi-query 1 -->
<p>You can run multiple search queries with SQL by separating them with a semicolon. When Manticore receives a query formatted like this from a client, all inter-statement optimizations will be applied.</p>
<p>Multi-queries don't support queries with <code>FACET</code>. The number of multi-queries in one batch shouldn't exceed <a href="../20-server_settings.html#max_batch_queries">max_batch_queries</a>.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;remove hair&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;remove hair&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="k">ASC</span>
</code></pre></div>


<!-- end -->

</div>

</div>

<h2 id="multi-queries-optimizations">Multi-queries optimizations</h2>
<p>There are two major optimizations to be aware of: common query optimization and common subtree optimization.</p>
<p><strong>Common query optimization</strong> means that <code>searchd</code> will identify all those queries in a batch where only the sorting and group-by settings differ, and <em>only perform searching once</em>. For example, if a batch consists of 3 queries, all of them are for "ipod nano", but the 1st query requests the top-10 results sorted by price, the 2nd query groups by vendor ID and requests the top-5 vendors sorted by rating, and the 3rd query requests the max price, full-text search for "ipod nano" will only be performed once, and its results will be reused to build 3 different result sets.</p>
<p><a href="../13-searching.html#toc-13.14-faceted_search">Faceted search</a> is a particularly important case that benefits from this optimization. Indeed, faceted searching can be implemented by running several queries, one to retrieve search results themselves, and a few others with the same full-text query but different group-by settings to retrieve all the required groups of results (top-3 authors, top-5 vendors, etc). As long as the full-text query and filtering settings stay the same, common query optimization will trigger, and greatly improve performance.</p>
<p><strong>Common subtree optimization</strong> is even more interesting. It allows <code>searchd</code> to exploit similarities between batched full-text queries. It identifies common full-text query parts (subtrees) in all queries and caches them between queries. For example, consider the following query batch:</p>
<div class="codehilite"><pre><span></span><code>donald<span class="w"> </span>trump<span class="w"> </span>president
donald<span class="w"> </span>trump<span class="w"> </span>barack<span class="w"> </span>obama<span class="w"> </span>john<span class="w"> </span>mccain
donald<span class="w"> </span>trump<span class="w"> </span>speech
</code></pre></div>

<p>There's a common two-word part <code>donald trump</code> that can be computed only once, then cached and shared across the queries. And common subtree optimization does just that. Per-query cache size is strictly controlled by <a href="../20-server_settings.html#subtree_docs_cache">subtree_docs_cache</a> and <a href="../20-server_settings.html#subtree_hits_cache">subtree_hits_cache</a> directives (so that caching <em>all</em> sixteen gazillions of documents that match "i am" does not exhaust the RAM and instantly kill your server).</p>
<!-- example multi-query 2 -->
<p>How can you tell if the queries in the batch were actually optimized? If they were, the respective query log will have a "multiplier" field that specifies how many queries were processed together:</p>
<p>Note the "x3" field. It means that this query was optimized and processed in a sub-batch of 3 queries.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
log
</div>

<!-- request log -->

<div class="codehilite"><pre><span></span><code><span class="o">[</span>Sun<span class="w"> </span>Jul<span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="m">15</span>:18:17.000<span class="w"> </span><span class="m">2009</span><span class="o">]</span><span class="w"> </span><span class="m">0</span>.040<span class="w"> </span>sec<span class="w"> </span>x3<span class="w"> </span><span class="o">[</span>ext/0/rel<span class="w"> </span><span class="m">747541</span><span class="w"> </span><span class="o">(</span><span class="m">0</span>,20<span class="o">)]</span><span class="w"> </span><span class="o">[</span>lj<span class="o">]</span><span class="w"> </span>the
<span class="o">[</span>Sun<span class="w"> </span>Jul<span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="m">15</span>:18:17.000<span class="w"> </span><span class="m">2009</span><span class="o">]</span><span class="w"> </span><span class="m">0</span>.040<span class="w"> </span>sec<span class="w"> </span>x3<span class="w"> </span><span class="o">[</span>ext/0/ext<span class="w"> </span><span class="m">747541</span><span class="w"> </span><span class="o">(</span><span class="m">0</span>,20<span class="o">)]</span><span class="w"> </span><span class="o">[</span>lj<span class="o">]</span><span class="w"> </span>the
<span class="o">[</span>Sun<span class="w"> </span>Jul<span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="m">15</span>:18:17.000<span class="w"> </span><span class="m">2009</span><span class="o">]</span><span class="w"> </span><span class="m">0</span>.040<span class="w"> </span>sec<span class="w"> </span>x3<span class="w"> </span><span class="o">[</span>ext/0/ext<span class="w"> </span><span class="m">747541</span><span class="w"> </span><span class="o">(</span><span class="m">0</span>,20<span class="o">)]</span><span class="w"> </span><span class="o">[</span>lj<span class="o">]</span><span class="w"> </span>the
</code></pre></div>


<!-- end -->

</div>

</div>

<!-- example multi-query 3 -->
<p>For reference, this is how the regular log would look like if the queries were not batched:</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
log
</div>

<!-- request log -->

<div class="codehilite"><pre><span></span><code><span class="o">[</span>Sun<span class="w"> </span>Jul<span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="m">15</span>:18:17.062<span class="w"> </span><span class="m">2009</span><span class="o">]</span><span class="w"> </span><span class="m">0</span>.059<span class="w"> </span>sec<span class="w"> </span><span class="o">[</span>ext/0/rel<span class="w"> </span><span class="m">747541</span><span class="w"> </span><span class="o">(</span><span class="m">0</span>,20<span class="o">)]</span><span class="w"> </span><span class="o">[</span>lj<span class="o">]</span><span class="w"> </span>the
<span class="o">[</span>Sun<span class="w"> </span>Jul<span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="m">15</span>:18:17.156<span class="w"> </span><span class="m">2009</span><span class="o">]</span><span class="w"> </span><span class="m">0</span>.091<span class="w"> </span>sec<span class="w"> </span><span class="o">[</span>ext/0/ext<span class="w"> </span><span class="m">747541</span><span class="w"> </span><span class="o">(</span><span class="m">0</span>,20<span class="o">)]</span><span class="w"> </span><span class="o">[</span>lj<span class="o">]</span><span class="w"> </span>the
<span class="o">[</span>Sun<span class="w"> </span>Jul<span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="m">15</span>:18:17.250<span class="w"> </span><span class="m">2009</span><span class="o">]</span><span class="w"> </span><span class="m">0</span>.092<span class="w"> </span>sec<span class="w"> </span><span class="o">[</span>ext/0/ext<span class="w"> </span><span class="m">747541</span><span class="w"> </span><span class="o">(</span><span class="m">0</span>,20<span class="o">)]</span><span class="w"> </span><span class="o">[</span>lj<span class="o">]</span><span class="w"> </span>the
</code></pre></div>


<!-- end -->

</div>

</div>

<p>Notice how the per-query time in the multi-query case improved by a factor of 1.5x to 2.3x, depending on the specific sorting mode.</p>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.12-sub-selects">
        <header>
            <a class="chapter-link" href="#toc-13.12-sub-selects"> ¶ 13.12</a>

            
            <h1 id="sub-selects">Sub-selects</h1>
            
        </header>

        
        
<p>Manticore supports SELECT subqueries via SQL in the following format:</p>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">cond1</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">cond2</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="n">Y</span>
</code></pre></div>

<p>The outer select allows only <code>ORDER BY</code> and <code>LIMIT</code> clauses. Sub-select queries currently have two use cases:</p>
<ol>
<li>
<p>When you have a query with two ranking UDFs, one very fast and the other slow, and perform a full-text search with a large match result set. Without subselect, the query would look like:</p>
<p><code>sql
SELECT id,slow_rank() as slow,fast_rank() as fast FROM index
    WHERE MATCH(‘some common query terms’) ORDER BY fast DESC, slow DESC LIMIT 20
    OPTION max_matches=1000;</code></p>
<p>With sub-selects, the query can be rewritten as:</p>
<p><code>sql
SELECT * FROM
    (SELECT id,slow_rank() as slow,fast_rank() as fast FROM index WHERE
        MATCH(‘some common query terms’)
        ORDER BY fast DESC LIMIT 100 OPTION max_matches=1000)
ORDER BY slow DESC LIMIT 20;</code></p>
<p>In the initial query, the <code>slow_rank()</code> UDF is computed for the entire match result set. With SELECT sub-queries, only <code>fast_rank()</code> is computed for the entire match result set, while <code>slow_rank()</code> is computed for a limited set.</p>
</li>
<li>
<p>The second case is useful for large result sets coming from a distributed table.</p>
<p>For this query:</p>
<p><code>sql
SELECT * FROM my_dist_index WHERE some_conditions LIMIT 50000;</code></p>
<p>If you have 20 nodes, each node can send back to the master a maximum of 50K records, resulting in 20 x 50K = 1M records. However, since the master sends back only 50K (out of 1M), it might be good enough for the nodes to send only the top 10K records. With sub-select, you can rewrite the query as:</p>
<p><code>sql
SELECT * FROM
     (SELECT * FROM my_dist_index WHERE some_conditions LIMIT 10000)
 ORDER by some_attr LIMIT 50000;</code></p>
<p>In this case, the nodes receive only the inner query and execute it. This means the master will receive only 20x10K=200K records. The master will take all the records received, reorder them by the OUTER clause, and return the best 50K records. The sub-select helps reduce the traffic between the master and the nodes, as well as reduce the master's computation time (since it processes only 200K instead of 1M records).</p>
</li>
</ol>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.13-grouping">
        <header>
            <a class="chapter-link" href="#toc-13.13-grouping"> ¶ 13.13</a>

            
            <h1 id="grouping-search-results">Grouping search results</h1>
            
        </header>

        
        
<!-- example general -->
<p>Grouping search results is often helpful for obtaining per-group match counts or other aggregations. For example, it's useful for creating a graph illustrating the number of matching blog posts per month or grouping web search results by site or forum posts by author, etc.</p>
<p>Manticore supports the grouping of search results by single or multiple columns and computed expressions. The results can:</p>
<ul>
<li>Be sorted within a group</li>
<li>Return more than one row per group</li>
<li>Have groups filtered</li>
<li>Have groups sorted</li>
<li>Be aggregated using the <a href="../13-searching.html#aggregation-functions">aggregation functions</a></li>
</ul>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>
The general syntax is:

<!-- request SQL -->
General syntax

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="err">{</span><span class="o">*</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">SELECT_expr</span><span class="w"> </span><span class="p">[,</span><span class="w"> </span><span class="n">SELECT_expr</span><span class="w"> </span><span class="p">...]</span><span class="err">}</span>
<span class="p">...</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="err">{</span><span class="n">field_name</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">alias</span><span class="w"> </span><span class="err">}</span><span class="w"> </span><span class="p">[,</span><span class="w"> </span><span class="p">...]</span>
<span class="p">[</span><span class="k">HAVING</span><span class="w"> </span><span class="n">where_condition</span><span class="p">]</span>
<span class="p">[</span><span class="n">WITHIN</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">field_name</span><span class="w"> </span><span class="err">{</span><span class="k">ASC</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">DESC</span><span class="err">}</span><span class="w"> </span><span class="p">[,</span><span class="w"> </span><span class="p">...]]</span>
<span class="p">...</span>

<span class="n">SELECT_expr</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">field_name</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">function_name</span><span class="p">(...)</span><span class="w"> </span><span class="err">}</span>
<span class="n">where_condition</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">aggregation</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="k">alias</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="err">}</span>
</code></pre></div>



<!-- request JSON -->
JSON query format currently supports a basic grouping that can retrieve aggregate values and their count(*).


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;index_name&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;aggs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;&lt;aggr_name&gt;&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;terms&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;attribute&gt;&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">&lt;i</span><span class="kc">nt</span><span class="w"> </span><span class="err">value&gt;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



The standard query output returns the result set without grouping, which can be hidden using `limit` (or `size`).
The aggregation requires setting a `size` for the group's result set size.

<!-- end -->

</div>

</div>

<!-- example group1 -->
<h3 id="just-grouping">Just Grouping</h3>
<p>Grouping is quite simple - just add "GROUP BY smth" to the end of your <code>SELECT</code> query. The something can be:</p>
<ul>
<li>Any non-full-text field from the table: integer, float, string, MVA (multi-value attribute)</li>
<li>Or, if you used an alias in the <code>SELECT</code> list, you can GROUP BY it too</li>
</ul>
<p>You can omit any <a href="../13-searching.html#aggregation-functions">aggregation functions</a> in the <code>SELECT</code> list and it will still work:</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
Example
</div>

<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">films</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</code></pre></div>


<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">--------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------------+</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2004</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2002</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2005</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------------+</span>
</code></pre></div>


<!-- end -->

</div>

</div>
<!-- example group2 -->
<p>In most cases, however, you'll want to obtain some aggregated data for each group, such as:</p>
<ul>
<li><code>COUNT(*)</code> to simply get the number of elements in each group</li>
<li>or <code>AVG(field)</code> to calculate the average value of the field within the group</li>
</ul>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
Example
</div>

<!-- request SQL1 -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">release_year</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">films</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</code></pre></div>


<!-- response SQL1 -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">--------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------------+----------+</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2004</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">108</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2002</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">108</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">91</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2005</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">93</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">97</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------------+----------+</span>
</code></pre></div>


<!-- request SQL2 -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">release_year</span><span class="p">,</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">rental_rate</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">films</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</code></pre></div>


<!-- response SQL2 -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">--------------+------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">rental_rate</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------------+------------------+</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2004</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">2</span><span class="p">.</span><span class="mi">78629661</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2002</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">3</span><span class="p">.</span><span class="mi">08259249</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">3</span><span class="p">.</span><span class="mi">09989142</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2005</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">2</span><span class="p">.</span><span class="mi">90397978</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">3</span><span class="p">.</span><span class="mi">17556739</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------------+------------------+</span>
</code></pre></div>



<!-- request JSON -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">     </span><span class="nt">&quot;index&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;films&quot;</span><span class="p">,</span>
<span class="w">     </span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">     </span><span class="nt">&quot;aggs&quot;</span><span class="w"> </span><span class="p">:</span>
<span class="w">     </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;release_year&quot;</span><span class="w"> </span><span class="p">:</span>
<span class="w">         </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;terms&quot;</span><span class="w"> </span><span class="p">:</span>
<span class="w">             </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="s2">&quot;release_year&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="mi">100</span>
<span class="w">             </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">     </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="err">&#39;</span>
</code></pre></div>


<!-- response JSON -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>

<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;release_year&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;group_brand_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;buckets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2004</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">108</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2002</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">108</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">97</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2005</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">93</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2001</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">91</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- request PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;setName(&#39;films&#39;);</span>
<span class="x">$search = $index-&gt;search(&#39;&#39;);</span>
<span class="x">$search-&gt;limit(0);</span>
<span class="x">$search-&gt;facet(&#39;release_year&#39;,&#39;release_year&#39;,100);</span>
<span class="x">$results = $search-&gt;get();</span>
<span class="x">print_r($results-&gt;getFacets());</span>
</code></pre></div>


<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Array</span>
<span class="x">(</span>
<span class="x">    [release_year] =&gt; Array</span>
<span class="x">        (</span>
<span class="x">            [buckets] =&gt; Array</span>
<span class="x">                (</span>
<span class="x">                    [0] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 2009</span>
<span class="x">                            [doc_count] =&gt; 99</span>
<span class="x">                        )</span>
<span class="x">                    [1] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 2008</span>
<span class="x">                            [doc_count] =&gt; 102</span>
<span class="x">                        )</span>
<span class="x">                    [2] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 2007</span>
<span class="x">                            [doc_count] =&gt; 93</span>
<span class="x">                        )</span>
<span class="x">                    [3] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 2006</span>
<span class="x">                            [doc_count] =&gt; 103</span>
<span class="x">                        )</span>
<span class="x">                    [4] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 2005</span>
<span class="x">                            [doc_count] =&gt; 93</span>
<span class="x">                        )</span>
<span class="x">                    [5] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 2004</span>
<span class="x">                            [doc_count] =&gt; 108</span>
<span class="x">                        )</span>
<span class="x">                    [6] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 2003</span>
<span class="x">                            [doc_count] =&gt; 106</span>
<span class="x">                        )</span>
<span class="x">                    [7] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 2002</span>
<span class="x">                            [doc_count] =&gt; 108</span>
<span class="x">                        )</span>
<span class="x">                    [8] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 2001</span>
<span class="x">                            [doc_count] =&gt; 91</span>
<span class="x">                        )</span>
<span class="x">                    [9] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 2000</span>
<span class="x">                            [doc_count] =&gt; 97</span>
<span class="x">                        )</span>
<span class="x">                )</span>
<span class="x">        )</span>
<span class="x">)</span>
</code></pre></div>


<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">res</span> <span class="o">=</span><span class="n">searchApi</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;films&quot;</span><span class="p">,</span><span class="s2">&quot;limit&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;aggs&quot;</span><span class="p">:{</span><span class="s2">&quot;release_year&quot;</span><span class="p">:{</span><span class="s2">&quot;terms&quot;</span><span class="p">:{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span><span class="s2">&quot;release_year&quot;</span><span class="p">,</span><span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">}}}})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;aggregations&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;release_year&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;buckets&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">99</span><span class="p">,</span>
                                                  <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">2009</span><span class="p">},</span>
                                                 <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">102</span><span class="p">,</span>
                                                  <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">2008</span><span class="p">},</span>
                                                 <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">93</span><span class="p">,</span>
                                                  <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">2007</span><span class="p">},</span>
                                                 <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">103</span><span class="p">,</span>
                                                  <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">2006</span><span class="p">},</span>
                                                 <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">93</span><span class="p">,</span>
                                                  <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">2005</span><span class="p">},</span>
                                                 <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">108</span><span class="p">,</span>
                                                  <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">2004</span><span class="p">},</span>
                                                 <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">106</span><span class="p">,</span>
                                                  <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">2003</span><span class="p">},</span>
                                                 <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">108</span><span class="p">,</span>
                                                  <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">2002</span><span class="p">},</span>
                                                 <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">91</span><span class="p">,</span>
                                                  <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">2001</span><span class="p">},</span>
                                                 <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">97</span><span class="p">,</span>
                                                  <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">2000</span><span class="p">}]}},</span>
 <span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;max_score&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>


<!-- request Javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="s2">&quot;films&quot;</span><span class="p">,</span><span class="s2">&quot;limit&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;aggs&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;release_year&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;terms&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="o">:</span><span class="s2">&quot;release_year&quot;</span><span class="p">,</span><span class="s2">&quot;size&quot;</span><span class="o">:</span><span class="mf">100</span><span class="p">}}}});</span>
</code></pre></div>


<!-- response Javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="s2">&quot;aggregations&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;release_year&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;buckets&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="mf">2009</span><span class="p">,</span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="mf">99</span><span class="p">},{</span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="mf">2008</span><span class="p">,</span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="mf">102</span><span class="p">},{</span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="mf">2007</span><span class="p">,</span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="mf">93</span><span class="p">},{</span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="mf">2006</span><span class="p">,</span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="mf">103</span><span class="p">},{</span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="mf">2005</span><span class="p">,</span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="mf">93</span><span class="p">},{</span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="mf">2004</span><span class="p">,</span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="mf">108</span><span class="p">},{</span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="mf">2003</span><span class="p">,</span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="mf">106</span><span class="p">},{</span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="mf">2002</span><span class="p">,</span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="mf">108</span><span class="p">},{</span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="mf">2001</span><span class="p">,</span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="mf">91</span><span class="p">},{</span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="mf">2000</span><span class="p">,</span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="mf">97</span><span class="p">}]}},</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">1000</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">[]}}</span>
</code></pre></div>


<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">aggs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;release_year&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;terms&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">            </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;field&quot;</span><span class="p">,</span><span class="s">&quot;release_year&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;size&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>
<span class="w">        </span><span class="p">}});</span>
<span class="w">    </span><span class="p">}});</span>
<span class="p">}};</span>

<span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">();</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;films&quot;</span><span class="p">);</span><span class="w">        </span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setLimit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">query</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;match_all&quot;</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setAggs</span><span class="p">(</span><span class="n">aggs</span><span class="p">);</span>
<span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">took</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">aggregations</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">release_year</span><span class="o">=</span><span class="p">{</span><span class="n">buckets</span><span class="o">=[</span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">2009</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">99</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">2008</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">102</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">2007</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">93</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">2006</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">103</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">2005</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">93</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">2004</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">108</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">2003</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">106</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">2002</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">108</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">2001</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">91</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">97</span><span class="p">}</span><span class="o">]</span><span class="p">}}</span>
<span class="w">    </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">maxScore</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">        </span><span class="n">total</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span>
<span class="w">        </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="o">[]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">profile</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- request C# -->

<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">agg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Aggregation</span><span class="p">(</span><span class="s2">&quot;release_year&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;release_year&quot;</span><span class="p">);</span>
<span class="n">agg</span><span class="o">.</span><span class="n">Size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="n">object</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">match_all</span><span class="o">=</span><span class="nb nb-Type">null</span><span class="w"> </span><span class="p">};</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;films&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Aggs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Aggregation</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="n">agg</span><span class="p">};</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="o">.</span><span class="n">Search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="n">class</span><span class="w"> </span><span class="n">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">took:</span><span class="w"> </span><span class="mh">0</span>
<span class="w">    </span><span class="nl">timedOut:</span><span class="w"> </span><span class="n">false</span>
<span class="w">    </span><span class="nl">aggregations:</span><span class="w"> </span><span class="p">{</span><span class="n">release_year</span><span class="o">=</span><span class="p">{</span><span class="n">buckets</span><span class="o">=</span><span class="p">[{</span><span class="n">key</span><span class="o">=</span><span class="mh">2009</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">99</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">2008</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">102</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">2007</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">93</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">2006</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">103</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">2005</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">93</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">2004</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">108</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">2003</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">106</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">2002</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">108</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">2001</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">91</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">2000</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">97</span><span class="p">}]}}</span>
<span class="w">    </span><span class="nl">hits:</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="n">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">maxScore:</span><span class="w"> </span><span class="n">null</span>
<span class="w">        </span><span class="nl">total:</span><span class="w"> </span><span class="mh">1000</span>
<span class="w">        </span><span class="nl">hits:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nl">profile:</span><span class="w"> </span><span class="n">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">limit</span><span class="o">:</span><span class="w"> </span><span class="kt">0</span><span class="p">,</span>
<span class="w">  </span><span class="nx">aggs</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">cat_id</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">terms</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;cat&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">size</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>



<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;aggregations&quot;</span><span class="o">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;cat_id&quot;</span><span class="o">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;buckets&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">[{</span>
<span class="w">                </span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="mf">1</span>
<span class="w">            </span><span class="p">}]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">5</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">[]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{};</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
<span class="nx">aggTerms</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewAggregationTerms</span><span class="p">()</span>
<span class="nx">aggTerms</span><span class="p">.</span><span class="nx">SetField</span><span class="p">(</span><span class="s">&quot;cat&quot;</span><span class="p">)</span>
<span class="nx">aggTerms</span><span class="p">.</span><span class="nx">SetSize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nx">aggregation</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewAggregation</span><span class="p">()</span>
<span class="nx">aggregation</span><span class="p">.</span><span class="nx">setTerms</span><span class="p">(</span><span class="nx">aggTerms</span><span class="p">)</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetAggregation</span><span class="p">(</span><span class="nx">aggregation</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">SearchRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">searchRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>



<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;took&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;timed_out&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;aggregations&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;cat_id&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;buckets&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">[{</span>
<span class="w">                </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;doc_count&quot;</span><span class="p">:</span><span class="mi">1</span>
<span class="w">            </span><span class="p">}]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;total&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;hits&quot;</span><span class="p">:[]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example sort1 -->

<div class='item-select'>
Sorting groups
</div>
<p>By default, groups are not sorted, and the next thing you typically want to do is order them by something, like the field you're grouping by:</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
Example
</div>

<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">release_year</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">films</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="k">asc</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</code></pre></div>


<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">--------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------------+----------+</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">97</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">91</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2002</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">108</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2003</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">106</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2004</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">108</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------------+----------+</span>
</code></pre></div>


<!-- end -->

</div>

</div>
<!-- example sort2 -->
<p>Alternatively, you can sort by the aggregation:</p>
<ul>
<li>by <code>count(*)</code> to display groups with the most elements first</li>
<li>by <code>avg(rental_rate)</code> to show the highest-rated movies first. Note that in the example, it's done via an alias: <code>avg(rental_rate)</code> is first mapped to <code>avg</code> in the <code>SELECT</code> list, and then we simply do <code>ORDER BY avg</code></li>
</ul>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
Example
</div>

<!-- request SQL1 -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">release_year</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">films</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">desc</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</code></pre></div>


<!-- response SQL1 -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">--------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------------+----------+</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2004</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">108</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2002</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">108</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2003</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">106</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2006</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">103</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2008</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">102</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------------+----------+</span>
</code></pre></div>



<!-- request SQL2 -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">release_year</span><span class="p">,</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">rental_rate</span><span class="p">)</span><span class="w"> </span><span class="k">avg</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">films</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">avg</span><span class="w"> </span><span class="k">desc</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</code></pre></div>


<!-- response SQL2 -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">--------------+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">avg</span><span class="w">        </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------------+------------+</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2006</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="mi">26184368</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="mi">17556739</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="mi">09989142</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2002</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="mi">08259249</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2008</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="mi">99000049</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------------+------------+</span>
</code></pre></div>


<!-- end -->

</div>

</div>

<!-- example group3 -->

<div class='item-select'>
GROUP BY multiple fields at once
</div>
<p>In some cases, you might want to group not just by a single field, but by multiple fields at once, such as a movie's category and year:</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
Example
</div>

<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">category_id</span><span class="p">,</span><span class="w"> </span><span class="n">release_year</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">films</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">category_id</span><span class="p">,</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">category_id</span><span class="w"> </span><span class="k">ASC</span><span class="p">,</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="k">ASC</span><span class="p">;</span>
</code></pre></div>


<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">-------------+--------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">category_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+--------------+----------+</span>
<span class="o">|</span><span class="w">           </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">           </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">           </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">2002</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">6</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">           </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">2003</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">6</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">           </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">2004</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">           </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">2005</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">           </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">2006</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">           </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">2007</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">           </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">2008</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">7</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">           </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">2009</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">14</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">           </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">           </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">           </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">2002</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">6</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">           </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">2003</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">6</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">           </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">2004</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">           </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">2005</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">           </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">2006</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">           </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">2007</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">8</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">           </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">2008</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">8</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">           </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">2009</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+--------------+----------+</span>
</code></pre></div>


<!-- request JSON -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;films&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="nt">&quot;aggs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;cat_release&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;composite&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;sources&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;category&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;terms&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;category_id&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">                    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;release year&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;terms&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;release_year&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="err">&#39;</span>
</code></pre></div>


<!-- response JSON -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;total_relation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eq&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;aggregations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;cat_release&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;after_key&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;category&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;release year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2007</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;buckets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;category&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;release year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2008</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;category&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;release year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2009</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">14</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;category&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;release year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2005</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;category&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;release year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2004</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;category&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;release year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2007</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- end -->

</div>

</div>

<!-- example group4 -->

<div class='item-select'>
Give me N rows
</div>
<p>Sometimes it's useful to see not just a single element per group, but multiple. This can be easily achieved with the help of <code>GROUP N BY</code>. For example, in the following case, we get two movies for each year rather than just one, which a simple <code>GROUP BY release_year</code> would have returned.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
Example
</div>

<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">release_year</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">films</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>
</code></pre></div>


<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">--------------+-----------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">title</span><span class="w">                       </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------------+-----------------------------+</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2009</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ALICE</span><span class="w"> </span><span class="n">FANTASIA</span><span class="w">              </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2009</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ALIEN</span><span class="w"> </span><span class="n">CENTER</span><span class="w">                </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2008</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">AMADEUS</span><span class="w"> </span><span class="n">HOLY</span><span class="w">                </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2008</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ANACONDA</span><span class="w"> </span><span class="n">CONFESSIONS</span><span class="w">        </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2007</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ANGELS</span><span class="w"> </span><span class="n">LIFE</span><span class="w">                 </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2007</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ARACHNOPHOBIA</span><span class="w"> </span><span class="n">ROLLERCOASTER</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------------+-----------------------------+</span>
</code></pre></div>


<!-- end -->

</div>

</div>

<!-- example group5 -->

<div class='item-select'>
Sorting inside a group
</div>
<p>Another crucial analytics requirement is to sort elements within a group. To achieve this, use the <code>WITHIN GROUP ORDER BY ... {ASC|DESC}</code> clause. For example, let's get the highest-rated film for each year. Note that it works in parallel with just <code>ORDER BY</code>:</p>
<ul>
<li><code>WITHIN GROUP ORDER BY</code> sorts results <strong>inside a group</strong></li>
<li>while just <code>GROUP BY</code> <strong>sorts the groups themselves</strong></li>
</ul>
<p>These two work entirely independently.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
Example
</div>

<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">release_year</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">rental_rate</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">films</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="n">WITHIN</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">rental_rate</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</code></pre></div>


<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">--------------+------------------+-------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">title</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">rental_rate</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------------+------------------+-------------+</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2009</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">AMERICAN</span><span class="w"> </span><span class="n">CIRCUS</span><span class="w">  </span><span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="p">.</span><span class="mi">990000</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2008</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ANTHEM</span><span class="w"> </span><span class="n">LUKE</span><span class="w">      </span><span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="p">.</span><span class="mi">990000</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2007</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ATTACKS</span><span class="w"> </span><span class="n">HATE</span><span class="w">     </span><span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="p">.</span><span class="mi">990000</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2006</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ALADDIN</span><span class="w"> </span><span class="n">CALENDAR</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="p">.</span><span class="mi">990000</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2005</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">AIRPLANE</span><span class="w"> </span><span class="n">SIERRA</span><span class="w">  </span><span class="o">|</span><span class="w">    </span><span class="mi">4</span><span class="p">.</span><span class="mi">990000</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------------+------------------+-------------+</span>
</code></pre></div>


<!-- end -->

</div>

</div>

<!-- example group6 -->

<div class='item-select'>
Filter groups
</div>
<p><code>HAVING expression</code> is a helpful clause for filtering groups. While <code>WHERE</code> is applied before grouping, <code>HAVING</code> works with the groups. For example, let's keep only those years when the average rental rate of the films for that year was higher than 3. We get only four years:</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
Example
</div>

<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">release_year</span><span class="p">,</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">rental_rate</span><span class="p">)</span><span class="w"> </span><span class="k">avg</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">films</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="k">HAVING</span><span class="w"> </span><span class="k">avg</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
</code></pre></div>


<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">--------------+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">avg</span><span class="w">        </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------------+------------+</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2002</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="mi">08259249</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="mi">09989142</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="mi">17556739</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2006</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="mi">26184368</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------------+------------+</span>
</code></pre></div>


<!-- end -->

</div>

</div>

<!-- example group7 -->

<div class='item-select'>
GROUPBY()
</div>
<p>There is a function <code>GROUPBY()</code> which returns the key of the current group. It's useful in many cases, especially when you <a href="../13-searching.html#grouping-by-mva-%28multi-value-attributes%29">GROUP BY an MVA</a> or a <a href="../13-searching.html#grouping-by-a-json-node">JSON value</a>.</p>
<p>It can also be used in <code>HAVING</code>, for example, to keep only years 2000 and 2002.</p>
<p>Note that <code>GROUPBY()</code>is not recommended for use when you GROUP BY multiple fields at once. It will still work, but since the group key in this case is a compound of field values, it may not appear the way you expect.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
Example
</div>

<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">release_year</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">films</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="k">HAVING</span><span class="w"> </span><span class="n">GROUPBY</span><span class="p">()</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="mi">2002</span><span class="p">);</span>
</code></pre></div>


<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">--------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------------+----------+</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2002</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">108</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">97</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------------+----------+</span>
</code></pre></div>


<!-- end -->

</div>

</div>
<!-- example mva -->

<div class='item-select'>
Grouping by MVA (multi-value attributes)
</div>
<p>Manticore supports grouping by <a href="../06-creating_a_table.html#multi-value-integer-%28mva%29">MVA</a>. To demonstrate how it works, let's create a table "shoes" with MVA "sizes" and insert a few documents into it:</p>
<div class="codehilite"><pre><span></span><code><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">shoes</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span><span class="w"> </span><span class="n">sizes</span><span class="w"> </span><span class="n">multi</span><span class="p">);</span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">shoes</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;nike&#39;</span><span class="p">,(</span><span class="mi">40</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">42</span><span class="p">)),(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;adidas&#39;</span><span class="p">,(</span><span class="mi">41</span><span class="p">,</span><span class="mi">43</span><span class="p">)),(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;reebook&#39;</span><span class="p">,(</span><span class="mi">42</span><span class="p">,</span><span class="mi">43</span><span class="p">));</span>
</code></pre></div>

<p>so we have:</p>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">shoes</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------------------+----------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">sizes</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">title</span><span class="w">   </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+----------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657851069130080265</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">42</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">nike</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657851069130080266</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">41</span><span class="p">,</span><span class="mi">43</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">adidas</span><span class="w">  </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657851069130080267</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="mi">43</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">reebook</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+----------+---------+</span>
</code></pre></div>

<p>If we now GROUP BY "sizes", it will process all our multi-value attributes and return an aggregation for each, in this case just the count:</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
Example
</div>

<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">groupby</span><span class="p">()</span><span class="w"> </span><span class="n">gb</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">shoes</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">sizes</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">gb</span><span class="w"> </span><span class="k">asc</span><span class="p">;</span>
</code></pre></div>


<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">gb</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+----------+</span>
<span class="o">|</span><span class="w">   </span><span class="mi">40</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">   </span><span class="mi">41</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">   </span><span class="mi">42</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">   </span><span class="mi">43</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+----------+</span>
</code></pre></div>



<!-- request JSON -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">     </span><span class="nt">&quot;index&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;shoes&quot;</span><span class="p">,</span>
<span class="w">     </span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">     </span><span class="nt">&quot;aggs&quot;</span><span class="w"> </span><span class="p">:</span>
<span class="w">     </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;sizes&quot;</span><span class="w"> </span><span class="p">:</span>
<span class="w">         </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;terms&quot;</span><span class="w"> </span><span class="p">:</span>
<span class="w">             </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="s2">&quot;sizes&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="mi">100</span>
<span class="w">             </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">     </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="err">&#39;</span>
</code></pre></div>


<!-- response JSON -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>

<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;aggregations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;sizes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;buckets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">43</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">41</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- request PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;setName(&#39;shoes&#39;);</span>
<span class="x">$search = $index-&gt;search(&#39;&#39;);</span>
<span class="x">$search-&gt;limit(0);</span>
<span class="x">$search-&gt;facet(&#39;sizes&#39;,&#39;sizes&#39;,100);</span>
<span class="x">$results = $search-&gt;get();</span>
<span class="x">print_r($results-&gt;getFacets());</span>
</code></pre></div>


<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Array</span>
<span class="x">(</span>
<span class="x">    [sizes] =&gt; Array</span>
<span class="x">        (</span>
<span class="x">            [buckets] =&gt; Array</span>
<span class="x">                (</span>
<span class="x">                    [0] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 43</span>
<span class="x">                            [doc_count] =&gt; 2</span>
<span class="x">                        )</span>
<span class="x">                    [1] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 42</span>
<span class="x">                            [doc_count] =&gt; 2</span>
<span class="x">                        )</span>
<span class="x">                    [2] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 41</span>
<span class="x">                            [doc_count] =&gt; 2</span>
<span class="x">                        )</span>
<span class="x">                    [3] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 40</span>
<span class="x">                            [doc_count] =&gt; 1</span>
<span class="x">                        )</span>
<span class="x">                )</span>
<span class="x">        )</span>
<span class="x">)</span>
</code></pre></div>


<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">res</span> <span class="o">=</span><span class="n">searchApi</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;shoes&quot;</span><span class="p">,</span><span class="s2">&quot;limit&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;aggs&quot;</span><span class="p">:{</span><span class="s2">&quot;sizes&quot;</span><span class="p">:{</span><span class="s2">&quot;terms&quot;</span><span class="p">:{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span><span class="s2">&quot;sizes&quot;</span><span class="p">,</span><span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">}}}})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;aggregations&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;sizes&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;buckets&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">43</span><span class="p">},</span>
                                          <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">},</span>
                                          <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">41</span><span class="p">},</span>
                                          <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">40</span><span class="p">}]}},</span>
 <span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;max_score&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>


<!-- request Javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="s2">&quot;shoes&quot;</span><span class="p">,</span><span class="s2">&quot;limit&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;aggs&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;sizes&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;terms&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="o">:</span><span class="s2">&quot;sizes&quot;</span><span class="p">,</span><span class="s2">&quot;size&quot;</span><span class="o">:</span><span class="mf">100</span><span class="p">}}}});</span>
</code></pre></div>


<!-- response Javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="s2">&quot;aggregations&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;sizes&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;buckets&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="mf">43</span><span class="p">,</span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="mf">2</span><span class="p">},{</span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="mf">42</span><span class="p">,</span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="mf">2</span><span class="p">},{</span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="mf">41</span><span class="p">,</span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="mf">2</span><span class="p">},{</span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="mf">40</span><span class="p">,</span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">}]}},</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">3</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">[]}}</span>
</code></pre></div>


<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">aggs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;release_year&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;terms&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">            </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;field&quot;</span><span class="p">,</span><span class="s">&quot;release_year&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;size&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>
<span class="w">        </span><span class="p">}});</span>
<span class="w">    </span><span class="p">}});</span>
<span class="p">}};</span>

<span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">();</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;films&quot;</span><span class="p">);</span><span class="w">        </span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setLimit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">query</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;match_all&quot;</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setAggs</span><span class="p">(</span><span class="n">aggs</span><span class="p">);</span>
<span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">took</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">aggregations</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">release_year</span><span class="o">=</span><span class="p">{</span><span class="n">buckets</span><span class="o">=[</span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">43</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">2</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">2</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">41</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">2</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">1</span><span class="p">}</span><span class="o">]</span><span class="p">}}</span>
<span class="w">    </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">maxScore</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">        </span><span class="n">total</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="o">[]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">profile</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- request C# -->

<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">agg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Aggregation</span><span class="p">(</span><span class="s2">&quot;release_year&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;release_year&quot;</span><span class="p">);</span>
<span class="n">agg</span><span class="o">.</span><span class="n">Size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="n">object</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">match_all</span><span class="o">=</span><span class="nb nb-Type">null</span><span class="w"> </span><span class="p">};</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;films&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Aggs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Aggregation</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="n">agg</span><span class="p">};</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="o">.</span><span class="n">Search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="n">class</span><span class="w"> </span><span class="n">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">took:</span><span class="w"> </span><span class="mh">0</span>
<span class="w">    </span><span class="nl">timedOut:</span><span class="w"> </span><span class="n">false</span>
<span class="w">    </span><span class="nl">aggregations:</span><span class="w"> </span><span class="p">{</span><span class="n">release_year</span><span class="o">=</span><span class="p">{</span><span class="n">buckets</span><span class="o">=</span><span class="p">[{</span><span class="n">key</span><span class="o">=</span><span class="mh">43</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">2</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">42</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">2</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">41</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">2</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">40</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">1</span><span class="p">}]}}</span>
<span class="w">    </span><span class="nl">hits:</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="n">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">maxScore:</span><span class="w"> </span><span class="n">null</span>
<span class="w">        </span><span class="nl">total:</span><span class="w"> </span><span class="mh">3</span>
<span class="w">        </span><span class="nl">hits:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nl">profile:</span><span class="w"> </span><span class="n">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">aggs</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">mva_agg</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">terms</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;mva_field&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">size</span><span class="o">:</span><span class="w"> </span><span class="kt">2</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>



<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;aggregations&quot;</span><span class="o">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;mva_agg&quot;</span><span class="o">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;buckets&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">[{</span>
<span class="w">                </span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="mf">4</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="mf">2</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="mf">2</span>
<span class="w">            </span><span class="p">}]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">4</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">[]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{};</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
<span class="nx">aggTerms</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewAggregationTerms</span><span class="p">()</span>
<span class="nx">aggTerms</span><span class="p">.</span><span class="nx">SetField</span><span class="p">(</span><span class="s">&quot;mva_field&quot;</span><span class="p">)</span>
<span class="nx">aggTerms</span><span class="p">.</span><span class="nx">SetSize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="nx">aggregation</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewAggregation</span><span class="p">()</span>
<span class="nx">aggregation</span><span class="p">.</span><span class="nx">setTerms</span><span class="p">(</span><span class="nx">aggTerms</span><span class="p">)</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetAggregation</span><span class="p">(</span><span class="nx">aggregation</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">SearchRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">searchRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>



<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;took&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;timed_out&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;aggregations&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;mva_agg&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;buckets&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">[{</span>
<span class="w">                </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;doc_count&quot;</span><span class="p">:</span><span class="mi">4</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;doc_count&quot;</span><span class="p">:</span><span class="mi">2</span>
<span class="w">            </span><span class="p">}]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;total&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;hits&quot;</span><span class="p">:[]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example json -->

<div class='item-select'>
Grouping by a JSON node
</div>
<p>If you have a field of type <a href="../06-creating_a_table.html#json">JSON</a>, you can GROUP BY any node from it. To demonstrate this, let's create a table "products" with a few documents, each having a color in the "meta" JSON field:</p>
<div class="codehilite"><pre><span></span><code><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">products</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="n">json</span><span class="p">);</span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;nike&#39;</span><span class="p">,</span><span class="s1">&#39;{&quot;color&quot;:&quot;red&quot;}&#39;</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;adidas&#39;</span><span class="p">,</span><span class="s1">&#39;{&quot;color&quot;:&quot;red&quot;}&#39;</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;puma&#39;</span><span class="p">,</span><span class="s1">&#39;{&quot;color&quot;:&quot;green&quot;}&#39;</span><span class="p">);</span>
</code></pre></div>

<p>This gives us:</p>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">products</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------------------+-------------------+--------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">meta</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="n">title</span><span class="w">  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+-------------------+--------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657851069130080268</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;color&quot;</span><span class="p">:</span><span class="ss">&quot;red&quot;</span><span class="err">}</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">nike</span><span class="w">   </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657851069130080269</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;color&quot;</span><span class="p">:</span><span class="ss">&quot;red&quot;</span><span class="err">}</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">adidas</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657851069130080270</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;color&quot;</span><span class="p">:</span><span class="ss">&quot;green&quot;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">puma</span><span class="w">   </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+-------------------+--------+</span>
</code></pre></div>

<p>To group the products by color, we can simply use <code>GROUP BY meta.color</code>, and to display the corresponding group key in the <code>SELECT</code> list, we can use <code>GROUPBY()</code>:</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
Example
</div>

<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">groupby</span><span class="p">()</span><span class="w"> </span><span class="n">color</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">meta</span><span class="p">.</span><span class="n">color</span><span class="p">;</span>
</code></pre></div>


<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">-------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">red</span><span class="w">   </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">green</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------+----------+</span>
</code></pre></div>


<!-- request JSON -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">     </span><span class="nt">&quot;index&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">     </span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">     </span><span class="nt">&quot;aggs&quot;</span><span class="w"> </span><span class="p">:</span>
<span class="w">     </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;color&quot;</span><span class="w"> </span><span class="p">:</span>
<span class="w">         </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;terms&quot;</span><span class="w"> </span><span class="p">:</span>
<span class="w">             </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="s2">&quot;meta.color&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="mi">100</span>
<span class="w">             </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">     </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="err">&#39;</span>
</code></pre></div>


<!-- response JSON -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>

<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;aggregations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;color&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;buckets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- request PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;setName(&#39;products&#39;);</span>
<span class="x">$search = $index-&gt;search(&#39;&#39;);</span>
<span class="x">$search-&gt;limit(0);</span>
<span class="x">$search-&gt;facet(&#39;meta.color&#39;,&#39;color&#39;,100);</span>
<span class="x">$results = $search-&gt;get();</span>
<span class="x">print_r($results-&gt;getFacets());</span>
</code></pre></div>


<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Array</span>
<span class="x">(</span>
<span class="x">    [color] =&gt; Array</span>
<span class="x">        (</span>
<span class="x">            [buckets] =&gt; Array</span>
<span class="x">                (</span>
<span class="x">                    [0] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; green</span>
<span class="x">                            [doc_count] =&gt; 1</span>
<span class="x">                        )</span>
<span class="x">                    [1] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; red</span>
<span class="x">                            [doc_count] =&gt; 2</span>
<span class="x">                        )</span>
<span class="x">                )</span>
<span class="x">        )</span>
<span class="x">)</span>
</code></pre></div>


<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">res</span> <span class="o">=</span><span class="n">searchApi</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="s2">&quot;limit&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;aggs&quot;</span><span class="p">:{</span><span class="s2">&quot;color&quot;</span><span class="p">:{</span><span class="s2">&quot;terms&quot;</span><span class="p">:{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span><span class="s2">&quot;meta.color&quot;</span><span class="p">,</span><span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">}}}})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;aggregations&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;buckets&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                           <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;green&#39;</span><span class="p">},</span>
                                          <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;red&#39;</span><span class="p">}]}},</span>
 <span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;max_score&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>


<!-- request Javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="s2">&quot;limit&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;aggs&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;terms&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="o">:</span><span class="s2">&quot;meta.color&quot;</span><span class="p">,</span><span class="s2">&quot;size&quot;</span><span class="o">:</span><span class="mf">100</span><span class="p">}}}});</span>
</code></pre></div>


<!-- response Javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="s2">&quot;aggregations&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;buckets&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="s2">&quot;green&quot;</span><span class="p">,</span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">},{</span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="mf">2</span><span class="p">}]}},</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">3</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">[]}}</span>
</code></pre></div>


<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">aggs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;color&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;terms&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">            </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;field&quot;</span><span class="p">,</span><span class="s">&quot;meta.color&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;size&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>
<span class="w">        </span><span class="p">}});</span>
<span class="w">    </span><span class="p">}});</span>
<span class="p">}};</span>

<span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">();</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;products&quot;</span><span class="p">);</span><span class="w">        </span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setLimit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">query</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;match_all&quot;</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setAggs</span><span class="p">(</span><span class="n">aggs</span><span class="p">);</span>
<span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">took</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">aggregations</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">color</span><span class="o">=</span><span class="p">{</span><span class="n">buckets</span><span class="o">=[</span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="n">green</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="n">red</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">2</span><span class="p">}</span><span class="o">]</span><span class="p">}}</span>
<span class="w">    </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">maxScore</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">        </span><span class="n">total</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="o">[]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">profile</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- request C# -->

<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">agg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Aggregation</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;meta.color&quot;</span><span class="p">);</span>
<span class="n">agg</span><span class="o">.</span><span class="n">Size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="n">object</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">match_all</span><span class="o">=</span><span class="nb nb-Type">null</span><span class="w"> </span><span class="p">};</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Aggs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Aggregation</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="n">agg</span><span class="p">};</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="o">.</span><span class="n">Search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="n">class</span><span class="w"> </span><span class="n">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">took:</span><span class="w"> </span><span class="mh">0</span>
<span class="w">    </span><span class="nl">timedOut:</span><span class="w"> </span><span class="n">false</span>
<span class="w">    </span><span class="nl">aggregations:</span><span class="w"> </span><span class="p">{</span><span class="n">color</span><span class="o">=</span><span class="p">{</span><span class="n">buckets</span><span class="o">=</span><span class="p">[{</span><span class="n">key</span><span class="o">=</span><span class="n">green</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">1</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="n">red</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">2</span><span class="p">}]}}</span>
<span class="w">    </span><span class="nl">hits:</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="n">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">maxScore:</span><span class="w"> </span><span class="n">null</span>
<span class="w">        </span><span class="nl">total:</span><span class="w"> </span><span class="mh">3</span>
<span class="w">        </span><span class="nl">hits:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nl">profile:</span><span class="w"> </span><span class="n">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">aggs</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">json_agg</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">terms</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;json_field.year&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">size</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>



<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;aggregations&quot;</span><span class="o">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;json_agg&quot;</span><span class="o">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;buckets&quot;</span><span class="o">:</span>
<span class="w">            </span><span class="p">[{</span>
<span class="w">                </span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="mf">2000</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="mf">2</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="mf">2001</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="mf">2</span>
<span class="w">            </span><span class="p">}]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">4</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">[]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{};</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
<span class="nx">aggTerms</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewAggregationTerms</span><span class="p">()</span>
<span class="nx">aggTerms</span><span class="p">.</span><span class="nx">SetField</span><span class="p">(</span><span class="s">&quot;json_field.year&quot;</span><span class="p">)</span>
<span class="nx">aggTerms</span><span class="p">.</span><span class="nx">SetSize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="nx">aggregation</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewAggregation</span><span class="p">()</span>
<span class="nx">aggregation</span><span class="p">.</span><span class="nx">setTerms</span><span class="p">(</span><span class="nx">aggTerms</span><span class="p">)</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetAggregation</span><span class="p">(</span><span class="nx">aggregation</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">SearchRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">searchRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>



<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;took&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;timed_out&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;aggregations&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;json_agg&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;buckets&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">[{</span>
<span class="w">                </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="mi">2000</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;doc_count&quot;</span><span class="p">:</span><span class="mi">2</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="mi">2001</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;doc_count&quot;</span><span class="p">:</span><span class="mi">2</span>
<span class="w">            </span><span class="p">}]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;total&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;hits&quot;</span><span class="p">:[]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<h2 id="aggregation-functions">Aggregation functions</h2>
<p>Besides <code>COUNT(*)</code>, which returns the number of elements in each group, you can use various other aggregation functions:</p>
<!-- example distinct -->

<div class='item-select'>
COUNT(DISTINCT field)
</div>
<p>While <code>COUNT(*)</code> returns the number of all elements in the group, <code>COUNT(DISTINCT field)</code> returns the number of unique values of the field in the group, which may be completely different from the total count. For instance, you can have 100 elements in the group, but all with the same value for a certain field. <code>COUNT(DISTINCT field)</code> helps to determine that. To demonstrate this, let's create a table "students" with the student's name, age, and major:</p>
<div class="codehilite"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">students</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="nb">int</span><span class="p">,</span><span class="w"> </span><span class="n">major</span><span class="w"> </span><span class="n">string</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">students</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;John&#39;</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="s1">&#39;arts&#39;</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;William&#39;</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="s1">&#39;business&#39;</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;Richard&#39;</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="s1">&#39;cs&#39;</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;Rebecca&#39;</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="s1">&#39;cs&#39;</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;Monica&#39;</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="s1">&#39;arts&#39;</span><span class="p">);</span>
</code></pre></div>

<p>so we have:</p>
<div class="codehilite"><pre><span></span><code><span class="n">MySQL</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">students</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------------------+------+----------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">age</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">major</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">name</span><span class="w">    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+------+----------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657851069130080271</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">21</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">arts</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">John</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657851069130080272</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">22</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">business</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">William</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657851069130080273</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">21</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">cs</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">Richard</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657851069130080274</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">22</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">cs</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">Rebecca</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657851069130080275</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">21</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">arts</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">Monica</span><span class="w">  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+------+----------+---------+</span>
</code></pre></div>

<p>In the example, you can see that if we GROUP BY major and display both <code>COUNT(*)</code> and <code>COUNT(DISTINCT age)</code>, it becomes clear that there are two students who chose the major "cs" with two unique ages, but for the major "arts", there are also two students, yet only one unique age.</p>
<p>There can be at most one <code>COUNT(DISTINCT)</code> per query.</p>
<p>** By default, counts are approximate **</p>
<p>Actually, some of them are exact, while others are approximate. More on that below.</p>
<p>Manticore supports two algorithms for computing counts of distinct values. One is a legacy algorithm that uses a lot of memory and is usually slow. It collects <code>{group; value}</code> pairs, sorts them, and periodically discards duplicates. The benefit of this approach is that it guarantees exact counts within a plain table. You can enable it by setting the <a href="../13-searching.html#distinct_precision_threshold">distinct_precision_threshold</a> option to <code>0</code>.</p>
<p>The other algorithm (enabled by default) loads counts into a hash table and returns its size. If the hash table becomes too large, its contents are moved into a <code>HyperLogLog</code>. This is where the counts become approximate since <code>HyperLogLog</code> is a probabilistic algorithm. The advantage is that the maximum memory usage per group is fixed and depends on the accuracy of the <code>HyperLogLog</code>. The overall memory usage also depends on the <a href="../13-searching.html#max_matches">max_matches</a> setting, which reflects the number of groups.</p>
<p>The <a href="../13-searching.html#distinct_precision_threshold">distinct_precision_threshold</a> option sets the threshold below which counts are guaranteed to be exact. The <code>HyperLogLog</code> accuracy setting and the threshold for the "hash table to HyperLogLog" conversion are derived from this setting. It's important to use this option with caution because doubling it will double the maximum memory required for count calculations. The maximum memory usage can be roughly estimated using this formula: <code>64 * max_matches * distinct_precision_threshold</code>. Note that this is the worst-case scenario, and in most cases, count calculations will use significantly less RAM.</p>
<p><strong><code>COUNT(DISTINCT)</code> against a distributed table or a real-time table consisting of multiple disk chunks may return inaccurate results</strong>, but the result should be accurate for a distributed table consisting of local plain or real-time tables with the same schema (identical set/order of fields, but may have different tokenization settings).</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
Example
</div>

<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">major</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="k">distinct</span><span class="w"> </span><span class="n">age</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">students</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">major</span><span class="p">;</span>
</code></pre></div>


<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">----------+----------+---------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">major</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="k">distinct</span><span class="w"> </span><span class="n">age</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------+----------+---------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">arts</span><span class="w">     </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">                   </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">business</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">                   </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">cs</span><span class="w">       </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">                   </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------+----------+---------------------+</span>
</code></pre></div>


<!-- end -->

</div>

</div>

<!-- example concat -->

<div class='item-select'>
GROUP_CONCAT(field)
</div>

<p>Often, you want to better understand the contents of each group. You can use <a href="../13-searching.html#give-me-n-rows">GROUP N BY</a> for that, but it would return additional rows you might not want in the output. <code>GROUP_CONCAT()</code> enriches your grouping by concatenating values of a specific field in the group. Let's take the previous example and improve it by displaying all the ages in each group.</p>
<p><code>GROUP_CONCAT(field)</code> returns the list as comma-separated values.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
Example
</div>

<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">major</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="k">distinct</span><span class="w"> </span><span class="n">age</span><span class="p">),</span><span class="w"> </span><span class="n">group_concat</span><span class="p">(</span><span class="n">age</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">students</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">major</span>
</code></pre></div>


<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">----------+----------+---------------------+-------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">major</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="k">distinct</span><span class="w"> </span><span class="n">age</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">group_concat</span><span class="p">(</span><span class="n">age</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------+----------+---------------------+-------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">arts</span><span class="w">     </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">                   </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="mi">21</span><span class="w">             </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">business</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">                   </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">22</span><span class="w">                </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">cs</span><span class="w">       </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">                   </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="mi">22</span><span class="w">             </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------+----------+---------------------+-------------------+</span>
</code></pre></div>


<!-- end -->

</div>

</div>
<!-- example sum -->

<div class='item-select'>
SUM(), MIN(), MAX(), AVG()
</div>
<p>Of course, you can also obtain the sum, average, minimum, and maximum values within a group.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
Example
</div>

<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">rental_rate</span><span class="p">)</span><span class="w"> </span><span class="k">sum</span><span class="p">,</span><span class="w"> </span><span class="k">min</span><span class="p">(</span><span class="n">rental_rate</span><span class="p">)</span><span class="w"> </span><span class="k">min</span><span class="p">,</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">rental_rate</span><span class="p">)</span><span class="w"> </span><span class="k">max</span><span class="p">,</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">rental_rate</span><span class="p">)</span><span class="w"> </span><span class="k">avg</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">films</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">year</span><span class="w"> </span><span class="k">asc</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</code></pre></div>


<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">------+------------+----------+----------+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="k">year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">sum</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">min</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="k">max</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="k">avg</span><span class="w">        </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------------+----------+----------+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">308</span><span class="p">.</span><span class="mi">030029</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">990000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="mi">990000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="mi">17556739</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">282</span><span class="p">.</span><span class="mi">090118</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">990000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="mi">990000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="mi">09989142</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2002</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">332</span><span class="p">.</span><span class="mi">919983</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">990000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="mi">990000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="mi">08259249</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2003</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">310</span><span class="p">.</span><span class="mi">940063</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">990000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="mi">990000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="mi">93339682</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2004</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">300</span><span class="p">.</span><span class="mi">920044</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">990000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="mi">990000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="mi">78629661</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------------+----------+----------+------------+</span>
</code></pre></div>


<!-- end -->

</div>

</div>

<!-- example accuracy -->
<h2 id="grouping-accuracy">Grouping accuracy</h2>
<p>Grouping is done in fixed memory, which depends on the <a href="../13-searching.html#max_matches">max_matches</a> setting. If <code>max_matches</code> allows for storage of all found groups, the results will be 100% accurate. However, if the value of <code>max_matches</code> is lower, the results will be less accurate.</p>
<p>When parallel processing is involved, it can become more complicated. When <code>pseudo_sharding</code> is enabled and/or when using an RT table with several disk chunks, each chunk or pseudo shard gets a result set that is no larger than <code>max_matches</code>. This can lead to inaccuracies in aggregates and group counts when the result sets from different threads are merged. To fix this, either a larger <code>max_matches</code> value or disabling parallel processing can be used.</p>
<p>Manticore will try to increase <code>max_matches</code> up to <a href="../13-searching.html#max_matches_increase_threshold">max_matches_increase_threshold</a> if it detects that groupby may return inaccurate results. Detection is based on the number of unique values of the groupby attribute, which is retrieved from secondary indexes (if present).</p>
<p>To ensure accurate aggregates and/or group counts when using RT tables or <code>pseudo_sharding</code>, <code>accurate_aggregation</code> can be enabled. This will try to increase <code>max_matches</code> up to the threshold, and if the threshold is not high enough, Manticore will disable parallel processing for the query.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
Example
</div>

<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="n">MySQL</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">films</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">year</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="o">+</span><span class="c1">------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="k">year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2004</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">108</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2002</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">108</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">91</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2005</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">93</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">97</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+----------+</span>

<span class="n">MySQL</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">films</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">year</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="k">option</span><span class="w"> </span><span class="n">max_matches</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="o">+</span><span class="c1">------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="k">year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2004</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">76</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+----------+</span>

<span class="n">MySQL</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">films</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">year</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="k">option</span><span class="w"> </span><span class="n">max_matches</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
<span class="o">+</span><span class="c1">------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="k">year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2004</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">76</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2002</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">74</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+----------+</span>

<span class="n">MySQL</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">release_year</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">films</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">year</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="k">option</span><span class="w"> </span><span class="n">max_matches</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span>
<span class="o">+</span><span class="c1">------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="k">year</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2004</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">108</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2002</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">108</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">2001</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">91</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+----------+</span>
</code></pre></div>


<!-- end -->

</div>

</div>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.14-faceted_search">
        <header>
            <a class="chapter-link" href="#toc-13.14-faceted_search"> ¶ 13.14</a>

            
            <h1 id="faceted-search">Faceted search</h1>
            
        </header>

        
        
<p>Faceted search is as crucial to a modern search application as <a href="../13-searching.html#toc-13.17-autocomplete">autocomplete</a>, <a href="../13-searching.html#toc-13.18-spell_correction">spell correction</a>, and search keywords <a href="../13-searching.html#toc-13.07-highlighting">highlighting</a>, especially in e-commerce products.</p>
<p><img alt="Faceted search" src="faceted.png" /></p>
<p>Faceted search comes in handy when dealing with large quantities of data and various interconnected properties, such as size, color, manufacturer, or other factors. When querying vast amounts of data, search results frequently include numerous entries that don't match the user's expectations. Faceted search enables the end user to explicitly define the criteria they want their search results to satisfy.</p>
<p>In Manticore Search, there's an optimization that maintains the result set of the original query and reuses it for each facet calculation. Since the aggregations are applied to an already calculated subset of documents, they're fast, and the total execution time can often be only slightly longer than the initial query. Facets can be added to any query, and the facet can be any attribute or expression. A facet result includes the facet values and the facet counts. Facets can be accessed using the SQL <code>SELECT</code> statement by declaring them at the very end of the query.</p>
<h2 id="aggregations">Aggregations</h2>
<!-- example Aggregations -->
<h3 id="sql">SQL</h3>
<p>The facet values can originate from an attribute, a JSON property within a JSON attribute, or an expression. Facet values can also be aliased, but the <strong>alias must be unique</strong> across all result sets (main query result set and other facets result sets). The facet value is derived from the aggregated attribute/expression, but it can also come from another attribute/expression.</p>
<div class="codehilite"><pre><span></span><code><span class="n">FACET</span><span class="w"> </span><span class="err">{</span><span class="n">expr_list</span><span class="err">}</span><span class="w"> </span><span class="p">[</span><span class="k">BY</span><span class="w"> </span><span class="err">{</span><span class="n">expr_list</span><span class="err">}</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="k">DISTINCT</span><span class="w"> </span><span class="err">{</span><span class="n">field_name</span><span class="err">}</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="err">{</span><span class="n">expr</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">FACET</span><span class="p">()</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="k">ASC</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">DESC</span><span class="err">}</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="k">LIMIT</span><span class="w"> </span><span class="p">[</span><span class="k">offset</span><span class="p">,]</span><span class="w"> </span><span class="k">count</span><span class="p">]</span>
</code></pre></div>

<p>Multiple facet declarations must be separated by a whitespace.</p>
<h3 id="http-json">HTTP JSON</h3>
<p>Facets can be defined in the <code>aggs</code> node:</p>
<div class="codehilite"><pre><span></span><code><span class="w">     </span><span class="nt">&quot;aggs&quot;</span><span class="w"> </span><span class="p">:</span>
<span class="w">     </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;group name&quot;</span><span class="w"> </span><span class="p">:</span>
<span class="w">         </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;terms&quot;</span><span class="w"> </span><span class="p">:</span>
<span class="w">             </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="s2">&quot;attribute name&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span>
<span class="w">             </span><span class="p">}</span>
<span class="w">             </span><span class="nt">&quot;sort&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;attribute name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;order&quot;</span><span class="p">:</span><span class="s2">&quot;asc&quot;</span><span class="w"> </span><span class="p">}}</span><span class="w"> </span><span class="p">]</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">     </span><span class="p">}</span>
</code></pre></div>

<p>where:</p>
<ul>
<li><code>group name</code> is an alias assigned to the aggregation</li>
<li><code>field</code> value must contain the name of the attribute or expression being faceted</li>
<li>optional <code>size</code> specifies the maximum number of buckets to include in the result. When not specified, it inherits the main query's limit. More details can be found in the <a href="../13-searching.html#size-of-facet-result">Size of facet result</a> section.</li>
<li>optional <code>sort</code> specifies an array of attributes and/or additional properties using the same syntax as the <a href="../13-searching.html#sorting-via-json">"sort" parameter in the main query</a>.</li>
</ul>
<p>The result set will contain an <code>aggregations</code> node with the returned facets, where <code>key</code> is the aggregated value and <code>doc_count</code> is the aggregation count.</p>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="nt">&quot;aggregations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;group name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;buckets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1019</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">954</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1021</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1011</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">997</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w">   </span>
</code></pre></div>

<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">aprice</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">facetdemo</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">FACET</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">FACET</span><span class="w"> </span><span class="n">brand_id</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</code></pre></div>



<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">------+-------+----------+---------------------+------------+-------------+---------------------------------------+------------+--------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">brand_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">title</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">brand_name</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">property</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">j</span><span class="w">                                     </span><span class="o">|</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">aprice</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-------+----------+---------------------+------------+-------------+---------------------------------------+------------+--------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">306</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="n">Ten</span><span class="w"> </span><span class="n">Three</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">One</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Six_Ten</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;prop1&quot;</span><span class="p">:</span><span class="mi">66</span><span class="p">,</span><span class="ss">&quot;prop2&quot;</span><span class="p">:</span><span class="mi">91</span><span class="p">,</span><span class="ss">&quot;prop3&quot;</span><span class="p">:</span><span class="ss">&quot;One&quot;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="w">      </span><span class="o">|</span><span class="w">    </span><span class="mi">306</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">400</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="n">Three</span><span class="w"> </span><span class="n">One</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Ten</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Four_Three</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;prop1&quot;</span><span class="p">:</span><span class="mi">69</span><span class="p">,</span><span class="ss">&quot;prop2&quot;</span><span class="p">:</span><span class="mi">19</span><span class="p">,</span><span class="ss">&quot;prop3&quot;</span><span class="p">:</span><span class="ss">&quot;One&quot;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="w">      </span><span class="o">|</span><span class="w">    </span><span class="mi">400</span><span class="w"> </span><span class="o">|</span>
<span class="p">...</span>
<span class="o">|</span><span class="w">    </span><span class="mi">9</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">560</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">6</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="n">Two</span><span class="w"> </span><span class="n">Five</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Six</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Eight_Two</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;prop1&quot;</span><span class="p">:</span><span class="mi">90</span><span class="p">,</span><span class="ss">&quot;prop2&quot;</span><span class="p">:</span><span class="mi">84</span><span class="p">,</span><span class="ss">&quot;prop3&quot;</span><span class="p">:</span><span class="ss">&quot;One&quot;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="w">      </span><span class="o">|</span><span class="w">    </span><span class="mi">560</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">   </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">229</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">9</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="n">Three</span><span class="w"> </span><span class="n">Eight</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Nine</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Seven_Three</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;prop1&quot;</span><span class="p">:</span><span class="mi">84</span><span class="p">,</span><span class="ss">&quot;prop2&quot;</span><span class="p">:</span><span class="mi">39</span><span class="p">,</span><span class="ss">&quot;prop3&quot;</span><span class="p">:</span><span class="ss">&quot;One&quot;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="w">      </span><span class="o">|</span><span class="w">    </span><span class="mi">229</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-------+----------+---------------------+------------+-------------+---------------------------------------+------------+--------+</span>
<span class="mi">10</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
<span class="o">+</span><span class="c1">-------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------+----------+</span>
<span class="o">|</span><span class="w">   </span><span class="mi">306</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">7</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">   </span><span class="mi">400</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">13</span><span class="w"> </span><span class="o">|</span>
<span class="p">...</span>
<span class="o">|</span><span class="w">   </span><span class="mi">229</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">9</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">   </span><span class="mi">595</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------+----------+</span>
<span class="mi">10</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
<span class="o">+</span><span class="c1">----------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">brand_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------+----------+</span>
<span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1013</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">       </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">998</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">        </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1007</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">        </span><span class="mi">8</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1033</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">        </span><span class="mi">7</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">965</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------+----------+</span>
<span class="mi">5</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">     </span><span class="nt">&quot;index&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;facetdemo&quot;</span><span class="p">,</span>
<span class="w">     </span><span class="nt">&quot;query&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;match_all&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">},</span>
<span class="w">     </span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">     </span><span class="nt">&quot;aggs&quot;</span><span class="w"> </span><span class="p">:</span>
<span class="w">     </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;group_property&quot;</span><span class="w"> </span><span class="p">:</span>
<span class="w">         </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;terms&quot;</span><span class="w"> </span><span class="p">:</span>
<span class="w">             </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="s2">&quot;price&quot;</span>
<span class="w">             </span><span class="p">}</span>
<span class="w">         </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;group_brand_id&quot;</span><span class="w"> </span><span class="p">:</span>
<span class="w">         </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;terms&quot;</span><span class="w"> </span><span class="p">:</span>
<span class="w">             </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="s2">&quot;brand_id&quot;</span>
<span class="w">             </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">     </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="err">&#39;</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">197</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;brand_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;brand_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Brand Ten&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;categories&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mi">10</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w"> </span><span class="err">...</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">805</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;brand_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;brand_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Brand Seven&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;categories&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mi">11</span><span class="p">,</span>
<span class="w">            </span><span class="mi">12</span><span class="p">,</span>
<span class="w">            </span><span class="mi">13</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;aggregations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;group_property&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;buckets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">11</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">999</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span>
<span class="w">        </span><span class="p">},</span>
<span class="err">...</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">991</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;group_brand_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;buckets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1019</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">954</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1021</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1011</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">997</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
PHP
</div>

<!-- request PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;setName(&#39;facetdemo&#39;);</span>
<span class="x">$search = $index-&gt;search(&#39;&#39;);</span>
<span class="x">$search-&gt;limit(5);</span>
<span class="x">$search-&gt;facet(&#39;price&#39;,&#39;price&#39;);</span>
<span class="x">$search-&gt;facet(&#39;brand_id&#39;,&#39;group_brand_id&#39;);</span>
<span class="x">$results = $search-&gt;get();</span>
</code></pre></div>


<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Array</span>
<span class="x">(</span>
<span class="x">    [price] =&gt; Array</span>
<span class="x">        (</span>
<span class="x">            [buckets] =&gt; Array</span>
<span class="x">                (</span>
<span class="x">                    [0] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 1000</span>
<span class="x">                            [doc_count] =&gt; 11</span>
<span class="x">                        )</span>
<span class="x">                    [1] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 999</span>
<span class="x">                            [doc_count] =&gt; 12</span>
<span class="x">                        )</span>
<span class="x">                    [2] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 998</span>
<span class="x">                            [doc_count] =&gt; 7</span>
<span class="x">                        )</span>
<span class="x">                    [3] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 997</span>
<span class="x">                            [doc_count] =&gt; 14</span>
<span class="x">                        )</span>
<span class="x">                    [4] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 996</span>
<span class="x">                            [doc_count] =&gt; 8</span>
<span class="x">                        )</span>
<span class="x">                )</span>
<span class="x">        )</span>
<span class="x">    [group_brand_id] =&gt; Array</span>
<span class="x">        (</span>
<span class="x">            [buckets] =&gt; Array</span>
<span class="x">                (</span>
<span class="x">                    [0] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 10</span>
<span class="x">                            [doc_count] =&gt; 1019</span>
<span class="x">                        )</span>
<span class="x">                    [1] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 9</span>
<span class="x">                            [doc_count] =&gt; 954</span>
<span class="x">                        )</span>
<span class="x">                    [2] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 8</span>
<span class="x">                            [doc_count] =&gt; 1021</span>
<span class="x">                        )</span>
<span class="x">                    [3] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 7</span>
<span class="x">                            [doc_count] =&gt; 1011</span>
<span class="x">                        )</span>
<span class="x">                    [4] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 6</span>
<span class="x">                            [doc_count] =&gt; 997</span>
<span class="x">                        )</span>
<span class="x">                )</span>
<span class="x">        )</span>
<span class="x">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Python
</div>

<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">res</span> <span class="o">=</span><span class="n">searchApi</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;facetdemo&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="p">:{</span><span class="s2">&quot;match_all&quot;</span><span class="p">:{}},</span><span class="s2">&quot;limit&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="s2">&quot;aggs&quot;</span><span class="p">:{</span><span class="s2">&quot;group_property&quot;</span><span class="p">:{</span><span class="s2">&quot;terms&quot;</span><span class="p">:{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span><span class="s2">&quot;price&quot;</span><span class="p">,}},</span><span class="s2">&quot;group_brand_id&quot;</span><span class="p">:{</span><span class="s2">&quot;terms&quot;</span><span class="p">:{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span><span class="s2">&quot;brand_id&quot;</span><span class="p">}}}})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;aggregations&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;group_brand_id&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;buckets&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">1019</span><span class="p">,</span>
                                                    <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">954</span><span class="p">,</span>
                                                    <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">1021</span><span class="p">,</span>
                                                    <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">1011</span><span class="p">,</span>
                                                    <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">997</span><span class="p">,</span>
                                                    <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">}]},</span>
                  <span class="sa">u</span><span class="s1">&#39;group_property&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;buckets&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
                                                    <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
                                                    <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">999</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
                                                    <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">998</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
                                                    <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">997</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
                                                    <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">996</span><span class="p">}]}},</span>
 <span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;brand_id&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;brand_name&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Brand Ten&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">],</span>
                                 <span class="sa">u</span><span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="mi">197</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Six&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Product Eight One&#39;</span><span class="p">}},</span>
                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;2&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;brand_id&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;brand_name&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Brand Six&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">],</span>
                                 <span class="sa">u</span><span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="mi">671</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Four&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Product Nine Seven&#39;</span><span class="p">}},</span>
                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;3&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;brand_id&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;brand_name&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Brand Three&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
                                 <span class="sa">u</span><span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="mi">92</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Six&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Product Five Four&#39;</span><span class="p">}},</span>
                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;4&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;brand_id&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;brand_name&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Brand Ten&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">],</span>
                                 <span class="sa">u</span><span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="mi">713</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Five&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Product Eight Nine&#39;</span><span class="p">}},</span>
                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;5&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;brand_id&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;brand_name&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Brand Seven&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span>
                                 <span class="sa">u</span><span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="mi">805</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Two&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Product Ten Three&#39;</span><span class="p">}}],</span>
          <span class="s1">&#39;max_score&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
          <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Javascript
</div>

<!-- request Javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="s2">&quot;facetdemo&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;match_all&quot;</span><span class="o">:</span><span class="p">{}},</span><span class="s2">&quot;limit&quot;</span><span class="o">:</span><span class="mf">5</span><span class="p">,</span><span class="s2">&quot;aggs&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;group_property&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;terms&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="o">:</span><span class="s2">&quot;price&quot;</span><span class="p">,}},</span><span class="s2">&quot;group_brand_id&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;terms&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="o">:</span><span class="s2">&quot;brand_id&quot;</span><span class="p">}}}});</span>
</code></pre></div>


<!-- response Javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">10000</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">197</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">10</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Ten&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">10</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Eight One&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Six&quot;</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">671</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">6</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Six&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">12</span><span class="p">,</span><span class="mf">13</span><span class="p">,</span><span class="mf">14</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Nine Seven&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Four&quot;</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;3&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">92</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">3</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Three&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">13</span><span class="p">,</span><span class="mf">14</span><span class="p">,</span><span class="mf">15</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Five Four&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Six&quot;</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;4&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">713</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">10</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Ten&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">11</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Eight Nine&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Five&quot;</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;5&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">805</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">7</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Seven&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">11</span><span class="p">,</span><span class="mf">12</span><span class="p">,</span><span class="mf">13</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Ten Three&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Two&quot;</span><span class="p">}}]}}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
Java
</div>

<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">aggs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;group_property&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;terms&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">                </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;field&quot;</span><span class="p">,</span><span class="s">&quot;price&quot;</span><span class="p">);</span>


<span class="w">        </span><span class="p">}});</span>
<span class="w">    </span><span class="p">}});</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;group_brand_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;terms&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">                </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;field&quot;</span><span class="p">,</span><span class="s">&quot;brand_id&quot;</span><span class="p">);</span>


<span class="w">        </span><span class="p">}});</span>
<span class="w">    </span><span class="p">}});</span><span class="w">            </span>
<span class="p">}};</span>

<span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">();</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;facetdemo&quot;</span><span class="p">);</span><span class="w">        </span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setLimit</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">query</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;match_all&quot;</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setAggs</span><span class="p">(</span><span class="n">aggs</span><span class="p">);</span>
<span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">took</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">aggregations</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">group_property</span><span class="o">=</span><span class="p">{</span><span class="n">buckets</span><span class="o">=[</span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">11</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">999</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">12</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">998</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">7</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">997</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">14</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">996</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">8</span><span class="p">}</span><span class="o">]</span><span class="p">},</span><span class="w"> </span><span class="n">group_brand_id</span><span class="o">=</span><span class="p">{</span><span class="n">buckets</span><span class="o">=[</span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">1019</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">954</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">1021</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">1011</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">997</span><span class="p">}</span><span class="o">]</span><span class="p">}}</span>
<span class="w">    </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">maxScore</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">        </span><span class="n">total</span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span>
<span class="w">        </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mi">197</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Ten</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=[</span><span class="mi">10</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Eight</span><span class="w"> </span><span class="n">One</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Six</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mi">671</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Six</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=[</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Nine</span><span class="w"> </span><span class="n">Seven</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Four</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mi">92</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Three</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=[</span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Five</span><span class="w"> </span><span class="n">Four</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Six</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mi">713</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Ten</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=[</span><span class="mi">11</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Eight</span><span class="w"> </span><span class="n">Nine</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Five</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mi">805</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Seven</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=[</span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Ten</span><span class="w"> </span><span class="n">Three</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Two</span><span class="p">}}</span><span class="o">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">profile</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
C
</div>

<!-- request C# -->

<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">agg1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Aggregation</span><span class="p">(</span><span class="s2">&quot;group_property&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;price&quot;</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">agg2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Aggregation</span><span class="p">(</span><span class="s2">&quot;group_brand_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;brand_id&quot;</span><span class="p">);</span>
<span class="n">object</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">match_all</span><span class="o">=</span><span class="nb nb-Type">null</span><span class="w"> </span><span class="p">};</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;facetdemo&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Aggs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Aggregation</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="n">agg1</span><span class="p">,</span><span class="w"> </span><span class="n">agg2</span><span class="p">};</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="o">.</span><span class="n">Search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="n">class</span><span class="w"> </span><span class="n">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">took:</span><span class="w"> </span><span class="mh">0</span>
<span class="w">    </span><span class="nl">timedOut:</span><span class="w"> </span><span class="n">false</span>
<span class="w">    </span><span class="nl">aggregations:</span><span class="w"> </span><span class="p">{</span><span class="n">group_property</span><span class="o">=</span><span class="p">{</span><span class="n">buckets</span><span class="o">=</span><span class="p">[{</span><span class="n">key</span><span class="o">=</span><span class="mh">1000</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">11</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">999</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">12</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">998</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">7</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">997</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">14</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">996</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">8</span><span class="p">}]},</span><span class="w"> </span><span class="n">group_brand_id</span><span class="o">=</span><span class="p">{</span><span class="n">buckets</span><span class="o">=</span><span class="p">[{</span><span class="n">key</span><span class="o">=</span><span class="mh">10</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">1019</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">9</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">954</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">8</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">1021</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">7</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">1011</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">6</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">997</span><span class="p">}]}}</span>
<span class="w">    </span><span class="nl">hits:</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="n">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">maxScore:</span><span class="w"> </span><span class="n">null</span>
<span class="w">        </span><span class="nl">total:</span><span class="w"> </span><span class="mh">10000</span>
<span class="w">        </span><span class="nl">hits:</span><span class="w"> </span><span class="p">[{</span><span class="n">_id</span><span class="o">=</span><span class="mh">1</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mh">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mh">197</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mh">10</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Ten</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="mh">10</span><span class="p">],</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Eight</span><span class="w"> </span><span class="n">One</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Six</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mh">2</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mh">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mh">671</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mh">6</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Six</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="mh">12</span><span class="p">,</span><span class="w"> </span><span class="mh">13</span><span class="p">,</span><span class="w"> </span><span class="mh">14</span><span class="p">],</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Nine</span><span class="w"> </span><span class="n">Seven</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Four</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mh">3</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mh">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mh">92</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mh">3</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Three</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="mh">13</span><span class="p">,</span><span class="w"> </span><span class="mh">14</span><span class="p">,</span><span class="w"> </span><span class="mh">15</span><span class="p">],</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Five</span><span class="w"> </span><span class="n">Four</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Six</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mh">4</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mh">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mh">713</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mh">10</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Ten</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="mh">11</span><span class="p">],</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Eight</span><span class="w"> </span><span class="n">Nine</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Five</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mh">5</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mh">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mh">805</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mh">7</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Seven</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="mh">11</span><span class="p">,</span><span class="w"> </span><span class="mh">12</span><span class="p">,</span><span class="w"> </span><span class="mh">13</span><span class="p">],</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Ten</span><span class="w"> </span><span class="n">Three</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Two</span><span class="p">}}]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nl">profile:</span><span class="w"> </span><span class="n">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">match_all</span><span class="o">:</span><span class="p">{}</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="nx">aggs</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">name_group</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">terms</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">field</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;name&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">cat_group</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">terms</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;cat&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>


<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;cat&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w"> </span><span class="p">...</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;5&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Text 5&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Doc 5&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;cat&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">4</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="s2">&quot;aggregations&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;name_group&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;buckets&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="w">        </span><span class="p">},</span>
<span class="p">...</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Doc 5&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;cat_group&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;buckets&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span>
<span class="w">        </span><span class="p">},</span>
<span class="p">...</span><span class="w">        </span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">4</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{}</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>

<span class="nx">aggByName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewAggregation</span><span class="p">()</span>
<span class="nx">aggTerms</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewAggregationTerms</span><span class="p">()</span>
<span class="nx">aggTerms</span><span class="p">.</span><span class="nx">SetField</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
<span class="nx">aggByName</span><span class="p">.</span><span class="nx">SetTerms</span><span class="p">(</span><span class="nx">aggTerms</span><span class="p">)</span>
<span class="nx">aggByCat</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewAggregation</span><span class="p">()</span>
<span class="nx">aggTerms</span><span class="p">.</span><span class="nx">SetField</span><span class="p">(</span><span class="s">&quot;cat&quot;</span><span class="p">)</span>
<span class="nx">aggByCat</span><span class="p">.</span><span class="nx">SetTerms</span><span class="p">(</span><span class="nx">aggTerms</span><span class="p">)</span>
<span class="nx">aggs</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">Aggregation</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;name_group&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">aggByName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cat_group&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">aggByCat</span><span class="w"> </span><span class="p">}</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetAggs</span><span class="p">(</span><span class="nx">aggs</span><span class="p">)</span>

<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">SearchRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">searchRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>


<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;cat&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w"> </span><span class="o">...</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;5&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Text 5&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Doc 5&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;cat&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="s">&quot;aggregations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;name_group&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s">&quot;buckets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="p">},</span>
<span class="o">...</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Doc 5&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s">&quot;cat_group&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s">&quot;buckets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="p">},</span>
<span class="o">...</span><span class="w">        </span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example Another_attribute -->

<h3 id="faceting-by-aggregation-over-another-attribute">Faceting by aggregation over another attribute</h3>
<p>Data can be faceted by aggregating another attribute or expression. For example if the documents contain both the brand id and name, we can return in facet the brand names, but aggregate the brand ids. This can be done by using <code>FACET {expr1} BY {expr2}</code></p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">facetdemo</span><span class="w"> </span><span class="n">FACET</span><span class="w"> </span><span class="n">brand_name</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">brand_id</span><span class="p">;</span>
</code></pre></div>



<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">------+-------+----------+---------------------+-------------+-------------+---------------------------------------+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">brand_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">title</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">brand_name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">property</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">j</span><span class="w">                                     </span><span class="o">|</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-------+----------+---------------------+-------------+-------------+---------------------------------------+------------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">306</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="n">Ten</span><span class="w"> </span><span class="n">Three</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">One</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Six_Ten</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;prop1&quot;</span><span class="p">:</span><span class="mi">66</span><span class="p">,</span><span class="ss">&quot;prop2&quot;</span><span class="p">:</span><span class="mi">91</span><span class="p">,</span><span class="ss">&quot;prop3&quot;</span><span class="p">:</span><span class="ss">&quot;One&quot;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="w">      </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">400</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="n">Three</span><span class="w"> </span><span class="n">One</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Ten</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Four_Three</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;prop1&quot;</span><span class="p">:</span><span class="mi">69</span><span class="p">,</span><span class="ss">&quot;prop2&quot;</span><span class="p">:</span><span class="mi">19</span><span class="p">,</span><span class="ss">&quot;prop3&quot;</span><span class="p">:</span><span class="ss">&quot;One&quot;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="w">      </span><span class="o">|</span>
<span class="p">....</span>
<span class="o">|</span><span class="w">   </span><span class="mi">19</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">855</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="n">Seven</span><span class="w"> </span><span class="n">Two</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">One</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Eight_Seven</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;prop1&quot;</span><span class="p">:</span><span class="mi">63</span><span class="p">,</span><span class="ss">&quot;prop2&quot;</span><span class="p">:</span><span class="mi">78</span><span class="p">,</span><span class="ss">&quot;prop3&quot;</span><span class="p">:</span><span class="ss">&quot;One&quot;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="w">   </span><span class="o">|</span>
<span class="o">|</span><span class="w">   </span><span class="mi">20</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">31</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">9</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="n">Four</span><span class="w"> </span><span class="n">One</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Nine</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Ten_Four</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;prop1&quot;</span><span class="p">:</span><span class="mi">79</span><span class="p">,</span><span class="ss">&quot;prop2&quot;</span><span class="p">:</span><span class="mi">42</span><span class="p">,</span><span class="ss">&quot;prop3&quot;</span><span class="p">:</span><span class="ss">&quot;One&quot;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="w">   </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-------+----------+---------------------+-------------+-------------+---------------------------------------+------------+</span>
<span class="mi">20</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">brand_name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">One</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="mi">1013</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Ten</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="mi">998</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Five</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="mi">1007</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Nine</span><span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="mi">944</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Two</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="mi">990</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Six</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="mi">1039</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Three</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1016</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Four</span><span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="mi">994</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Eight</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1033</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Seven</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">965</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="mi">10</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example Distinct -->

<h3 id="faceting-without-duplicates">Faceting without duplicates</h3>
<p>If you need to remove duplicates from the buckets returned by FACET, you can use <code>DISTINCT field_name</code>, where <code>field_name</code> is the field by which you want to perform deduplication. It can also be <code>id</code> (which is the default) if you make a FACET query against a distributed table and are not sure whether you have unique ids in the tables (the tables should be local and have the same schema).</p>
<p>If you have multiple FACET declarations in your query, <code>field_name</code> should be the same in all of them.</p>
<p><code>DISTINCT</code> returns an additional column <code>count(distinct ...)</code> before the column <code>count(*)</code>, allowing you to obtain both results without needing to make another query.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="n">brand_name</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">facetdemo</span><span class="w"> </span><span class="n">FACET</span><span class="w"> </span><span class="n">brand_name</span><span class="w"> </span><span class="k">distinct</span><span class="w"> </span><span class="n">property</span><span class="p">;</span>
</code></pre></div>



<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">brand_name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">property</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Nine</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Four</span><span class="w">     </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Ten</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Four</span><span class="w">     </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">One</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Five</span><span class="w">     </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Seven</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Nine</span><span class="w">     </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Seven</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Seven</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Three</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Seven</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Nine</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Five</span><span class="w">     </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Three</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Eight</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Two</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Eight</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Six</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Eight</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Ten</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Four</span><span class="w">     </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Ten</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Two</span><span class="w">      </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Four</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Ten</span><span class="w">      </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">One</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Nine</span><span class="w">     </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Four</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Eight</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Nine</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Seven</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Four</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Five</span><span class="w">     </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Three</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Four</span><span class="w">     </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Four</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Two</span><span class="w">      </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Four</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Eight</span><span class="w">    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="mi">20</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="o">+</span><span class="c1">-------------+--------------------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">brand_name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="k">distinct</span><span class="w"> </span><span class="n">property</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+--------------------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Nine</span><span class="w">  </span><span class="o">|</span><span class="w">                        </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Ten</span><span class="w">   </span><span class="o">|</span><span class="w">                        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">One</span><span class="w">   </span><span class="o">|</span><span class="w">                        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Seven</span><span class="w"> </span><span class="o">|</span><span class="w">                        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Three</span><span class="w"> </span><span class="o">|</span><span class="w">                        </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Two</span><span class="w">   </span><span class="o">|</span><span class="w">                        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Six</span><span class="w">   </span><span class="o">|</span><span class="w">                        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Four</span><span class="w">  </span><span class="o">|</span><span class="w">                        </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+--------------------------+----------+</span>
<span class="mi">8</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example Expressions -->
<h3 id="facet-over-expressions">Facet over expressions</h3>
<p>Facets can aggregate over expressions. A classic example is the segmentation of prices by specific ranges:</p>
<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">facetdemo</span><span class="w"> </span><span class="n">FACET</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="p">(</span><span class="n">price</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">400</span><span class="p">,</span><span class="mi">600</span><span class="p">,</span><span class="mi">800</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">price_range</span><span class="w"> </span><span class="p">;</span>
</code></pre></div>

<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">------+-------+----------+---------------------+-------------+-------------+---------------------------------------+------------+-------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">brand_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">title</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">brand_name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">property</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">j</span><span class="w">                                     </span><span class="o">|</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">price_range</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-------+----------+---------------------+-------------+-------------+---------------------------------------+------------+-------------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">306</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="n">Ten</span><span class="w"> </span><span class="n">Three</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">One</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Six_Ten</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;prop1&quot;</span><span class="p">:</span><span class="mi">66</span><span class="p">,</span><span class="ss">&quot;prop2&quot;</span><span class="p">:</span><span class="mi">91</span><span class="p">,</span><span class="ss">&quot;prop3&quot;</span><span class="p">:</span><span class="ss">&quot;One&quot;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="w">      </span><span class="o">|</span><span class="w">           </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="p">...</span>
<span class="o">+</span><span class="c1">------+-------+----------+---------------------+-------------+-------------+---------------------------------------+------------+-------------+</span>
<span class="mi">20</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">price_range</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="o">|</span><span class="w">           </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1885</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">           </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1973</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">           </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">2100</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">           </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1999</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">           </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">2043</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="mi">5</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>

<!-- request JSON -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">     </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;facetdemo&quot;</span><span class="p">,</span>
<span class="w">     </span><span class="nt">&quot;query&quot;</span><span class="p">:</span>
<span class="w">     </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;match_all&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="w">     </span><span class="p">},</span>
<span class="w">     </span><span class="nt">&quot;expressions&quot;</span><span class="p">:</span>
<span class="w">     </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;price_range&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;INTERVAL(price,200,400,600,800)&quot;</span>
<span class="w">     </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;aggs&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;group_property&quot;</span><span class="p">:</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;terms&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;price_range&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- response JSON -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">197</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;brand_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;brand_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Brand Ten&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;categories&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mi">10</span>
<span class="w">          </span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;price_range&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w"> </span><span class="err">...</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;20&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">227</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;brand_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;brand_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Brand Three&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;categories&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mi">12</span><span class="p">,</span>
<span class="w">            </span><span class="mi">13</span>
<span class="w">          </span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;price_range&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;aggregations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;group_property&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;buckets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2100</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1973</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1999</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2043</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1885</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- request PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;setName(&#39;facetdemo&#39;);</span>
<span class="x">$search = $index-&gt;search(&#39;&#39;);</span>
<span class="x">$search-&gt;limit(5);</span>
<span class="x">$search-&gt;expression(&#39;price_range&#39;,&#39;INTERVAL(price,200,400,600,800)&#39;);</span>
<span class="x">$search-&gt;facet(&#39;price_range&#39;,&#39;group_property&#39;);</span>
<span class="x">$results = $search-&gt;get();</span>
<span class="x">print_r($results-&gt;getFacets());</span>
</code></pre></div>

<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Array</span>
<span class="x">(</span>
<span class="x">    [group_property] =&gt; Array</span>
<span class="x">        (</span>
<span class="x">            [buckets] =&gt; Array</span>
<span class="x">                (</span>
<span class="x">                    [0] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 4</span>
<span class="x">                            [doc_count] =&gt; 2100</span>
<span class="x">                        )</span>
<span class="x">                    [1] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 3</span>
<span class="x">                            [doc_count] =&gt; 1973</span>
<span class="x">                        )</span>
<span class="x">                    [2] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 2</span>
<span class="x">                            [doc_count] =&gt; 1999</span>
<span class="x">                        )</span>
<span class="x">                    [3] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 1</span>
<span class="x">                            [doc_count] =&gt; 2043</span>
<span class="x">                        )</span>
<span class="x">                    [4] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 0</span>
<span class="x">                            [doc_count] =&gt; 1885</span>
<span class="x">                        )</span>
<span class="x">                )</span>
<span class="x">        )</span>
<span class="x">)</span>
</code></pre></div>

<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">res</span> <span class="o">=</span><span class="n">searchApi</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;facetdemo&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="p">:{</span><span class="s2">&quot;match_all&quot;</span><span class="p">:{}},</span><span class="s2">&quot;expressions&quot;</span><span class="p">:{</span><span class="s2">&quot;price_range&quot;</span><span class="p">:</span><span class="s2">&quot;INTERVAL(price,200,400,600,800)&quot;</span><span class="p">},</span><span class="s2">&quot;aggs&quot;</span><span class="p">:{</span><span class="s2">&quot;group_property&quot;</span><span class="p">:{</span><span class="s2">&quot;terms&quot;</span><span class="p">:{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span><span class="s2">&quot;price_range&quot;</span><span class="p">}}}})</span>
</code></pre></div>

<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;aggregations&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;group_brand_id&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;buckets&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">1019</span><span class="p">,</span>
                                                    <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">954</span><span class="p">,</span>
                                                    <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">1021</span><span class="p">,</span>
                                                    <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">1011</span><span class="p">,</span>
                                                    <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">997</span><span class="p">,</span>
                                                    <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">}]},</span>
                  <span class="sa">u</span><span class="s1">&#39;group_property&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;buckets&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
                                                    <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
                                                    <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">999</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
                                                    <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">998</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
                                                    <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">997</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
                                                    <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">996</span><span class="p">}]}},</span>
 <span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;brand_id&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;brand_name&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Brand Ten&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">],</span>
                                 <span class="sa">u</span><span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="mi">197</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Six&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Product Eight One&#39;</span><span class="p">}},</span>
                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;2&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;brand_id&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;brand_name&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Brand Six&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">],</span>
                                 <span class="sa">u</span><span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="mi">671</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Four&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Product Nine Seven&#39;</span><span class="p">}},</span>
                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;3&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;brand_id&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;brand_name&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Brand Three&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
                                 <span class="sa">u</span><span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="mi">92</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Six&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Product Five Four&#39;</span><span class="p">}},</span>
                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;4&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;brand_id&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;brand_name&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Brand Ten&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">],</span>
                                 <span class="sa">u</span><span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="mi">713</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Five&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Product Eight Nine&#39;</span><span class="p">}},</span>
                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;5&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;brand_id&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;brand_name&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Brand Seven&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span>
                                 <span class="sa">u</span><span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="mi">805</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Two&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Product Ten Three&#39;</span><span class="p">}}],</span>
          <span class="s1">&#39;max_score&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
          <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>

<!-- request Javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="s2">&quot;facetdemo&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;match_all&quot;</span><span class="o">:</span><span class="p">{}},</span><span class="s2">&quot;expressions&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price_range&quot;</span><span class="o">:</span><span class="s2">&quot;INTERVAL(price,200,400,600,800)&quot;</span><span class="p">},</span><span class="s2">&quot;aggs&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;group_property&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;terms&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="o">:</span><span class="s2">&quot;price_range&quot;</span><span class="p">}}}});</span>
</code></pre></div>

<!-- response Javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">10000</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">197</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">10</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Ten&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">10</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Eight One&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Six&quot;</span><span class="p">,</span><span class="s2">&quot;price_range&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">671</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">6</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Six&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">12</span><span class="p">,</span><span class="mf">13</span><span class="p">,</span><span class="mf">14</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Nine Seven&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Four&quot;</span><span class="p">,</span><span class="s2">&quot;price_range&quot;</span><span class="o">:</span><span class="mf">3</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;3&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">92</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">3</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Three&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">13</span><span class="p">,</span><span class="mf">14</span><span class="p">,</span><span class="mf">15</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Five Four&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Six&quot;</span><span class="p">,</span><span class="s2">&quot;price_range&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;4&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">713</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">10</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Ten&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">11</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Eight Nine&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Five&quot;</span><span class="p">,</span><span class="s2">&quot;price_range&quot;</span><span class="o">:</span><span class="mf">3</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;5&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">805</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">7</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Seven&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">11</span><span class="p">,</span><span class="mf">12</span><span class="p">,</span><span class="mf">13</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Ten Three&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Two&quot;</span><span class="p">,</span><span class="s2">&quot;price_range&quot;</span><span class="o">:</span><span class="mf">4</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;6&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">420</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">2</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Two&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">10</span><span class="p">,</span><span class="mf">11</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Two One&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Six&quot;</span><span class="p">,</span><span class="s2">&quot;price_range&quot;</span><span class="o">:</span><span class="mf">2</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;7&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">412</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">9</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Nine&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">10</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Four Nine&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Eight&quot;</span><span class="p">,</span><span class="s2">&quot;price_range&quot;</span><span class="o">:</span><span class="mf">2</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;8&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">300</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">9</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Nine&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">13</span><span class="p">,</span><span class="mf">14</span><span class="p">,</span><span class="mf">15</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Eight Four&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Five&quot;</span><span class="p">,</span><span class="s2">&quot;price_range&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;9&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">728</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand One&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">11</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Nine Six&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Four&quot;</span><span class="p">,</span><span class="s2">&quot;price_range&quot;</span><span class="o">:</span><span class="mf">3</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;10&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">622</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">3</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Three&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">10</span><span class="p">,</span><span class="mf">11</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Six Seven&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Two&quot;</span><span class="p">,</span><span class="s2">&quot;price_range&quot;</span><span class="o">:</span><span class="mf">3</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;11&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">462</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">5</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Five&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">10</span><span class="p">,</span><span class="mf">11</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Ten Two&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Eight&quot;</span><span class="p">,</span><span class="s2">&quot;price_range&quot;</span><span class="o">:</span><span class="mf">2</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;12&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">939</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">7</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Seven&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">12</span><span class="p">,</span><span class="mf">13</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Nine Seven&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Six&quot;</span><span class="p">,</span><span class="s2">&quot;price_range&quot;</span><span class="o">:</span><span class="mf">4</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;13&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">948</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">8</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Eight&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">12</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Ten One&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Six&quot;</span><span class="p">,</span><span class="s2">&quot;price_range&quot;</span><span class="o">:</span><span class="mf">4</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;14&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">900</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">9</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Nine&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">12</span><span class="p">,</span><span class="mf">13</span><span class="p">,</span><span class="mf">14</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Ten Nine&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Three&quot;</span><span class="p">,</span><span class="s2">&quot;price_range&quot;</span><span class="o">:</span><span class="mf">4</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;15&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">224</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">3</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Three&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">13</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Two Six&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Four&quot;</span><span class="p">,</span><span class="s2">&quot;price_range&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;16&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">713</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">10</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Ten&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">12</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Two Four&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Six&quot;</span><span class="p">,</span><span class="s2">&quot;price_range&quot;</span><span class="o">:</span><span class="mf">3</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;17&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">510</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">2</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Two&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">10</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Ten Two&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Seven&quot;</span><span class="p">,</span><span class="s2">&quot;price_range&quot;</span><span class="o">:</span><span class="mf">2</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;18&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">702</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">10</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Ten&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">12</span><span class="p">,</span><span class="mf">13</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Nine One&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Three&quot;</span><span class="p">,</span><span class="s2">&quot;price_range&quot;</span><span class="o">:</span><span class="mf">3</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;19&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">836</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">4</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Four&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">10</span><span class="p">,</span><span class="mf">11</span><span class="p">,</span><span class="mf">12</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Four Five&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Two&quot;</span><span class="p">,</span><span class="s2">&quot;price_range&quot;</span><span class="o">:</span><span class="mf">4</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;20&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">227</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">3</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Three&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">12</span><span class="p">,</span><span class="mf">13</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Three Four&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Ten&quot;</span><span class="p">,</span><span class="s2">&quot;price_range&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">}}]}}</span>
</code></pre></div>

<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">();</span>
<span class="n">expressions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;price_range&quot;</span><span class="p">,</span><span class="s">&quot;INTERVAL(price,200,400,600,800)&quot;</span><span class="p">);</span>
<span class="p">}};</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setExpressions</span><span class="p">(</span><span class="n">expressions</span><span class="p">);</span>
<span class="n">aggs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;group_property&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;terms&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">                </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;field&quot;</span><span class="p">,</span><span class="s">&quot;price_range&quot;</span><span class="p">);</span>


<span class="w">        </span><span class="p">}});</span>
<span class="w">    </span><span class="p">}});</span>

<span class="p">}};</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;facetdemo&quot;</span><span class="p">);</span><span class="w">        </span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setLimit</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">query</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;match_all&quot;</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setAggs</span><span class="p">(</span><span class="n">aggs</span><span class="p">);</span>
<span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>

<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">took</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">aggregations</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">group_property</span><span class="o">=</span><span class="p">{</span><span class="n">buckets</span><span class="o">=[</span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">2100</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">1973</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">1999</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">2043</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">1885</span><span class="p">}</span><span class="o">]</span><span class="p">}}</span>
<span class="w">    </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">maxScore</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">        </span><span class="n">total</span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span>
<span class="w">        </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mi">197</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Ten</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=[</span><span class="mi">10</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Eight</span><span class="w"> </span><span class="n">One</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Six</span><span class="p">,</span><span class="w"> </span><span class="n">price_range</span><span class="o">=</span><span class="mi">0</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mi">671</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Six</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=[</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Nine</span><span class="w"> </span><span class="n">Seven</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Four</span><span class="p">,</span><span class="w"> </span><span class="n">price_range</span><span class="o">=</span><span class="mi">3</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mi">92</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Three</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=[</span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Five</span><span class="w"> </span><span class="n">Four</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Six</span><span class="p">,</span><span class="w"> </span><span class="n">price_range</span><span class="o">=</span><span class="mi">0</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mi">713</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Ten</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=[</span><span class="mi">11</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Eight</span><span class="w"> </span><span class="n">Nine</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Five</span><span class="p">,</span><span class="w"> </span><span class="n">price_range</span><span class="o">=</span><span class="mi">3</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mi">805</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Seven</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=[</span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Ten</span><span class="w"> </span><span class="n">Three</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Two</span><span class="p">,</span><span class="w"> </span><span class="n">price_range</span><span class="o">=</span><span class="mi">4</span><span class="p">}}</span><span class="o">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">profile</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
</code></pre></div>

<!-- request C# -->

<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">expr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;price_range&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;INTERVAL(price,200,400,600,800&quot;</span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">agg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Aggregation</span><span class="p">(</span><span class="s2">&quot;group_property&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;price_range&quot;</span><span class="p">);</span>
<span class="n">object</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">match_all</span><span class="o">=</span><span class="nb nb-Type">null</span><span class="w"> </span><span class="p">};</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;facetdemo&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Expressions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="n">expr</span><span class="p">};</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Aggs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Aggregation</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="n">agg</span><span class="p">};</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="o">.</span><span class="n">Search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>

<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="n">class</span><span class="w"> </span><span class="n">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">took:</span><span class="w"> </span><span class="mh">0</span>
<span class="w">    </span><span class="nl">timedOut:</span><span class="w"> </span><span class="n">false</span>
<span class="w">    </span><span class="nl">aggregations:</span><span class="w"> </span><span class="p">{</span><span class="n">group_property</span><span class="o">=</span><span class="p">{</span><span class="n">buckets</span><span class="o">=</span><span class="p">[{</span><span class="n">key</span><span class="o">=</span><span class="mh">4</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">2100</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">3</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">1973</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">2</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">1999</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">1</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">2043</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">0</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">1885</span><span class="p">}]}}</span>
<span class="w">    </span><span class="nl">hits:</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="n">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">maxScore:</span><span class="w"> </span><span class="n">null</span>
<span class="w">        </span><span class="nl">total:</span><span class="w"> </span><span class="mh">10000</span>
<span class="w">        </span><span class="nl">hits:</span><span class="w"> </span><span class="p">[{</span><span class="n">_id</span><span class="o">=</span><span class="mh">1</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mh">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mh">197</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mh">10</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Ten</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="mh">10</span><span class="p">],</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Eight</span><span class="w"> </span><span class="n">One</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Six</span><span class="p">,</span><span class="w"> </span><span class="n">price_range</span><span class="o">=</span><span class="mh">0</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mh">2</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mh">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mh">671</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mh">6</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Six</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="mh">12</span><span class="p">,</span><span class="w"> </span><span class="mh">13</span><span class="p">,</span><span class="w"> </span><span class="mh">14</span><span class="p">],</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Nine</span><span class="w"> </span><span class="n">Seven</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Four</span><span class="p">,</span><span class="w"> </span><span class="n">price_range</span><span class="o">=</span><span class="mh">3</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mh">3</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mh">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mh">92</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mh">3</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Three</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="mh">13</span><span class="p">,</span><span class="w"> </span><span class="mh">14</span><span class="p">,</span><span class="w"> </span><span class="mh">15</span><span class="p">],</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Five</span><span class="w"> </span><span class="n">Four</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Six</span><span class="p">,</span><span class="w"> </span><span class="n">price_range</span><span class="o">=</span><span class="mh">0</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mh">4</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mh">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mh">713</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mh">10</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Ten</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="mh">11</span><span class="p">],</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Eight</span><span class="w"> </span><span class="n">Nine</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Five</span><span class="p">,</span><span class="w"> </span><span class="n">price_range</span><span class="o">=</span><span class="mh">3</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mh">5</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mh">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mh">805</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mh">7</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Seven</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="mh">11</span><span class="p">,</span><span class="w"> </span><span class="mh">12</span><span class="p">,</span><span class="w"> </span><span class="mh">13</span><span class="p">],</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Ten</span><span class="w"> </span><span class="n">Three</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Two</span><span class="p">,</span><span class="w"> </span><span class="n">price_range</span><span class="o">=</span><span class="mh">4</span><span class="p">}}]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nl">profile:</span><span class="w"> </span><span class="n">null</span>
<span class="p">}</span>
</code></pre></div>

<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nt">res</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="nt">await</span><span class="w"> </span><span class="nt">searchApi</span><span class="p">.</span><span class="nc">search</span><span class="o">(</span><span class="p">{</span>
<span class="w">  </span><span class="n">index</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n">query</span><span class="o">:</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">match_all</span><span class="o">:</span><span class="err">{</span><span class="p">}</span><span class="w"> </span><span class="err">}</span><span class="o">,</span>
<span class="w">  </span><span class="nt">expressions</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cat_range</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;INTERVAL(cat,1,3)&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="nt">aggs</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">expr_group</span><span class="p">:</span><span class="w"> </span><span class="err">{</span>
<span class="w">      </span><span class="n">terms</span><span class="o">:</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;cat_range&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">  </span><span class="err">}</span>
<span class="err">}</span><span class="o">);</span>
</code></pre></div>

<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;cat&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;cat_range&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w"> </span><span class="p">...</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;5&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Text 5&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Doc 5&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;cat&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">4</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;cat_range&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="s2">&quot;aggregations&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;expr_group&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;buckets&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">3</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{}</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>

<span class="nx">exprs</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;cat_range&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;INTERVAL(cat,1,3)&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetExpressions</span><span class="p">(</span><span class="nx">exprs</span><span class="p">)</span>

<span class="nx">aggByExpr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewAggregation</span><span class="p">()</span>
<span class="nx">aggTerms</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewAggregationTerms</span><span class="p">()</span>
<span class="nx">aggTerms</span><span class="p">.</span><span class="nx">SetField</span><span class="p">(</span><span class="s">&quot;cat_range&quot;</span><span class="p">)</span>
<span class="nx">aggByExpr</span><span class="p">.</span><span class="nx">SetTerms</span><span class="p">(</span><span class="nx">aggTerms</span><span class="p">)</span>
<span class="nx">aggs</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">Aggregation</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;expr_group&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">aggByExpr</span><span class="w"> </span><span class="p">}</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetAggs</span><span class="p">(</span><span class="nx">aggs</span><span class="p">)</span>

<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">SearchRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">searchRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>

<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;cat&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;cat_range&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w"> </span><span class="o">...</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;5&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Text 5&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Doc 5&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;cat&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;cat_range&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="s">&quot;aggregations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;expr_group&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s">&quot;buckets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<!-- example Multi-level -->

<h3 id="facet-over-multi-level-grouping">Facet over multi-level grouping</h3>
<p>Facets can aggregate over multi-level grouping, with the result set being the same as if the query performed a multi-level grouping:</p>
<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="nb">INTERVAL</span><span class="p">(</span><span class="n">price</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">400</span><span class="p">,</span><span class="mi">600</span><span class="p">,</span><span class="mi">800</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">price_range</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">facetdemo</span>
<span class="n">FACET</span><span class="w"> </span><span class="n">price_range</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">price_range</span><span class="p">,</span><span class="n">brand_name</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">brand_name</span><span class="w"> </span><span class="k">asc</span><span class="p">;</span>
</code></pre></div>

<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">------+-------+----------+---------------------+-------------+-------------+---------------------------------------+------------+-------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">brand_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">title</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">brand_name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">property</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">j</span><span class="w">                                     </span><span class="o">|</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">price_range</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-------+----------+---------------------+-------------+-------------+---------------------------------------+------------+-------------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">306</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="n">Ten</span><span class="w"> </span><span class="n">Three</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">One</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Six_Ten</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;prop1&quot;</span><span class="p">:</span><span class="mi">66</span><span class="p">,</span><span class="ss">&quot;prop2&quot;</span><span class="p">:</span><span class="mi">91</span><span class="p">,</span><span class="ss">&quot;prop3&quot;</span><span class="p">:</span><span class="ss">&quot;One&quot;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="w">      </span><span class="o">|</span><span class="w">           </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="p">...</span>
<span class="o">+</span><span class="c1">------+-------+----------+---------------------+-------------+-------------+---------------------------------------+------------+-------------+</span>
<span class="mi">20</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="o">+</span><span class="c1">--------------+-------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">fprice_range</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">brand_name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">--------------+-------------+----------+</span>
<span class="o">|</span><span class="w">            </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Eight</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">197</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">            </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Eight</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">235</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">            </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Eight</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">203</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">            </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Eight</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">201</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">            </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Eight</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">197</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">            </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Five</span><span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="mi">230</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">            </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Five</span><span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="mi">197</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">            </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Five</span><span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="mi">204</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">            </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Five</span><span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="mi">193</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">            </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Five</span><span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="mi">183</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">            </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Four</span><span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="mi">195</span><span class="w"> </span><span class="o">|</span>
<span class="p">...</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<!-- example histogram -->

<h3 id="facet-over-histogram-values">Facet over histogram values</h3>
<p>Facets can aggregate over histogram values by constructing fixed-size buckets over the values.<br />
The key function is:</p>
<div class="codehilite"><pre><span></span><code><span class="n">key_of_the_bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">interval</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">offset</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">floor</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">offset</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">interval</span><span class="w"> </span><span class="p">)</span>
</code></pre></div>

<p>The histogram argument <code>interval</code> must be positive, and the histogram argument <code>offset</code> must be positive and less than <code>interval</code>. By default, the buckets are returned as an array. The histogram argument <code>keyed</code> makes the response a dictionary with the bucket keys.</p>
<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">HISTOGRAM</span><span class="p">(</span><span class="n">price</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="n">hist_interval</span><span class="o">=</span><span class="mi">100</span><span class="err">}</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">price_range</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">facets</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">price_range</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">price_range</span><span class="w"> </span><span class="k">ASC</span><span class="p">;</span>
</code></pre></div>

<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">----------+-------------+</span>
<span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">price_range</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------+-------------+</span>
<span class="o">|</span><span class="w">        </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">        </span><span class="mi">5</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">100</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">300</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">        </span><span class="mi">4</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">400</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">500</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">        </span><span class="mi">3</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">700</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="mi">900</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------+-------------+</span>
</code></pre></div>

<!-- request JSON -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;facets&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;aggs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;price_range&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;histogram&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;price&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;interval&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">300</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span><span class="err">&#39;</span>
</code></pre></div>

<!-- response JSON -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;total_relation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eq&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;aggregations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;price_range&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;buckets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">600</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">900</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- request JSON 2 -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;facets&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;aggs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;price_range&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;histogram&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;price&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;interval&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;keyed&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span><span class="err">&#39;</span>
</code></pre></div>

<!-- response JSON 2 -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;total_relation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eq&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;aggregations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;price_range&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;buckets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;0&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;300&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;600&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">600</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;900&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">900</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<!-- example histogram_date -->

<h3 id="facet-over-histogram-date-values">Facet over histogram date values</h3>
<p>Facets can aggregate over histogram date values, which is similar to the normal histogram. The difference is that the interval is specified using a date or time expression. Such expressions require special support because the intervals are not always of fixed length. Values are rounded to the closest bucket using the following key function:</p>
<div class="codehilite"><pre><span></span><code><span class="n">key_of_the_bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">interval</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">floor</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">interval</span><span class="w"> </span><span class="p">)</span>
</code></pre></div>

<p>The histogram parameter <code>calendar_interval</code> understands months to have different amounts of days. The accepted intervals are described in the <a href="../15-functions.html#date_histogram">date_histogram</a> expression. By default, the buckets are returned as an array. The histogram argument <code>keyed</code> makes the response a dictionary with the bucket keys.</p>
<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">DATE_HISTOGRAM</span><span class="p">(</span><span class="n">tm</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="n">calendar_interval</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="err">}</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">months</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">idx_dates</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">months</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">months</span><span class="w"> </span><span class="k">ASC</span>
</code></pre></div>

<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">----------+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">months</span><span class="w">     </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------+------------+</span>
<span class="o">|</span><span class="w">      </span><span class="mi">442</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1485907200</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">      </span><span class="mi">744</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1488326400</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">      </span><span class="mi">720</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1491004800</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">      </span><span class="mi">230</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1493596800</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------+------------+</span>
</code></pre></div>

<!-- request JSON -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;idx_dates&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;aggs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;months&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;date_histogram&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tm&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;keyed&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;calendar_interval&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;month&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span><span class="err">&#39;</span>
</code></pre></div>

<!-- response JSON -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2136</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;total_relation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;aggregations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;months&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;buckets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;2017-02-01T00:00:00&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1485907200</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;key_as_string&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2017-02-01T00:00:00&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">442</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="nt">&quot;2017-03-01T00:00:00&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1488326400</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;key_as_string&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2017-03-01T00:00:00&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">744</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="nt">&quot;2017-04-01T00:00:00&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1491004800</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;key_as_string&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2017-04-01T00:00:00&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">720</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="nt">&quot;2017-05-01T00:00:00&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1493596800</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;key_as_string&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2017-05-01T00:00:00&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">230</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<!-- example facet range -->

<h3 id="facet-over-set-of-ranges">Facet over set of ranges</h3>
<p>Facets can aggregate over a set of ranges. The values are checked against the bucket range, where each bucket includes the <code>from</code> value and excludes the <code>to</code> value from the range.<br />
Setting the <code>keyed</code> property to <code>true</code> makes the response a dictionary with the bucket keys rather than an array.</p>
<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">RANGE</span><span class="p">(</span><span class="n">price</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="n">range_to</span><span class="o">=</span><span class="mi">150</span><span class="err">}</span><span class="p">,</span><span class="err">{</span><span class="n">range_from</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span><span class="n">range_to</span><span class="o">=</span><span class="mi">300</span><span class="err">}</span><span class="p">,</span><span class="err">{</span><span class="n">range_from</span><span class="o">=</span><span class="mi">300</span><span class="err">}</span><span class="p">)</span><span class="w"> </span><span class="n">price_range</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">facets</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">price_range</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">price_range</span><span class="w"> </span><span class="k">ASC</span><span class="p">;</span>
</code></pre></div>

<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">----------+-------------+</span>
<span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">price_range</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------+-------------+</span>
<span class="o">|</span><span class="w">        </span><span class="mi">8</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">       </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------+-------------+</span>
</code></pre></div>

<!-- request JSON -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;facets&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;aggs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;price_range&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;range&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;price&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;ranges&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;to&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;from&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;to&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">550</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;from&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">550</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span><span class="err">&#39;</span>
</code></pre></div>

<!-- response JSON -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;total_relation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eq&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;aggregations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;price_range&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;buckets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*-99&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;to&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;99&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;99-550&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;from&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;99&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;to&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;550&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">11</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;550-*&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;from&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;550&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- request JSON 2 -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;facets&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;aggs&quot;</span><span class="p">:{</span>
<span class="w">    </span><span class="nt">&quot;price_range&quot;</span><span class="p">:{</span>
<span class="w">      </span><span class="nt">&quot;range&quot;</span><span class="p">:{</span>
<span class="w">        </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="s2">&quot;price&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;keyed&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;ranges&quot;</span><span class="p">:[</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;from&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;to&quot;</span><span class="p">:</span><span class="mi">399</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;from&quot;</span><span class="p">:</span><span class="mi">399</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span><span class="err">&#39;</span>
</code></pre></div>

<!-- response JSON 2 -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;total_relation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eq&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;aggregations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;price_range&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;buckets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;100-399&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;from&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;100&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;to&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;399&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;399-*&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;from&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;399&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<!-- example facet range_date -->

<h3 id="facet-over-set-of-date-ranges">Facet over set of date ranges</h3>
<p>Facets can aggregate over a set of date ranges, which is similar to the normal range. The difference is that the <code>from</code> and <code>to</code> values can be expressed in <a href="../15-functions.html#date-math">Date math</a> expressions. This aggregation includes the <code>from</code> value and excludes the <code>to</code> value for each range. Setting the <code>keyed</code> property to <code>true</code> makes the response a dictionary with the bucket keys rather than an array.</p>
<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">DATE_RANGE</span><span class="p">(</span><span class="n">tm</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="n">range_to</span><span class="o">=</span><span class="s1">&#39;2017||+2M/M&#39;</span><span class="err">}</span><span class="p">,</span><span class="err">{</span><span class="n">range_from</span><span class="o">=</span><span class="s1">&#39;2017||+2M/M&#39;</span><span class="p">,</span><span class="n">range_to</span><span class="o">=</span><span class="s1">&#39;2017||+5M/M&#39;</span><span class="err">}</span><span class="p">,</span><span class="err">{</span><span class="n">range_from</span><span class="o">=</span><span class="s1">&#39;2017||+5M/M&#39;</span><span class="err">}</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">points</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">idx_dates</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">points</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">points</span><span class="w"> </span><span class="k">ASC</span><span class="p">;</span>
</code></pre></div>

<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">----------+--------+</span>
<span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">points</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------+--------+</span>
<span class="o">|</span><span class="w">      </span><span class="mi">442</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">     </span><span class="mi">1464</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">      </span><span class="mi">230</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------+--------+</span>
</code></pre></div>

<!-- request JSON -->

<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;idx_dates&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;aggs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;points&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;date_range&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tm&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;keyed&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;ranges&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;to&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2017||+2M/M&quot;</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;from&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2017||+2M/M&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;to&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2017||+4M/M&quot;</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;from&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2017||+4M/M&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;to&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2017||+5M/M&quot;</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;from&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2017||+5M/M&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span><span class="err">&#39;</span>
</code></pre></div>

<!-- response JSON -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2136</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;total_relation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;aggregations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;points&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;buckets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;*-2017-03-01T00:00:00&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;to&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2017-03-01T00:00:00&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">442</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="nt">&quot;2017-03-01T00:00:00-2017-04-01T00:00:00&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;from&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2017-03-01T00:00:00&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;to&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2017-04-01T00:00:00&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">744</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="nt">&quot;2017-04-01T00:00:00-2017-05-01T00:00:00&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;from&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2017-04-01T00:00:00&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;to&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2017-05-01T00:00:00&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">720</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="nt">&quot;2017-05-01T00:00:00-*&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;from&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2017-05-01T00:00:00&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">230</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<!-- example Ordering -->
<h3 id="ordering-in-facet-result">Ordering in facet result</h3>
<p>Facets support the <code>ORDER BY</code> clause just like a standard query. Each facet can have its own ordering, and the facet ordering doesn't affect the main result set's ordering, which is determined by the main query's <code>ORDER BY</code>. Sorting can be done on attribute name, count (using <code>COUNT(*)</code>), or the special <code>FACET()</code> function, which provides the aggregated data values.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">facetdemo</span>
<span class="n">FACET</span><span class="w"> </span><span class="n">brand_name</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">brand_id</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">FACET</span><span class="p">()</span><span class="w"> </span><span class="k">ASC</span>
<span class="n">FACET</span><span class="w"> </span><span class="n">brand_name</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">brand_id</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">brand_name</span><span class="w"> </span><span class="k">ASC</span>
<span class="n">FACET</span><span class="w"> </span><span class="n">brand_name</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">brand_id</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</code></pre></div>



<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">------+-------+----------+---------------------+-------------+-------------+---------------------------------------+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">brand_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">title</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">brand_name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">property</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">j</span><span class="w">                                     </span><span class="o">|</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-------+----------+---------------------+-------------+-------------+---------------------------------------+------------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">306</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="n">Ten</span><span class="w"> </span><span class="n">Three</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">One</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Six_Ten</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;prop1&quot;</span><span class="p">:</span><span class="mi">66</span><span class="p">,</span><span class="ss">&quot;prop2&quot;</span><span class="p">:</span><span class="mi">91</span><span class="p">,</span><span class="ss">&quot;prop3&quot;</span><span class="p">:</span><span class="ss">&quot;One&quot;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="w">      </span><span class="o">|</span>
<span class="p">...</span>
<span class="o">|</span><span class="w">   </span><span class="mi">20</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">31</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">9</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="n">Four</span><span class="w"> </span><span class="n">One</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Nine</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Ten_Four</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;prop1&quot;</span><span class="p">:</span><span class="mi">79</span><span class="p">,</span><span class="ss">&quot;prop2&quot;</span><span class="p">:</span><span class="mi">42</span><span class="p">,</span><span class="ss">&quot;prop3&quot;</span><span class="p">:</span><span class="ss">&quot;One&quot;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="w">   </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-------+----------+---------------------+-------------+-------------+---------------------------------------+------------+</span>
<span class="mi">20</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">brand_name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">One</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="mi">1013</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Two</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="mi">990</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Three</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1016</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Four</span><span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="mi">994</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Five</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="mi">1007</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Six</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="mi">1039</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Seven</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">965</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Eight</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1033</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Nine</span><span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="mi">944</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Ten</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="mi">998</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="mi">10</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">brand_name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Eight</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1033</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Five</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="mi">1007</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Four</span><span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="mi">994</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Nine</span><span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="mi">944</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">One</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="mi">1013</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Seven</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">965</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Six</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="mi">1039</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Ten</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="mi">998</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Three</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1016</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Two</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="mi">990</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="mi">10</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">brand_name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Six</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="mi">1039</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Eight</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1033</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Three</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1016</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">One</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="mi">1013</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Five</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="mi">1007</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Ten</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="mi">998</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Four</span><span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="mi">994</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Two</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="mi">990</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Seven</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">965</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Nine</span><span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="mi">944</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="mi">10</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span>
<span class="p">{</span>
<span class="w">   </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;table_name&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;aggs&quot;</span><span class="p">:{</span>
<span class="w">      </span><span class="nt">&quot;group_property&quot;</span><span class="p">:{</span>
<span class="w">         </span><span class="nt">&quot;terms&quot;</span><span class="p">:{</span>
<span class="w">            </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="s2">&quot;a&quot;</span>
<span class="w">         </span><span class="p">},</span>
<span class="w">         </span><span class="nt">&quot;sort&quot;</span><span class="p">:[</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">               </span><span class="nt">&quot;count(*)&quot;</span><span class="p">:{</span>
<span class="w">                  </span><span class="nt">&quot;order&quot;</span><span class="p">:</span><span class="s2">&quot;desc&quot;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span><span class="err">&#39;</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;total_relation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eq&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1515697460415037554&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1515697460415037555&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1515697460415037556&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1515697460415037557&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1515697460415037558&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1515697460415037559&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;aggregations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;group_property&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;buckets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example Size -->
<h3 id="size-of-facet-result">Size of facet result</h3>
<p>By default, each facet result set is limited to 20 values. The number of facet values can be controlled with the <code>LIMIT</code> clause individually for each facet by providing either a number of values to return in the format <code>LIMIT count</code> or with an offset as <code>LIMIT offset, count</code>.</p>
<p>The maximum facet values that can be returned is limited by the query's <code>max_matches</code> setting. If you want to implement dynamic <code>max_matches</code> (limiting <code>max_matches</code> to offset + per page for better performance), it must be taken into account that a too low <code>max_matches</code> value can affect the number of facet values. In this case, a minimum <code>max_matches</code> value should be used that is sufficient to cover the number of facet values.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">facetdemo</span>
<span class="n">FACET</span><span class="w"> </span><span class="n">brand_name</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">brand_id</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">FACET</span><span class="p">()</span><span class="w"> </span><span class="k">ASC</span><span class="w">  </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span>
<span class="n">FACET</span><span class="w"> </span><span class="n">brand_name</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">brand_id</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">brand_name</span><span class="w"> </span><span class="k">ASC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span>
<span class="n">FACET</span><span class="w"> </span><span class="n">brand_name</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">brand_id</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
</code></pre></div>



<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">------+-------+----------+---------------------+-------------+-------------+---------------------------------------+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">brand_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">title</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">brand_name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">property</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">j</span><span class="w">                                     </span><span class="o">|</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-------+----------+---------------------+-------------+-------------+---------------------------------------+------------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">306</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="n">Ten</span><span class="w"> </span><span class="n">Three</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">One</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Six_Ten</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;prop1&quot;</span><span class="p">:</span><span class="mi">66</span><span class="p">,</span><span class="ss">&quot;prop2&quot;</span><span class="p">:</span><span class="mi">91</span><span class="p">,</span><span class="ss">&quot;prop3&quot;</span><span class="p">:</span><span class="ss">&quot;One&quot;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="w">      </span><span class="o">|</span>
<span class="p">...</span>
<span class="o">|</span><span class="w">   </span><span class="mi">20</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="mi">31</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">9</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="n">Four</span><span class="w"> </span><span class="n">One</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Nine</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">Ten_Four</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;prop1&quot;</span><span class="p">:</span><span class="mi">79</span><span class="p">,</span><span class="ss">&quot;prop2&quot;</span><span class="p">:</span><span class="mi">42</span><span class="p">,</span><span class="ss">&quot;prop3&quot;</span><span class="p">:</span><span class="ss">&quot;One&quot;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="w">   </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-------+----------+---------------------+-------------+-------------+---------------------------------------+------------+</span>
<span class="mi">20</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">brand_name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">One</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="mi">1013</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">brand_name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Four</span><span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="mi">994</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Nine</span><span class="w">  </span><span class="o">|</span><span class="w">      </span><span class="mi">944</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">One</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="mi">1013</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Seven</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="mi">965</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="mi">4</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>

<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">brand_name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Six</span><span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="mi">1039</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Eight</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1033</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">Three</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1016</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+----------+</span>
<span class="mi">3</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>


<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">     </span><span class="nt">&quot;index&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;facetdemo&quot;</span><span class="p">,</span>
<span class="w">     </span><span class="nt">&quot;query&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;match_all&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="p">},</span>
<span class="w">     </span><span class="nt">&quot;limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">     </span><span class="nt">&quot;aggs&quot;</span><span class="w"> </span><span class="p">:</span>
<span class="w">     </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;group_property&quot;</span><span class="w"> </span><span class="p">:</span>
<span class="w">         </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;terms&quot;</span><span class="w"> </span><span class="p">:</span>
<span class="w">             </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="s2">&quot;price&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">             </span><span class="p">}</span>
<span class="w">         </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;group_brand_id&quot;</span><span class="w"> </span><span class="p">:</span>
<span class="w">         </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;terms&quot;</span><span class="w"> </span><span class="p">:</span>
<span class="w">             </span><span class="p">{</span>
<span class="w">              </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="s2">&quot;brand_id&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="mi">3</span>
<span class="w">             </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">     </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="err">&#39;</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">197</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;brand_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;brand_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Brand Ten&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;categories&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mi">10</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w"> </span><span class="err">...</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">805</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;brand_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;brand_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Brand Seven&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;categories&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mi">11</span><span class="p">,</span>
<span class="w">            </span><span class="mi">12</span><span class="p">,</span>
<span class="w">            </span><span class="mi">13</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;aggregations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;group_property&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;buckets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">11</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;group_brand_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;buckets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1019</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">954</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1021</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- request PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">$index-&gt;setName(&#39;facetdemo&#39;);</span>
<span class="x">$search = $index-&gt;search(&#39;&#39;);</span>
<span class="x">$search-&gt;limit(5);</span>
<span class="x">$search-&gt;facet(&#39;price&#39;,&#39;price&#39;,1);</span>
<span class="x">$search-&gt;facet(&#39;brand_id&#39;,&#39;group_brand_id&#39;,3);</span>
<span class="x">$results = $search-&gt;get();</span>
<span class="x">print_r($results-&gt;getFacets());</span>
</code></pre></div>


<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Array</span>
<span class="x">(</span>
<span class="x">    [price] =&gt; Array</span>
<span class="x">        (</span>
<span class="x">            [buckets] =&gt; Array</span>
<span class="x">                (</span>
<span class="x">                    [0] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 1000</span>
<span class="x">                            [doc_count] =&gt; 11</span>
<span class="x">                        )</span>
<span class="x">                )</span>
<span class="x">        )</span>
<span class="x">    [group_brand_id] =&gt; Array</span>
<span class="x">        (</span>
<span class="x">            [buckets] =&gt; Array</span>
<span class="x">                (</span>
<span class="x">                    [0] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 10</span>
<span class="x">                            [doc_count] =&gt; 1019</span>
<span class="x">                        )</span>
<span class="x">                    [1] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 9</span>
<span class="x">                            [doc_count] =&gt; 954</span>
<span class="x">                        )</span>
<span class="x">                    [2] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [key] =&gt; 8</span>
<span class="x">                            [doc_count] =&gt; 1021</span>
<span class="x">                        )</span>
<span class="x">                )</span>
<span class="x">        )</span>
<span class="x">)</span>
</code></pre></div>


<!-- request Python -->

<div class="codehilite"><pre><span></span><code><span class="n">res</span> <span class="o">=</span><span class="n">searchApi</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;facetdemo&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="p">:{</span><span class="s2">&quot;match_all&quot;</span><span class="p">:{}},</span><span class="s2">&quot;limit&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="s2">&quot;aggs&quot;</span><span class="p">:{</span><span class="s2">&quot;group_property&quot;</span><span class="p">:{</span><span class="s2">&quot;terms&quot;</span><span class="p">:{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span><span class="s2">&quot;price&quot;</span><span class="p">,</span><span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,}},</span><span class="s2">&quot;group_brand_id&quot;</span><span class="p">:{</span><span class="s2">&quot;terms&quot;</span><span class="p">:{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span><span class="s2">&quot;brand_id&quot;</span><span class="p">,</span><span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">}}}})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;aggregations&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;group_brand_id&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;buckets&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">1019</span><span class="p">,</span>
                                                    <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">954</span><span class="p">,</span>
                                                    <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">},</span>
                                                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">1021</span><span class="p">,</span>
                                                    <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">}]},</span>
                  <span class="sa">u</span><span class="s1">&#39;group_property&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;buckets&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;doc_count&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
                                                    <span class="sa">u</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">}]}},</span>
 <span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;brand_id&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;brand_name&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Brand Ten&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">],</span>
                                 <span class="sa">u</span><span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="mi">197</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Six&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Product Eight One&#39;</span><span class="p">}},</span>
                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;2&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;brand_id&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;brand_name&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Brand Six&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">],</span>
                                 <span class="sa">u</span><span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="mi">671</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Four&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Product Nine Seven&#39;</span><span class="p">}},</span>
                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;3&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;brand_id&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;brand_name&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Brand Three&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
                                 <span class="sa">u</span><span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="mi">92</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Six&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Product Five Four&#39;</span><span class="p">}},</span>
                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;4&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;brand_id&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;brand_name&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Brand Ten&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">],</span>
                                 <span class="sa">u</span><span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="mi">713</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Five&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Product Eight Nine&#39;</span><span class="p">}},</span>
                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;5&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;brand_id&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;brand_name&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Brand Seven&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span>
                                 <span class="sa">u</span><span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="mi">805</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Two&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;Product Ten Three&#39;</span><span class="p">}}],</span>
          <span class="s1">&#39;max_score&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
          <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>


<!-- request Javascript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="s2">&quot;facetdemo&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;match_all&quot;</span><span class="o">:</span><span class="p">{}},</span><span class="s2">&quot;limit&quot;</span><span class="o">:</span><span class="mf">5</span><span class="p">,</span><span class="s2">&quot;aggs&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;group_property&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;terms&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="o">:</span><span class="s2">&quot;price&quot;</span><span class="p">,</span><span class="s2">&quot;size&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,}},</span><span class="s2">&quot;group_brand_id&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;terms&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="o">:</span><span class="s2">&quot;brand_id&quot;</span><span class="p">,</span><span class="s2">&quot;size&quot;</span><span class="o">:</span><span class="mf">3</span><span class="p">}}}});</span>
</code></pre></div>


<!-- response Javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="mf">10000</span><span class="p">,</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">197</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">10</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Ten&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">10</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Eight One&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Six&quot;</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">671</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">6</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Six&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">12</span><span class="p">,</span><span class="mf">13</span><span class="p">,</span><span class="mf">14</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Nine Seven&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Four&quot;</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;3&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">92</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">3</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Three&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">13</span><span class="p">,</span><span class="mf">14</span><span class="p">,</span><span class="mf">15</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Five Four&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Six&quot;</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;4&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">713</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">10</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Ten&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">11</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Eight Nine&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Five&quot;</span><span class="p">}},{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;5&quot;</span><span class="p">,</span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="o">:</span><span class="mf">805</span><span class="p">,</span><span class="s2">&quot;brand_id&quot;</span><span class="o">:</span><span class="mf">7</span><span class="p">,</span><span class="s2">&quot;brand_name&quot;</span><span class="o">:</span><span class="s2">&quot;Brand Seven&quot;</span><span class="p">,</span><span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[</span><span class="mf">11</span><span class="p">,</span><span class="mf">12</span><span class="p">,</span><span class="mf">13</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Product Ten Three&quot;</span><span class="p">,</span><span class="s2">&quot;property&quot;</span><span class="o">:</span><span class="s2">&quot;Two&quot;</span><span class="p">}}]}}</span>
</code></pre></div>



<!-- request Java -->

<div class="codehilite"><pre><span></span><code><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">();</span>
<span class="n">aggs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;group_property&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;terms&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">                </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;field&quot;</span><span class="p">,</span><span class="s">&quot;price&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;size&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>


<span class="w">        </span><span class="p">}});</span>
<span class="w">    </span><span class="p">}});</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;group_brand_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;terms&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">                </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;field&quot;</span><span class="p">,</span><span class="s">&quot;brand_id&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;size&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>


<span class="w">        </span><span class="p">}});</span>
<span class="w">    </span><span class="p">}});</span><span class="w">            </span>
<span class="p">}};</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;facetdemo&quot;</span><span class="p">);</span><span class="w">        </span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setLimit</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">query</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;match_all&quot;</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setAggs</span><span class="p">(</span><span class="n">aggs</span><span class="p">);</span>
<span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">took</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">aggregations</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">group_property</span><span class="o">=</span><span class="p">{</span><span class="n">buckets</span><span class="o">=[</span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">11</span><span class="p">}</span><span class="o">]</span><span class="p">},</span><span class="w"> </span><span class="n">group_brand_id</span><span class="o">=</span><span class="p">{</span><span class="n">buckets</span><span class="o">=[</span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">1019</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">954</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mi">1021</span><span class="p">}</span><span class="o">]</span><span class="p">}}</span>
<span class="w">    </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">maxScore</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">        </span><span class="n">total</span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span>
<span class="w">        </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mi">197</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Ten</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=[</span><span class="mi">10</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Eight</span><span class="w"> </span><span class="n">One</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Six</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mi">671</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Six</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=[</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Nine</span><span class="w"> </span><span class="n">Seven</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Four</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mi">92</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Three</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=[</span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Five</span><span class="w"> </span><span class="n">Four</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Six</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mi">713</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Ten</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=[</span><span class="mi">11</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Eight</span><span class="w"> </span><span class="n">Nine</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Five</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mi">805</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Seven</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=[</span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Ten</span><span class="w"> </span><span class="n">Three</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Two</span><span class="p">}}</span><span class="o">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">profile</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- request C# -->

<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">agg1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Aggregation</span><span class="p">(</span><span class="s2">&quot;group_property&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;price&quot;</span><span class="p">);</span>
<span class="n">agg1</span><span class="o">.</span><span class="n">Size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">agg2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Aggregation</span><span class="p">(</span><span class="s2">&quot;group_brand_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;brand_id&quot;</span><span class="p">);</span>
<span class="n">agg2</span><span class="o">.</span><span class="n">Size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="n">agg2</span><span class="o">.</span><span class="n">Size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="n">object</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">match_all</span><span class="o">=</span><span class="nb nb-Type">null</span><span class="w"> </span><span class="p">};</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">(</span><span class="s2">&quot;facetdemo&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="o">.</span><span class="n">Aggs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Aggregation</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="n">agg1</span><span class="p">,</span><span class="w"> </span><span class="n">agg2</span><span class="p">};</span>
<span class="k">var</span><span class="w"> </span><span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="o">.</span><span class="n">Search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="n">class</span><span class="w"> </span><span class="n">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">took:</span><span class="w"> </span><span class="mh">0</span>
<span class="w">    </span><span class="nl">timedOut:</span><span class="w"> </span><span class="n">false</span>
<span class="w">    </span><span class="nl">aggregations:</span><span class="w"> </span><span class="p">{</span><span class="n">group_property</span><span class="o">=</span><span class="p">{</span><span class="n">buckets</span><span class="o">=</span><span class="p">[{</span><span class="n">key</span><span class="o">=</span><span class="mh">1000</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">11</span><span class="p">}]},</span><span class="w"> </span><span class="n">group_brand_id</span><span class="o">=</span><span class="p">{</span><span class="n">buckets</span><span class="o">=</span><span class="p">[{</span><span class="n">key</span><span class="o">=</span><span class="mh">10</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">1019</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">9</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">954</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="o">=</span><span class="mh">8</span><span class="p">,</span><span class="w"> </span><span class="n">doc_count</span><span class="o">=</span><span class="mh">1021</span><span class="p">}]}}</span>
<span class="w">    </span><span class="nl">hits:</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="n">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">maxScore:</span><span class="w"> </span><span class="n">null</span>
<span class="w">        </span><span class="nl">total:</span><span class="w"> </span><span class="mh">10000</span>
<span class="w">        </span><span class="nl">hits:</span><span class="w"> </span><span class="p">[{</span><span class="n">_id</span><span class="o">=</span><span class="mh">1</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mh">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mh">197</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mh">10</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Ten</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="mh">10</span><span class="p">],</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Eight</span><span class="w"> </span><span class="n">One</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Six</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mh">2</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mh">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mh">671</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mh">6</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Six</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="mh">12</span><span class="p">,</span><span class="w"> </span><span class="mh">13</span><span class="p">,</span><span class="w"> </span><span class="mh">14</span><span class="p">],</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Nine</span><span class="w"> </span><span class="n">Seven</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Four</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mh">3</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mh">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mh">92</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mh">3</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Three</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="mh">13</span><span class="p">,</span><span class="w"> </span><span class="mh">14</span><span class="p">,</span><span class="w"> </span><span class="mh">15</span><span class="p">],</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Five</span><span class="w"> </span><span class="n">Four</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Six</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mh">4</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mh">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mh">713</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mh">10</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Ten</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="mh">11</span><span class="p">],</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Eight</span><span class="w"> </span><span class="n">Nine</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Five</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mh">5</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mh">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">price</span><span class="o">=</span><span class="mh">805</span><span class="p">,</span><span class="w"> </span><span class="n">brand_id</span><span class="o">=</span><span class="mh">7</span><span class="p">,</span><span class="w"> </span><span class="n">brand_name</span><span class="o">=</span><span class="n">Brand</span><span class="w"> </span><span class="n">Seven</span><span class="p">,</span><span class="w"> </span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="mh">11</span><span class="p">,</span><span class="w"> </span><span class="mh">12</span><span class="p">,</span><span class="w"> </span><span class="mh">13</span><span class="p">],</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="n">Ten</span><span class="w"> </span><span class="n">Three</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="n">Two</span><span class="p">}}]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nl">profile:</span><span class="w"> </span><span class="n">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">match_all</span><span class="o">:</span><span class="p">{}</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="nx">aggs</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">name_group</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">terms</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">field</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">size</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">cat_group</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">terms</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">field</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;cat&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>


<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;cat&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w"> </span><span class="p">...</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;5&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Text 5&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Doc 5&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;cat&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">4</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="s2">&quot;aggregations&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;name_group&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;buckets&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s2">&quot;cat_group&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;buckets&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span>
<span class="w">        </span><span class="p">},</span>
<span class="p">...</span><span class="w">        </span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;key&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">4</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;doc_count&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{}</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>

<span class="nx">aggByName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewAggregation</span><span class="p">()</span>
<span class="nx">aggTerms</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewAggregationTerms</span><span class="p">()</span>
<span class="nx">aggTerms</span><span class="p">.</span><span class="nx">SetField</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
<span class="nx">aggByName</span><span class="p">.</span><span class="nx">SetTerms</span><span class="p">(</span><span class="nx">aggTerms</span><span class="p">)</span>
<span class="nx">aggByName</span><span class="p">.</span><span class="nx">SetSize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nx">aggByCat</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewAggregation</span><span class="p">()</span>
<span class="nx">aggTerms</span><span class="p">.</span><span class="nx">SetField</span><span class="p">(</span><span class="s">&quot;cat&quot;</span><span class="p">)</span>
<span class="nx">aggByCat</span><span class="p">.</span><span class="nx">SetTerms</span><span class="p">(</span><span class="nx">aggTerms</span><span class="p">)</span>
<span class="nx">aggs</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">Aggregation</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;name_group&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">aggByName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cat_group&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">aggByCat</span><span class="w"> </span><span class="p">}</span>
<span class="nx">searchRequest</span><span class="p">.</span><span class="nx">SetAggs</span><span class="p">(</span><span class="nx">aggs</span><span class="p">)</span>

<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">SearchRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">searchRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>


<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Text 1&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;cat&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w"> </span><span class="o">...</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;5&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Text 5&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Doc 5&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;cat&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="s">&quot;aggregations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;name_group&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s">&quot;buckets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Doc 1&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s">&quot;cat_group&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s">&quot;buckets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="p">},</span>
<span class="o">...</span><span class="w">        </span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">          </span><span class="s">&quot;doc_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>
<h3 id="returned-result-set">Returned result set</h3>
<p>When using SQL, a search with facets returns multiple result sets. The MySQL client/library/connector used <strong>must</strong> support multiple result sets in order to access the facet result sets.</p>
<!-- example Performance -->
<h3 id="performance">Performance</h3>
<p>Internally, the <code>FACET</code> is a shorthand for executing a multi-query where the first query contains the main search query and the rest of the queries in the batch have each a clustering. As in the case of multi-query, the common query optimization can kick in for a faceted search, meaning the search query is executed only once, and the facets operate on the search query result, with each facet adding only a fraction of time to the total query time.</p>
<p>To check if the faceted search ran in an optimized mode, you can look in the <a href="../18-logging.html#toc-18.01-query_logging">query log</a>, where all logged queries will contain an <code>xN</code> string, where <code>N</code> is the number of queries that ran in the optimized group. Alternatively, you can check the output of the <a href="../19-node_info_and_management.html#toc-19.02-show_meta">SHOW META</a> statement, which will display a <code>multiplier</code> metric:</p>
<!-- request SQL -->

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">facetdemo</span><span class="w"> </span><span class="n">FACET</span><span class="w"> </span><span class="n">brand_id</span><span class="w"> </span><span class="n">FACET</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="n">FACET</span><span class="w"> </span><span class="n">categories</span><span class="p">;</span>
<span class="k">SHOW</span><span class="w"> </span><span class="n">META</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;multiplier&#39;</span><span class="p">;</span>
</code></pre></div>

<!-- response SQL -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">------+-------+----------+---------------------+-------------+-------------+---------------------------------------+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">brand_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">title</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">brand_name</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">property</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">j</span><span class="w">                                     </span><span class="o">|</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-------+----------+---------------------+-------------+-------------+---------------------------------------+------------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="mi">306</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="n">Ten</span><span class="w"> </span><span class="n">Three</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Brand</span><span class="w"> </span><span class="n">One</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">Six_Ten</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;prop1&quot;</span><span class="p">:</span><span class="mi">66</span><span class="p">,</span><span class="ss">&quot;prop2&quot;</span><span class="p">:</span><span class="mi">91</span><span class="p">,</span><span class="ss">&quot;prop3&quot;</span><span class="p">:</span><span class="ss">&quot;One&quot;</span><span class="err">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="w">      </span><span class="o">|</span>
<span class="p">...</span>

<span class="o">+</span><span class="c1">----------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">brand_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------+----------+</span>
<span class="o">|</span><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1013</span><span class="w"> </span><span class="o">|</span>
<span class="p">...</span>

<span class="o">+</span><span class="c1">-------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------+----------+</span>
<span class="o">|</span><span class="w">   </span><span class="mi">306</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="mi">7</span><span class="w"> </span><span class="o">|</span>
<span class="p">...</span>

<span class="o">+</span><span class="c1">------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------------+----------+</span>
<span class="o">|</span><span class="w">         </span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">2436</span><span class="w"> </span><span class="o">|</span>
<span class="p">...</span>

<span class="o">+</span><span class="c1">---------------+-------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Variable_name</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Value</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------+-------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">multiplier</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">4</span><span class="w">     </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------+-------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.15-geo_search">
        <header>
            <a class="chapter-link" href="#toc-13.15-geo_search"> ¶ 13.15</a>

            
            <h1 id="geo-search">Geo search</h1>
            
        </header>

        
        
<p>One of the greatest features of Manticore Search is the ability to combine full-text searching with geo-location. For example, a retailer can offer a search where a user looks for a product, and the result set can indicate the closest shop that has the product in stock, so the user can go in-store and pick it up. A travel site can provide results based on a search limited to a certain area and have the results sorted by the distance from a point (for example, 'search museums near a hotel'). </p>
<p>To perform geo-searching, a document needs to contain pairs of latitude/longitude coordinates. The coordinates can be stored as float attributes. If the document has multiple locations, it may be convenient to use a JSON attribute to store coordinate pairs.</p>
<div class="codehilite"><pre><span></span><code><span class="na">table myrt</span>
<span class="na">{</span>
<span class="w">    </span><span class="na">...</span>
<span class="w">    </span><span class="na">rt_attr_float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">lat</span>
<span class="w">    </span><span class="na">rt_attr_float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">lon</span>
<span class="w">    </span><span class="na">...</span>
<span class="na">}</span>
</code></pre></div>

<p>The coordinates can be stored as degrees or radians.</p>
<h2 id="performing-distance-alculation">Performing distance сalculation</h2>
<p>To find out the distance between two points, the <a href="../15-functions.html#geodist">GEODIST()</a> function can be used. <code>GEODIST</code> requires two pairs of coordinates as its first four parameters.</p>
<p>The 5th parameter in a simplified JSON format can configure certain aspects of the function. By default, <code>GEODIST</code> expects coordinates to be in radians, but <code>in=degrees</code> can be added to allow using degrees as input. The coordinates for which we perform the geo distance must have the same type (degrees or radians) as the ones stored in the table; otherwise, results will be misleading.</p>
<p>The calculated distance is by default in meters, but with the <code>out</code> option, it can be transformed to kilometers, feet, or miles. Lastly, by default, a calculation method called <code>adaptive</code> is used. An alternative method based on the <code>haversine</code> algorithm is available; however, this one is slower and less precise.</p>
<p>The result of the function - the distance - can be used in the<code>ORDER BY</code> clause to sort the results:</p>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">GEODIST</span><span class="p">(</span><span class="mi">40</span><span class="p">.</span><span class="mi">7643929</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">73</span><span class="p">.</span><span class="mi">9997683</span><span class="p">,</span><span class="w"> </span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">lon</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="k">in</span><span class="o">=</span><span class="n">degrees</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="o">=</span><span class="n">miles</span><span class="err">}</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">myindex</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="k">ASC</span><span class="p">,</span><span class="w"> </span><span class="n">WEIGHT</span><span class="p">()</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</code></pre></div>

<p>Or to limit the results to a radial area around the point:</p>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="n">GEODIST</span><span class="p">(</span><span class="mi">40</span><span class="p">.</span><span class="mi">7643929</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">73</span><span class="p">.</span><span class="mi">9997683</span><span class="p">,</span><span class="w"> </span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="k">in</span><span class="o">=</span><span class="n">degrees</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="o">=</span><span class="n">miles</span><span class="err">}</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">myindex</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">1000</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">WEIGHT</span><span class="p">(),</span><span class="w"> </span><span class="n">DISTANCE</span><span class="w"> </span><span class="k">ASC</span><span class="p">;</span>
</code></pre></div>

<h2 id="searching-in-polygons">Searching in polygons</h2>
<p>Another geo search feature is the ability to determine if a location is within a specified area. A special function constructs a polygon object, which is then used by another function to test whether a set of coordinates is contained within that polygon or not.</p>
<p>There are two functions available for creating the polygon:</p>
<ul>
<li><a href="../15-functions.html#geopoly2d">GEOPOLY2D()</a> - creates a polygon that takes into account the Earth's curvature</li>
<li><a href="../15-functions.html#poly2d">POLY2D()</a> - creates a simple polygon in flat space</li>
</ul>
<p><code>POLY2D</code> is suitable for geo searches when the area has sides shorter than 500km (for polygons with 3-4 sides; for polygons with more sides, lower values should be considered). For areas with longer sides, using <code>GEOPOLY2D</code> is required to maintain accurate results. <code>GEOPOLY2D</code> expects coordinates as latitude/longitude pairs in degrees; using radians will yield results in flat space (similar to <code>POLY2D</code>).</p>
<p><a href="../15-functions.html#contains">CONTAINS()</a> takes a polygon and a set of coordinates as input and outputs <code>1</code> if the point is inside the polygon or <code>0</code> otherwise.</p>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="k">CONTAINS</span><span class="p">(</span><span class="n">GEOPOLY2D</span><span class="p">(</span><span class="mi">40</span><span class="p">.</span><span class="mi">76439</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">73</span><span class="p">.</span><span class="mi">9997</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">.</span><span class="mi">21211</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">73</span><span class="p">.</span><span class="mi">999</span><span class="p">,</span><span class="w">  </span><span class="mi">42</span><span class="p">.</span><span class="mi">21211</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">76</span><span class="p">.</span><span class="mi">123</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">.</span><span class="mi">76439</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">76</span><span class="p">.</span><span class="mi">123</span><span class="p">),</span><span class="w"> </span><span class="mi">41</span><span class="p">.</span><span class="mi">5445</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">74</span><span class="p">.</span><span class="mi">973</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">myindex</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">MATCH</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">inside</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>

<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.16-percolate_query">
        <header>
            <a class="chapter-link" href="#toc-13.16-percolate_query"> ¶ 13.16</a>

            
            <h1 id="percolate-query">Percolate Query</h1>
            
        </header>

        
        
<p>Percolate queries are also known as Persistent queries, Prospective search, document routing, search in reverse, and inverse search.</p>
<p>The traditional way of conducting searches involves storing documents and performing search queries against them. However, there are cases where we want to apply a query to a newly incoming document to signal a match. Some scenarios where this is desired include monitoring systems that collect data and notify users about specific events, such as reaching a certain threshold for a metric or a particular value appearing in the monitored data. Another example is news aggregation, where users may want to be notified only about certain categories or topics, or even specific "keywords."</p>
<p>In these situations, traditional search is not the best fit, as it assumes the desired search is performed over the entire collection. This process gets multiplied by the number of users, resulting in many queries running over the entire collection, which can cause significant additional load. The alternative approach described in this section involves storing the queries instead and testing them against an incoming new document or a batch of documents.</p>
<p>Google Alerts, AlertHN, Bloomberg Terminal, and other systems that allow users to subscribe to specific content utilize similar technology.</p>
<blockquote>
<ul>
<li>See <a href="../06-creating_a_table.html#toc-06.02.04-percolate_table">percolate</a> for information on creating a PQ table.</li>
<li>See <a href="../12-data_creation_and_modification.html#toc-12.01.02-adding_rules_to_a_percolate_table">Adding rules to a percolate table</a> to learn how to add percolate rules (also known as PQ rules). Here's a quick example:</li>
</ul>
</blockquote>
<h3 id="performing-a-percolate-query-with-call-pq">Performing a percolate query with CALL PQ</h3>
<p>The key thing to remember about percolate queries is that your search queries are already in the table. What you need to provide are documents <strong>to check if any of them match any of the stored rules</strong>.</p>
<p>You can perform a percolate query via SQL or JSON interfaces, as well as using programming language clients. The SQL approach offers more flexibility, while the HTTP method is simpler and provides most of what you need. The table below can help you understand the differences.</p>
<table>
<thead>
<tr>
<th>Desired Behavior</th>
<th>SQL</th>
<th>HTTP</th>
<th>PHP</th>
</tr>
</thead>
<tbody>
<tr>
<td>Provide a single document</td>
<td><code>CALL PQ('tbl', '{doc1}')</code></td>
<td><code>query.percolate.document{doc1}</code></td>
<td><code>$client-&gt;pq()-&gt;search([$percolate])</code></td>
</tr>
<tr>
<td>Provide a single document (alternative)</td>
<td><code>CALL PQ('tbl', 'doc1', 0 as docs_json)</code></td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>Provide multiple documents</td>
<td><code>CALL PQ('tbl', ('doc1', 'doc2'), 0 as docs_json)</code></td>
<td><code>query.percolate.documents[{doc1}, {doc2}]</code></td>
<td><code>$client-&gt;pq()-&gt;search([$percolate])</code></td>
</tr>
<tr>
<td>Provide multiple documents (alternative)</td>
<td><code>CALL PQ('tbl', ('{doc1}', '{doc2}'))</code></td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Provide multiple documents (alternative)</td>
<td><code>CALL PQ('tbl', '[{doc1}, {doc2}]')</code></td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Return matching document ids</td>
<td>0/1 as docs (disabled by default)</td>
<td>Enabled by default</td>
<td>Enabled by default</td>
</tr>
<tr>
<td>Use document's own id to show in the result</td>
<td>'id field' as docs_id (disabled by default)</td>
<td>Not available</td>
<td>Not available</td>
</tr>
<tr>
<td>Consider input documents are JSON</td>
<td>1 as docs_json (1 by default)</td>
<td>Enabled by default</td>
<td>Enabled by default</td>
</tr>
<tr>
<td>Consider input documents are plain text</td>
<td>0 as docs_json (1 by default)</td>
<td>Not available</td>
<td>Not available</td>
</tr>
<tr>
<td><a href="../13-searching.html#i-want-higher-performance-of-a-percolate-query">Sparsed distribution mode</a></td>
<td>default</td>
<td>default</td>
<td>default</td>
</tr>
<tr>
<td><a href="../13-searching.html#i-want-higher-performance-of-a-percolate-query">Sharded distribution mode</a></td>
<td>sharded as mode</td>
<td>Not available</td>
<td>Not available</td>
</tr>
<tr>
<td>Return all info about matching query</td>
<td>1 as query (0 by default)</td>
<td>Enabled by default</td>
<td>Enabled by default</td>
</tr>
<tr>
<td>Skip invalid JSON</td>
<td>1 as skip_bad_json (0 by default)</td>
<td>Not available</td>
<td>Not available</td>
</tr>
<tr>
<td>Extended info in <a href="../19-node_info_and_management.html#toc-19.02-show_meta">SHOW META</a></td>
<td>1 as verbose (0 by default)</td>
<td>Not available</td>
<td>Not available</td>
</tr>
<tr>
<td>Define the number which will be added to document ids if no docs_id fields provided (mostly relevant in <a href="../06-creating_a_table.html#distributed-percolate-tables-%28dpq-tables%29">distributed PQ modes</a>)</td>
<td>1 as shift (0 by default)</td>
<td>Not available</td>
<td>Not available</td>
</tr>
</tbody>
</table>
<!-- example create percolate -->
<p>To demonstrate how this works, here are a few examples. Let's create a PQ table with two fields:</p>
<ul>
<li>title (text)</li>
<li>color (string)</li>
</ul>
<p>and three rules in it:</p>
<ul>
<li>Just full-text. Query: <code>@title bag</code></li>
<li>Full-text and filtering. Query: <code>@title shoes</code>. Filters: <code>color='red'</code></li>
<li>Full-text and more complex filtering. Query: <code>@title shoes</code>. Filters: <code>color IN('blue', 'green')</code></li>
</ul>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>
#### SQL
<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">products</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;pq&#39;</span><span class="p">;</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">products</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="s1">&#39;@title bag&#39;</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">products</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="n">filters</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="s1">&#39;@title shoes&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;color=\&#39;</span><span class="n">red</span><span class="err">\</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">products</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="n">filters</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="s1">&#39;@title shoes&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;color in (\&#39;</span><span class="n">blue</span><span class="err">\</span><span class="s1">&#39;, \&#39;</span><span class="n">green</span><span class="err">\</span><span class="s1">&#39;)&#39;</span><span class="p">);</span>
<span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">products</span><span class="p">;</span>
</code></pre></div>



<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">---------------------+--------------+------+---------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">query</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">tags</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filters</span><span class="w">                   </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+--------------+------+---------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657852401006149635</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">@</span><span class="n">title</span><span class="w"> </span><span class="n">shoes</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;blue, &#39;</span><span class="n">green</span><span class="s1">&#39;) |</span>
<span class="s1">| 1657852401006149636 | @title shoes |      | color=&#39;</span><span class="n">red</span><span class="err">&#39;</span><span class="w">               </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657852401006149637</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">@</span><span class="n">title</span><span class="w"> </span><span class="n">bag</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w">                           </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+--------------+------+---------------------------+</span>
</code></pre></div>



<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">PUT</span><span class="w"> </span><span class="err">/pq/produc</span><span class="kc">ts</span><span class="err">/doc/</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bag&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;filters&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="p">}</span>

<span class="err">PUT</span><span class="w"> </span><span class="err">/pq/produc</span><span class="kc">ts</span><span class="err">/doc/</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;shoes&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;filters&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;color=&#39;red&#39;&quot;</span>
<span class="p">}</span>

<span class="err">PUT</span><span class="w"> </span><span class="err">/pq/produc</span><span class="kc">ts</span><span class="err">/doc/</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;shoes&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;filters&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;color IN (&#39;blue&#39;, &#39;green&#39;)&quot;</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
#### JSON
<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1657852401006149661&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span>
<span class="p">}</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1657852401006149662&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span>
<span class="p">}</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1657852401006149663&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
#### PHP
<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$index = [</span>
<span class="x">    &#39;index&#39; =&gt; &#39;products&#39;,</span>
<span class="x">    &#39;body&#39; =&gt; [</span>
<span class="x">        &#39;columns&#39; =&gt; [</span>
<span class="x">            &#39;title&#39; =&gt; [&#39;type&#39; =&gt; &#39;text&#39;],</span>
<span class="x">            &#39;color&#39; =&gt; [&#39;type&#39; =&gt; &#39;string&#39;]</span>
<span class="x">        ],</span>
<span class="x">        &#39;settings&#39; =&gt; [</span>
<span class="x">            &#39;type&#39; =&gt; &#39;pq&#39;</span>
<span class="x">        ]</span>
<span class="x">    ]</span>
<span class="x">];</span>
<span class="x">$client-&gt;indices()-&gt;create($index);</span>

<span class="x">$query = [</span>
<span class="x">    &#39;index&#39; =&gt; &#39;products&#39;,</span>
<span class="x">    &#39;body&#39; =&gt; [ &#39;query&#39;=&gt;[&#39;match&#39;=&gt;[&#39;title&#39;=&gt;&#39;bag&#39;]]]</span>
<span class="x">];</span>
<span class="x">$client-&gt;pq()-&gt;doc($query);</span>
<span class="x">$query = [</span>
<span class="x">    &#39;index&#39; =&gt; &#39;products&#39;,</span>
<span class="x">    &#39;body&#39; =&gt; [ &#39;query&#39;=&gt;[&#39;match&#39;=&gt;[&#39;title&#39;=&gt;&#39;shoes&#39;]],&#39;filters&#39;=&gt;&quot;color=&#39;red&#39;&quot;]</span>
<span class="x">];</span>
<span class="x">$client-&gt;pq()-&gt;doc($query);</span>


<span class="x">$query = [</span>
<span class="x">    &#39;index&#39; =&gt; &#39;products&#39;,</span>
<span class="x">    &#39;body&#39; =&gt; [ &#39;query&#39;=&gt;[&#39;match&#39;=&gt;[&#39;title&#39;=&gt;&#39;shoes&#39;]],&#39;filters&#39;=&gt;&quot;color IN (&#39;blue&#39;, &#39;green&#39;)&quot;]</span>
<span class="x">];</span>
<span class="x">$client-&gt;pq()-&gt;doc($query);</span>
</code></pre></div>


<!-- response PHP -->

<div class="codehilite"><pre><span></span><code><span class="x">Array(</span>
<span class="x">  [index] =&gt; products</span>
<span class="x">  [type] =&gt; doc</span>
<span class="x">  [_id] =&gt; 1657852401006149661</span>
<span class="x">  [result] =&gt; created</span>
<span class="x">)</span>
<span class="x">Array(</span>
<span class="x">  [index] =&gt; products</span>
<span class="x">  [type] =&gt; doc</span>
<span class="x">  [_id] =&gt; 1657852401006149662</span>
<span class="x">  [result] =&gt; created</span>
<span class="x">)</span>
<span class="x">Array(</span>
<span class="x">  [index] =&gt; products</span>
<span class="x">  [type] =&gt; doc</span>
<span class="x">  [_id] =&gt; 1657852401006149663</span>
<span class="x">  [result] =&gt; created</span>
<span class="x">)</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
Python
<!-- request Python -->


<div class="codehilite"><pre><span></span><code><span class="n">utilsApi</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s1">&#39;create table products(title text, color string) type=</span><span class="se">\&#39;</span><span class="s1">pq</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">indexApi</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span> <span class="s2">&quot;doc&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="s2">&quot;@title bag&quot;</span> <span class="p">}})</span>
<span class="n">indexApi</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span>  <span class="s2">&quot;doc&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="s2">&quot;@title shoes&quot;</span><span class="p">,</span> <span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="s2">&quot;color=&#39;red&#39;&quot;</span> <span class="p">}})</span>
<span class="n">indexApi</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s2">&quot;index&quot;</span> <span class="p">:</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span>  <span class="s2">&quot;doc&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="s2">&quot;@title shoes&quot;</span><span class="p">,</span><span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="s2">&quot;color IN (&#39;blue&#39;, &#39;green&#39;)&quot;</span> <span class="p">}})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;created&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
 <span class="s1">&#39;found&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;products&#39;</span><span class="p">,</span>
 <span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="s1">&#39;created&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="s1">&#39;created&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
 <span class="s1">&#39;found&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;products&#39;</span><span class="p">,</span>
 <span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="s1">&#39;created&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="s1">&#39;created&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
 <span class="s1">&#39;found&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;products&#39;</span><span class="p">,</span>
 <span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="s1">&#39;created&#39;</span><span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
javascript
<!-- request javascript -->


<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">utilsApi</span><span class="p">.</span><span class="nx">sql</span><span class="p">(</span><span class="s1">&#39;create table products(title text, color string) type=\&#39;pq\&#39;&#39;</span><span class="p">);</span>
<span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;query&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;@title bag&quot;</span><span class="w"> </span><span class="p">}});</span>
<span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w">  </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;query&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;@title shoes&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;filters&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;color=&#39;red&#39;&quot;</span><span class="w"> </span><span class="p">}});</span>
<span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="w">  </span><span class="s2">&quot;doc&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;query&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;@title shoes&quot;</span><span class="p">,</span><span class="s2">&quot;filters&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;color IN (&#39;blue&#39;, &#39;green&#39;)&quot;</span><span class="w"> </span><span class="p">}});</span>
</code></pre></div>


<!-- response javascript -->

<div class="codehilite"><pre><span></span><code><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;created&quot;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;created&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;created&quot;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;created&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;created&quot;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;created&quot;</span><span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
java
<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">utilsApi</span><span class="p">.</span><span class="na">sql</span><span class="p">(</span><span class="s">&quot;create table products(title text, color string) type=&#39;pq&#39;&quot;</span><span class="p">);</span>
<span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;query&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@title bag&quot;</span><span class="p">);</span>
<span class="p">}};</span>
<span class="n">newdoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InsertDocumentRequest</span><span class="p">();</span>
<span class="n">newdoc</span><span class="p">.</span><span class="na">index</span><span class="p">(</span><span class="s">&quot;products&quot;</span><span class="p">).</span><span class="na">setDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">indexApi</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">newdoc</span><span class="p">);</span>

<span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;query&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@title shoes&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;filters&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;color=&#39;red&#39;&quot;</span><span class="p">);</span>
<span class="p">}};</span>
<span class="n">newdoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InsertDocumentRequest</span><span class="p">();</span>
<span class="n">newdoc</span><span class="p">.</span><span class="na">index</span><span class="p">(</span><span class="s">&quot;products&quot;</span><span class="p">).</span><span class="na">setDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">indexApi</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">newdoc</span><span class="p">);</span>

<span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;query&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@title shoes&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;filters&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;color IN (&#39;blue&#39;, &#39;green&#39;)&quot;</span><span class="p">);</span>
<span class="p">}};</span>
<span class="n">newdoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InsertDocumentRequest</span><span class="p">();</span>
<span class="n">newdoc</span><span class="p">.</span><span class="na">index</span><span class="p">(</span><span class="s">&quot;products&quot;</span><span class="p">).</span><span class="na">setDoc</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
<span class="n">indexApi</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">newdoc</span><span class="p">);</span>
</code></pre></div>


<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="n">total</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="o">=</span><span class="p">,</span><span class="w"> </span><span class="n">warning</span><span class="o">=</span><span class="p">}</span>
<span class="kd">class</span> <span class="nc">SuccessResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">index</span><span class="p">:</span><span class="w"> </span><span class="n">products</span>
<span class="w">    </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">created</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">result</span><span class="p">:</span><span class="w"> </span><span class="n">created</span>
<span class="w">    </span><span class="n">found</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
<span class="kd">class</span> <span class="nc">SuccessResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">index</span><span class="p">:</span><span class="w"> </span><span class="n">products</span>
<span class="w">    </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">created</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">result</span><span class="p">:</span><span class="w"> </span><span class="n">created</span>
<span class="w">    </span><span class="n">found</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
<span class="kd">class</span> <span class="nc">SuccessResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">index</span><span class="p">:</span><span class="w"> </span><span class="n">products</span>
<span class="w">    </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">created</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="n">result</span><span class="p">:</span><span class="w"> </span><span class="n">created</span>
<span class="w">    </span><span class="n">found</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
C#
<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="nx">utilsApi</span><span class="p">.</span><span class="nx">Sql</span><span class="p">(</span><span class="s">&quot;create table products(title text, color string) type=&#39;pq&#39;&quot;</span><span class="p">);</span>

<span class="nx">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">Object</span><span class="p">&gt;</span><span class="w"> </span><span class="nx">doc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">new</span><span class="w"> </span><span class="nx">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">Object</span><span class="p">&gt;();</span><span class="w"> </span>
<span class="nx">doc</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="s">&quot;query&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@title bag&quot;</span><span class="p">);</span>
<span class="nx">InsertDocumentRequest</span><span class="w"> </span><span class="nx">newdoc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">new</span><span class="w"> </span><span class="nx">InsertDocumentRequest</span><span class="p">(</span><span class="nx">index</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">:</span><span class="w"> </span><span class="nx">doc</span><span class="p">);</span>
<span class="nx">indexApi</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="nx">newdoc</span><span class="p">);</span>

<span class="nx">doc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">new</span><span class="w"> </span><span class="nx">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">Object</span><span class="p">&gt;();</span><span class="w"> </span>
<span class="nx">doc</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="s">&quot;query&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@title shoes&quot;</span><span class="p">);</span>
<span class="nx">doc</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="s">&quot;filters&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;color=&#39;red&#39;&quot;</span><span class="p">);</span>
<span class="nx">newdoc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">new</span><span class="w"> </span><span class="nx">InsertDocumentRequest</span><span class="p">(</span><span class="nx">index</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">:</span><span class="w"> </span><span class="nx">doc</span><span class="p">);</span>
<span class="nx">indexApi</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="nx">newdoc</span><span class="p">);</span>

<span class="nx">doc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">new</span><span class="w"> </span><span class="nx">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">Object</span><span class="p">&gt;();</span><span class="w"> </span>
<span class="nx">doc</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="s">&quot;query&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@title bag&quot;</span><span class="p">);</span>
<span class="nx">doc</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="s">&quot;filters&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;color IN (&#39;blue&#39;, &#39;green&#39;)&quot;</span><span class="p">);</span>
<span class="nx">newdoc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">new</span><span class="w"> </span><span class="nx">InsertDocumentRequest</span><span class="p">(</span><span class="nx">index</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;products&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">:</span><span class="w"> </span><span class="nx">doc</span><span class="p">);</span>
<span class="nx">indexApi</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="nx">newdoc</span><span class="p">);</span>
</code></pre></div>


<!-- response C# -->

<div class="codehilite"><pre><span></span><code>{total=0, error=&quot;&quot;, warning=&quot;&quot;}

class SuccessResponse {
    index: products
    id: 0
    created: true
    result: created
    found: null
}
class SuccessResponse {
    index: products
    id: 0
    created: true
    result: created
    found: null
}
class SuccessResponse {
    index: products
    id: 0
    created: true
    result: created
    found: null
}
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
TypeScript
<!-- request TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">utilsApi</span><span class="p">.</span><span class="nx">sql</span><span class="p">(</span><span class="s2">&quot;create table test_pq(title text, color string) type=&#39;pq&#39;&quot;</span><span class="p">);</span>
<span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test_pq&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">doc</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;@title bag&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="p">});</span>
<span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test_pq&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">doc</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;@title shoes&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;color=&#39;red&#39;&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="p">});</span>
<span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">indexApi</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span>
<span class="w">  </span><span class="nx">index</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test_pq&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">doc</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;@title shoes&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">filters</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;color IN (&#39;blue&#39;, &#39;green&#39;)&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>


<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;test_pq&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">1657852401006149661</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;created&quot;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;created&quot;</span>
<span class="p">}</span>
<span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;test_pq&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">1657852401006149662</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;created&quot;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;created&quot;</span>
<span class="p">}</span>
<span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="s2">&quot;test_pq&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mf">1657852401006149663</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;created&quot;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;created&quot;</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
Go
<!-- request Go -->

<div class="codehilite"><pre><span></span><code><span class="nx">apiClient</span><span class="p">.</span><span class="nx">UtilsAPI</span><span class="p">.</span><span class="nx">Sql</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">Body</span><span class="p">(</span><span class="s">&quot;create table test_pq(title text, color string) type=&#39;pq&#39;&quot;</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>

<span class="nx">indexDoc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;@title bag&quot;</span><span class="p">}</span>
<span class="nx">indexReq</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewInsertDocumentRequest</span><span class="p">(</span><span class="s">&quot;test_pq&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">indexDoc</span><span class="p">)</span>
<span class="nx">apiClient</span><span class="p">.</span><span class="nx">IndexAPI</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">InsertDocumentRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">indexReq</span><span class="p">).</span><span class="nx">Execute</span><span class="p">();</span>

<span class="nx">indexDoc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;@title shoes&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;filters&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;color=&#39;red&#39;&quot;</span><span class="p">}</span>
<span class="nx">indexReq</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewInsertDocumentRequest</span><span class="p">(</span><span class="s">&quot;test_pq&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">indexDoc</span><span class="p">)</span>
<span class="nx">apiClient</span><span class="p">.</span><span class="nx">IndexAPI</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">InsertDocumentRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">indexReq</span><span class="p">).</span><span class="nx">Execute</span><span class="p">();</span>

<span class="nx">indexDoc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;@title shoes&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;filters&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;color IN (&#39;blue&#39;, &#39;green&#39;)&quot;</span><span class="p">}</span>
<span class="nx">indexReq</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewInsertDocumentRequest</span><span class="p">(</span><span class="s">&quot;test_pq&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">indexDoc</span><span class="p">)</span>
<span class="nx">apiClient</span><span class="p">.</span><span class="nx">IndexAPI</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()).</span><span class="nx">InsertDocumentRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">indexReq</span><span class="p">).</span><span class="nx">Execute</span><span class="p">();</span>
</code></pre></div>


<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;_index&quot;</span><span class="p">:</span><span class="s">&quot;test_pq&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="mi">1657852401006149661</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;created&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;result&quot;</span><span class="p">:</span><span class="s">&quot;created&quot;</span>
<span class="p">}</span>
<span class="p">{</span>
<span class="w">    </span><span class="s">&quot;_index&quot;</span><span class="p">:</span><span class="s">&quot;test_pq&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="mi">1657852401006149662</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;created&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;result&quot;</span><span class="p">:</span><span class="s">&quot;created&quot;</span>
<span class="p">}</span>
<span class="p">{</span>
<span class="w">    </span><span class="s">&quot;_index&quot;</span><span class="p">:</span><span class="s">&quot;test_pq&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="mi">1657852401006149663</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;created&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;result&quot;</span><span class="p">:</span><span class="s">&quot;created&quot;</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example single -->

<div class='item-select'>
Just tell me what PQ rules match my single document
</div>

<p>The first document doesn't match any rules. It could match the first two, but they require additional filters.</p>
<p>The second document matches one rule. Note that CALL PQ by default expects a document to be a JSON, but if you use <code>0 as docs_json</code>, you can pass a plain string instead.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>
SQL:
<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">CALL</span><span class="w"> </span><span class="n">PQ</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Beautiful shoes&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">docs_json</span><span class="p">);</span>

<span class="k">CALL</span><span class="w"> </span><span class="n">PQ</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;What a nice bag&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">docs_json</span><span class="p">);</span>
<span class="k">CALL</span><span class="w"> </span><span class="n">PQ</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;title&quot;: &quot;What a nice bag&quot;}&#39;</span><span class="p">);</span>
</code></pre></div>


<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657852401006149637</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+</span>

<span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657852401006149637</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
JSON:
<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/pq/produc</span><span class="kc">ts</span><span class="err">/_search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;percolate&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;document&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;What a nice bag&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;max_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1657852401006149644&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;ql&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;@title bag&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;_percolator_document_slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mi">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
PHP:
<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$percolate = [</span>
<span class="x">    &#39;index&#39; =&gt; &#39;products&#39;,</span>
<span class="x">    &#39;body&#39; =&gt; [</span>
<span class="x">        &#39;query&#39; =&gt; [</span>
<span class="x">            &#39;percolate&#39; =&gt; [</span>
<span class="x">                &#39;document&#39; =&gt; [</span>
<span class="x">                    &#39;title&#39; =&gt; &#39;What a nice bag&#39;</span>
<span class="x">                ]</span>
<span class="x">            ]</span>
<span class="x">        ]</span>
<span class="x">    ]</span>
<span class="x">];</span>
<span class="x">$client-&gt;pq()-&gt;search($percolate);</span>
</code></pre></div>


<!-- response PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">Array</span>
<span class="x">(</span>
<span class="x">    [took] =&gt; 0</span>
<span class="x">    [timed_out] =&gt;</span>
<span class="x">    [hits] =&gt; Array</span>
<span class="x">        (</span>
<span class="x">            [total] =&gt; 1</span>
<span class="x">            [max_score] =&gt; 1</span>
<span class="x">            [hits] =&gt; Array</span>
<span class="x">                (</span>
<span class="x">                    [0] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [_index] =&gt; products</span>
<span class="x">                            [_type] =&gt; doc</span>
<span class="x">                            [_id] =&gt; 1657852401006149644</span>
<span class="x">                            [_score] =&gt; 1</span>
<span class="x">                            [_source] =&gt; Array</span>
<span class="x">                                (</span>
<span class="x">                                    [query] =&gt; Array</span>
<span class="x">                                        (</span>
<span class="x">                                            [match] =&gt; Array</span>
<span class="x">                                                (</span>
<span class="x">                                                    [title] =&gt; bag</span>
<span class="x">                                                )</span>
<span class="x">                                        )</span>
<span class="x">                                )</span>
<span class="x">                            [fields] =&gt; Array</span>
<span class="x">                                (</span>
<span class="x">                                    [_percolator_document_slot] =&gt; Array</span>
<span class="x">                                        (</span>
<span class="x">                                            [0] =&gt; 1</span>
<span class="x">                                        )</span>
<span class="x">                                )</span>
<span class="x">                        )</span>
<span class="x">                )</span>
<span class="x">        )</span>
<span class="x">)</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
Python
<!-- request Python -->


<div class="codehilite"><pre><span></span><code><span class="n">searchApi</span><span class="o">.</span><span class="n">percolate</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,{</span><span class="s2">&quot;query&quot;</span><span class="p">:{</span><span class="s2">&quot;percolate&quot;</span><span class="p">:{</span><span class="s2">&quot;document&quot;</span><span class="p">:{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;What a nice bag&quot;</span><span class="p">}}}})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;2811025403043381480&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_index&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;products&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;ql&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;@title bag&#39;</span><span class="p">}},</span>
                    <span class="sa">u</span><span class="s1">&#39;_type&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;doc&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_percolator_document_slot&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]}}],</span>
          <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
javascript
<!-- request javascript -->


<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">percolate</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,{</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;percolate&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;document&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;What a nice bag&quot;</span><span class="p">}}}});</span>
</code></pre></div>


<!-- response javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;2811045522851233808&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;ql&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;@title bag&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;_percolator_document_slot&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mf">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
java
<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">PercolateRequest</span><span class="w"> </span><span class="n">percolateRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PercolateRequest</span><span class="p">();</span>
<span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;percolate&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;document&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">            </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span><span class="s">&quot;what a nice bag&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}});</span>
<span class="w">    </span><span class="p">}});</span>
<span class="p">}};</span>
<span class="n">percolateRequest</span><span class="p">.</span><span class="na">query</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">searchApi</span><span class="p">.</span><span class="na">percolate</span><span class="p">(</span><span class="s">&quot;test_pq&quot;</span><span class="p">,</span><span class="n">percolateRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response Javs -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">took</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">total</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="n">maxScore</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="p">{</span><span class="n">_index</span><span class="o">=</span><span class="n">products</span><span class="p">,</span><span class="w"> </span><span class="n">_type</span><span class="o">=</span><span class="n">doc</span><span class="p">,</span><span class="w"> </span><span class="n">_id</span><span class="o">=</span><span class="mi">2811045522851234109</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="n">ql</span><span class="o">=</span><span class="nd">@title</span><span class="w"> </span><span class="n">bag</span><span class="p">}},</span><span class="w"> </span><span class="n">fields</span><span class="o">=</span><span class="p">{</span><span class="n">_percolator_document_slot</span><span class="o">=[</span><span class="mi">1</span><span class="o">]</span><span class="p">}}</span><span class="o">]</span>
<span class="w">        </span><span class="n">aggregations</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">profile</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
C#
<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="x">Dictionary&lt;string, Object&gt; percolateDoc = new Dictionary&lt;string, Object&gt;(); </span>
<span class="x">percolateDoc.Add(&quot;document&quot;, new Dictionary&lt;string, Object&gt; </span><span class="cp">{{</span> <span class="s2">&quot;title&quot;</span><span class="o">,</span> <span class="s2">&quot;what a nice bag&quot;</span> <span class="cp">}}</span><span class="x">);</span>
<span class="x">Dictionary&lt;string, Object&gt; query = new Dictionary&lt;string, Object&gt; </span><span class="cp">{{</span> <span class="s2">&quot;percolate&quot;</span><span class="o">,</span> <span class="nv">percolateDoc</span> <span class="cp">}}</span><span class="x">; </span>
<span class="x">PercolateRequest percolateRequest = new PercolateRequest(query=query);</span>
<span class="x">searchApi.Percolate(&quot;test_pq&quot;,percolateRequest);</span>
</code></pre></div>


<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nx">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">took</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="nx">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="nx">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">total</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="nx">maxScore</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="nx">hits</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">_index</span><span class="p">=</span><span class="nx">products</span><span class="p">,</span><span class="w"> </span><span class="nx">_type</span><span class="p">=</span><span class="nx">doc</span><span class="p">,</span><span class="w"> </span><span class="nx">_id</span><span class="p">=</span><span class="mi">2811045522851234109</span><span class="p">,</span><span class="w"> </span><span class="nx">_score</span><span class="p">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nx">_source</span><span class="p">={</span><span class="nx">query</span><span class="p">={</span><span class="nx">ql</span><span class="p">=</span><span class="err">@</span><span class="nx">title</span><span class="w"> </span><span class="nx">bag</span><span class="p">}},</span><span class="w"> </span><span class="nx">fields</span><span class="p">={</span><span class="nx">_percolator_document_slot</span><span class="p">=[</span><span class="mi">1</span><span class="p">]}}]</span>
<span class="w">        </span><span class="nx">aggregations</span><span class="p">:</span><span class="w"> </span><span class="nx">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">profile</span><span class="p">:</span><span class="w"> </span><span class="nx">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
TypeScript
<!-- request TypeScript -->


<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">percolate</span><span class="p">(</span><span class="s1">&#39;test_pq&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">percolate</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">document</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">title</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;What a nice bag&#39;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>


<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test_pq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1657852401006149661&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;ql&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;@title bag&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;_percolator_document_slot&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mf">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
Go
<!-- request Go -->


<div class="codehilite"><pre><span></span><code><span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;what a nice bag&quot;</span><span class="p">}</span>
<span class="nx">percolateRequestQuery</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewPercolateQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
<span class="nx">percolateRequest</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewPercolateRequest</span><span class="p">(</span><span class="nx">percolateRequestQuery</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Percolate</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;test_pq&quot;</span><span class="p">).</span><span class="nx">PercolateRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">percolateRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>


<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;test_pq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1657852401006149661&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;ql&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;@title bag&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;_percolator_document_slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mi">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example pq_rules -->

<div class='item-select'>
I want to know complete PQ rules matching my document
</div>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>
SQL:
<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">CALL</span><span class="w"> </span><span class="n">PQ</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;title&quot;: &quot;What a nice bag&quot;}&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">query</span><span class="p">);</span>
</code></pre></div>


<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">---------------------+------------+------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">query</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">tags</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filters</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+------------+------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657852401006149637</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">@</span><span class="n">title</span><span class="w"> </span><span class="n">bag</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w">         </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+------------+------+---------+</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
JSON:
<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/pq/produc</span><span class="kc">ts</span><span class="err">/_search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;percolate&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;document&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;What a nice bag&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;max_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1657852401006149644&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;ql&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;@title bag&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;_percolator_document_slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mi">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
PHP:
<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$percolate = [</span>
<span class="x">    &#39;index&#39; =&gt; &#39;products&#39;,</span>
<span class="x">    &#39;body&#39; =&gt; [</span>
<span class="x">        &#39;query&#39; =&gt; [</span>
<span class="x">            &#39;percolate&#39; =&gt; [</span>
<span class="x">                &#39;document&#39; =&gt; [</span>
<span class="x">                    &#39;title&#39; =&gt; &#39;What a nice bag&#39;</span>
<span class="x">                ]</span>
<span class="x">            ]</span>
<span class="x">        ]</span>
<span class="x">    ]</span>
<span class="x">];</span>
<span class="x">$client-&gt;pq()-&gt;search($percolate);</span>
</code></pre></div>


<!-- response PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">Array</span>
<span class="x">(</span>
<span class="x">    [took] =&gt; 0</span>
<span class="x">    [timed_out] =&gt;</span>
<span class="x">    [hits] =&gt; Array</span>
<span class="x">        (</span>
<span class="x">            [total] =&gt; 1</span>
<span class="x">            [max_score] =&gt; 1</span>
<span class="x">            [hits] =&gt; Array</span>
<span class="x">                (</span>
<span class="x">                    [0] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [_index] =&gt; products</span>
<span class="x">                            [_type] =&gt; doc</span>
<span class="x">                            [_id] =&gt; 1657852401006149644</span>
<span class="x">                            [_score] =&gt; 1</span>
<span class="x">                            [_source] =&gt; Array</span>
<span class="x">                                (</span>
<span class="x">                                    [query] =&gt; Array</span>
<span class="x">                                        (</span>
<span class="x">                                            [match] =&gt; Array</span>
<span class="x">                                                (</span>
<span class="x">                                                    [title] =&gt; bag</span>
<span class="x">                                                )</span>
<span class="x">                                        )</span>
<span class="x">                                )</span>
<span class="x">                            [fields] =&gt; Array</span>
<span class="x">                                (</span>
<span class="x">                                    [_percolator_document_slot] =&gt; Array</span>
<span class="x">                                        (</span>
<span class="x">                                            [0] =&gt; 1</span>
<span class="x">                                        )</span>
<span class="x">                                )</span>
<span class="x">                        )</span>
<span class="x">                )</span>
<span class="x">        )</span>
<span class="x">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
Python
<!-- request Python -->


<div class="codehilite"><pre><span></span><code><span class="n">searchApi</span><span class="o">.</span><span class="n">percolate</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,{</span><span class="s2">&quot;query&quot;</span><span class="p">:{</span><span class="s2">&quot;percolate&quot;</span><span class="p">:{</span><span class="s2">&quot;document&quot;</span><span class="p">:{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;What a nice bag&quot;</span><span class="p">}}}})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;2811025403043381480&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_index&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;products&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;ql&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;@title bag&#39;</span><span class="p">}},</span>
                    <span class="sa">u</span><span class="s1">&#39;_type&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;doc&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_percolator_document_slot&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]}}],</span>
          <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
javascript
<!-- request javascript -->


<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">percolate</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,{</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;percolate&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;document&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;What a nice bag&quot;</span><span class="p">}}}});</span>
</code></pre></div>


<!-- response javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;2811045522851233808&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;ql&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;@title bag&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;_percolator_document_slot&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mf">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
java
<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">PercolateRequest</span><span class="w"> </span><span class="n">percolateRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PercolateRequest</span><span class="p">();</span>
<span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;percolate&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;document&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">            </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span><span class="s">&quot;what a nice bag&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}});</span>
<span class="w">    </span><span class="p">}});</span>
<span class="p">}};</span>
<span class="n">percolateRequest</span><span class="p">.</span><span class="na">query</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">searchApi</span><span class="p">.</span><span class="na">percolate</span><span class="p">(</span><span class="s">&quot;test_pq&quot;</span><span class="p">,</span><span class="n">percolateRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">took</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">total</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="n">maxScore</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="p">{</span><span class="n">_index</span><span class="o">=</span><span class="n">products</span><span class="p">,</span><span class="w"> </span><span class="n">_type</span><span class="o">=</span><span class="n">doc</span><span class="p">,</span><span class="w"> </span><span class="n">_id</span><span class="o">=</span><span class="mi">2811045522851234109</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="n">ql</span><span class="o">=</span><span class="nd">@title</span><span class="w"> </span><span class="n">bag</span><span class="p">}},</span><span class="w"> </span><span class="n">fields</span><span class="o">=</span><span class="p">{</span><span class="n">_percolator_document_slot</span><span class="o">=[</span><span class="mi">1</span><span class="o">]</span><span class="p">}}</span><span class="o">]</span>
<span class="w">        </span><span class="n">aggregations</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">profile</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
C#
<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="x">Dictionary&lt;string, Object&gt; percolateDoc = new Dictionary&lt;string, Object&gt;(); </span>
<span class="x">percolateDoc.Add(&quot;document&quot;, new Dictionary&lt;string, Object&gt; </span><span class="cp">{{</span> <span class="s2">&quot;title&quot;</span><span class="o">,</span> <span class="s2">&quot;what a nice bag&quot;</span> <span class="cp">}}</span><span class="x">);</span>
<span class="x">Dictionary&lt;string, Object&gt; query = new Dictionary&lt;string, Object&gt; </span><span class="cp">{{</span> <span class="s2">&quot;percolate&quot;</span><span class="o">,</span> <span class="nv">percolateDoc</span> <span class="cp">}}</span><span class="x">; </span>
<span class="x">PercolateRequest percolateRequest = new PercolateRequest(query=query);</span>
<span class="x">searchApi.Percolate(&quot;test_pq&quot;,percolateRequest);</span>
</code></pre></div>


<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nx">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">took</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="nx">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="nx">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">total</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="nx">maxScore</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="nx">hits</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">_index</span><span class="p">=</span><span class="nx">products</span><span class="p">,</span><span class="w"> </span><span class="nx">_type</span><span class="p">=</span><span class="nx">doc</span><span class="p">,</span><span class="w"> </span><span class="nx">_id</span><span class="p">=</span><span class="mi">2811045522851234109</span><span class="p">,</span><span class="w"> </span><span class="nx">_score</span><span class="p">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nx">_source</span><span class="p">={</span><span class="nx">query</span><span class="p">={</span><span class="nx">ql</span><span class="p">=</span><span class="err">@</span><span class="nx">title</span><span class="w"> </span><span class="nx">bag</span><span class="p">}},</span><span class="w"> </span><span class="nx">fields</span><span class="p">={</span><span class="nx">_percolator_document_slot</span><span class="p">=[</span><span class="mi">1</span><span class="p">]}}]</span>
<span class="w">        </span><span class="nx">aggregations</span><span class="p">:</span><span class="w"> </span><span class="nx">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">profile</span><span class="p">:</span><span class="w"> </span><span class="nx">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
TypeScript
<!-- request TypeScript -->


<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">percolate</span><span class="p">(</span><span class="s1">&#39;test_pq&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">percolate</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">document</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">title</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;What a nice bag&#39;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>


<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test_pq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1657852401006149661&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;ql&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;@title bag&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;_percolator_document_slot&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mf">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
Go
<!-- request Go -->


<div class="codehilite"><pre><span></span><code><span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;what a nice bag&quot;</span><span class="p">}</span>
<span class="nx">percolateRequestQuery</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewPercolateQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
<span class="nx">percolateRequest</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewPercolateRequest</span><span class="p">(</span><span class="nx">percolateRequestQuery</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Percolate</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;test_pq&quot;</span><span class="p">).</span><span class="nx">PercolateRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">percolateRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>


<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;test_pq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1657852401006149661&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;ql&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;@title bag&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;_percolator_document_slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mi">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example multiple -->

<div class='item-select'>
How about multiple documents?
</div>

<p>Note that with <code>CALL PQ</code>, you can provide multiple documents in different ways:</p>
<ul>
<li>as an array of plain documents in round brackets <code>('doc1', 'doc2')</code>. This requires <code>0 as docs_json</code></li>
<li>as an array of JSONs in round brackets <code>('{doc1}', '{doc2}')</code></li>
<li>or as a standard JSON array <code>'[{doc1}, {doc2}]'</code></li>
</ul>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>
SQL:
<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">CALL</span><span class="w"> </span><span class="n">PQ</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;nice pair of shoes&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;beautiful bag&#39;</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">docs_json</span><span class="p">);</span>

<span class="k">CALL</span><span class="w"> </span><span class="n">PQ</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;{&quot;title&quot;: &quot;nice pair of shoes&quot;, &quot;color&quot;: &quot;red&quot;}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;title&quot;: &quot;beautiful bag&quot;}&#39;</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">query</span><span class="p">);</span>

<span class="k">CALL</span><span class="w"> </span><span class="n">PQ</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;[{&quot;title&quot;: &quot;nice pair of shoes&quot;, &quot;color&quot;: &quot;blue&quot;}, {&quot;title&quot;: &quot;beautiful bag&quot;}]&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">query</span><span class="p">);</span>
</code></pre></div>


<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">---------------------+------------+------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">query</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">tags</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filters</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+------------+------+---------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657852401006149637</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">@</span><span class="n">title</span><span class="w"> </span><span class="n">bag</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w">         </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+------------+------+---------+</span>

<span class="o">+</span><span class="c1">---------------------+--------------+------+-------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">query</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">tags</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filters</span><span class="w">     </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+--------------+------+-------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657852401006149636</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">@</span><span class="n">title</span><span class="w"> </span><span class="n">shoes</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657852401006149637</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">@</span><span class="n">title</span><span class="w"> </span><span class="n">bag</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w">             </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+--------------+------+-------------+</span>

<span class="o">+</span><span class="c1">---------------------+--------------+------+---------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">query</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">tags</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filters</span><span class="w">                   </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+--------------+------+---------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657852401006149635</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">@</span><span class="n">title</span><span class="w"> </span><span class="n">shoes</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;blue, &#39;</span><span class="n">green</span><span class="err">&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657852401006149637</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">@</span><span class="n">title</span><span class="w"> </span><span class="n">bag</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w">                           </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+--------------+------+---------------------------+</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
JSON:
<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/pq/produc</span><span class="kc">ts</span><span class="err">/_search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;percolate&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;documents&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;nice pair of shoes&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;color&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;blue&quot;</span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;beautiful bag&quot;</span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;max_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1657852401006149644&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;ql&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;@title bag&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;_percolator_document_slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mi">2</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1657852401006149646&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;ql&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;@title shoes&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;_percolator_document_slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mi">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
PHP:
<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$percolate = [</span>
<span class="x">    &#39;index&#39; =&gt; &#39;products&#39;,</span>
<span class="x">    &#39;body&#39; =&gt; [</span>
<span class="x">        &#39;query&#39; =&gt; [</span>
<span class="x">            &#39;percolate&#39; =&gt; [</span>
<span class="x">                &#39;documents&#39; =&gt; [</span>
<span class="x">                    [&#39;title&#39; =&gt; &#39;nice pair of shoes&#39;,&#39;color&#39;=&gt;&#39;blue&#39;],</span>
<span class="x">                    [&#39;title&#39; =&gt; &#39;beautiful bag&#39;]</span>
<span class="x">                ]</span>
<span class="x">            ]</span>
<span class="x">        ]</span>
<span class="x">    ]</span>
<span class="x">];</span>
<span class="x">$client-&gt;pq()-&gt;search($percolate);</span>
</code></pre></div>


<!-- response PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">Array</span>
<span class="x">(</span>
<span class="x">    [took] =&gt; 23</span>
<span class="x">    [timed_out] =&gt;</span>
<span class="x">    [hits] =&gt; Array</span>
<span class="x">        (</span>
<span class="x">            [total] =&gt; 2</span>
<span class="x">            [max_score] =&gt; 1</span>
<span class="x">            [hits] =&gt; Array</span>
<span class="x">                (</span>
<span class="x">                    [0] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [_index] =&gt; products</span>
<span class="x">                            [_type] =&gt; doc</span>
<span class="x">                            [_id] =&gt; 2810781492890828819</span>
<span class="x">                            [_score] =&gt; 1</span>
<span class="x">                            [_source] =&gt; Array</span>
<span class="x">                                (</span>
<span class="x">                                    [query] =&gt; Array</span>
<span class="x">                                        (</span>
<span class="x">                                            [match] =&gt; Array</span>
<span class="x">                                                (</span>
<span class="x">                                                    [title] =&gt; bag</span>
<span class="x">                                                )</span>
<span class="x">                                        )</span>
<span class="x">                                )</span>
<span class="x">                            [fields] =&gt; Array</span>
<span class="x">                                (</span>
<span class="x">                                    [_percolator_document_slot] =&gt; Array</span>
<span class="x">                                        (</span>
<span class="x">                                            [0] =&gt; 2</span>
<span class="x">                                        )</span>
<span class="x">                                )</span>
<span class="x">                        )</span>
<span class="x">                    [1] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [_index] =&gt; products</span>
<span class="x">                            [_type] =&gt; doc</span>
<span class="x">                            [_id] =&gt; 2810781492890828821</span>
<span class="x">                            [_score] =&gt; 1</span>
<span class="x">                            [_source] =&gt; Array</span>
<span class="x">                                (</span>
<span class="x">                                    [query] =&gt; Array</span>
<span class="x">                                        (</span>
<span class="x">                                            [match] =&gt; Array</span>
<span class="x">                                                (</span>
<span class="x">                                                    [title] =&gt; shoes</span>
<span class="x">                                                )</span>
<span class="x">                                        )</span>
<span class="x">                                )</span>
<span class="x">                            [fields] =&gt; Array</span>
<span class="x">                                (</span>
<span class="x">                                    [_percolator_document_slot] =&gt; Array</span>
<span class="x">                                        (</span>
<span class="x">                                            [0] =&gt; 1</span>
<span class="x">                                        )</span>
<span class="x">                                )</span>
<span class="x">                        )</span>
<span class="x">                )</span>
<span class="x">        )</span>
<span class="x">)</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
Python
<!-- request Python -->


<div class="codehilite"><pre><span></span><code><span class="n">searchApi</span><span class="o">.</span><span class="n">percolate</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,{</span><span class="s2">&quot;query&quot;</span><span class="p">:{</span><span class="s2">&quot;percolate&quot;</span><span class="p">:{</span><span class="s2">&quot;documents&quot;</span><span class="p">:[{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;nice pair of shoes&quot;</span><span class="p">,</span><span class="s2">&quot;color&quot;</span><span class="p">:</span><span class="s2">&quot;blue&quot;</span><span class="p">},{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;beautiful bag&quot;</span><span class="p">}]}}})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;2811025403043381494&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_index&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;products&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;ql&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;@title bag&#39;</span><span class="p">}},</span>
                    <span class="sa">u</span><span class="s1">&#39;_type&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;doc&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_percolator_document_slot&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">]}},</span>
                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;2811025403043381496&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_index&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;products&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;ql&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;@title shoes&#39;</span><span class="p">}},</span>
                    <span class="sa">u</span><span class="s1">&#39;_type&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;doc&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_percolator_document_slot&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]}}],</span>
          <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
javascript
<!-- request javascript -->


<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">percolate</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,{</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;percolate&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;documents&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;nice pair of shoes&quot;</span><span class="p">,</span><span class="s2">&quot;color&quot;</span><span class="o">:</span><span class="s2">&quot;blue&quot;</span><span class="p">},{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;beautiful bag&quot;</span><span class="p">}]}}});</span>
</code></pre></div>


<!-- response javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">6</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;2811045522851233808&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;ql&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;@title bag&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;_percolator_document_slot&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mf">2</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;2811045522851233810&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;ql&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;@title shoes&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;_percolator_document_slot&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mf">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
java
<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">percolateRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PercolateRequest</span><span class="p">();</span>
<span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;percolate&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">            </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;documents&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">                    </span><span class="n">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">                        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span><span class="s">&quot;nice pair of shoes&quot;</span><span class="p">);</span>
<span class="w">                        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;color&quot;</span><span class="p">,</span><span class="s">&quot;blue&quot;</span><span class="p">);</span>
<span class="w">                    </span><span class="p">}});</span>
<span class="w">                    </span><span class="n">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">                        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span><span class="s">&quot;beautiful bag&quot;</span><span class="p">);</span>

<span class="w">                    </span><span class="p">}});</span>

<span class="w">                     </span><span class="p">}});</span>
<span class="w">        </span><span class="p">}});</span>
<span class="w">    </span><span class="p">}};</span>
<span class="n">percolateRequest</span><span class="p">.</span><span class="na">query</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">searchApi</span><span class="p">.</span><span class="na">percolate</span><span class="p">(</span><span class="s">&quot;products&quot;</span><span class="p">,</span><span class="n">percolateRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">took</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">total</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="n">maxScore</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="p">{</span><span class="n">_index</span><span class="o">=</span><span class="n">products</span><span class="p">,</span><span class="w"> </span><span class="n">_type</span><span class="o">=</span><span class="n">doc</span><span class="p">,</span><span class="w"> </span><span class="n">_id</span><span class="o">=</span><span class="mi">2811045522851234133</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="n">ql</span><span class="o">=</span><span class="nd">@title</span><span class="w"> </span><span class="n">bag</span><span class="p">}},</span><span class="w"> </span><span class="n">fields</span><span class="o">=</span><span class="p">{</span><span class="n">_percolator_document_slot</span><span class="o">=[</span><span class="mi">2</span><span class="o">]</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_index</span><span class="o">=</span><span class="n">products</span><span class="p">,</span><span class="w"> </span><span class="n">_type</span><span class="o">=</span><span class="n">doc</span><span class="p">,</span><span class="w"> </span><span class="n">_id</span><span class="o">=</span><span class="mi">2811045522851234135</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="n">ql</span><span class="o">=</span><span class="nd">@title</span><span class="w"> </span><span class="n">shoes</span><span class="p">}},</span><span class="w"> </span><span class="n">fields</span><span class="o">=</span><span class="p">{</span><span class="n">_percolator_document_slot</span><span class="o">=[</span><span class="mi">1</span><span class="o">]</span><span class="p">}}</span><span class="o">]</span>
<span class="w">        </span><span class="n">aggregations</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">profile</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
C#
<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">doc1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">doc1</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span><span class="s2">&quot;nice pair of shoes&quot;</span><span class="p">);</span>
<span class="n">doc1</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span><span class="s2">&quot;blue&quot;</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">doc2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">doc2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span><span class="s2">&quot;beautiful bag&quot;</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">docs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="n">doc1</span><span class="p">,</span><span class="w"> </span><span class="n">doc2</span><span class="p">};</span>
<span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">percolateDoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{{</span><span class="w"> </span><span class="s2">&quot;documents&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">docs</span><span class="w"> </span><span class="p">}};</span><span class="w"> </span>
<span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{{</span><span class="w"> </span><span class="s2">&quot;percolate&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">percolateDoc</span><span class="w"> </span><span class="p">}};</span><span class="w"> </span>
<span class="n">PercolateRequest</span><span class="w"> </span><span class="n">percolateRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">PercolateRequest</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">);</span>
<span class="n">searchApi</span><span class="o">.</span><span class="n">Percolate</span><span class="p">(</span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="n">percolateRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nx">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">took</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="nx">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="nx">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">total</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="nx">maxScore</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="nx">hits</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">_index</span><span class="p">=</span><span class="nx">products</span><span class="p">,</span><span class="w"> </span><span class="nx">_type</span><span class="p">=</span><span class="nx">doc</span><span class="p">,</span><span class="w"> </span><span class="nx">_id</span><span class="p">=</span><span class="mi">2811045522851234133</span><span class="p">,</span><span class="w"> </span><span class="nx">_score</span><span class="p">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nx">_source</span><span class="p">={</span><span class="nx">query</span><span class="p">={</span><span class="nx">ql</span><span class="p">=</span><span class="err">@</span><span class="nx">title</span><span class="w"> </span><span class="nx">bag</span><span class="p">}},</span><span class="w"> </span><span class="nx">fields</span><span class="p">={</span><span class="nx">_percolator_document_slot</span><span class="p">=[</span><span class="mi">2</span><span class="p">]}},</span><span class="w"> </span><span class="p">{</span><span class="nx">_index</span><span class="p">=</span><span class="nx">products</span><span class="p">,</span><span class="w"> </span><span class="nx">_type</span><span class="p">=</span><span class="nx">doc</span><span class="p">,</span><span class="w"> </span><span class="nx">_id</span><span class="p">=</span><span class="mi">2811045522851234135</span><span class="p">,</span><span class="w"> </span><span class="nx">_score</span><span class="p">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nx">_source</span><span class="p">={</span><span class="nx">query</span><span class="p">={</span><span class="nx">ql</span><span class="p">=</span><span class="err">@</span><span class="nx">title</span><span class="w"> </span><span class="nx">shoes</span><span class="p">}},</span><span class="w"> </span><span class="nx">fields</span><span class="p">={</span><span class="nx">_percolator_document_slot</span><span class="p">=[</span><span class="mi">1</span><span class="p">]}}]</span>
<span class="w">        </span><span class="nx">aggregations</span><span class="p">:</span><span class="w"> </span><span class="nx">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">profile</span><span class="p">:</span><span class="w"> </span><span class="nx">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
TypeScript
<!-- request TypeScript -->


<div class="codehilite"><pre><span></span><code><span class="nx">docs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="nx">title</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;What a nice bag&#39;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nx">title</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Really nice shoes&#39;</span><span class="p">}</span><span class="w"> </span><span class="p">];</span><span class="w"> </span>
<span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">percolate</span><span class="p">(</span><span class="s1">&#39;test_pq&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">percolate</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">documents</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">docs</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>


<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test_pq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1657852401006149661&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;ql&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;@title bag&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;_percolator_document_slot&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mf">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test_pq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1657852401006149662&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;ql&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;@title shoes&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;_percolator_document_slot&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mf">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
Go
<!-- request Go -->


<div class="codehilite"><pre><span></span><code><span class="nx">doc1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;What a nice bag&quot;</span><span class="p">}</span>
<span class="nx">doc2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Really nice shoes&quot;</span><span class="p">}</span>
<span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="nx">doc1</span><span class="p">,</span><span class="w"> </span><span class="nx">doc2</span><span class="p">}</span>
<span class="nx">percolateRequestQuery</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewPercolateQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
<span class="nx">percolateRequest</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewPercolateRequest</span><span class="p">(</span><span class="nx">percolateRequestQuery</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Percolate</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;test_pq&quot;</span><span class="p">).</span><span class="nx">PercolateRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">percolateRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>


<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;test_pq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1657852401006149661&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;ql&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;@title bag&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;_percolator_document_slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mi">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;test_pq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1657852401006149662&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;ql&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;@title shoes&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;_percolator_document_slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mi">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example docs_1 -->

<div class='item-select'>
I want to know what docs match what rules
</div>

<p>Using the option <code>1 as docs</code> allows you to see which documents of the provided ones match which rules.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>
SQL:
<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">CALL</span><span class="w"> </span><span class="n">PQ</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;[{&quot;title&quot;: &quot;nice pair of shoes&quot;, &quot;color&quot;: &quot;blue&quot;}, {&quot;title&quot;: &quot;beautiful bag&quot;}]&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">docs</span><span class="p">);</span>
</code></pre></div>



<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">---------------------+-----------+--------------+------+---------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">documents</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">query</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">tags</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filters</span><span class="w">                   </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+-----------+--------------+------+---------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657852401006149635</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="o">@</span><span class="n">title</span><span class="w"> </span><span class="n">shoes</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;blue, &#39;</span><span class="n">green</span><span class="err">&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657852401006149637</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="o">@</span><span class="n">title</span><span class="w"> </span><span class="n">bag</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w">                           </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+-----------+--------------+------+---------------------------+</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
JSON:
<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/pq/produc</span><span class="kc">ts</span><span class="err">/_search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;percolate&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;documents&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;nice pair of shoes&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;color&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;blue&quot;</span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;beautiful bag&quot;</span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;max_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1657852401006149644&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;ql&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;@title bag&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;_percolator_document_slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mi">2</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1657852401006149646&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;ql&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;@title shoes&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;_percolator_document_slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mi">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
PHP:
<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$percolate = [</span>
<span class="x">    &#39;index&#39; =&gt; &#39;products&#39;,</span>
<span class="x">    &#39;body&#39; =&gt; [</span>
<span class="x">        &#39;query&#39; =&gt; [</span>
<span class="x">            &#39;percolate&#39; =&gt; [</span>
<span class="x">                &#39;documents&#39; =&gt; [</span>
<span class="x">                    [&#39;title&#39; =&gt; &#39;nice pair of shoes&#39;,&#39;color&#39;=&gt;&#39;blue&#39;],</span>
<span class="x">                    [&#39;title&#39; =&gt; &#39;beautiful bag&#39;]</span>
<span class="x">                ]</span>
<span class="x">            ]</span>
<span class="x">        ]</span>
<span class="x">    ]</span>
<span class="x">];</span>
<span class="x">$client-&gt;pq()-&gt;search($percolate);</span>
</code></pre></div>


<!-- response PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">Array</span>
<span class="x">(</span>
<span class="x">    [took] =&gt; 23</span>
<span class="x">    [timed_out] =&gt;</span>
<span class="x">    [hits] =&gt; Array</span>
<span class="x">        (</span>
<span class="x">            [total] =&gt; 2</span>
<span class="x">            [max_score] =&gt; 1</span>
<span class="x">            [hits] =&gt; Array</span>
<span class="x">                (</span>
<span class="x">                    [0] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [_index] =&gt; products</span>
<span class="x">                            [_type] =&gt; doc</span>
<span class="x">                            [_id] =&gt; 2810781492890828819</span>
<span class="x">                            [_score] =&gt; 1</span>
<span class="x">                            [_source] =&gt; Array</span>
<span class="x">                                (</span>
<span class="x">                                    [query] =&gt; Array</span>
<span class="x">                                        (</span>
<span class="x">                                            [match] =&gt; Array</span>
<span class="x">                                                (</span>
<span class="x">                                                    [title] =&gt; bag</span>
<span class="x">                                                )</span>
<span class="x">                                        )</span>
<span class="x">                                )</span>
<span class="x">                            [fields] =&gt; Array</span>
<span class="x">                                (</span>
<span class="x">                                    [_percolator_document_slot] =&gt; Array</span>
<span class="x">                                        (</span>
<span class="x">                                            [0] =&gt; 2</span>
<span class="x">                                        )</span>
<span class="x">                                )</span>
<span class="x">                        )</span>
<span class="x">                    [1] =&gt; Array</span>
<span class="x">                        (</span>
<span class="x">                            [_index] =&gt; products</span>
<span class="x">                            [_type] =&gt; doc</span>
<span class="x">                            [_id] =&gt; 2810781492890828821</span>
<span class="x">                            [_score] =&gt; 1</span>
<span class="x">                            [_source] =&gt; Array</span>
<span class="x">                                (</span>
<span class="x">                                    [query] =&gt; Array</span>
<span class="x">                                        (</span>
<span class="x">                                            [match] =&gt; Array</span>
<span class="x">                                                (</span>
<span class="x">                                                    [title] =&gt; shoes</span>
<span class="x">                                                )</span>
<span class="x">                                        )</span>
<span class="x">                                )</span>
<span class="x">                            [fields] =&gt; Array</span>
<span class="x">                                (</span>
<span class="x">                                    [_percolator_document_slot] =&gt; Array</span>
<span class="x">                                        (</span>
<span class="x">                                            [0] =&gt; 1</span>
<span class="x">                                        )</span>
<span class="x">                                )</span>
<span class="x">                        )</span>
<span class="x">                )</span>
<span class="x">        )</span>
<span class="x">)</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
Python
<!-- request Python -->


<div class="codehilite"><pre><span></span><code><span class="n">searchApi</span><span class="o">.</span><span class="n">percolate</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,{</span><span class="s2">&quot;query&quot;</span><span class="p">:{</span><span class="s2">&quot;percolate&quot;</span><span class="p">:{</span><span class="s2">&quot;documents&quot;</span><span class="p">:[{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;nice pair of shoes&quot;</span><span class="p">,</span><span class="s2">&quot;color&quot;</span><span class="p">:</span><span class="s2">&quot;blue&quot;</span><span class="p">},{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;beautiful bag&quot;</span><span class="p">}]}}})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;2811025403043381494&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_index&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;products&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;ql&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;@title bag&#39;</span><span class="p">}},</span>
                    <span class="sa">u</span><span class="s1">&#39;_type&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;doc&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_percolator_document_slot&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">]}},</span>
                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;2811025403043381496&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_index&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;products&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;ql&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;@title shoes&#39;</span><span class="p">}},</span>
                    <span class="sa">u</span><span class="s1">&#39;_type&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;doc&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_percolator_document_slot&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]}}],</span>
          <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
javascript
<!-- request javascript -->


<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">percolate</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,{</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;percolate&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;documents&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;nice pair of shoes&quot;</span><span class="p">,</span><span class="s2">&quot;color&quot;</span><span class="o">:</span><span class="s2">&quot;blue&quot;</span><span class="p">},{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;beautiful bag&quot;</span><span class="p">}]}}});</span>
</code></pre></div>


<!-- response javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">6</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;2811045522851233808&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;ql&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;@title bag&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;_percolator_document_slot&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mf">2</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;products&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;2811045522851233810&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;ql&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;@title shoes&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;_percolator_document_slot&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mf">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
java
<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">percolateRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PercolateRequest</span><span class="p">();</span>
<span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;percolate&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">            </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;documents&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">                    </span><span class="n">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">                        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span><span class="s">&quot;nice pair of shoes&quot;</span><span class="p">);</span>
<span class="w">                        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;color&quot;</span><span class="p">,</span><span class="s">&quot;blue&quot;</span><span class="p">);</span>
<span class="w">                    </span><span class="p">}});</span>
<span class="w">                    </span><span class="n">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">                        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span><span class="s">&quot;beautiful bag&quot;</span><span class="p">);</span>

<span class="w">                    </span><span class="p">}});</span>

<span class="w">                     </span><span class="p">}});</span>
<span class="w">        </span><span class="p">}});</span>
<span class="w">    </span><span class="p">}};</span>
<span class="n">percolateRequest</span><span class="p">.</span><span class="na">query</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">searchApi</span><span class="p">.</span><span class="na">percolate</span><span class="p">(</span><span class="s">&quot;products&quot;</span><span class="p">,</span><span class="n">percolateRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">took</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">total</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="n">maxScore</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="p">{</span><span class="n">_index</span><span class="o">=</span><span class="n">products</span><span class="p">,</span><span class="w"> </span><span class="n">_type</span><span class="o">=</span><span class="n">doc</span><span class="p">,</span><span class="w"> </span><span class="n">_id</span><span class="o">=</span><span class="mi">2811045522851234133</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="n">ql</span><span class="o">=</span><span class="nd">@title</span><span class="w"> </span><span class="n">bag</span><span class="p">}},</span><span class="w"> </span><span class="n">fields</span><span class="o">=</span><span class="p">{</span><span class="n">_percolator_document_slot</span><span class="o">=[</span><span class="mi">2</span><span class="o">]</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_index</span><span class="o">=</span><span class="n">products</span><span class="p">,</span><span class="w"> </span><span class="n">_type</span><span class="o">=</span><span class="n">doc</span><span class="p">,</span><span class="w"> </span><span class="n">_id</span><span class="o">=</span><span class="mi">2811045522851234135</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="n">ql</span><span class="o">=</span><span class="nd">@title</span><span class="w"> </span><span class="n">shoes</span><span class="p">}},</span><span class="w"> </span><span class="n">fields</span><span class="o">=</span><span class="p">{</span><span class="n">_percolator_document_slot</span><span class="o">=[</span><span class="mi">1</span><span class="o">]</span><span class="p">}}</span><span class="o">]</span>
<span class="w">        </span><span class="n">aggregations</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">profile</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
C#
<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">doc1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">doc1</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span><span class="s2">&quot;nice pair of shoes&quot;</span><span class="p">);</span>
<span class="n">doc1</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span><span class="s2">&quot;blue&quot;</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">doc2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">doc2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span><span class="s2">&quot;beautiful bag&quot;</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">docs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="n">doc1</span><span class="p">,</span><span class="w"> </span><span class="n">doc2</span><span class="p">};</span>
<span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">percolateDoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{{</span><span class="w"> </span><span class="s2">&quot;documents&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">docs</span><span class="w"> </span><span class="p">}};</span><span class="w"> </span>
<span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{{</span><span class="w"> </span><span class="s2">&quot;percolate&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">percolateDoc</span><span class="w"> </span><span class="p">}};</span><span class="w"> </span>
<span class="n">PercolateRequest</span><span class="w"> </span><span class="n">percolateRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">PercolateRequest</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">);</span>
<span class="n">searchApi</span><span class="o">.</span><span class="n">Percolate</span><span class="p">(</span><span class="s2">&quot;products&quot;</span><span class="p">,</span><span class="n">percolateRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nx">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">took</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="nx">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="nx">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">total</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="nx">maxScore</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="nx">hits</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">_index</span><span class="p">=</span><span class="nx">products</span><span class="p">,</span><span class="w"> </span><span class="nx">_type</span><span class="p">=</span><span class="nx">doc</span><span class="p">,</span><span class="w"> </span><span class="nx">_id</span><span class="p">=</span><span class="mi">2811045522851234133</span><span class="p">,</span><span class="w"> </span><span class="nx">_score</span><span class="p">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nx">_source</span><span class="p">={</span><span class="nx">query</span><span class="p">={</span><span class="nx">ql</span><span class="p">=</span><span class="err">@</span><span class="nx">title</span><span class="w"> </span><span class="nx">bag</span><span class="p">}},</span><span class="w"> </span><span class="nx">fields</span><span class="p">={</span><span class="nx">_percolator_document_slot</span><span class="p">=[</span><span class="mi">2</span><span class="p">]}},</span><span class="w"> </span><span class="p">{</span><span class="nx">_index</span><span class="p">=</span><span class="nx">products</span><span class="p">,</span><span class="w"> </span><span class="nx">_type</span><span class="p">=</span><span class="nx">doc</span><span class="p">,</span><span class="w"> </span><span class="nx">_id</span><span class="p">=</span><span class="mi">2811045522851234135</span><span class="p">,</span><span class="w"> </span><span class="nx">_score</span><span class="p">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nx">_source</span><span class="p">={</span><span class="nx">query</span><span class="p">={</span><span class="nx">ql</span><span class="p">=</span><span class="err">@</span><span class="nx">title</span><span class="w"> </span><span class="nx">shoes</span><span class="p">}},</span><span class="w"> </span><span class="nx">fields</span><span class="p">={</span><span class="nx">_percolator_document_slot</span><span class="p">=[</span><span class="mi">1</span><span class="p">]}}]</span>
<span class="w">        </span><span class="nx">aggregations</span><span class="p">:</span><span class="w"> </span><span class="nx">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">profile</span><span class="p">:</span><span class="w"> </span><span class="nx">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
TypeScript
<!-- request TypeScript -->


<div class="codehilite"><pre><span></span><code><span class="nx">docs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="nx">title</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;What a nice bag&#39;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nx">title</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Really nice shoes&#39;</span><span class="p">}</span><span class="w"> </span><span class="p">];</span><span class="w"> </span>
<span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">percolate</span><span class="p">(</span><span class="s1">&#39;test_pq&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">percolate</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">documents</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">docs</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>


<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test_pq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1657852401006149661&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;ql&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;@title bag&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;_percolator_document_slot&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mf">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test_pq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1657852401006149662&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;ql&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;@title shoes&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;_percolator_document_slot&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mf">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
Go
<!-- request Go -->


<div class="codehilite"><pre><span></span><code><span class="nx">doc1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;What a nice bag&quot;</span><span class="p">}</span>
<span class="nx">doc2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Really nice shoes&quot;</span><span class="p">}</span>
<span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="nx">doc1</span><span class="p">,</span><span class="w"> </span><span class="nx">doc2</span><span class="p">}</span>
<span class="nx">percolateRequestQuery</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewPercolateQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
<span class="nx">percolateRequest</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewPercolateRequest</span><span class="p">(</span><span class="nx">percolateRequestQuery</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Percolate</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;test_pq&quot;</span><span class="p">).</span><span class="nx">PercolateRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">percolateRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>


<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;test_pq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1657852401006149661&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;ql&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;@title bag&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;_percolator_document_slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mi">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;test_pq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1657852401006149662&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;ql&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;@title shoes&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;_percolator_document_slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mi">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example docs_id -->
<h4 id="static-ids">Static ids</h4>
<p>By default, matching document ids correspond to their relative numbers in the list you provide. However, in some cases, each document already has its own id. For this case, there's an option <code>'id field name' as docs_id</code> for <code>CALL PQ</code>.</p>
<p>Note that if the id cannot be found by the provided field name, the PQ rule will not be shown in the results.</p>
<p>This option is only available for <code>CALL PQ</code> via SQL.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">CALL</span><span class="w"> </span><span class="n">PQ</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;[{&quot;id&quot;: 123, &quot;title&quot;: &quot;nice pair of shoes&quot;, &quot;color&quot;: &quot;blue&quot;}, {&quot;id&quot;: 456, &quot;title&quot;: &quot;beautiful bag&quot;}]&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">docs_id</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">docs</span><span class="p">);</span>
</code></pre></div>


<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">---------------------+-----------+--------------+------+---------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">documents</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">query</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">tags</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filters</span><span class="w">                   </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+-----------+--------------+------+---------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657852401006149664</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">456</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="o">@</span><span class="n">title</span><span class="w"> </span><span class="n">bag</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w">                           </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657852401006149666</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">123</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="o">@</span><span class="n">title</span><span class="w"> </span><span class="n">shoes</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;blue, &#39;</span><span class="n">green</span><span class="err">&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+-----------+--------------+------+---------------------------+</span>
</code></pre></div>


<!-- end -->

</div>

</div>

<!-- example invalid_json -->

<div class='item-select'>
I may have invalid JSONs, please skip them
</div>

<p>When using CALL PQ with separate JSONs, you can use the option 1 as skip_bad_json to skip any invalid JSONs in the input. In the example below, the 2nd query fails due to an invalid JSON, but the 3rd query avoids the error by using 1 as skip_bad_json. Keep in mind that this option is not available when sending JSON queries over HTTP, as the whole JSON query must be valid in that case.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>
SQL:
<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">CALL</span><span class="w"> </span><span class="n">PQ</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;{&quot;title&quot;: &quot;nice pair of shoes&quot;, &quot;color&quot;: &quot;blue&quot;}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;title&quot;: &quot;beautiful bag&quot;}&#39;</span><span class="p">));</span>

<span class="k">CALL</span><span class="w"> </span><span class="n">PQ</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;{&quot;title&quot;: &quot;nice pair of shoes&quot;, &quot;color&quot;: &quot;blue&quot;}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;title&quot;: &quot;beautiful bag}&#39;</span><span class="p">));</span>

<span class="k">CALL</span><span class="w"> </span><span class="n">PQ</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;{&quot;title&quot;: &quot;nice pair of shoes&quot;, &quot;color&quot;: &quot;blue&quot;}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;title&quot;: &quot;beautiful bag}&#39;</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">skip_bad_json</span><span class="p">);</span>
</code></pre></div>


<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657852401006149635</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657852401006149637</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+</span>

<span class="n">ERROR</span><span class="w"> </span><span class="mi">1064</span><span class="w"> </span><span class="p">(</span><span class="mi">42000</span><span class="p">):</span><span class="w"> </span><span class="n">Bad</span><span class="w"> </span><span class="n">JSON</span><span class="w"> </span><span class="n">objects</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">strings</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>

<span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657852401006149635</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<h5 id="i-want-higher-performance-of-a-percolate-query">I want higher performance of a percolate query</h5>
<p>Percolate queries are designed with high throughput and large data volumes in mind. To optimize performance for lower latency and higher throughput, consider the following.</p>
<p>There are two modes of distribution for a percolate table and how a percolate query can work against it:</p>
<ul>
<li><strong>Sparse (default).</strong> Ideal for: many documents, mirrored PQ tables. When your document set is large but the set of queries stored in the PQ table is small, the sparse mode is beneficial. In this mode, the batch of documents you pass will be divided among the number of agents, so each node processes only a portion of the documents from your request. Manticore splits your document set and distributes chunks among the mirrors. Once the agents have finished processing the queries, Manticore collects and merges the results, returning a final query set as if it came from a single table. Use <a href="../28-references.html#replication">replication</a> to assist the process.</li>
<li><strong>Sharded.</strong> Ideal for: many PQ rules, rules split among PQ tables. In this mode, the entire document set is broadcast to all tables of the distributed PQ table without initially splitting the documents. This is beneficial when pushing a relatively small set of documents, but the number of stored queries is large. In this case, it's more appropriate to store only a portion of PQ rules on each node and then merge the results returned from the nodes that process the same set of documents against different sets of PQ rules. This mode must be explicitly set, as it implies an increase in network payload and expects tables with different PQs, which <a href="../28-references.html#replication">replication</a> cannot do out-of-the-box.</li>
</ul>
<p>Assume you have table <code>pq_d2</code> defined as:</p>
<div class="codehilite"><pre><span></span><code><span class="na">table pq_d2</span>
<span class="na">{</span>
<span class="w">    </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">distributed</span>
<span class="w">    </span><span class="na">agent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">127.0.0.1:6712:pq</span>
<span class="w">    </span><span class="na">agent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">127.0.0.1:6712:ptitle</span>
<span class="na">}</span>
</code></pre></div>

<!-- example distributed pq modes 1 -->
<p>Each of 'pq' and 'ptitle' contains:</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">pq</span><span class="p">;</span>
</code></pre></div>



<!-- response sql -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">------+-------------+------+-------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">query</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">tags</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filters</span><span class="w">           </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-------------+------+-------------------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">gid</span><span class="o">&gt;=</span><span class="mi">10</span><span class="w">           </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">angry</span><span class="w">       </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">gid</span><span class="o">&gt;=</span><span class="mi">10</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">gid</span><span class="o">&lt;=</span><span class="mi">3</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-------------+------+-------------------+</span>
<span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/pq/pq/_search</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:{</span>
<span class="w">        </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;hits&quot;</span><span class="p">:[</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;_source&quot;</span><span class="p">:{</span>
<span class="w">                    </span><span class="nt">&quot;query&quot;</span><span class="p">:{</span><span class="w"> </span><span class="nt">&quot;ql&quot;</span><span class="p">:</span><span class="s2">&quot;filter test&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">                    </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;filters&quot;</span><span class="p">:</span><span class="s2">&quot;gid&gt;=10&quot;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="s2">&quot;2&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;_source&quot;</span><span class="p">:{</span>
<span class="w">                    </span><span class="nt">&quot;query&quot;</span><span class="p">:{</span><span class="nt">&quot;ql&quot;</span><span class="p">:</span><span class="s2">&quot;angry&quot;</span><span class="p">},</span>
<span class="w">                    </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;filters&quot;</span><span class="p">:</span><span class="s2">&quot;gid&gt;=10 OR gid&lt;=3&quot;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span><span class="w">            </span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$params = [</span>
<span class="x">    &#39;index&#39; =&gt; &#39;pq&#39;,</span>
<span class="x">    &#39;body&#39; =&gt; [</span>
<span class="x">    ]</span>
<span class="x">];</span>
<span class="x">$response = $client-&gt;pq()-&gt;search($params);</span>
</code></pre></div>



<!-- response PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">(</span>
<span class="x">    [took] =&gt; 0</span>
<span class="x">    [timed_out] =&gt;</span>
<span class="x">    [hits] =&gt;</span>
<span class="x">        (</span>
<span class="x">            [total] =&gt; 2</span>
<span class="x">            [hits] =&gt;</span>
<span class="x">                (</span>
<span class="x">                    [0] =&gt;</span>
<span class="x">                        (</span>
<span class="x">                            [_id] =&gt; 1</span>
<span class="x">                            [_score] =&gt; 1</span>
<span class="x">                            [_source] =&gt;</span>
<span class="x">                                (</span>
<span class="x">                                    [query] =&gt;</span>
<span class="x">                                        (</span>
<span class="x">                                            [ql] =&gt; filter test</span>
<span class="x">                                        )</span>
<span class="x">                                    [tags] =&gt;</span>
<span class="x">                                    [filters] =&gt; gid&gt;=10</span>
<span class="x">                                )</span>
<span class="x">                        ),</span>
<span class="x">                    [1] =&gt;</span>
<span class="x">                        (</span>
<span class="x">                            [_id] =&gt; 1</span>
<span class="x">                            [_score] =&gt; 1</span>
<span class="x">                            [_source] =&gt;</span>
<span class="x">                                (</span>
<span class="x">                                    [query] =&gt;</span>
<span class="x">                                        (</span>
<span class="x">                                            [ql] =&gt; angry</span>
<span class="x">                                        )</span>
<span class="x">                                    [tags] =&gt;</span>
<span class="x">                                    [filters] =&gt; gid&gt;=10 OR gid&lt;=3</span>
<span class="x">                                )</span>
<span class="x">                        )</span>
<span class="x">                )</span>
<span class="x">        )</span>
<span class="x">)</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
Python
<!-- request Python -->


<div class="codehilite"><pre><span></span><code><span class="n">searchApi</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;pq&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="p">:{</span><span class="s2">&quot;match_all&quot;</span><span class="p">:{}}})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;2811025403043381501&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;gid&gt;=10&quot;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;filter test&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;&#39;</span><span class="p">}},</span>
                   <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;2811025403043381502&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;gid&gt;=10 OR gid&lt;=3&quot;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;angry&#39;</span><span class="p">,</span>
                                 <span class="sa">u</span><span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;&#39;</span><span class="p">}}],</span>
          <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
javascript
<!-- request javascript -->


<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="s2">&quot;pq&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;match_all&quot;</span><span class="o">:</span><span class="p">{}}});</span>
</code></pre></div>


<!-- response javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">u</span><span class="s1">&#39;_id&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">u</span><span class="s1">&#39;2811025403043381501&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">u</span><span class="s1">&#39;_score&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">u</span><span class="s1">&#39;_source&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">u</span><span class="s1">&#39;filters&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">u</span><span class="s2">&quot;gid&gt;=10&quot;</span><span class="p">,</span>
<span class="w">                                 </span><span class="nx">u</span><span class="s1">&#39;query&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">u</span><span class="s1">&#39;filter test&#39;</span><span class="p">,</span>
<span class="w">                                 </span><span class="nx">u</span><span class="s1">&#39;tags&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">u</span><span class="s1">&#39;&#39;</span><span class="p">}},</span>
<span class="w">                   </span><span class="p">{</span><span class="nx">u</span><span class="s1">&#39;_id&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">u</span><span class="s1">&#39;2811025403043381502&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">u</span><span class="s1">&#39;_score&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">u</span><span class="s1">&#39;_source&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">u</span><span class="s1">&#39;filters&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">u</span><span class="s2">&quot;gid&gt;=10 OR gid&lt;=3&quot;</span><span class="p">,</span>
<span class="w">                                 </span><span class="nx">u</span><span class="s1">&#39;query&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">u</span><span class="s1">&#39;angry&#39;</span><span class="p">,</span>
<span class="w">                                 </span><span class="nx">u</span><span class="s1">&#39;tags&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">u</span><span class="s1">&#39;&#39;</span><span class="p">}}],</span>
<span class="w">          </span><span class="s1">&#39;total&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">},</span>
<span class="w"> </span><span class="s1">&#39;profile&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">None</span><span class="p">,</span>
<span class="w"> </span><span class="s1">&#39;timed_out&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">False</span><span class="p">,</span>
<span class="w"> </span><span class="s1">&#39;took&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
javascript
<!-- request javascript -->


<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="s2">&quot;pq&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;match_all&quot;</span><span class="o">:</span><span class="p">{}}});</span>
</code></pre></div>


<!-- response javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;2811025403043381501&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">                    </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;filters&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">u</span><span class="s2">&quot;gid&gt;=10&quot;</span><span class="p">,</span>
<span class="w">                                 </span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;filter test&quot;</span><span class="p">,</span>
<span class="w">                                 </span><span class="s2">&quot;tags&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">}},</span>
<span class="w">                   </span><span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;2811025403043381502&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">                    </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;filters&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">u</span><span class="s2">&quot;gid&gt;=10 OR gid&lt;=3&quot;</span><span class="p">,</span>
<span class="w">                                 </span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;angry&quot;</span><span class="p">,</span>
<span class="w">                                 </span><span class="s2">&quot;tags&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">}}],</span>
<span class="w">          </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">},</span>
<span class="w">  </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w"> </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
java
<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">query</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;match_all&quot;</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
<span class="n">SearchRequest</span><span class="w"> </span><span class="n">searchRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SearchRequest</span><span class="p">();</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="s">&quot;pq&quot;</span><span class="p">);</span>
<span class="n">searchRequest</span><span class="p">.</span><span class="na">setQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">SearchResponse</span><span class="w"> </span><span class="n">searchResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">searchApi</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">searchRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response Java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">took</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">total</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="n">maxScore</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">        </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">2811045522851233962</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">filters</span><span class="o">=</span><span class="n">gid</span><span class="o">&gt;=</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="o">=</span><span class="n">filter</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">tags</span><span class="o">=</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mi">2811045522851233951</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">filters</span><span class="o">=</span><span class="n">gid</span><span class="o">&gt;=</span><span class="mi">10</span><span class="w"> </span><span class="n">OR</span><span class="w"> </span><span class="n">gid</span><span class="o">&lt;=</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="o">=</span><span class="n">angry</span><span class="p">,</span><span class="n">tags</span><span class="o">=</span><span class="p">}}</span><span class="o">]</span>
<span class="w">        </span><span class="n">aggregations</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">profile</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
C#
<!-- request C# -->


<div class="codehilite"><pre><span></span><code>object query =  new { match_all=null };
SearchRequest searchRequest = new SearchRequest(&quot;pq&quot;, query);
SearchResponse searchResponse = searchApi.Search(searchRequest);
</code></pre></div>


<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="n">class</span><span class="w"> </span><span class="n">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">took:</span><span class="w"> </span><span class="mh">0</span>
<span class="w">    </span><span class="nl">timedOut:</span><span class="w"> </span><span class="n">false</span>
<span class="w">    </span><span class="nl">hits:</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="n">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">total:</span><span class="w"> </span><span class="mh">2</span>
<span class="w">        </span><span class="nl">maxScore:</span><span class="w"> </span><span class="n">null</span>
<span class="w">        </span><span class="nl">hits:</span><span class="w"> </span><span class="p">[{</span><span class="n">_id</span><span class="o">=</span><span class="mh">2811045522851233962</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mh">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">filters</span><span class="o">=</span><span class="n">gid</span><span class="o">&gt;=</span><span class="mh">10</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="o">=</span><span class="n">filter</span><span class="w"> </span><span class="n">test</span><span class="p">,</span><span class="w"> </span><span class="n">tags</span><span class="o">=</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="o">=</span><span class="mh">2811045522851233951</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mh">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">filters</span><span class="o">=</span><span class="n">gid</span><span class="o">&gt;=</span><span class="mh">10</span><span class="w"> </span><span class="n">OR</span><span class="w"> </span><span class="n">gid</span><span class="o">&lt;=</span><span class="mh">3</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="o">=</span><span class="n">angry</span><span class="p">,</span><span class="n">tags</span><span class="o">=</span><span class="p">}}]</span>
<span class="w">        </span><span class="nl">aggregations:</span><span class="w"> </span><span class="n">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nl">profile:</span><span class="w"> </span><span class="n">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
TypeScript
<!-- request TypeScript -->


<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">search</span><span class="p">({</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="s2">&quot;test_pq&quot;</span><span class="p">,</span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;match_all&quot;</span><span class="o">:</span><span class="p">{}}});</span>
</code></pre></div>


<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s1">&#39;hits&#39;</span><span class="o">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="s1">&#39;hits&#39;</span><span class="o">:</span><span class="w"> </span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="s1">&#39;_id&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;2811025403043381501&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;_score&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;_source&#39;</span><span class="o">:</span><span class="w"> </span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s1">&#39;filters&#39;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;gid&gt;=10&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;query&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;filter test&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="s1">&#39;tags&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s1">&#39;_id&#39;</span><span class="o">:</span><span class="w"> </span>
<span class="w">            </span><span class="s1">&#39;2811025403043381502&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;_score&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;_source&#39;</span><span class="o">:</span><span class="w"> </span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s1">&#39;filters&#39;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;gid&gt;=10 OR gid&lt;=3&quot;</span><span class="p">,</span>
<span class="w">                 </span><span class="s1">&#39;query&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;angry&#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="s1">&#39;tags&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}],</span>
<span class="w">        </span><span class="s1">&#39;total&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s1">&#39;profile&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">None</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;timed_out&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">False</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;took&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
Go
<!-- request Go -->


<div class="codehilite"><pre><span></span><code><span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{}</span>
<span class="nx">percolateRequestQuery</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewPercolateRequestQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
<span class="nx">percolateRequest</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewPercolateRequest</span><span class="p">(</span><span class="nx">percolateRequestQuery</span><span class="p">)</span><span class="w"> </span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Percolate</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;test_pq&quot;</span><span class="p">).</span><span class="nx">PercolateRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">percolateRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>


<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="err">&#39;</span><span class="nx">hits</span><span class="err">&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="err">&#39;</span><span class="nx">hits</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span>
<span class="w">        </span><span class="p">[{</span>
<span class="w">            </span><span class="err">&#39;</span><span class="nx">_id</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="mi">2811025403043381501</span><span class="err">&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="err">&#39;</span><span class="nx">_score</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">            </span><span class="err">&#39;</span><span class="nx">_source</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="err">&#39;</span><span class="nx">filters</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;gid&gt;=10&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="err">&#39;</span><span class="nx">query</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">filter</span><span class="w"> </span><span class="nx">test</span><span class="err">&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="err">&#39;</span><span class="nx">tags</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;&#39;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="err">&#39;</span><span class="nx">_id</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span>
<span class="w">            </span><span class="err">&#39;</span><span class="mi">2811025403043381502</span><span class="err">&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="err">&#39;</span><span class="nx">_score</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">            </span><span class="err">&#39;</span><span class="nx">_source</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="err">&#39;</span><span class="nx">filters</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;gid&gt;=10 OR gid&lt;=3&quot;</span><span class="p">,</span>
<span class="w">                 </span><span class="err">&#39;</span><span class="nx">query</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">angry</span><span class="err">&#39;</span><span class="p">,</span>
<span class="w">                 </span><span class="err">&#39;</span><span class="nx">tags</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;&#39;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}],</span>
<span class="w">        </span><span class="err">&#39;</span><span class="nx">total</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="err">&#39;</span><span class="nx">profile</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="nx">None</span><span class="p">,</span>
<span class="w">    </span><span class="err">&#39;</span><span class="nx">timed_out</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="nx">False</span><span class="p">,</span>
<span class="w">    </span><span class="err">&#39;</span><span class="nx">took</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example call_pq_example -->

<p>And you execute <code>CALL PQ</code> on the distributed table with a couple of documents.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">CALL</span><span class="w"> </span><span class="n">PQ</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;pq_d2&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;{&quot;title&quot;:&quot;angry test&quot;, &quot;gid&quot;:3 }&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;title&quot;:&quot;filter test doc2&quot;, &quot;gid&quot;:13}&#39;</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">docs</span><span class="p">);</span>
</code></pre></div>



<!-- response sql -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">------+-----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">documents</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-----------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">         </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">         </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-----------+</span>
</code></pre></div>



<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/pq/pq/_search</span><span class="w"> </span><span class="mi">-</span><span class="err">d</span><span class="w"> </span><span class="err">&#39;</span>
<span class="nt">&quot;query&quot;</span><span class="p">:</span>
<span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;percolate&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;documents&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;angry test&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;gid&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">},</span>
<span class="w">                    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;filter test doc2&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;gid&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="p">}</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="p">}</span>
<span class="err">&#39;</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:{</span>
<span class="w">    </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="nt">&quot;hits&quot;</span><span class="p">:[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="s2">&quot;2&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_source&quot;</span><span class="p">:{</span>
<span class="w">                </span><span class="nt">&quot;query&quot;</span><span class="p">:{</span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;angry&quot;</span><span class="p">},</span>
<span class="w">                </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;filters&quot;</span><span class="p">:</span><span class="s2">&quot;gid&gt;=10 OR gid&lt;=3&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;_source&quot;</span><span class="p">:{</span>
<span class="w">                </span><span class="nt">&quot;query&quot;</span><span class="p">:{</span><span class="nt">&quot;ql&quot;</span><span class="p">:</span><span class="s2">&quot;filter test&quot;</span><span class="p">},</span>
<span class="w">                </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;filters&quot;</span><span class="p">:</span><span class="s2">&quot;gid&gt;=10&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- request PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">$params = [</span>
<span class="x">    &#39;index&#39; =&gt; &#39;pq&#39;,</span>
<span class="x">    &#39;body&#39; =&gt; [</span>
<span class="x">        &#39;query&#39; =&gt; [</span>
<span class="x">            &#39;percolate&#39; =&gt; [</span>
<span class="x">                &#39;documents&#39; =&gt; [</span>
<span class="x">                    [</span>
<span class="x">                        &#39;title&#39;=&gt;&#39;angry test&#39;,</span>
<span class="x">                        &#39;gid&#39; =&gt; 3</span>
<span class="x">                    ],</span>
<span class="x">                    [</span>
<span class="x">                        &#39;title&#39;=&gt;&#39;filter test doc2&#39;,</span>
<span class="x">                        &#39;gid&#39; =&gt; 13</span>
<span class="x">                    ],</span>
<span class="x">                ]</span>
<span class="x">            ]</span>
<span class="x">        ]</span>
<span class="x">    ]</span>
<span class="x">];</span>
<span class="x">$response = $client-&gt;pq()-&gt;search($params);</span>
</code></pre></div>



<!-- response PHP -->


<div class="codehilite"><pre><span></span><code><span class="x">(</span>
<span class="x">    [took] =&gt; 0</span>
<span class="x">    [timed_out] =&gt;</span>
<span class="x">    [hits] =&gt;</span>
<span class="x">        (</span>
<span class="x">            [total] =&gt; 2</span>
<span class="x">            [hits] =&gt;</span>
<span class="x">                (</span>
<span class="x">                    [0] =&gt;</span>
<span class="x">                        (</span>
<span class="x">                            [_index] =&gt; pq  </span>
<span class="x">                            [_type] =&gt; doc                            </span>
<span class="x">                            [_id] =&gt; 2</span>
<span class="x">                            [_score] =&gt; 1</span>
<span class="x">                            [_source] =&gt;</span>
<span class="x">                                (</span>
<span class="x">                                    [query] =&gt;</span>
<span class="x">                                        (</span>
<span class="x">                                            [ql] =&gt; angry</span>
<span class="x">                                        )</span>
<span class="x">                                    [tags] =&gt;</span>
<span class="x">                                    [filters] =&gt; gid&gt;=10 OR gid&lt;=3</span>
<span class="x">                                ),</span>
<span class="x">                           [fields] =&gt;</span>
<span class="x">                                (</span>
<span class="x">                                    [_percolator_document_slot] =&gt;</span>
<span class="x">                                        (</span>
<span class="x">                                            [0] =&gt; 1</span>
<span class="x">                                        )</span>

<span class="x">                                )</span>
<span class="x">                        ),</span>
<span class="x">                    [1] =&gt;</span>
<span class="x">                        (</span>
<span class="x">                            [_index] =&gt; pq                            </span>
<span class="x">                            [_id] =&gt; 1</span>
<span class="x">                            [_score] =&gt; 1</span>
<span class="x">                            [_source] =&gt;</span>
<span class="x">                                (</span>
<span class="x">                                    [query] =&gt;</span>
<span class="x">                                        (</span>
<span class="x">                                            [ql] =&gt; filter test</span>
<span class="x">                                        )</span>
<span class="x">                                    [tags] =&gt;</span>
<span class="x">                                    [filters] =&gt; gid&gt;=10</span>
<span class="x">                                )</span>
<span class="x">                           [fields] =&gt;</span>
<span class="x">                                (</span>
<span class="x">                                    [_percolator_document_slot] =&gt;</span>
<span class="x">                                        (</span>
<span class="x">                                            [0] =&gt; 0</span>
<span class="x">                                        )</span>

<span class="x">                                )</span>
<span class="x">                        )</span>
<span class="x">                )</span>
<span class="x">        )</span>
<span class="x">)</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
Python
<!-- request Python -->


<div class="codehilite"><pre><span></span><code><span class="n">searchApi</span><span class="o">.</span><span class="n">percolate</span><span class="p">(</span><span class="s1">&#39;pq&#39;</span><span class="p">,{</span><span class="s2">&quot;percolate&quot;</span><span class="p">:{</span><span class="s2">&quot;documents&quot;</span><span class="p">:[{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;angry test&quot;</span><span class="p">,</span><span class="s2">&quot;gid&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">},{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;filter test doc2&quot;</span><span class="p">,</span><span class="s2">&quot;gid&quot;</span><span class="p">:</span><span class="mi">13</span><span class="p">}]}})</span>
</code></pre></div>


<!-- response Python -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;2811025403043381480&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_index&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;pq&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;ql&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;angry&#39;</span><span class="p">},</span><span class="sa">u</span><span class="s1">&#39;tags&#39;</span><span class="p">:</span><span class="sa">u</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;filters&#39;</span><span class="p">:</span><span class="sa">u</span><span class="s2">&quot;gid&gt;=10 OR gid&lt;=3&quot;</span><span class="p">},</span>
                    <span class="sa">u</span><span class="s1">&#39;_type&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;doc&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_percolator_document_slot&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]}},</span>
                    <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;2811025403043381501&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_index&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;pq&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_score&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;_source&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;ql&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;filter test&#39;</span><span class="p">},</span><span class="sa">u</span><span class="s1">&#39;tags&#39;</span><span class="p">:</span><span class="sa">u</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;filters&#39;</span><span class="p">:</span><span class="sa">u</span><span class="s2">&quot;gid&gt;=10&quot;</span><span class="p">},</span>
                    <span class="sa">u</span><span class="s1">&#39;_type&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;doc&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;_percolator_document_slot&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]}}],</span>
          <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
 <span class="s1">&#39;profile&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
 <span class="s1">&#39;timed_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
 <span class="s1">&#39;took&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
javascript
<!-- request javascript -->


<div class="codehilite"><pre><span></span><code><span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">percolate</span><span class="p">(</span><span class="s1">&#39;pq&#39;</span><span class="p">,{</span><span class="s2">&quot;percolate&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;documents&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;angry test&quot;</span><span class="p">,</span><span class="s2">&quot;gid&quot;</span><span class="o">:</span><span class="mf">3</span><span class="p">},{</span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;filter test doc2&quot;</span><span class="p">,</span><span class="s2">&quot;gid&quot;</span><span class="o">:</span><span class="mf">13</span><span class="p">}]}});</span>
</code></pre></div>


<!-- response javascript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;hits&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">u</span><span class="s1">&#39;_id&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">u</span><span class="s1">&#39;2811025403043381480&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">u</span><span class="s1">&#39;_index&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">u</span><span class="s1">&#39;pq&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">u</span><span class="s1">&#39;_score&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">u</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">u</span><span class="s1">&#39;_source&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">u</span><span class="s1">&#39;query&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">u</span><span class="s1">&#39;ql&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">u</span><span class="s1">&#39;angry&#39;</span><span class="p">},</span><span class="nx">u</span><span class="s1">&#39;tags&#39;</span><span class="o">:</span><span class="nx">u</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="nx">u</span><span class="s1">&#39;filters&#39;</span><span class="o">:</span><span class="nx">u</span><span class="s2">&quot;gid&gt;=10 OR gid&lt;=3&quot;</span><span class="p">},</span>
<span class="w">                    </span><span class="nx">u</span><span class="s1">&#39;_type&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">u</span><span class="s1">&#39;doc&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">u</span><span class="s1">&#39;fields&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">u</span><span class="s1">&#39;_percolator_document_slot&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">]}},</span>
<span class="w">                    </span><span class="p">{</span><span class="nx">u</span><span class="s1">&#39;_id&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">u</span><span class="s1">&#39;2811025403043381501&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">u</span><span class="s1">&#39;_index&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">u</span><span class="s1">&#39;pq&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">u</span><span class="s1">&#39;_score&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">u</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">u</span><span class="s1">&#39;_source&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">u</span><span class="s1">&#39;query&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">u</span><span class="s1">&#39;ql&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">u</span><span class="s1">&#39;filter test&#39;</span><span class="p">},</span><span class="nx">u</span><span class="s1">&#39;tags&#39;</span><span class="o">:</span><span class="nx">u</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="nx">u</span><span class="s1">&#39;filters&#39;</span><span class="o">:</span><span class="nx">u</span><span class="s2">&quot;gid&gt;=10&quot;</span><span class="p">},</span>
<span class="w">                    </span><span class="nx">u</span><span class="s1">&#39;_type&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">u</span><span class="s1">&#39;doc&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">u</span><span class="s1">&#39;fields&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">u</span><span class="s1">&#39;_percolator_document_slot&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">]}}],</span>
<span class="w">          </span><span class="s1">&#39;total&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">},</span>
<span class="w"> </span><span class="s1">&#39;profile&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">None</span><span class="p">,</span>
<span class="w"> </span><span class="s1">&#39;timed_out&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">False</span><span class="p">,</span>
<span class="w"> </span><span class="s1">&#39;took&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">}</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
java
<!-- request Java -->


<div class="codehilite"><pre><span></span><code><span class="n">percolateRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PercolateRequest</span><span class="p">();</span>
<span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">    </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;percolate&quot;</span><span class="p">,</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">        </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;documents&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">            </span><span class="n">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">                </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span><span class="s">&quot;angry test&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;gid&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="w">            </span><span class="p">}});</span>
<span class="w">            </span><span class="n">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(){{</span>
<span class="w">                </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span><span class="s">&quot;filter test doc2&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="n">put</span><span class="p">(</span><span class="s">&quot;gid&quot;</span><span class="p">,</span><span class="mi">13</span><span class="p">);</span>
<span class="w">            </span><span class="p">}});</span>
<span class="w">        </span><span class="p">}});</span>
<span class="w">    </span><span class="p">}});</span>
<span class="p">}};</span>
<span class="n">percolateRequest</span><span class="p">.</span><span class="na">query</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="n">searchApi</span><span class="p">.</span><span class="na">percolate</span><span class="p">(</span><span class="s">&quot;pq&quot;</span><span class="p">,</span><span class="n">percolateRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response java -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">took</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="n">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">total</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="n">maxScore</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="n">hits</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="p">{</span><span class="n">_index</span><span class="o">=</span><span class="n">pq</span><span class="p">,</span><span class="w"> </span><span class="n">_type</span><span class="o">=</span><span class="n">doc</span><span class="p">,</span><span class="w"> </span><span class="n">_id</span><span class="o">=</span><span class="mi">2811045522851234165</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="n">ql</span><span class="o">=</span><span class="nd">@title</span><span class="w"> </span><span class="n">angry</span><span class="p">}},</span><span class="w"> </span><span class="n">fields</span><span class="o">=</span><span class="p">{</span><span class="n">_percolator_document_slot</span><span class="o">=[</span><span class="mi">1</span><span class="o">]</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="n">_index</span><span class="o">=</span><span class="n">pq</span><span class="p">,</span><span class="w"> </span><span class="n">_type</span><span class="o">=</span><span class="n">doc</span><span class="p">,</span><span class="w"> </span><span class="n">_id</span><span class="o">=</span><span class="mi">2811045522851234166</span><span class="p">,</span><span class="w"> </span><span class="n">_score</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">_source</span><span class="o">=</span><span class="p">{</span><span class="n">query</span><span class="o">=</span><span class="p">{</span><span class="n">ql</span><span class="o">=</span><span class="nd">@title</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">doc2</span><span class="p">}},</span><span class="w"> </span><span class="n">fields</span><span class="o">=</span><span class="p">{</span><span class="n">_percolator_document_slot</span><span class="o">=[</span><span class="mi">2</span><span class="o">]</span><span class="p">}}</span><span class="o">]</span>
<span class="w">        </span><span class="n">aggregations</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">profile</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
C#
<!-- request C# -->


<div class="codehilite"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">doc1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">doc1</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span><span class="s2">&quot;angry test&quot;</span><span class="p">);</span>
<span class="n">doc1</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;gid&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">doc2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">doc2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span><span class="s2">&quot;filter test doc2&quot;</span><span class="p">);</span>
<span class="n">doc2</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">&quot;gid&quot;</span><span class="p">,</span><span class="mi">13</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">docs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="n">doc1</span><span class="p">,</span><span class="w"> </span><span class="n">doc2</span><span class="p">};</span>
<span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">percolateDoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{{</span><span class="w"> </span><span class="s2">&quot;documents&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">docs</span><span class="w"> </span><span class="p">}};</span><span class="w"> </span>
<span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{{</span><span class="w"> </span><span class="s2">&quot;percolate&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">percolateDoc</span><span class="w"> </span><span class="p">}};</span><span class="w"> </span>
<span class="n">PercolateRequest</span><span class="w"> </span><span class="n">percolateRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">PercolateRequest</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">);</span>
<span class="n">searchApi</span><span class="o">.</span><span class="n">Percolate</span><span class="p">(</span><span class="s2">&quot;pq&quot;</span><span class="p">,</span><span class="n">percolateRequest</span><span class="p">);</span>
</code></pre></div>


<!-- response C# -->

<div class="codehilite"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nx">SearchResponse</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">took</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="nx">timedOut</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="nx">hits</span><span class="p">:</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">SearchResponseHits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">total</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="nx">maxScore</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="nx">hits</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nx">_index</span><span class="p">=</span><span class="nx">pq</span><span class="p">,</span><span class="w"> </span><span class="nx">_type</span><span class="p">=</span><span class="nx">doc</span><span class="p">,</span><span class="w"> </span><span class="nx">_id</span><span class="p">=</span><span class="mi">2811045522851234165</span><span class="p">,</span><span class="w"> </span><span class="nx">_score</span><span class="p">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nx">_source</span><span class="p">={</span><span class="nx">query</span><span class="p">={</span><span class="nx">ql</span><span class="p">=</span><span class="err">@</span><span class="nx">title</span><span class="w"> </span><span class="nx">angry</span><span class="p">}},</span><span class="w"> </span><span class="nx">fields</span><span class="p">={</span><span class="nx">_percolator_document_slot</span><span class="p">=[</span><span class="mi">1</span><span class="p">]}},</span><span class="w"> </span><span class="p">{</span><span class="nx">_index</span><span class="p">=</span><span class="nx">pq</span><span class="p">,</span><span class="w"> </span><span class="nx">_type</span><span class="p">=</span><span class="nx">doc</span><span class="p">,</span><span class="w"> </span><span class="nx">_id</span><span class="p">=</span><span class="mi">2811045522851234166</span><span class="p">,</span><span class="w"> </span><span class="nx">_score</span><span class="p">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nx">_source</span><span class="p">={</span><span class="nx">query</span><span class="p">={</span><span class="nx">ql</span><span class="p">=</span><span class="err">@</span><span class="nx">title</span><span class="w"> </span><span class="nx">filter</span><span class="w"> </span><span class="nx">test</span><span class="w"> </span><span class="nx">doc2</span><span class="p">}},</span><span class="w"> </span><span class="nx">fields</span><span class="p">={</span><span class="nx">_percolator_document_slot</span><span class="p">=[</span><span class="mi">2</span><span class="p">]}}]</span>
<span class="w">        </span><span class="nx">aggregations</span><span class="p">:</span><span class="w"> </span><span class="nx">null</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">profile</span><span class="p">:</span><span class="w"> </span><span class="nx">null</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
TypeScript
<!-- request TypeScript -->


<div class="codehilite"><pre><span></span><code><span class="nx">docs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="nx">title</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;What a nice bag&#39;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nx">title</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Really nice shoes&#39;</span><span class="p">}</span><span class="w"> </span><span class="p">];</span><span class="w"> </span>
<span class="nx">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">searchApi</span><span class="p">.</span><span class="nx">percolate</span><span class="p">(</span><span class="s1">&#39;test_pq&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">percolate</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">documents</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">docs</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>


<!-- response TypeScript -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;took&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;timed_out&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;total&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;hits&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test_pq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1657852401006149661&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;ql&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;@title bag&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;_percolator_document_slot&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mf">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;_index&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test_pq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1657852401006149662&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_score&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;_source&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s2">&quot;ql&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;@title shoes&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s2">&quot;_percolator_document_slot&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mf">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>
Go
<!-- request Go -->


<div class="codehilite"><pre><span></span><code><span class="nx">doc1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;What a nice bag&quot;</span><span class="p">}</span>
<span class="nx">doc2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Really nice shoes&quot;</span><span class="p">}</span>
<span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span><span class="nx">doc1</span><span class="p">,</span><span class="w"> </span><span class="nx">doc2</span><span class="p">}</span>
<span class="nx">percolateRequestQuery</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewPercolateQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
<span class="nx">percolateRequest</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">manticoreclient</span><span class="p">.</span><span class="nx">NewPercolateRequest</span><span class="p">(</span><span class="nx">percolateRequestQuery</span><span class="p">)</span>
<span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">apiClient</span><span class="p">.</span><span class="nx">SearchAPI</span><span class="p">.</span><span class="nx">Percolate</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;test_pq&quot;</span><span class="p">).</span><span class="nx">PercolateRequest</span><span class="p">(</span><span class="o">*</span><span class="nx">percolateRequest</span><span class="p">).</span><span class="nx">Execute</span><span class="p">()</span>
</code></pre></div>


<!-- response Go -->

<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s">&quot;took&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;timed_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="s">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;hits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;test_pq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1657852401006149661&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;ql&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;@title bag&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;_percolator_document_slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mi">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;test_pq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;doc&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1657852401006149662&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_score&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;ql&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;@title shoes&quot;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="s">&quot;_percolator_document_slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="mi">1</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<p>In the previous example, we used the default <strong>sparse</strong> mode. To demonstrate the <strong>sharded</strong> mode, let's create a distributed PQ table consisting of 2 local PQ tables and add 2 documents to "products1" and 1 document to "products2":</p>
<div class="codehilite"><pre><span></span><code><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">products1</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;pq&#39;</span><span class="p">;</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">products2</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;pq&#39;</span><span class="p">;</span>
<span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">products_distributed</span><span class="w"> </span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;distributed&#39;</span><span class="w"> </span><span class="k">local</span><span class="o">=</span><span class="s1">&#39;products1&#39;</span><span class="w"> </span><span class="k">local</span><span class="o">=</span><span class="s1">&#39;products2&#39;</span><span class="p">;</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">products1</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="s1">&#39;@title bag&#39;</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">products1</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="n">filters</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="s1">&#39;@title shoes&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;color=\&#39;</span><span class="n">red</span><span class="err">\</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">products2</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="n">filters</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="s1">&#39;@title shoes&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;color in (\&#39;</span><span class="n">blue</span><span class="err">\</span><span class="s1">&#39;, \&#39;</span><span class="n">green</span><span class="err">\</span><span class="s1">&#39;)&#39;</span><span class="p">);</span>
</code></pre></div>

<!-- example sharded -->
<p>Now, if you add <code>'sharded' as mode</code> to <code>CALL PQ</code>, it will send the documents to all the agent's tables (in this case, just local tables, but they can be remote to utilize external hardware). This mode is not available via the JSON interface.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>
SQL:
<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">CALL</span><span class="w"> </span><span class="n">PQ</span><span class="p">(</span><span class="s1">&#39;products_distributed&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;{&quot;title&quot;: &quot;nice pair of shoes&quot;, &quot;color&quot;: &quot;blue&quot;}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;title&quot;: &quot;beautiful bag&quot;}&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;sharded&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">mode</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">query</span><span class="p">);</span>
</code></pre></div>


<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">---------------------+--------------+------+---------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">query</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">tags</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filters</span><span class="w">                   </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+--------------+------+---------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657852401006149639</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">@</span><span class="n">title</span><span class="w"> </span><span class="n">bag</span><span class="w">   </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w">                           </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657852401006149643</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">@</span><span class="n">title</span><span class="w"> </span><span class="n">shoes</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;blue, &#39;</span><span class="n">green</span><span class="err">&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+--------------+------+---------------------------+</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<p>Note that the syntax of agent mirrors in the configuration (when several hosts are assigned to one <code>agent</code> line, separated with <code>|</code>) has nothing to do with the <code>CALL PQ</code> query mode. Each <code>agent</code> always represents <strong>one</strong> node, regardless of the number of HA mirrors specified for that agent.</p>
<!-- example verbose -->

<div class='item-select'>
How can I learn more about performance?
</div>
<p>In some cases, you might want to get more details about the performance of a percolate query. For that purpose, there is the option <code>1 as verbose</code>, which is only available via SQL and allows you to save more performance metrics. You can see them using the <code>SHOW META</code> query, which you can run after <code>CALL PQ</code>. See <a href="../19-node_info_and_management.html#toc-19.02-show_meta">SHOW META</a> for more info.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>
1 as verbose:
<!-- request 1 as verbose -->


<div class="codehilite"><pre><span></span><code><span class="k">CALL</span><span class="w"> </span><span class="n">PQ</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;{&quot;title&quot;: &quot;nice pair of shoes&quot;, &quot;color&quot;: &quot;blue&quot;}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;title&quot;: &quot;beautiful bag&quot;}&#39;</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">verbose</span><span class="p">);</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="n">meta</span><span class="p">;</span>
</code></pre></div>


<!-- response 1 as verbose -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657852401006149644</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657852401006149646</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">+</span><span class="c1">-------------------------+-----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Name</span><span class="w">                    </span><span class="o">|</span><span class="w"> </span><span class="n">Value</span><span class="w">     </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------------------+-----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Total</span><span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">000</span><span class="w"> </span><span class="n">sec</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Setup</span><span class="w">                   </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">000</span><span class="w"> </span><span class="n">sec</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Queries</span><span class="w"> </span><span class="n">matched</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Queries</span><span class="w"> </span><span class="n">failed</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="w">         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Document</span><span class="w"> </span><span class="n">matched</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">queries</span><span class="w"> </span><span class="n">stored</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="w">         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Term</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">queries</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="w">         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Fast</span><span class="w"> </span><span class="n">rejected</span><span class="w"> </span><span class="n">queries</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="w">         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="k">Time</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">query</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="mi">27</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="k">Time</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">matched</span><span class="w"> </span><span class="n">queries</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">37</span><span class="w">        </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------------------+-----------+</span>
</code></pre></div>


<!-- intro -->

</div>

<div class='xcodeblock-item'>
0 as verbose (default):
<!-- request 0 as verbose -->


<div class="codehilite"><pre><span></span><code><span class="k">CALL</span><span class="w"> </span><span class="n">PQ</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;{&quot;title&quot;: &quot;nice pair of shoes&quot;, &quot;color&quot;: &quot;blue&quot;}&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;title&quot;: &quot;beautiful bag&quot;}&#39;</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">verbose</span><span class="p">);</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="n">meta</span><span class="p">;</span>
</code></pre></div>


<!-- response 0 as verbose -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657852401006149644</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1657852401006149646</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------+</span>
<span class="o">+</span><span class="c1">-----------------------+-----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Name</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">Value</span><span class="w">     </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-----------------------+-----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Total</span><span class="w">                 </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">000</span><span class="w"> </span><span class="n">sec</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Queries</span><span class="w"> </span><span class="n">matched</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Queries</span><span class="w"> </span><span class="n">failed</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="w">         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Document</span><span class="w"> </span><span class="n">matched</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="n">queries</span><span class="w"> </span><span class="n">stored</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="w">         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Term</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">queries</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="w">         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Fast</span><span class="w"> </span><span class="n">rejected</span><span class="w"> </span><span class="n">queries</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="w">         </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-----------------------+-----------+</span>
</code></pre></div>


<!-- end -->

</div>

</div>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.17-autocomplete">
        <header>
            <a class="chapter-link" href="#toc-13.17-autocomplete"> ¶ 13.17</a>

            
            <h1 id="autocomplete">Autocomplete</h1>
            
        </header>

        
        
<p>Autocomplete (or word completion) is a feature in which an application predicts the rest of a word a user is typing. On websites, it's used in search boxes, where a user starts to type a word, and a dropdown with suggestions pops up so the user can select the ending from the list.</p>
<p><img alt="Autocomplete" src="autocomplete.png" /></p>
<p>There are a few ways you can do autocomplete in Manticore:</p>
<h5 id="autocomplete-a-sentence">Autocomplete a sentence</h5>
<p>To autocomplete a sentence, you can use <a href="../06-creating_a_table.html#min_infix_len">infixed search</a>. You can find endings of a document's field by providing its beginning and:</p>
<ul>
<li>using <a href="../13-searching.html#toc-13.02.02-operators">full-text operators</a> <code>*</code> to match anything it substitutes</li>
<li>and optionally <code>^</code> to start from the beginning of the field</li>
<li>and perhaps <code>""</code> for phrase matching</li>
<li>and optionally <a href="../13-searching.html#toc-13.07-highlighting">highlight the results</a> so you don't have to fetch them in full to your application</li>
</ul>
<p>There is an <a href="https://manticoresearch.com/2020/03/31/simple-autocomplete-with-manticore/">article about it in our blog</a> and an <a href="../13-searching.html#interactive-course">interactive course</a>. A quick example is:</p>
<ul>
<li>Let's assume you have a document: <code>My cat loves my dog. The cat (Felis catus) is a domestic species of small carnivorous mammal.</code></li>
<li>Then you can use <code>^</code>, <code>""</code>, and <code>*</code> so as the user is typing, you make queries like: <code>^"m*"</code>, <code>^"my *"</code>, <code>^"my c*"</code>, <code>^"my ca*"</code> and so on</li>
<li>It will find the document, and if you also do <a href="../13-searching.html#toc-13.07-highlighting">highlighting</a>, you will get something like: <code>&lt;b&gt;My cat&lt;/b&gt; loves my dog. The cat ( ...</code></li>
</ul>
<h5 id="autocomplete-a-word">Autocomplete a word</h5>
<p>In some cases, all you need is to autocomplete a single word or a couple of words. In this case, you can use <code>CALL KEYWORDS</code>.</p>
<h3 id="call-keywords">CALL KEYWORDS</h3>
<p><code>CALL KEYWORDS</code> is available through the SQL interface and offers a way to examine how keywords are tokenized or to obtain the tokenized forms of specific keywords. If the table enables <a href="../06-creating_a_table.html#min_infix_len">infixes</a>, it allows you to quickly find possible endings for given keywords, making it suitable for autocomplete functionality.</p>
<p>This is a great alternative to general infixed search, as it provides higher performance since it only needs the table's dictionary, not the documents themselves.</p>
<h3 id="general-syntax">General syntax</h3>
<!-- example keywords -->

<div class="codehilite"><pre><span></span><code><span class="k">CALL</span><span class="w"> </span><span class="n">KEYWORDS</span><span class="p">(</span><span class="nb">text</span><span class="p">,</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="p">[,</span><span class="w"> </span><span class="k">options</span><span class="p">])</span>
</code></pre></div>

<p>The <code>CALL KEYWORDS</code> statement divides text into keywords. It returns the tokenized and normalized forms of the keywords, and if desired, keyword statistics. Additionally, it provides the position of each keyword in the query and all forms of tokenized keywords when the table enables <a href="../06-creating_a_table.html#toc-06.03.09-morphology">lemmatizers</a>.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>text</td>
<td>Text to break down to keywords</td>
</tr>
<tr>
<td>table</td>
<td>Name of the table from which to take the text processing settings</td>
</tr>
<tr>
<td>0/1 as stats</td>
<td>Show statistics of keywords, default is 0</td>
</tr>
<tr>
<td>0/1 as fold_wildcards</td>
<td>Fold wildcards, default is 0</td>
</tr>
<tr>
<td>0/1 as fold_lemmas</td>
<td>Fold morphological lemmas, default is 0</td>
</tr>
<tr>
<td>0/1 as fold_blended</td>
<td>Fold blended words, default is 0</td>
</tr>
<tr>
<td>N as expansion_limit</td>
<td>Override <a href="../06-creating_a_table.html#expansion_limit">expansion_limit</a> defined in the server configuration, default is 0 (use value from the configuration)</td>
</tr>
<tr>
<td>docs/hits as sort_mode</td>
<td>Sort output results by either 'docs' or 'hits'. Default no sorting</td>
</tr>
</tbody>
</table>
<p>The examples show how it works if assuming the user is trying to get an autocomplete for "my cat ...". So on the application side all you need to do is to suggest the user the endings from the column "normalized" for each new word. It often makes sense to sort by hits or docs using <code>'hits' as sort_mode</code> or <code>'docs' as sort_mode</code>.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
Examples
</div>

<!-- request Examples -->


<div class="codehilite"><pre><span></span><code><span class="n">MySQL</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">CALL</span><span class="w"> </span><span class="n">KEYWORDS</span><span class="p">(</span><span class="s1">&#39;m*&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">stats</span><span class="p">);</span>
<span class="o">+</span><span class="c1">------+-----------+------------+------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">qpos</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">tokenized</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">normalized</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">docs</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">hits</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-----------+------------+------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">m</span><span class="o">*</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">my</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">m</span><span class="o">*</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">mammal</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-----------+------------+------+------+</span>

<span class="n">MySQL</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">CALL</span><span class="w"> </span><span class="n">KEYWORDS</span><span class="p">(</span><span class="s1">&#39;my*&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">stats</span><span class="p">);</span>
<span class="o">+</span><span class="c1">------+-----------+------------+------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">qpos</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">tokenized</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">normalized</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">docs</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">hits</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-----------+------------+------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">my</span><span class="o">*</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">my</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-----------+------------+------+------+</span>

<span class="n">MySQL</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">CALL</span><span class="w"> </span><span class="n">KEYWORDS</span><span class="p">(</span><span class="s1">&#39;c*&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">stats</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;hits&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sort_mode</span><span class="p">);</span>
<span class="o">+</span><span class="c1">------+-----------+-------------+------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">qpos</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">tokenized</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">normalized</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">docs</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">hits</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-----------+-------------+------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">c</span><span class="o">*</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">cat</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">c</span><span class="o">*</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">carnivorous</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">c</span><span class="o">*</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">catus</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-----------+-------------+------+------+</span>

<span class="n">MySQL</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">CALL</span><span class="w"> </span><span class="n">KEYWORDS</span><span class="p">(</span><span class="s1">&#39;ca*&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">stats</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;hits&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sort_mode</span><span class="p">);</span>
<span class="o">+</span><span class="c1">------+-----------+-------------+------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">qpos</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">tokenized</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">normalized</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">docs</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">hits</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-----------+-------------+------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ca</span><span class="o">*</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">cat</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ca</span><span class="o">*</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">carnivorous</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ca</span><span class="o">*</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">catus</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-----------+-------------+------+------+</span>

<span class="n">MySQL</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">CALL</span><span class="w"> </span><span class="n">KEYWORDS</span><span class="p">(</span><span class="s1">&#39;cat*&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">stats</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;hits&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sort_mode</span><span class="p">);</span>
<span class="o">+</span><span class="c1">------+-----------+------------+------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">qpos</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">tokenized</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">normalized</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">docs</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">hits</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-----------+------------+------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">cat</span><span class="o">*</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">cat</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">cat</span><span class="o">*</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">catus</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-----------+------------+------+------+</span>
</code></pre></div>


<!-- end -->

</div>

</div>
<!-- example bigram -->
<p>There is a nice trick how you can improve the above algorithm - use <a href="../06-creating_a_table.html#bigram_index">bigram_index</a>. When you have it enabled for the table what you get in it is not just a single word, but each pair of words standing one after another indexed as a separate token.</p>
<p>This allows to predict not just the current word's ending, but the next word too which is especially beneficial for the purpose of autocomplete.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
Examples
</div>

<!-- request Examples -->


<div class="codehilite"><pre><span></span><code><span class="n">MySQL</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">CALL</span><span class="w"> </span><span class="n">KEYWORDS</span><span class="p">(</span><span class="s1">&#39;m*&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">stats</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;hits&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sort_mode</span><span class="p">);</span>
<span class="o">+</span><span class="c1">------+-----------+------------+------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">qpos</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">tokenized</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">normalized</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">docs</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">hits</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-----------+------------+------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">m</span><span class="o">*</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">my</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">m</span><span class="o">*</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">mammal</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">m</span><span class="o">*</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">my</span><span class="w"> </span><span class="n">cat</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">m</span><span class="o">*</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">my</span><span class="w"> </span><span class="n">dog</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-----------+------------+------+------+</span>

<span class="n">MySQL</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">CALL</span><span class="w"> </span><span class="n">KEYWORDS</span><span class="p">(</span><span class="s1">&#39;my*&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">stats</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;hits&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sort_mode</span><span class="p">);</span>
<span class="o">+</span><span class="c1">------+-----------+------------+------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">qpos</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">tokenized</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">normalized</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">docs</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">hits</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-----------+------------+------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">my</span><span class="o">*</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">my</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">my</span><span class="o">*</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">my</span><span class="w"> </span><span class="n">cat</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">my</span><span class="o">*</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">my</span><span class="w"> </span><span class="n">dog</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-----------+------------+------+------+</span>

<span class="n">MySQL</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">CALL</span><span class="w"> </span><span class="n">KEYWORDS</span><span class="p">(</span><span class="s1">&#39;c*&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">stats</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;hits&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sort_mode</span><span class="p">);</span>
<span class="o">+</span><span class="c1">------+-----------+--------------------+------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">qpos</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">tokenized</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">normalized</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">docs</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">hits</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-----------+--------------------+------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">c</span><span class="o">*</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">cat</span><span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">c</span><span class="o">*</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">carnivorous</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">c</span><span class="o">*</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">carnivorous</span><span class="w"> </span><span class="n">mammal</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">c</span><span class="o">*</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">felis</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">c</span><span class="o">*</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">loves</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">c</span><span class="o">*</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">catus</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">c</span><span class="o">*</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">catus</span><span class="w"> </span><span class="k">is</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-----------+--------------------+------+------+</span>

<span class="n">MySQL</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">CALL</span><span class="w"> </span><span class="n">KEYWORDS</span><span class="p">(</span><span class="s1">&#39;ca*&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">stats</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;hits&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sort_mode</span><span class="p">);</span>
<span class="o">+</span><span class="c1">------+-----------+--------------------+------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">qpos</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">tokenized</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">normalized</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="n">docs</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">hits</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-----------+--------------------+------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ca</span><span class="o">*</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">cat</span><span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ca</span><span class="o">*</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">carnivorous</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ca</span><span class="o">*</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">carnivorous</span><span class="w"> </span><span class="n">mammal</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ca</span><span class="o">*</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">felis</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ca</span><span class="o">*</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">loves</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ca</span><span class="o">*</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">catus</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ca</span><span class="o">*</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">catus</span><span class="w"> </span><span class="k">is</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-----------+--------------------+------+------+</span>

<span class="n">MySQL</span><span class="w"> </span><span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">CALL</span><span class="w"> </span><span class="n">KEYWORDS</span><span class="p">(</span><span class="s1">&#39;cat*&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">stats</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;hits&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sort_mode</span><span class="p">);</span>
<span class="o">+</span><span class="c1">------+-----------+------------+------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">qpos</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">tokenized</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">normalized</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">docs</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">hits</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-----------+------------+------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">cat</span><span class="o">*</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">cat</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">cat</span><span class="o">*</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">felis</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">cat</span><span class="o">*</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">loves</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">cat</span><span class="o">*</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">catus</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">cat</span><span class="o">*</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">catus</span><span class="w"> </span><span class="k">is</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+-----------+------------+------+------+</span>
</code></pre></div>


<!-- end -->

</div>

</div>

<p><code>CALL KEYWORDS</code> supports distributed tables so no matter how big your data set you can benefit from using it.</p>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.18-spell_correction">
        <header>
            <a class="chapter-link" href="#toc-13.18-spell_correction"> ¶ 13.18</a>

            
            <h1 id="spell-correction">Spell correction</h1>
            
        </header>

        
        
<p>Spell correction, also known as:</p>
<ul>
<li>Auto correction</li>
<li>Text correction</li>
<li>Fixing spelling errors</li>
<li>Typo tolerance</li>
<li>"Did you mean?"</li>
</ul>
<p>and so on, is a software functionality that suggests alternatives to or makes automatic corrections of the text you have typed in. The concept of correcting typed text dates back to the 1960s when computer scientist Warren Teitelman, who also invented the "undo" command, introduced a philosophy of computing called D.W.I.M., or "Do What I Mean." Instead of programming computers to accept only perfectly formatted instructions, Teitelman argued that they should be programmed to recognize obvious mistakes.</p>
<p>The first well-known product to provide spell correction functionality was Microsoft Word 6.0, released in 1993.</p>
<h3 id="how-it-works">How it works</h3>
<p>There are a few ways spell correction can be done, but it's important to note that there is no purely programmatic way to convert your mistyped "ipone" into "iphone" with decent quality. Mostly, there has to be a dataset the system is based on. The dataset can be:</p>
<ul>
<li>A dictionary of properly spelled words, which in turn can be:</li>
<li>Based on your real data. The idea here is that, for the most part, the spelling in the dictionary made up of your data is correct, and the system tries to find a word that is most similar to the typed word (we'll discuss how this can be done with Manticore shortly).</li>
<li>Or it can be based on an external dictionary unrelated to your data. The issue that may arise here is that your data and the external dictionary can be too different: some words may be missing in the dictionary, while others may be missing in your data.</li>
<li>Not just dictionary-based, but also context-aware, e.g., "white ber" would be corrected to "white bear," while "dark ber" would be corrected to "dark beer." The context might not just be a neighboring word in your query, but also your location, time of day, the current sentence's grammar (to change "there" to "their" or not), your search history, and virtually any other factors that can affect your intent.</li>
<li>Another classic approach is to use previous search queries as the dataset for spell correction. This is even more utilized in <a href="../13-searching.html#toc-13.17-autocomplete">autocomplete</a> functionality but makes sense for autocorrect too. The idea is that users are mostly right with spelling, so we can use words from their search history as a source of truth, even if we don't have the words in our documents or use an external dictionary. Context-awareness is also possible here.</li>
</ul>
<p>Manticore provides the commands <code>CALL QSUGGEST</code> and <code>CALL SUGGEST</code> that can be used for automatic spell correction purposes.</p>
<h3 id="call-qsuggest-call-suggest">CALL QSUGGEST, CALL SUGGEST</h3>
<p>Both commands are available via SQL only, and the general syntax is:</p>
<div class="codehilite"><pre><span></span><code><span class="k">CALL</span><span class="w"> </span><span class="n">QSUGGEST</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="p">[,</span><span class="k">options</span><span class="p">])</span>
<span class="k">CALL</span><span class="w"> </span><span class="n">SUGGEST</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="p">[,</span><span class="k">options</span><span class="p">])</span>

<span class="k">options</span><span class="p">:</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">option_name</span><span class="p">[,</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">another_option</span><span class="p">,</span><span class="w"> </span><span class="p">...]</span>
</code></pre></div>

<p>These commands provide all suggestions from the dictionary for a given word. They work only on tables with <a href="../06-creating_a_table.html#min_infix_len">infixing</a> enabled and <a href="../06-creating_a_table.html#dict">dict=keywords</a>. They return the suggested keywords, Levenshtein distance between the suggested and original keywords, and the document statistics of the suggested keyword.</p>
<p>If the first parameter contains multiple words, then:</p>
<ul>
<li><code>CALL QSUGGEST</code> will return suggestions only for the <strong>last</strong> word, ignoring the rest.</li>
<li><code>CALL SUGGEST</code> will return suggestions only for the <strong>first</strong> word.</li>
</ul>
<p>That's the only difference between them. Several options are supported for customization:</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>limit</td>
<td>Returns N top matches</td>
<td>5</td>
</tr>
<tr>
<td>max_edits</td>
<td>Keeps only dictionary words with a Levenshtein distance less than or equal to N</td>
<td>4</td>
</tr>
<tr>
<td>result_stats</td>
<td>Provides Levenshtein distance and document count of the found words</td>
<td>1 (enabled)</td>
</tr>
<tr>
<td>delta_len</td>
<td>Keeps only dictionary words with a length difference less than N</td>
<td>3</td>
</tr>
<tr>
<td>max_matches</td>
<td>Number of matches to keep</td>
<td>25</td>
</tr>
<tr>
<td>reject</td>
<td>Rejected words are matches that are not better than those already in the match queue. They are put in a rejected queue that gets reset in case one actually can go in the match queue. This parameter defines the size of the rejected queue (as reject*max(max_matched,limit)). If the rejected queue is filled, the engine stops looking for potential matches</td>
<td>4</td>
</tr>
<tr>
<td>result_line</td>
<td>alternate mode to display the data by returning all suggests, distances and docs each per one row</td>
<td>0</td>
</tr>
<tr>
<td>non_char</td>
<td>do not skip dictionary words with non alphabet symbols</td>
<td>0 (skip such words)</td>
</tr>
<tr>
<td>sentence</td>
<td>Returns the original sentence along with the last word replaced by the matched one.</td>
<td>0 (do not return the full sentence)</td>
</tr>
</tbody>
</table>
<p>To show how it works, let's create a table and add a few documents to it.</p>
<div class="codehilite"><pre><span></span><code><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">products</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="nb">text</span><span class="p">)</span><span class="w"> </span><span class="n">min_infix_len</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">;</span>
<span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;Crossbody Bag with Tassel&#39;</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;microfiber sheet set&#39;</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;Pet Hair Remover Glove&#39;</span><span class="p">);</span>
</code></pre></div>

<!-- example single -->

<div class='item-select'>
Single word example
</div>
<p>As you can see, the mistyped word "crossb<strong>U</strong>dy" gets corrected to "crossbody". By default, <code>CALL SUGGEST/QSUGGEST</code> return:</p>
<ul>
<li><code>distance</code> - the Levenshtein distance which means how many edits they had to make to convert the given word to the suggestion</li>
<li><code>docs</code> - number of documents containing the suggested word</li>
</ul>
<p>To disable the display of these statistics, you can use the option <code>0 as result_stats</code>.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
Example
</div>

<!-- request Example -->


<div class="codehilite"><pre><span></span><code><span class="k">call</span><span class="w"> </span><span class="n">suggest</span><span class="p">(</span><span class="s1">&#39;crossbudy&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;products&#39;</span><span class="p">);</span>
</code></pre></div>


<!-- response Example -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">-----------+----------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">suggest</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">docs</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-----------+----------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">crossbody</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-----------+----------+------+</span>
</code></pre></div>


<!-- end -->

</div>

</div>
<!-- example first -->

<div class='item-select'>
CALL SUGGEST takes only the first word
</div>
<p>If the first parameter is not a single word, but multiple, then <code>CALL SUGGEST</code> will return suggestions only for the first word.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
Example
</div>

<!-- request Example -->


<div class="codehilite"><pre><span></span><code><span class="k">call</span><span class="w"> </span><span class="n">suggest</span><span class="p">(</span><span class="s1">&#39;bagg with tasel&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;products&#39;</span><span class="p">);</span>
</code></pre></div>


<!-- response Example -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">---------+----------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">suggest</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">docs</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------+----------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">bag</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------+----------+------+</span>
</code></pre></div>


<!-- end -->

</div>

</div>
<!-- example last -->

<div class='item-select'>
CALL QSUGGEST takes only the last word
</div>
<p>If the first parameter is not a single word, but multiple, then <code>CALL SUGGEST</code> will return suggestions only for the last word.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
Example
</div>

<!-- request Example -->


<div class="codehilite"><pre><span></span><code><span class="k">CALL</span><span class="w"> </span><span class="n">QSUGGEST</span><span class="p">(</span><span class="s1">&#39;bagg with tasel&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;products&#39;</span><span class="p">);</span>
</code></pre></div>


<!-- response Example -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">---------+----------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">suggest</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">docs</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------+----------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">tassel</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">---------+----------+------+</span>
</code></pre></div>


<!-- end -->

</div>

</div>

<!-- example last2 -->

<p>Adding <code>1 as sentence</code> makes <code>CALL QSUGGEST</code> return the entire sentence with the last word corrected.</p>
<!-- request Example -->

<div class="codehilite"><pre><span></span><code><span class="k">CALL</span><span class="w"> </span><span class="n">QSUGGEST</span><span class="p">(</span><span class="s1">&#39;bag with tasel&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;products&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sentence</span><span class="p">);</span>
</code></pre></div>

<!-- response Example -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">-------------------+----------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">suggest</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">docs</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------------+----------+------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">bag</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">tassel</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-------------------+----------+------+</span>
</code></pre></div>

<!-- end -->

</div>
</div>
<h5 id="different-display-mode">Different display mode</h5>
<p>The <code>1 as result_line</code> option changes the way the suggestions are displayed in the output. Instead of showing each suggestion in a separate row, it displays all suggestions, distances, and docs in a single row. Here's an example to demonstrate this:</p>
<!-- intro -->
<h5 id="example">Example:</h5>
<!-- request Example -->

<div class="codehilite"><pre><span></span><code><span class="k">CALL</span><span class="w"> </span><span class="n">QSUGGEST</span><span class="p">(</span><span class="s1">&#39;bagg with tasel&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;products&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">result_line</span><span class="p">);</span>
</code></pre></div>

<!-- response Example -->

<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">----------+--------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">name</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">value</span><span class="w">  </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------+--------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">suggests</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">tassel</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">      </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">docs</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">      </span><span class="o">|</span>
<span class="o">+</span><span class="c1">----------+--------+</span>
</code></pre></div>

<!-- end -->

<h3 id="interactive-course">Interactive course</h3>
<p><a href="https://play.manticoresearch.com/didyoumean/">This interactive course</a> demonstrates online how the spell correction feature works on a web page and experiment with different examples.</p>
<p><img alt="Typical flow with Manticore and a database" class="scale-0.5" src="didyoumean.png" /></p>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.19-query_cache">
        <header>
            <a class="chapter-link" href="#toc-13.19-query_cache"> ¶ 13.19</a>

            
            <h1 id="query-cache">Query cache</h1>
            
        </header>

        
        
<p>Query cache stores compressed result sets in memory and reuses them for subsequent queries when possible. You can configure it using the following directives:</p>
<ul>
<li><a href="../20-server_settings.html#qcache_max_bytes">qcache_max_bytes</a>, a limit on the RAM usage for cached query storage. Defaults to 16 MB. Setting <code>qcache_max_bytes</code> to 0 completely disables the query cache.</li>
<li><a href="../20-server_settings.html#qcache_thresh_msec">qcache_thresh_msec</a>, the minimum wall query time to cache. Queries that complete faster than this will <em>not</em> be cached. Defaults to 3000 msec, or 3 seconds.</li>
<li><a href="../20-server_settings.html#qcache_ttl_sec">qcache_ttl_sec</a>, cached entry TTL, or time to live. Queries will stay cached for this duration. Defaults to 60 seconds, or 1 minute.</li>
</ul>
<p>These settings can be changed on the fly using the <code>SET GLOBAL</code> statement:</p>
<div class="codehilite"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">GLOBAL</span><span class="w"> </span><span class="n">qcache_max_bytes</span><span class="o">=</span><span class="mi">128000000</span><span class="p">;</span>
</code></pre></div>

<p>These changes are applied immediately, and cached result sets that no longer satisfy the constraints are immediately discarded. When reducing the cache size on the fly, MRU (most recently used) result sets win.</p>
<p>Query cache operates as follows. When enabled, every full-text search result is completely stored in memory. This occurs after full-text matching, filtering, and ranking, so essentially we store <code>total_found</code> {docid,weight} pairs. Compressed matches can consume anywhere from 2 bytes to 12 bytes per match on average, mostly depending on the deltas between subsequent docids. Once the query is complete, we check the wall time and size thresholds, and either save the compressed result set for reuse or discard it.</p>
<p>Note that the query cache's impact on RAM is not limited by<code>qcache_max_bytes</code>! If you run, for example, 10 concurrent queries, each matching up to 1M matches (after filters), then the peak temporary RAM usage will be in the range of 40 MB to 240 MB, even if the queries are fast enough and don't get cached.</p>
<p>Queries can use cache when the table, full-text query (i.e.,<code>MATCH()</code> contents), and ranker all match, and filters are compatible. This means:</p>
<ul>
<li>The full-text part within <code>MATCH()</code> must be a bytewise match. Add a single extra space, and it's now a different query as far as the query cache is concerned.</li>
<li>The ranker (and its parameters, if any, for user-defined rankers) must be a bytewise match.</li>
<li>The filters must be a superset of the original filters. You can add extra filters and still hit the cache. (In this case, the extra filters will be applied to the cached result.) But if you remove one, that will be a new query again.</li>
</ul>
<p>Cache entries expire with TTL and also get invalidated on table rotation, or on  <code>TRUNCATE</code>, or on <code>ATTACH</code>.  Note that currently, entries are not invalidated on arbitrary RT table writes! So a cached query might return older results for the duration of its TTL.</p>
<p>You can inspect the current cache status with <a href="../19-node_info_and_management.html#show-status">SHOW STATUS</a> through the <code>qcache_XXX</code> variables:</p>
<div class="codehilite"><pre><span></span><code><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">SHOW</span><span class="w"> </span><span class="n">STATUS</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;qcache%&#39;</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-----------------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Counter</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">Value</span><span class="w">    </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-----------------------+----------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">qcache_max_bytes</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">16777216</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">qcache_thresh_msec</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">3000</span><span class="w">     </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">qcache_ttl_sec</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">60</span><span class="w">       </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">qcache_cached_queries</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="w">        </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">qcache_used_bytes</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="w">        </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">qcache_hits</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="w">        </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-----------------------+----------+</span>
<span class="mi">6</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>

<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.20-collations">
        <header>
            <a class="chapter-link" href="#toc-13.20-collations"> ¶ 13.20</a>

            
            <h1 id="collations">Collations</h1>
            
        </header>

        
        
<p>Collations primarily impact string attribute comparisons. They define both the character set encoding and the strategy Manticore employs for comparing strings when performing <code>ORDER BY</code> or <code>GROUP BY</code> with a string attribute involved.</p>
<p>String attributes are stored as-is during indexing, and no character set or language information is attached to them. This is fine as long as Manticore only needs to store and return the strings to the calling application verbatim. However, when you ask Manticore to sort by a string value, the request immediately becomes ambiguous.</p>
<p>First, single-byte (ASCII, ISO-8859-1, or Windows-1251) strings need to be processed differently than UTF-8 strings, which may encode each character with a variable number of bytes. Thus, we need to know the character set type to properly interpret the raw bytes as meaningful characters.</p>
<p>Second, we also need to know the language-specific string sorting rules. For example, when sorting according to US rules in the en_US locale, the accented character <code>ï</code> (small letter <code>i</code> with diaeresis) should be placed somewhere after <code>z</code>. However, when sorting with French rules and the fr_FR locale in mind, it should be placed between <code>i</code> and <code>j</code>. Some other set of rules might choose to ignore accents altogether, allowing <code>ï</code> and <code>i</code> to be mixed arbitrarily.</p>
<p>Third, in some cases, we may require case-sensitive sorting, while in others, case-insensitive sorting is needed.</p>
<p>Collations encapsulate all of the following: the character set, the language rules, and the case sensitivity. Manticore currently provides four collations:</p>
<ol>
<li><code>libc_ci</code></li>
<li><code>libc_cs</code></li>
<li><code>utf8_general_ci</code></li>
<li><code>binary</code></li>
</ol>
<p>The first two collations rely on several standard C library (libc) calls and can thus support any locale installed on your system. They provide case-insensitive (<code>_ci</code>) and case-sensitive (<code>_cs</code>) comparisons, respectively. By default, they use the C locale, effectively resorting to bytewise comparisons. To change that, you need to specify a different available locale using the <a href="../20-server_settings.html#collation_libc_locale">collation_libc_locale</a> directive. The list of locales available on your system can usually be obtained with the <code>locale</code> command:</p>
<div class="codehilite"><pre><span></span><code>$<span class="w"> </span>locale<span class="w"> </span>-a
C
en_AG
en_AU.utf8
en_BW.utf8
en_CA.utf8
en_DK.utf8
en_GB.utf8
en_HK.utf8
en_IE.utf8
en_IN
en_NG
en_NZ.utf8
en_PH.utf8
en_SG.utf8
en_US.utf8
en_ZA.utf8
en_ZW.utf8
es_ES
fr_FR
POSIX
ru_RU.utf8
ru_UA.utf8
</code></pre></div>

<p>The specific list of system locales may vary. Consult your OS documentation to install additional needed locales.</p>
<p><code>utf8_general_ci</code> and <code>binary</code> locales are built-in into Manticore. The first one is a generic collation for UTF-8 data (without any so-called language tailoring); it should behave similarly to the <code>utf8_general_ci</code> collation in MySQL. The second one is a simple bytewise comparison.</p>
<p>Collation can be overridden via SQL on a per-session basis using the <code>SET collation_connection</code> statement. All subsequent SQL queries will use this collation. Otherwise, all queries will use the server default collation or as specified in the <a href="../20-server_settings.html#collation_server">collation_server</a> configuration directive. Manticore currently defaults to the <code>libc_ci</code> collation.</p>
<p>Collations affect all string attribute comparisons, including those within <code>ORDER BY</code> and <code>GROUP BY</code>, so differently ordered or grouped results can be returned depending on the collation chosen. Note that collations don't affect full-text searching; for that, use the <a href="../06-creating_a_table.html#charset_table">charset_table</a>.</p>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.21-cost-based_optimizer">
        <header>
            <a class="chapter-link" href="#toc-13.21-cost-based_optimizer"> ¶ 13.21</a>

            
            <h1 id="cost-based-optimizer">Cost-based optimizer</h1>
            
        </header>

        
        
<p>When Manticore executes a fullscan query, it can either use a plain scan to check every document against the filters or employ additional data and/or algorithms to speed up query execution. Manticore uses a cost-based optimizer (CBO), also known as a "query optimizer" to determine which approach to take.</p>
<p>The CBO can also enhance the performance of full-text queries. See below for more details.</p>
<p>The CBO may decide to replace one or more query filters with one of the following entities if it determines that doing so will improve performance:</p>
<ol>
<li>A <strong>docid index</strong> utilizes a special docid-only secondary index stored in files with the <code>.spt</code> extension. Besides improving filters on document IDs, the docid index is also used to accelerate document ID to row ID lookups and to speed up the application of large killlists during daemon startup.</li>
<li>A <strong>columnar scan</strong> relies on columnar storage and can only be used on a columnar attribute. It scans every value and tests it against the filter, but it is heavily optimized and is typically faster than the default approach.</li>
<li><strong>Secondary indexes</strong> are generated for all attributes by default. They use the <a href="https://pgm.di.unipi.it/">PGM index</a> along with Manticore's built-in inverted index to retrieve the list of row IDs corresponding to a value or range of values. Secondary indexes are stored in files with the <code>.spidx</code> extension.</li>
</ol>
<p>The optimizer estimates the cost of each execution path using various attribute statistics, including:</p>
<ol>
<li>Information on the data distribution within an attribute (histograms, stored in <code>.sphi</code> files). Histograms are generated automatically when data is indexed and serve as the primary source of information for the CBO.</li>
<li>Information from PGM (secondary indexes), which helps estimate the number of document lists to read. This assists in gauging doclist merge performance and in selecting the appropriate merge algorithm (priority queue merge or bitmap merge).</li>
<li>Columnar encoding statistics, employed to estimate columnar data decompression performance.</li>
<li>A columnar min-max tree. While the CBO uses histograms to estimate the number of documents left after applying the filter, it also needs to determine how many documents the filter had to process. For columnar attributes, partial evaluation of the min-max tree serves this purpose.</li>
<li>Full-text dictionary. The CBO utilizes term stats to estimate the cost of evaluating the full-text tree.</li>
</ol>
<p>The optimizer computes the execution cost for every filter used in a query. Since certain filters can be replaced with several different entities (e.g., for a document id, Manticore can use a plain scan, a docid index lookup, a columnar scan (if the document id is columnar), and a secondary index), the optimizer evaluates all available combinations. However, there is a maximum limit of 1024 combinations.</p>
<p>To estimate query execution costs, the optimizer calculates the estimated costs of the most significant operations performed when executing the query. It uses preset constants to represent the cost of each operation.</p>
<p>The optimizer compares the costs of each execution path and chooses the path with the lowest cost to execute the query.</p>
<p>When working with full-text queries that have filters by attributes, the query optimizer decides between two possible execution paths. One is to execute the full-text query, retrieve the matches, and use filters. The other is to replace filters with one or more entities described above, fetch rowids from them, and inject them into the full-text matching tree. This way, full-text search results will intersect with full-scan results. The query optimizer estimates the cost of full-text tree evaluation and the best possible path for computing filter results. Using this information, the optimizer chooses the execution path.</p>
<p>Another factor to consider is multithreaded query execution (when <code>pseudo_sharding</code> is enabled). The CBO is aware that some queries can be executed in multiple threads and takes this into account. The CBO prioritizes shorter query execution times (i.e., latency) over throughput. For instance, if a query using a columnar scan can be executed in multiple threads (and occupy multiple CPU cores) and is faster than a query executed in a single thread using secondary indexes, multithreaded execution will be preferred.</p>
<p>Queries using secondary indexes and docid indexes always run in a single thread, as benchmarks indicate that there is little to no benefit in making them multithreaded.</p>
<p>At present, the optimizer only uses CPU costs and does not take memory or disk usage into account.</p>
<!-- proofread -->
        
    </section>
    
    <section class="chapter-section" id="toc-13.22-k-nearest_neighbor_vector_search">
        <header>
            <a class="chapter-link" href="#toc-13.22-k-nearest_neighbor_vector_search"> ¶ 13.22</a>

            
            <h1 id="k-nearest-neighbor-vector-search">K-nearest neighbor vector search</h1>
            
        </header>

        
        
<p>Manticore Search supports the ability to add embeddings generated by your Machine Learning models to each document, and then doing a nearest-neighbor search on them. This lets you build features like similarity search, recommendations, semantic search, and relevance ranking based on NLP algorithms, among others, including image, video, and sound searches.</p>
<h2 id="what-is-an-embedding">What is an embedding?</h2>
<p>An embedding is a method of representing data—such as text, images, or sound—as vectors in a high-dimensional space. These vectors are crafted to ensure that the distance between them reflects the similarity of the data they represent. This process typically employs algorithms like word embeddings (e.g., Word2Vec, BERT) for text or neural networks for images. The high-dimensional nature of the vector space, with many components per vector, allows for the representation of complex and nuanced relationships between items. Their similarity is gauged by the distance between these vectors, often measured using methods like Euclidean distance or cosine similarity.</p>
<p>Manticore Search enables k-nearest neighbor (KNN) vector searches using the HNSW library. This functionality is part of the <a href="https://github.com/manticoresoftware/columnar">Manticore Columnar Library</a>.</p>
<!-- example KNN -->

<h3 id="configuring-a-table-for-knn-search">Configuring a table for KNN search</h3>
<p>To run KNN searches, you must first configure your table. It needs to have at least one float_vector attribute, which serves as a data vector. You need to specify the following properties:</p>
<ul>
<li><code>knn_type</code>: A mandatory setting; currently, only <code>hnsw</code> is supported.</li>
<li><code>knn_dims</code>: A mandatory setting that specifies the dimensions of the vectors being indexed.</li>
<li><code>hnsw_similarity</code>: A mandatory setting that specifies the distance function used by the HNSW index. Acceptable values are:</li>
<li><code>L2</code> - Squared L2</li>
<li><code>IP</code> - Inner product</li>
<li>
<p><code>COSINE</code> - Cosine similarity</p>
</li>
<li>
<p><code>hnsw_m</code>: An optional setting that defines the maximum number of outgoing connections in the graph. The default is 16.</p>
</li>
<li><code>hnsw_ef_construction</code>: An optional setting that defines a construction time/accuracy trade-off.</li>
</ul>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span><span class="w"> </span><span class="n">image_vector</span><span class="w"> </span><span class="n">float_vector</span><span class="w"> </span><span class="n">knn_type</span><span class="o">=</span><span class="s1">&#39;hnsw&#39;</span><span class="w"> </span><span class="n">knn_dims</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="w"> </span><span class="n">hnsw_similarity</span><span class="o">=</span><span class="s1">&#39;l2&#39;</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>


<!-- response -->


<div class="codehilite"><pre><span></span><code><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>


<!-- end -->

</div>

</div>

<!-- example knn_insert -->

<h3 id="inserting-vector-data">Inserting vector data</h3>
<p>After creating the table, you need to insert your vector data, ensuring it matches the dimensions you specified when creating the table.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;yellow bag&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">653448</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mi">192478</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mi">017971</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mi">339821</span><span class="p">)</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;white bag&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">148894</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mi">748278</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mi">091892</span><span class="p">,</span><span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">095406</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>


<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="n">Query</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/i</span><span class="kc">nsert</span>
<span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test_vec&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;title&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;yellow bag&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;image_vector&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">0.653448</span><span class="p">,</span><span class="mf">0.192478</span><span class="p">,</span><span class="mf">0.017971</span><span class="p">,</span><span class="mf">0.339821</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="err">POST</span><span class="w"> </span><span class="err">/i</span><span class="kc">nsert</span>
<span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="s2">&quot;test_vec&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;doc&quot;</span><span class="p">:</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;title&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;white bag&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;image_vector&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">-0.148894</span><span class="p">,</span><span class="mf">0.748278</span><span class="p">,</span><span class="mf">0.091892</span><span class="p">,</span><span class="mf">-0.095406</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;created&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="s2">&quot;created&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="mi">201</span>
<span class="p">}</span>

<span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;_index&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;created&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="s2">&quot;created&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="mi">201</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example knn_search -->

<h3 id="knn-vector-search">KNN vector search</h3>
<p>Now, you can perform a KNN search using the <code>knn</code> clause in either SQL or JSON format. Both interfaces support the same essential parameters, ensuring a consistent experience regardless of the format you choose:</p>
<ul>
<li>SQL: <code>select ... from &lt;table name&gt; where knn ( &lt;field&gt;, &lt;k&gt;, &lt;query vector&gt; [,&lt;ef&gt;] )</code></li>
<li>JSON:<br />
<code>POST /search
  {
      "index": "&lt;table name&gt;",
      "knn":
      {
          "field": "&lt;field&gt;",
          "query_vector": [&lt;query vector&gt;],
          "k": &lt;k&gt;,
          "ef": &lt;ef&gt;
      }
  }</code></li>
</ul>
<p>The parameters are:</p>
<ul>
<li><code>field</code>: This is the name of the float vector attribute containing vector data.</li>
<li><code>k</code>: This represents the number of documents to return and is a key parameter for Hierarchical Navigable Small World (HNSW) indexes. It specifies the quantity of documents that a single HNSW index should return. However, the actual number of documents included in the final results may vary. For instance, if the system is dealing with real-time tables divided into disk chunks, each chunk could return <code>k</code> documents, leading to a total that exceeds the specified <code>k</code> (as the cumulative count would be <code>num_chunks * k</code>). On the other hand, the final document count might be less than <code>k</code> if, after requesting <code>k</code> documents, some are filtered out based on specific attributes. It's important to note that the parameter <code>k</code> does not apply to ramchunks. In the context of ramchunks, the retrieval process operates differently, and thus, the <code>k</code> parameter's effect on the number of documents returned is not applicable.</li>
<li><code>query_vector</code>: This is the search vector.</li>
<li><code>ef</code>: optional size of the dynamic list used during the search. A higher <code>ef</code> leads to more accurate but slower search.</li>
</ul>
<p>Documents are always sorted by their distance to the search vector. Any additional sorting criteria you specify will be applied after this primary sort condition. For retrieving the distance, there is a built-in function called <a href="../15-functions.html#knn_dist">knn_dist()</a>.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">knn_dist</span><span class="p">()</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">knn</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">image_vector</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">286569</span><span class="p">,</span><span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">031816</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mi">066684</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mi">032926</span><span class="p">),</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>


<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">------+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">knn_dist</span><span class="p">()</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">28146550</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">81527930</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------------+</span>
<span class="mi">2</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;knn&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;image_vector&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;query_vector&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">0.286569</span><span class="p">,</span><span class="mf">-0.031816</span><span class="p">,</span><span class="mf">0.066684</span><span class="p">,</span><span class="mf">0.032926</span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;k&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;ef&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2000</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;total_relation&quot;</span><span class="p">:</span><span class="s2">&quot;eq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;_knn_dist&quot;</span><span class="p">:</span><span class="mf">0.28146550</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;yellow bag&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;image_vector&quot;</span><span class="p">:[</span><span class="mf">0.653448</span><span class="p">,</span><span class="mf">0.192478</span><span class="p">,</span><span class="mf">0.017971</span><span class="p">,</span><span class="mf">0.339821</span><span class="p">]</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="s2">&quot;2&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;_knn_dist&quot;</span><span class="p">:</span><span class="mf">0.81527930</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;white bag&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;image_vector&quot;</span><span class="p">:[</span><span class="mf">-0.148894</span><span class="p">,</span><span class="mf">0.748278</span><span class="p">,</span><span class="mf">0.091892</span><span class="p">,</span><span class="mf">-0.095406</span><span class="p">]</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example knn_similar_docs -->

<h3 id="find-similar-docs-by-id">Find similar docs by id</h3>
<p>Finding documents similar to a specific one based on its unique ID is a common task. For instance, when a user views a particular item, Manticore Search can efficiently identify and display a list of items that are most similar to it in the vector space. Here's how you can do it:</p>
<ul>
<li>SQL: <code>select ... from &lt;table name&gt; where knn ( &lt;field&gt;, &lt;k&gt;, &lt;document id&gt; )</code></li>
<li>JSON:<br />
<code>POST /search
  {
      "index": "&lt;table name&gt;",
      "knn":
      {
          "field": "&lt;field&gt;",
          "doc_id": &lt;document id&gt;,
          "k": &lt;k&gt;
      }
  }</code></li>
</ul>
<p>The parameters are:</p>
<ul>
<li><code>field</code>: This is the name of the float vector attribute containing vector data.</li>
<li><code>k</code>: This represents the number of documents to return and is a key parameter for Hierarchical Navigable Small World (HNSW) indexes. It specifies the quantity of documents that a single HNSW index should return. However, the actual number of documents included in the final results may vary. For instance, if the system is dealing with real-time tables divided into disk chunks, each chunk could return <code>k</code> documents, leading to a total that exceeds the specified <code>k</code> (as the cumulative count would be <code>num_chunks * k</code>). On the other hand, the final document count might be less than <code>k</code> if, after requesting <code>k</code> documents, some are filtered out based on specific attributes. It's important to note that the parameter <code>k</code> does not apply to ramchunks. In the context of ramchunks, the retrieval process operates differently, and thus, the <code>k</code> parameter's effect on the number of documents returned is not applicable.</li>
<li><code>document id</code>: Document ID for KNN similarity search.</li>
</ul>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">knn_dist</span><span class="p">()</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">knn</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">image_vector</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>


<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">------+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">knn_dist</span><span class="p">()</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">81527930</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;knn&quot;</span><span class="p">:</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;image_vector&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;doc_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;k&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;total_relation&quot;</span><span class="p">:</span><span class="s2">&quot;eq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="s2">&quot;2&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="mi">1643</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;_knn_dist&quot;</span><span class="p">:</span><span class="mf">0.81527930</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;white bag&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;image_vector&quot;</span><span class="p">:[</span><span class="mf">-0.148894</span><span class="p">,</span><span class="mf">0.748278</span><span class="p">,</span><span class="mf">0.091892</span><span class="p">,</span><span class="mf">-0.095406</span><span class="p">]</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- example knn_filtering -->

<h3 id="filtering-knn-vector-search-results">Filtering KNN vector search results</h3>
<p>Manticore also supports additional filtering of documents returned by the KNN search, either by full-text matching, attribute filters, or both.</p>
<!-- intro -->

<div class='xcodeblock'>

<div class='xcodeblock-item'>

<div class='item-select'>
SQL
</div>

<!-- request SQL -->


<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">knn_dist</span><span class="p">()</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">knn</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">image_vector</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">286569</span><span class="p">,</span><span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">031816</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mi">066684</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mi">032926</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">match</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</code></pre></div>


<!-- response SQL -->


<div class="codehilite"><pre><span></span><code><span class="o">+</span><span class="c1">------+------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">knn_dist</span><span class="p">()</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------------+</span>
<span class="o">|</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">81527930</span><span class="w"> </span><span class="o">|</span>
<span class="o">+</span><span class="c1">------+------------+</span>
<span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span><span class="w"> </span><span class="n">sec</span><span class="p">)</span>
</code></pre></div>



<!-- intro -->

</div>

<div class='xcodeblock-item'>

<div class='item-select'>
JSON
</div>

<!-- request JSON -->


<div class="codehilite"><pre><span></span><code><span class="err">POST</span><span class="w"> </span><span class="err">/search</span>
<span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;knn&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;image_vector&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;query_vector&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">0.286569</span><span class="p">,</span><span class="mf">-0.031816</span><span class="p">,</span><span class="mf">0.066684</span><span class="p">,</span><span class="mf">0.032926</span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;k&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;filter&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;bool&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;must&quot;</span><span class="p">:</span>
<span class="w">                </span><span class="p">[</span>
<span class="w">                    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;match&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;_all&quot;</span><span class="p">:</span><span class="s2">&quot;white&quot;</span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
<span class="w">                    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;range&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;lt&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- response JSON -->


<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;took&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;timed_out&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;total_relation&quot;</span><span class="p">:</span><span class="s2">&quot;eq&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;hits&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;_id&quot;</span><span class="p">:</span><span class="s2">&quot;2&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;_score&quot;</span><span class="p">:</span><span class="mi">1643</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;_knn_dist&quot;</span><span class="p">:</span><span class="mf">0.81527930</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;_source&quot;</span><span class="p">:</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;white bag&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nt">&quot;image_vector&quot;</span><span class="p">:[</span><span class="mf">-0.148894</span><span class="p">,</span><span class="mf">0.748278</span><span class="p">,</span><span class="mf">0.091892</span><span class="p">,</span><span class="mf">-0.095406</span><span class="p">]</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>



<!-- end -->

</div>

</div>

<!-- proofread -->
        
    </section>
    

    <script>
        const hide = (el) => el.style.display = 'none';
        const show = (el) => el.style.display = '';

        function gen(html) {
            const template = document.createElement('template');
            template.innerHTML = html.trim();
            return template.content;
        }

        function processCodeBlock(block) {
            block.append(gen(`<div class="selectors"></div><div class="codes"></div>`));

            let selectors = block.querySelector(".selectors");
            let codes = block.querySelector(".codes");

            function hideAllCodes() {
                for (let i = 0; i < codes.children.length; i++) {
                    hide(codes.children[i]);
                }
            }

            function clearSelection() {
                for (let i = 0; i < selectors.children.length; i++) {
                    selectors.children[i].classList.remove('selected');
                }
            }

            let items = block.querySelectorAll('.xcodeblock-item');
            for (let i = 0; i < items.length; i++) {
                let lang = items[i];

                lang.remove();

                let sel = lang.querySelector('.item-select');
                let code = lang.querySelector('.codehilite');

                if (!sel || !code) {
                    continue
                }

                sel.remove();
                code.remove();

                selectors.append(sel);
                codes.append(code);

                if (i == 0) {
                    sel.classList.add('selected');
                } else {
                    hide(code);
                }

                sel.addEventListener('click', () => {
                    hideAllCodes();
                    clearSelection();
                    show(code);
                    sel.classList.add('selected');
                });
            }
        }

        let codeBlocks = document.querySelectorAll('.xcodeblock');
        for (let i = 0; i < codeBlocks.length; i++) {
            processCodeBlock(codeBlocks[i]);
        }
    </script>
</body>
</html>